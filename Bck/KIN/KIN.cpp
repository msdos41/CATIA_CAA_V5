// COPYRIGHT Dassault Systemes 2013
//===================================================================
//
// TestCmd.cpp
// The state chart based command: TestCmd
//
//===================================================================
//
// Usage notes:
//
//===================================================================
//
//  May 2013  Creation: Code generated by the CAA wizard  Administrator
//===================================================================
#include "TestCmd.h"
#include "CATIndicationAgent.h"
#include "CATMathPlane.h"

#include "CATCreateExternalObject.h"
CATCreateClass( TestCmd);



#include "iostream.h"
#include "CATLISTV_CATISpecObject.h"
#include "CATLISTV_CATMathPoint.h"
//#include "CATCollec.h"
//MecModInterfaces
#include "CATIFeaturize.h"
#include "CATIPrtPart.h"
#include "CATIMechanicalRootFactory.h"
#include "CATMfErrUpdate.h"

//ObjectSpecsModeler
#include "CATIDescendants.h"
//#include "CATMeasModeOfCalc.h"
//GSMInterfaces
#include "CATIGSMFactory.h"
#include "CATIGSMProject.h"
#include "CATIGSMProceduralView.h"

//ObjectModelerBase
#include "CATILinkableObject.h"
#include "CATInit.h"
#include "CATDocument.h"

//ApplicationFrame
#include "CATApplicationFrame.h"
#include "CAT2DImagePixelRep.h"
#include "CATPixelImage.h"

#include"iomanip.h"

#include "CATIMfBRep.h"
#include "CATPoint.h"
#include "CATVertex.h"
#include "CATICkeParmFactory.h"
#include "CATICkeParm.h"
#include "CATIGSMPointCoord.h"
#include "CATBoolean.h"
#include "CATTopDefine.h"
#include "CATCrvParam.h"
#include "CATPointOnEdgeCurve.h"
#include "CATIBRepAccess.h"
#include "CATMfBRepDecode.h"
#include "CATIGSMExtractSolide.h"
#include "CATMathConstant.h"
#include "CATListOfCATCells.h"
#include "CATIGSMAssemble.h"
#include "CATIVisProperties.h"
#include "CATIMeasurableInContext.h"
#include "CATIParmDictionary.h"
#include "CATCkeGlobalFunctions.h"
#include "CATIGSMOffset.h"
#include "CATIInstance.h"
#include "CATISpecAttrKey.h"
#include "CATIGSMCurvePar.h"
#include "CATSurParam.h"
#include "CATSurface.h"
#include "CATIDocRoots.h"

#include "CATAsmConnectorServices.h"
#include "CATIKinMechanismFactory.h"
#include "CATKinDefs.h"
#include "CATIKinCmd.h"
#include "CATIKinJoint.h"
#include "CATIModelEvents.h"
#include "LifeCycleObject.h"
#include "CATCstDefs.h"
#include "CATICst.h"
#include "CATIMeasurablePlane.h"
#include "CATCstDefs.h"
#include "CATMathPlane.h"
#include "CATPlane.h"
#include "CATIMovable.h"
#include "CATGeometryType.h"
#include "CATAfrCommandHeaderServices.h"
#include "CATIReplayFactory.h"
#include "CATIAReplay.h"
#include "CATISweptVolumeFactory.h"
#include "CATAutoConversions.h"
#include "CATIADocument.h"
#include "CATPathElement.h"
#include <vector>
//#include "CATIAReplayWorkbench.h"
#include "CATIASimulationWorkbench.h"
#include <time.h>
#include "CATCell.h"
#ifdef _WINDOWS_
#undef _WINDOWS_
#endif
#include "afxdb.h"
#define _WINDOWS_
#include "stdafx.h"
#include "excel.h"
#include "comdef.h"
#include "CATGetEnvValue.h"
#include "CATAsmConstraintSetServices.h"
#include "SJDExcelClass.h"
#include "CATCGMContainerMngt.h"
#include "CATGeoFactory.h"
#include "CATLoop.h"
#include "CATShell.h"
#include "CATIPrtFactory.h"
#include "CATLine.h"
#include "CATRevolutionSurface.h"
#include "CATIAGroups.h"
#include "CATIADistances.h"
#include "CATMmrInterPartCopy.h"
#include "CATIDatumFactory.h"
//#include "CATISchContCutAndPaste.h"
#include "CATLISTV_CATBaseUnknown.h"
#include "CATBaseUnknown.h"
#include "CATICutAndPastable.h"
#include "CATIMechanicalFeature.h"
#include "CATModify.h"
#include "CATIRedrawEvent.h"
#include "CATIContainerOfDocument.h"
#include "CATSoftwareConfiguration.h"
#include "CATCloneManager.h"
#include "CATEdgeCurve.h"
using namespace std;

//-------------------------------------------------------------------------
// Constructor
//-------------------------------------------------------------------------
TestCmd::TestCmd() :
  CATStateCommand ("TestCmd", CATDlgEngOneShot, CATCommandModeExclusive) 
//  Valid states are CATDlgEngOneShot and CATDlgEngRepeat



,_Panel(NULL)
,_RailPanel(NULL)
,_HingePanel(NULL)
,_RotatePanel(NULL)
,_RotateHingePanel(NULL)
,_BodyPanel(NULL)
,_DoorPanel(NULL)
,_SweepPrtPanel(NULL)



,_pPanelCancelAgent(NULL)
,_pPanelCloseAgent(NULL)
,_pPanelOKAgent(NULL)
,_IsMoreWindowOpen(FALSE)
,_pRailButtonAgent(NULL)
,_pRotateButtonAgent(NULL)
,_pBodyButtonAgent(NULL)
,_pSweptButtonAgent(NULL)



,_pRotateFaceCloseAgent(NULL)
,_pSweptCloseAgent(NULL)
,_pBodyCloseAgent(NULL)
,_pDoorCloseAgent(NULL)
,_pRollingFaceCloseAgent(NULL)
,_pHingeFaceCloseAgent(NULL)

,_editor(NULL)



,_pSweptOKAgent(NULL)
,_pSweptCancleAgent(NULL)

,_pSweptelListAgent(NULL)
,_pSwepTPartAgent(NULL)
,spFixedProduct(NULL_var)

,_pRefPartAgent(NULL)
,spRefPrd(NULL_var)
,_pRefListAgent(NULL)
,spLastFeaOnRefPrd(NULL_var)
,pRefPartPathSel(NULL)


,_pMdRotateDirFaceAgent(NULL)
,_pMdRotateDirFaceAgent2(NULL)
,_pDwRotateDirFaceAgent(NULL)
,_pDwRotateDirFaceAgent2(NULL)

,_pUpRotateFaceAgent(NULL)
,_pMdRotateFaceAgent(NULL)
,_pDwRotateFaceAgent(NULL)
,_pRotateFaceOKAgent(NULL)
,_pRotateFaceCancleAgent(NULL)
,_pRotateFaceSelLis1Agent(NULL)
,_pRotateFaceSelLis2Agent(NULL)
,_pRotateFaceSelLis3Agent(NULL)
,_pRotateFaceSelLis6Agent(NULL)
,_pRotateFaceSelLis7Agent(NULL)

,_pRotateFaceSelLis4Agent(NULL)
,_pRotateFaceSelLis5Agent(NULL)
,spiUpRotateSpcSurface(NULL_var)
,spiMidRotateSpcSurface1(NULL_var)
,spiDownRotateSpcSurface2(NULL_var)
,spiDownRotateSpcSurface1(NULL_var)
,pMidRotateFacePathSel1(NULL)
,pMidRotateFacePathSel2(NULL)
,pDownRotateFacePathSel1(NULL)
,pDownRotateFacePathSel2(NULL)
,pDownBearRotateFacePathSel(NULL)
,spiMidRotateSpcSurface2(NULL_var)
,spiUpRotatCenter(NULL_var)
,piMechanism(NULL)
,pUpRotateFacePathSel(NULL)


,_pBodyAgent(NULL)
,_pBodyOKAgent(NULL)
,_pBodyCancleAgent(NULL)
,_pBodyelLis1Agent(NULL)
,_pBodySelLis2Agent(NULL)
,_pBodyPartAgent(NULL)
,spBodyPrd(NULL_var)
,spDoorPrd(NULL_var)
,_pdaClearSeat1Select(NULL)

,_pDoorAgent(NULL)
,_pDoorOKAgent(NULL)
,_pDoorCancleAgent(NULL)
,_pDoorelLis1Agent(NULL)
,_pDoorSelLis2Agent(NULL)
,_pDoorPartAgent(NULL)
,_pdaClearSeat2Select(NULL)



,_pUpRollingFaceAgent(NULL)
,_pMdRollingFaceAgent(NULL)
,_pDwRollingFaceAgent(NULL)
,_pMdBearFaceAgent(NULL)
,_pDwBearFaceAgent(NULL)
,pDownBearRollingFacePathSel(NULL)
,pMidRollingFacePathSel(NULL)

,_pRollingFaceOKAgent(NULL)
,_pRollingFaceCancleAgent(NULL)
,_pRollingFaceSelLis1Agent(NULL)
,_pRollingFaceSelLis2Agent(NULL)
,_pRollingFaceSelLis3Agent(NULL)
,_pRollingFaceSelLis4Agent(NULL)
,_pRollingFaceSelLis5Agent(NULL)
,pUpRollingFacePathSel(NULL)
,spiUpRollingSpcSurface(NULL_var)
,spiUpRollingSpcOnRail(NULL_var)
,spiMidRollingSpcSurface(NULL_var)
,piInstanceProdOnUpRollingFace(NULL)

,piInstanceProdOnDownRollingFace(NULL)
,spiDownRollingSpcSurface(NULL_var)
,spiDownRollingSpcOnRail(NULL_var)
,pDownRollingFacePathSel(NULL)

,_pHingeButtonAgent(NULL)

,_pHinge1Line1Agent(NULL)
,_pHinge1Line2Agent(NULL)
,_pHinge1Plane1Agent(NULL)
,_pHinge1Plane2Agent(NULL)

,_pHinge2Line1Agent(NULL)
,_pHinge2Line2Agent(NULL)
,_pHinge2Plane1Agent(NULL)
,_pHinge2Plane2Agent(NULL)

,_pHinge1Line1SelLisAgent(NULL)
,_pHinge1Line2SelLisAgent(NULL)
,_pHinge1Plane1SelLisAgent(NULL)
,_pHinge1Plane2SelLisAgent(NULL)

,_pHinge2Line1SelLisAgent(NULL)
,_pHinge2Line2SelLisAgent(NULL)
,_pHinge2Plane1SelLisAgent(NULL)
,_pHinge2Plane2SelLisAgent(NULL)


,spiHinge1Line1(NULL_var)
,pHinge1Line1PathSel(NULL)
,spiHinge1Plane1(NULL_var)
,spLastFeaOnHinge1Plane1(NULL_var)
,pHinge1Plane1PathSel(NULL)
,piInstanceProdOnHinge1Plane1(NULL)
,spiBRepHinge1Plane1(NULL_var)
,spiBRepHinge2Plane1(NULL_var)

,spiHinge1Line2(NULL_var)
,pHinge1Line2PathSel(NULL)
,spiHinge1Plane2(NULL_var)
,pHinge1Plane2PathSel(NULL)
,piInstanceProdOnHinge1Plane2(NULL)
,spLastFeaOnHinge1Plane2(NULL_var)

,spiHinge2Line1(NULL_var)
,pHinge2Line1PathSel(NULL)
,spiHinge2Plane1(NULL_var)
,pHinge2Plane1PathSel(NULL)
,piInstanceProdOnHinge2Plane1(NULL)
,spLastFeaOnHinge2Plane1(NULL_var)

,spiHinge2Line2(NULL_var)
,pHinge2Line2PathSel(NULL)
,spiHinge2Plane2(NULL_var)
,pHinge2Plane2PathSel(NULL)
,piInstanceProdOnHinge2Plane2(NULL)
,spLastFeaOnHinge2Plane2(NULL_var)


,_pHingeFaceOKAgent(NULL)
,_pHingeFaceCancleAgent(NULL)

,_pImageRep(NULL)

{
	cout<<"cmd构造"<<endl;

	//CATString strWorkbenchName;
	//CATApplicationFrame *appFrame = CATApplicationFrame::GetFrame();
	//strWorkbenchName=appFrame->GetCurrentWorkbench();
	//cout<<"# The Current Activiated Workbench is: "<<strWorkbenchName.CastToCharPtr()<<endl;

	//if (strWorkbenchName!="DMUKinematics")
	//{
	//	RDCDMUBFErrorMsgBox("请先进入运动机构模块！");
	//	cout<<"3"<<endl;
	//	this->RequestDelayedDestruction();
	//	cout<<"4"<<endl;
	//	return;
	//}

cout<<"5"<<endl;




	_Panel=new TestDlg();//-------------------pan
	_Panel->Build();
	_Panel->SetVisibility(CATDlgShow);//初始化对

	_RailPanel=new RailDlg();
	_RailPanel->Build();
	_RailPanel->SetVisibility(CATDlgHide);

	_HingePanel=new HingeDlg();
	_HingePanel->Build();
	_HingePanel->SetVisibility(CATDlgHide);

	_RotatePanel=new RotateDlg();
	_RotatePanel->Build();
	_RotatePanel->SetVisibility(CATDlgHide);

	_RotateHingePanel=new RotateHingeDlg();
	_RotateHingePanel->Build();
	_RotateHingePanel->SetVisibility(CATDlgHide);

	_BodyPanel=new BodyDlg();
	_BodyPanel->Build();
	_BodyPanel->SetVisibility(CATDlgHide);

	_DoorPanel=new DoorDlg();
	_DoorPanel->Build();
	_DoorPanel->SetVisibility(CATDlgHide);

	_SweepPrtPanel=new SweepPrtDlg();
	_SweepPrtPanel->Build();
	_SweepPrtPanel->SetVisibility(CATDlgHide);

	_editor = CATFrmEditor::GetCurrentEditor();//

	if ( NULL != _editor )
	{		
		_HSO = _editor->GetHSO();
	}
	else
		cout<<"没有得到editor"<<endl;

	_pSMCSpotWeldMethod = new SMCSpotWeldMethod();
	_pSMCSpotWeldMethod->RecordUseInfo("BIW","Sliding door");



}

//-----------------
// Destructor
//-----------------
TestCmd::~TestCmd()
{

	cout<<"执行析构函数"<<endl;

	if (_pHingeFaceCloseAgent!=NULL)
	{
		_pHingeFaceCloseAgent->RequestDelayedDestruction();
		_pHingeFaceCloseAgent=NULL;
	}
	if (_pRotateFaceCloseAgent!=NULL)
	{
		_pRotateFaceCloseAgent->RequestDelayedDestruction();
		_pRotateFaceCloseAgent=NULL;
	}
	if (_pSweptCloseAgent!=NULL)
	{
		_pSweptCloseAgent->RequestDelayedDestruction();
		_pSweptCloseAgent=NULL;
	}
	if (_pBodyCloseAgent!=NULL)
	{
		_pBodyCloseAgent->RequestDelayedDestruction();
		_pBodyCloseAgent=NULL;
	}
	if (_pDoorCloseAgent!=NULL)
	{
		_pDoorCloseAgent->RequestDelayedDestruction();
		_pDoorCloseAgent=NULL;
	}
	if (_pRollingFaceCloseAgent!=NULL)
	{
		_pRollingFaceCloseAgent->RequestDelayedDestruction();
		_pRollingFaceCloseAgent=NULL;
	}




	cout<<"1"<<endl;






	if (_pPanelCancelAgent!=NULL)
	{
		_pPanelCancelAgent->RequestDelayedDestruction();
		_pPanelCancelAgent=NULL;
	}
	if (_pPanelCloseAgent!=NULL)
	{
		_pPanelCloseAgent->RequestDelayedDestruction();
		_pPanelCloseAgent=NULL;
	}
	if (_pSweptCloseAgent!=NULL)
	{
		_pSweptCloseAgent->RequestDelayedDestruction();
		_pSweptCloseAgent=NULL;
	}
	if (_pPanelOKAgent!=NULL)
	{
		_pPanelOKAgent->RequestDelayedDestruction();
		_pPanelOKAgent=NULL;
	}


	if (_pRotateButtonAgent!=NULL)
	{
		_pRotateButtonAgent->RequestDelayedDestruction();
		_pRotateButtonAgent=NULL;
	}
	if (_pBodyButtonAgent!=NULL)
	{
		_pBodyButtonAgent->RequestDelayedDestruction();
		_pBodyButtonAgent=NULL;
	}
	if (_pRotateFaceOKAgent!=NULL)
	{
		_pRotateFaceOKAgent->RequestDelayedDestruction();
		_pRotateFaceOKAgent=NULL;
	}
	if (_pRotateFaceCancleAgent!=NULL)
	{
		_pRotateFaceCancleAgent->RequestDelayedDestruction();
		_pRotateFaceCancleAgent=NULL;
	}
	if (_pUpRotateFaceAgent!=NULL)
	{
		_pUpRotateFaceAgent->RequestDelayedDestruction();
		_pUpRotateFaceAgent=NULL;
	}
	if (_pMdRotateFaceAgent!=NULL)
	{
		_pMdRotateFaceAgent->RequestDelayedDestruction();
		_pMdRotateFaceAgent=NULL;
	}
	if (_pDwRotateFaceAgent!=NULL)
	{
		_pDwRotateFaceAgent->RequestDelayedDestruction();
		_pDwRotateFaceAgent=NULL;
	}

	if (_pRotateFaceSelLis1Agent!=NULL)
	{
		_pRotateFaceSelLis1Agent->RequestDelayedDestruction();
		_pRotateFaceSelLis1Agent=NULL;
	}
	if (_pRotateFaceSelLis2Agent!=NULL)
	{
		_pRotateFaceSelLis2Agent->RequestDelayedDestruction();
		_pRotateFaceSelLis2Agent=NULL;
	}
	if (_pRotateFaceSelLis3Agent!=NULL)
	{
		_pRotateFaceSelLis3Agent->RequestDelayedDestruction();
		_pRotateFaceSelLis3Agent=NULL;
	}
	if (_pRotateFaceSelLis6Agent!=NULL)
	{
		_pRotateFaceSelLis6Agent->RequestDelayedDestruction();
		_pRotateFaceSelLis6Agent=NULL;
	}
	if (_pRotateFaceSelLis7Agent!=NULL)
	{
		_pRotateFaceSelLis7Agent->RequestDelayedDestruction();
		_pRotateFaceSelLis7Agent=NULL;
	}
	if (_pRotateFaceSelLis4Agent!=NULL)
	{
		_pRotateFaceSelLis4Agent->RequestDelayedDestruction();
		_pRotateFaceSelLis4Agent=NULL;
	}

	if (_pRotateFaceSelLis5Agent!=NULL)
	{
		_pRotateFaceSelLis5Agent->RequestDelayedDestruction();
		_pRotateFaceSelLis5Agent=NULL;
	}

	if (_pMdRotateDirFaceAgent!=NULL)
	{
		_pMdRotateDirFaceAgent->RequestDelayedDestruction();
		_pMdRotateDirFaceAgent=NULL;
	}
	if (_pMdRotateDirFaceAgent2!=NULL)
	{
		_pMdRotateDirFaceAgent2->RequestDelayedDestruction();
		_pMdRotateDirFaceAgent2=NULL;
	}
	if (_pDwRotateDirFaceAgent!=NULL)
	{
		_pDwRotateDirFaceAgent->RequestDelayedDestruction();
		_pDwRotateDirFaceAgent=NULL;
	}
	if (_pDwRotateDirFaceAgent2!=NULL)
	{
		_pDwRotateDirFaceAgent2->RequestDelayedDestruction();
		_pDwRotateDirFaceAgent2=NULL;
	}

	if (_pSweptButtonAgent!=NULL)
	{
		_pSweptButtonAgent->RequestDelayedDestruction();
		_pSweptButtonAgent=NULL;
	}

	cout<<"2"<<endl;





	if (_pRailButtonAgent!=NULL)
	{
		_pRailButtonAgent->RequestDelayedDestruction();
		_pRailButtonAgent=NULL;
	}
	if (_pRollingFaceOKAgent!=NULL)
	{
		_pRollingFaceOKAgent->RequestDelayedDestruction();
		_pRollingFaceOKAgent=NULL;
	}
	if (_pRollingFaceCancleAgent!=NULL)
	{
		_pRollingFaceCancleAgent->RequestDelayedDestruction();
		_pRollingFaceCancleAgent=NULL;
	}
	if (_pUpRollingFaceAgent!=NULL)
	{
		_pUpRollingFaceAgent->RequestDelayedDestruction();
		_pUpRollingFaceAgent=NULL;
	}
	if (_pMdRollingFaceAgent!=NULL)
	{
		_pMdRollingFaceAgent->RequestDelayedDestruction();
		_pMdRollingFaceAgent=NULL;
	}
	if (_pDwRollingFaceAgent!=NULL)
	{
		_pDwRollingFaceAgent->RequestDelayedDestruction();
		_pDwRollingFaceAgent=NULL;
	}
	if (_pMdBearFaceAgent!=NULL)
	{
		_pMdBearFaceAgent->RequestDelayedDestruction();
		_pMdBearFaceAgent=NULL;
	}
	if (_pDwBearFaceAgent!=NULL)
	{
		_pDwBearFaceAgent->RequestDelayedDestruction();
		_pDwBearFaceAgent=NULL;
	}
	if (_pRollingFaceSelLis1Agent!=NULL)
	{
		_pRollingFaceSelLis1Agent->RequestDelayedDestruction();
		_pRollingFaceSelLis1Agent=NULL;
	}
	if (_pRollingFaceSelLis2Agent!=NULL)
	{
		_pRollingFaceSelLis2Agent->RequestDelayedDestruction();
		_pRollingFaceSelLis2Agent=NULL;
	}
	if (_pRollingFaceSelLis3Agent!=NULL)
	{
		_pRollingFaceSelLis3Agent->RequestDelayedDestruction();
		_pRollingFaceSelLis3Agent=NULL;
	}
	if (_pRollingFaceSelLis4Agent!=NULL)
	{
		_pRollingFaceSelLis4Agent->RequestDelayedDestruction();
		_pRollingFaceSelLis4Agent=NULL;
	}
	if (_pRollingFaceSelLis5Agent!=NULL)
	{
		_pRollingFaceSelLis5Agent->RequestDelayedDestruction();
		_pRollingFaceSelLis5Agent=NULL;
	}




	if (_pHingeButtonAgent!=NULL)
	{
		_pHingeButtonAgent->RequestDelayedDestruction();
		_pHingeButtonAgent=NULL;
	}
	if (_pHinge1Line1Agent!=NULL)
	{
		_pHinge1Line1Agent->RequestDelayedDestruction();
		_pHinge1Line1Agent=NULL;
	}
	if (_pHinge1Line2Agent!=NULL)
	{
		_pHinge1Line2Agent->RequestDelayedDestruction();
		_pHinge1Line2Agent=NULL;
	}
	if (_pHinge1Plane1Agent!=NULL)
	{
		_pHinge1Plane1Agent->RequestDelayedDestruction();
		_pHinge1Plane1Agent=NULL;
	}
	if (_pHinge1Plane2Agent!=NULL)
	{
		_pHinge1Plane2Agent->RequestDelayedDestruction();
		_pHinge1Plane2Agent=NULL;
	}
	if (_pHinge2Line1Agent!=NULL)
	{
		_pHinge2Line1Agent->RequestDelayedDestruction();
		_pHinge2Line1Agent=NULL;
	}
	if (_pHinge2Line2Agent!=NULL)
	{
		_pHinge2Line2Agent->RequestDelayedDestruction();
		_pHinge2Line2Agent=NULL;
	}
	if (_pHinge2Plane1Agent!=NULL)
	{
		_pHinge2Plane1Agent->RequestDelayedDestruction();
		_pHinge2Plane1Agent=NULL;
	}
	if (_pHinge2Plane2Agent!=NULL)
	{
		_pHinge2Plane2Agent->RequestDelayedDestruction();
		_pHinge2Plane2Agent=NULL;
	}


	if (_pHingeFaceOKAgent!=NULL)
	{
		_pHingeFaceOKAgent->RequestDelayedDestruction();
		_pHingeFaceOKAgent=NULL;
	}
	if (_pHingeFaceCancleAgent!=NULL)
	{
		_pHingeFaceCancleAgent->RequestDelayedDestruction();
		_pHingeFaceCancleAgent=NULL;
	}

	if (_pHinge1Line1SelLisAgent!=NULL)
	{
		_pHinge1Line1SelLisAgent->RequestDelayedDestruction();
		_pHinge1Line1SelLisAgent=NULL;
	}
	if (_pHinge1Line2SelLisAgent!=NULL)
	{
		_pHinge1Line2SelLisAgent->RequestDelayedDestruction();
		_pHinge1Line2SelLisAgent=NULL;
	}
	if (_pHinge1Plane1SelLisAgent!=NULL)
	{
		_pHinge1Plane1SelLisAgent->RequestDelayedDestruction();
		_pHinge1Plane1SelLisAgent=NULL;
	}
	if (_pHinge1Plane2SelLisAgent!=NULL)
	{
		_pHinge1Plane2SelLisAgent->RequestDelayedDestruction();
		_pHinge1Plane2SelLisAgent=NULL;
	}

	if (_pHinge2Line1SelLisAgent!=NULL)
	{
		_pHinge2Line1SelLisAgent->RequestDelayedDestruction();
		_pHinge2Line1SelLisAgent=NULL;
	}
	if (_pHinge2Line2SelLisAgent!=NULL)
	{
		_pHinge2Line2SelLisAgent->RequestDelayedDestruction();
		_pHinge2Line2SelLisAgent=NULL;
	}
	if (_pHinge2Plane1SelLisAgent!=NULL)
	{
		_pHinge2Plane1SelLisAgent->RequestDelayedDestruction();
		_pHinge2Plane1SelLisAgent=NULL;
	}
	if (_pHinge2Plane2SelLisAgent!=NULL)
	{
		_pHinge2Plane2SelLisAgent->RequestDelayedDestruction();
		_pHinge2Plane2SelLisAgent=NULL;
	}



	if (_pSwepTPartAgent!=NULL)
	{
		_pSwepTPartAgent->RequestDelayedDestruction();
		_pSwepTPartAgent=NULL;
	}
	if (_pSweptOKAgent!=NULL)
	{
		_pSweptOKAgent->RequestDelayedDestruction();
		_pSweptOKAgent=NULL;
	}
	if (_pSweptCancleAgent!=NULL)
	{
		_pSweptCancleAgent->RequestDelayedDestruction();
		_pSweptCancleAgent=NULL;
	}
	if (_pSweptelListAgent!=NULL)
	{
		_pSweptelListAgent->RequestDelayedDestruction();
		_pSweptelListAgent=NULL;
	}



	if (_pRefPartAgent!=NULL)
	{
		_pRefPartAgent->RequestDelayedDestruction();
		_pRefPartAgent=NULL;
	}
	if (_pRefListAgent!=NULL)
	{
		_pRefListAgent->RequestDelayedDestruction();
		_pRefListAgent=NULL;
	}


	cout<<"3"<<endl;


	if (_pBodyAgent!=NULL)
	{
		_pBodyAgent->RequestDelayedDestruction();
		_pBodyAgent=NULL;
	}

	if (_pBodyOKAgent!=NULL)
	{
		_pBodyOKAgent->RequestDelayedDestruction();
		_pBodyOKAgent=NULL;
	}

	if (_pBodyCancleAgent!=NULL)
	{
		_pBodyCancleAgent->RequestDelayedDestruction();
		_pBodyCancleAgent=NULL;
	}

	if (_pBodyelLis1Agent!=NULL)
	{
		_pBodyelLis1Agent->RequestDelayedDestruction();
		_pBodyelLis1Agent=NULL;
	}
	if (_pBodySelLis2Agent!=NULL)
	{
		_pBodySelLis2Agent->RequestDelayedDestruction();
		_pBodySelLis2Agent=NULL;
	}

	if (_pBodyPartAgent!=NULL)
	{
		_pBodyPartAgent->RequestDelayedDestruction();
		_pBodyPartAgent=NULL;
	}
	if (_pdaClearSeat1Select != NULL) 
		_pdaClearSeat1Select->RequestDelayedDestruction();



	cout<<"4"<<endl;



	if (_pDoorAgent!=NULL)
	{
		_pDoorAgent->RequestDelayedDestruction();
		_pDoorAgent=NULL;
	}

	if (_pDoorOKAgent!=NULL)
	{
		_pDoorOKAgent->RequestDelayedDestruction();
		_pDoorOKAgent=NULL;
	}

	if (_pDoorCancleAgent!=NULL)
	{
		_pDoorCancleAgent->RequestDelayedDestruction();
		_pDoorCancleAgent=NULL;
	}

	if (_pDoorelLis1Agent!=NULL)
	{
		_pDoorelLis1Agent->RequestDelayedDestruction();
		_pDoorelLis1Agent=NULL;
	}
	if (_pDoorSelLis2Agent!=NULL)
	{
		_pDoorSelLis2Agent->RequestDelayedDestruction();
		_pDoorSelLis2Agent=NULL;
	}

	if (_pDoorPartAgent!=NULL)
	{
		_pDoorPartAgent->RequestDelayedDestruction();
		_pDoorPartAgent=NULL;
	}

	if (_pdaClearSeat2Select != NULL) 
		_pdaClearSeat2Select->RequestDelayedDestruction();







	cout<<"5"<<endl;







	if (_Panel!=NULL)
	{
		_Panel->RequestDelayedDestruction();
		_Panel=NULL;
	}
	cout<<"51"<<endl;

	if (_RailPanel!=NULL)
	{
		_RailPanel->RequestDelayedDestruction();
		_RailPanel=NULL;
	}
	cout<<"52"<<endl;

	if (_HingePanel!=NULL)
	{
		_HingePanel->RequestDelayedDestruction();
		_HingePanel=NULL;
	}
	if (_RotatePanel!=NULL)
	{
		_RotatePanel->RequestDelayedDestruction();
		_RotatePanel=NULL;
	}

	if (_RotateHingePanel!=NULL)
	{
		_RotateHingePanel->RequestDelayedDestruction();
		_RotateHingePanel=NULL;
	}
	if (_BodyPanel!=NULL)
	{
		_BodyPanel->RequestDelayedDestruction();
		_BodyPanel=NULL;
	}
	if (_DoorPanel!=NULL)
	{
		_DoorPanel->RequestDelayedDestruction();
		_DoorPanel=NULL;
	}
	if (_SweepPrtPanel!=NULL)
	{
		_SweepPrtPanel->RequestDelayedDestruction();
		_SweepPrtPanel=NULL;
	}

	cout<<"6"<<endl;
if (piMechanism!=NULL)
{
	piMechanism->Release();
	piMechanism = NULL;
}


cout<<"7"<<endl;


cout<<"xigou here"<<endl;

	//_Viewer2DRotate = NULL;
	//_Viewer2DRail = NULL;
	//_Viewer2DHinge = NULL;
	//_Viewer2DRotateHinge = NULL;
	//_Viewer2DBody = NULL;
	//_Viewer2DDoor = NULL;


}


//-------------------------------------------------------------------------
// BuildGraph()
//-------------------------------------------------------------------------
void TestCmd::BuildGraph()
{


	_Panel->_PushButton166->SetSensitivity(CATDlgDisable);
	_Panel->_PushButton186->SetSensitivity(CATDlgDisable);
	_Panel->_PushButton196->SetSensitivity(CATDlgDisable);
	_Panel->_PushButton133->SetSensitivity(CATDlgDisable);
	_Panel->_PushButton135->SetSensitivity(CATDlgDisable);
	_Panel->_PushButton136->SetSensitivity(CATDlgDisable);
	_Panel->_PushButton139->SetSensitivity(CATDlgDisable);
	_Panel->_PushButton140->SetSensitivity(CATDlgDisable);
	_Panel->_PushButton144->SetSensitivity(CATDlgDisable);
	_Panel->_PushButton187->SetSensitivity(CATDlgDisable);
	_Panel->_PushButton192->SetSensitivity(CATDlgDisable);
	_Panel->_PushButton195->SetSensitivity(CATDlgDisable);




	_BodyPanel->_Label008-> SetIconName("cheshen");
	_DoorPanel->_Label007-> SetIconName("chemen");
	_HingePanel->_Label027-> SetIconName("zhixiana");
	_RailPanel->_Label018-> SetIconName("shangdaogui");
	_RotatePanel->_Label015-> SetIconName("shanggunlun");
	_RotatePanel->_Frame010->SetTitle("上滚轮");

	_RotatePanel->_Frame001->SetTitle("下滚轮");

	_RailPanel->_Frame015->SetTitle("上轨道");

	_RailPanel->_Frame001->SetTitle("下轨道");



	//_Viewer2DRail = new CATNavigation2DViewer(_RailPanel->_Frame003,"DlgVeiwer2D",CATDlgFraNoTitle|CATDlgFraNoFrame,200,140);
	//_Viewer2DRail -> SetGridConstraints(0, 0, 1, 1,4);
	//_RailPanel->_Frame003->Attach4Sides(_Viewer2DRail);


	//_Viewer2DHinge = new CATNavigation2DViewer(_HingePanel->_Frame002,"DlgVeiwer2D",CATDlgFraNoTitle|CATDlgFraNoFrame,200,140);
	//_Viewer2DHinge -> SetGridConstraints(0, 0, 1, 1, 4);
	//_HingePanel->_Frame002->Attach4Sides(_Viewer2DHinge);


	//_Viewer2DRotate = new CATNavigation2DViewer(_RotatePanel->_Frame002,"DlgVeiwer2D",CATDlgFraNoTitle|CATDlgFraNoFrame,200,140);
	//_Viewer2DRotate -> SetGridConstraints(0, 0, 1, 1, 4);
	//_RotatePanel->_Frame002->Attach4Sides(_Viewer2DRotate);


	//_Viewer2DRotateHinge = new CATNavigation2DViewer(_RotateHingePanel->_Frame002,"DlgVeiwer2D",CATDlgFraNoTitle|CATDlgFraNoFrame,200,140);
	//_Viewer2DRotateHinge -> SetGridConstraints(0, 0, 1, 1, 4);
	//_RotateHingePanel->_Frame002->Attach4Sides(_Viewer2DRotateHinge);

	//_Viewer2DBody = new CATNavigation2DViewer(_BodyPanel->_Frame002,"DlgVeiwer2D",CATDlgFraNoTitle|CATDlgFraNoFrame,200,140);
	//_Viewer2DBody -> SetGridConstraints(0, 0, 1, 1, 4);
	//_BodyPanel->_Frame002->Attach4Sides(_Viewer2DBody);

	//_Viewer2DDoor = new CATNavigation2DViewer(_DoorPanel->_Frame002,"DlgVeiwer2D",CATDlgFraNoTitle|CATDlgFraNoFrame,200,140);
	//_Viewer2DDoor -> SetGridConstraints(0, 0, 1, 1, 4);
	//_DoorPanel->_Frame002->Attach4Sides(_Viewer2DDoor);


	cout<<"cmd build"<<endl;

	AddAnalyseNotificationCB (_Panel->_TabContainer068, 
		_Panel->_TabContainer068->GetTabSelectNotification(),
		(CATCommandMethod)&TestCmd::OnTabContainer068TabSelectNotification,
		NULL);
	AddAnalyseNotificationCB (_Panel->_PushButton187, 
		_Panel->_PushButton187->GetPushBActivateNotification(),
		(CATCommandMethod)&TestCmd::OnPushButton187PushBActivateNotification,
		NULL);//more less
	AddAnalyseNotificationCB (_Panel->_PushButton144, 
		_Panel->_PushButton144->GetPushBActivateNotification(),
		(CATCommandMethod)&TestCmd::OnPushButton144PushBActivateNotification,
		NULL);//生成机构

	AddAnalyseNotificationCB (_Panel->_PushButton192, 
		_Panel->_PushButton192->GetPushBActivateNotification(),
		(CATCommandMethod)&TestCmd::OnPushButton192PushBActivateNotification,
		NULL);//模拟
	AddAnalyseNotificationCB (_Panel->_PushButton195, 
		_Panel->_PushButton195->GetPushBActivateNotification(),
		(CATCommandMethod)&TestCmd::OnPushButton195PushBActivateNotification,
		NULL);//重放
	AddAnalyseNotificationCB (_Panel->_PushButton196, 
		_Panel->_PushButton196->GetPushBActivateNotification(),
		(CATCommandMethod)&TestCmd::OnPushButton196PushBActivateNotification,
		NULL);//包络
	AddAnalyseNotificationCB (_Panel->_Combo132, 
		_Panel->_Combo132->GetComboSelectNotification(),
		(CATCommandMethod)&TestCmd::OnCombo132ComboSelectNotification,
		NULL);//导轨形式

	//AddAnalyseNotificationCB (_Panel->_SelectorList159, 
	//	_Panel->_SelectorList159->GetListSelectNotification(),
	//	(CATCommandMethod)&TestCmd::OnSelectorList159ListSelectNotification,
	//	NULL);//参考零件






	//AddAnalyseNotificationCB (_Panel->_PushButton140, 
	//_Panel->	_PushButton140->GetPushBActivateNotification(),
	//	(CATCommandMethod)&TestCmd::OnPushButton140PushBActivateNotification,
	//	NULL);
	//AddAnalyseNotificationCB (_Panel->_PushButton139, 
	//_Panel->	_PushButton139->GetPushBActivateNotification(),
	//	(CATCommandMethod)&TestCmd::OnPushButton139PushBActivateNotification,
	//	NULL);
	AddAnalyseNotificationCB (_Panel->_PushButton166, 
		_Panel->_PushButton166->GetPushBActivateNotification(),
		(CATCommandMethod)&TestCmd::OnPushButton166PushBActivateNotification,
		NULL);//指定储存位置
	//AddAnalyseNotificationCB (_Panel->_PushButton137, 
	//	_Panel->_PushButton137->GetPushBActivateNotification(),
	//	(CATCommandMethod)&TestCmd::OnPushButton137PushBActivateNotification,
	//	NULL);
	//AddAnalyseNotificationCB (_Panel->_PushButton136, 
	//	_Panel->_PushButton136->GetPushBActivateNotification(),
	//	(CATCommandMethod)&TestCmd::OnPushButton136PushBActivateNotification,
	//	NULL);
	//AddAnalyseNotificationCB (_Panel->_PushButton135, 
	//	_Panel->_PushButton135->GetPushBActivateNotification(),
	//	(CATCommandMethod)&TestCmd::OnPushButton135PushBActivateNotification,
	//	NULL);
	//AddAnalyseNotificationCB (_Panel, 
	//	_Panel->GetDiaOKNotification(),
	//	(CATCommandMethod)&TestCmd::OnTestDlgDiaOKNotification,
	//	NULL);
	//AddAnalyseNotificationCB (_Panel, 
	//	_Panel->GetDiaCANCELNotification(),
	//	(CATCommandMethod)&TestCmd::OnTestDlgDiaCANCELNotification,
	//	NULL);
	//AddAnalyseNotificationCB (_Panel, 
	//	_Panel->GetDiaCLOSENotification(),
	//	(CATCommandMethod)&TestCmd::OnTestDlgDiaCLOSENotification,
	//	NULL);
	//AddAnalyseNotificationCB (_Panel->_SelectorList171, 
	//	_Panel->_SelectorList171->GetListSelectNotification(),
	//	(CATCommandMethod)&TestCmd::OnSelectorList171ListSelectNotification,
	//	NULL);
	//AddAnalyseNotificationCB (_Panel->_PushButton133, 
	//	_Panel->_PushButton133->GetPushBActivateNotification(),
	//	(CATCommandMethod)&TestCmd::OnPushButton133PushBActivateNotification,
	//	NULL);

	_MoreMsg = CATMsgCatalog::BuildMessage("CAADlgMoreButtonDlg","ButtonMore",NULL,0,"More");
	_LessMsg = CATMsgCatalog::BuildMessage("CAADlgMoreButtonDlg","ButtonLess",NULL,0,"Less△");                                       
	_Panel->_PushButton187->SetTitle(_MoreMsg);









	//AddAnalyseNotificationCB (_Panel,_Panel->GetDiaOKNotification(),(CATCommandMethod)&TestCmd::TestCmdOK,NULL);//单击对话框上面的确定按钮时的响应函数，执行TestCmdOK这个函数

	//AddAnalyseNotificationCB (_Panel,_Panel->GetDiaCANCELNotification(),(CATCommandMethod)&TestCmd::TestCmdCANCEL,NULL);//单击对话框上面的取消按钮时的响应函数，执行TestCmdCANCEL这个函数

	//AddAnalyseNotificationCB(_Panel,_Panel->GetWindCloseNotification(),(CATCommandMethod)&TestCmd::TestCmdCANCEL,NULL);//单击对话框上面的X时的响应函数，执行TestCmdCANCEL这个函数




	_pPanelOKAgent  = new CATDialogAgent( "PanelOKAgent");//------------------
	_pPanelOKAgent-> AcceptOnNotify ( _Panel,_Panel->GetDiaOKNotification());

	_pPanelCancelAgent  = new CATDialogAgent( "PanelCancelAgent");//------------------
	_pPanelCancelAgent-> AcceptOnNotify ( _Panel,_Panel->GetDiaCLOSENotification ());

	_pPanelCloseAgent  = new CATDialogAgent( "PanelCloseAgent");//------------------
	_pPanelCloseAgent-> AcceptOnNotify ( _Panel,_Panel->GetWindCloseNotification());



	_pRailButtonAgent  = new CATDialogAgent( "RailButtonAgent");//------------------
	_pRailButtonAgent-> AcceptOnNotify ( _Panel->_PushButton133,_Panel->_PushButton133->GetPushBActivateNotification());

	_pHingeButtonAgent  = new CATDialogAgent( "HingeButtonAgent");//------------------
	_pHingeButtonAgent-> AcceptOnNotify ( _Panel->_PushButton135,_Panel->_PushButton135->GetPushBActivateNotification());

	_pRotateButtonAgent  = new CATDialogAgent( "RotateButtonAgent");//------------------
	_pRotateButtonAgent-> AcceptOnNotify ( _Panel->_PushButton136,_Panel->_PushButton136->GetPushBActivateNotification());

	_pBodyButtonAgent  = new CATDialogAgent( "BodyButtonAgent");//------------------
	_pBodyButtonAgent-> AcceptOnNotify ( _Panel->_PushButton139,_Panel->_PushButton139->GetPushBActivateNotification());


	_pDoorButtonAgent  = new CATDialogAgent( "DoorButtonAgent");//------------------
	_pDoorButtonAgent-> AcceptOnNotify ( _Panel->_PushButton140,_Panel->_PushButton140->GetPushBActivateNotification());

	_pSweptButtonAgent  = new CATDialogAgent( "SweptButtonAgent");//------------------
	_pSweptButtonAgent-> AcceptOnNotify ( _Panel->_PushButton186,_Panel->_PushButton186->GetPushBActivateNotification());


	//closeagent




	//swept 代理
	_pSweptOKAgent  = new CATDialogAgent( "SweptOKAgent");
	_pSweptOKAgent-> AcceptOnNotify ( _SweepPrtPanel,_SweepPrtPanel->GetDiaOKNotification());

	_pSweptCancleAgent  = new CATDialogAgent( "SweptCancleAgent");
	_pSweptCancleAgent-> AcceptOnNotify ( _SweepPrtPanel,_SweepPrtPanel->GetDiaCANCELNotification());

	_pSweptCloseAgent  = new CATDialogAgent( "SweptCloseAgent");//------------------
	_pSweptCloseAgent-> AcceptOnNotify ( _SweepPrtPanel,_SweepPrtPanel->GetWindCloseNotification());

	_pSweptelListAgent  = new CATDialogAgent( "SweptListAgent");
	_pSweptelListAgent-> AcceptOnNotify ( _SweepPrtPanel->_SelectorList002,_SweepPrtPanel->_SelectorList002->GetListSelectNotification());

	_pSwepTPartAgent = new CATPathElementAgent("SweptAgent");
	_pSwepTPartAgent->AddOrderedElementType("CATIProduct");//
	_pSwepTPartAgent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);


	_pRefPartAgent = new CATPathElementAgent("RefPartAgent");
	_pRefPartAgent->AddOrderedElementType("CATIProduct");
	_pRefPartAgent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pRefListAgent  = new CATDialogAgent( "RefListAgent");
	_pRefListAgent-> AcceptOnNotify ( _Panel->_SelectorList159,_Panel->_SelectorList159->GetListSelectNotification());


//body代理 车身

	_pBodyOKAgent  = new CATDialogAgent( "BodyOKAgent");
	_pBodyOKAgent-> AcceptOnNotify ( _BodyPanel,_BodyPanel->GetDiaOKNotification());

	_pBodyCancleAgent  = new CATDialogAgent( "BodyCancleAgent");
	_pBodyCancleAgent-> AcceptOnNotify ( _BodyPanel,_BodyPanel->GetDiaCANCELNotification());

	_pBodyCloseAgent  = new CATDialogAgent( "BodyCloseAgent");//------------------
	_pBodyCloseAgent-> AcceptOnNotify ( _BodyPanel,_BodyPanel->GetWindCloseNotification());


	_pBodyelLis1Agent  = new CATDialogAgent( "BodyelLis1Agent");
	_pBodyelLis1Agent-> AcceptOnNotify ( _BodyPanel->_SelectorList006,_BodyPanel->_SelectorList006->GetListSelectNotification());

	_pBodySelLis2Agent  = new CATDialogAgent( "BodySelLis2Agent");
	_pBodySelLis2Agent-> AcceptOnNotify ( _BodyPanel->_SelectorList007,_BodyPanel->_SelectorList007->GetListSelectNotification());

	_pBodyAgent = new CATPathElementAgent("BodyAgent");
	_pBodyAgent->AddOrderedElementType("CATIProduct");
	_pBodyAgent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pBodyPartAgent = new CATPathElementAgent("BodyPartAgent");
	_pBodyPartAgent->AddOrderedElementType("CATIProduct");
	_pBodyPartAgent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pdaClearSeat1Select   = new CATDialogAgent(" CleanSeat1Faces");
	_pdaClearSeat1Select ->AcceptOnNotify(_BodyPanel->GetClearItem(),_BodyPanel->GetClearItem()->GetMenuIActivateNotification ());

//door代理


	_pDoorOKAgent  = new CATDialogAgent( "DoorOKAgent");
	_pDoorOKAgent-> AcceptOnNotify ( _DoorPanel,_DoorPanel->GetDiaOKNotification());

	_pDoorCancleAgent  = new CATDialogAgent( "DoorCancleAgent");
	_pDoorCancleAgent-> AcceptOnNotify ( _DoorPanel,_DoorPanel->GetDiaCANCELNotification());

	_pDoorCloseAgent  = new CATDialogAgent( "DoorCloseAgent");//------------------
	_pDoorCloseAgent-> AcceptOnNotify ( _DoorPanel,_DoorPanel->GetWindCloseNotification());


	_pDoorelLis1Agent  = new CATDialogAgent( "DoorelLis1Agent");
	_pDoorelLis1Agent-> AcceptOnNotify ( _DoorPanel->_SelectorList005,_DoorPanel->_SelectorList005->GetListSelectNotification());

	_pDoorSelLis2Agent  = new CATDialogAgent( "DoorSelLis2Agent");
	_pDoorSelLis2Agent-> AcceptOnNotify ( _DoorPanel->_SelectorList006,_DoorPanel->_SelectorList006->GetListSelectNotification());

	_pDoorAgent = new CATPathElementAgent("DoorAgent");
	_pDoorAgent->AddOrderedElementType("CATIProduct");
	_pDoorAgent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pDoorPartAgent = new CATFeatureImportAgent("DoorPartAgent");
	_pDoorPartAgent->AddOrderedElementType("CATIProduct");
	_pDoorPartAgent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pdaClearSeat2Select   = new CATDialogAgent(" CleanSeat2Faces");
	_pdaClearSeat2Select ->AcceptOnNotify(_DoorPanel->GetClearItem(),_DoorPanel->GetClearItem()->GetMenuIActivateNotification ());




//滚轮代理
	_pRotateFaceOKAgent  = new CATDialogAgent( "RotateFaceOKAgent");
	_pRotateFaceOKAgent-> AcceptOnNotify ( _RotatePanel,_RotatePanel->GetDiaOKNotification());

	_pRotateFaceCancleAgent  = new CATDialogAgent( "RotateFaceCancleAgent");
	_pRotateFaceCancleAgent-> AcceptOnNotify ( _RotatePanel,_RotatePanel->GetDiaCANCELNotification());

	_pRotateFaceCloseAgent  = new CATDialogAgent( "RotateFaceCloseAgent");//------------------
	_pRotateFaceCloseAgent-> AcceptOnNotify ( _RotatePanel,_RotatePanel->GetWindCloseNotification());

	_pRotateFaceSelLis1Agent  = new CATDialogAgent( "RotateFaceSelLis1Agent");
	_pRotateFaceSelLis1Agent-> AcceptOnNotify ( _RotatePanel->_SelectorList006,_RotatePanel->_SelectorList006->GetListSelectNotification());
	cout<<"2.3"<<endl;

	_pRotateFaceSelLis2Agent  = new CATDialogAgent( "RotateFaceSelLis2Agent");
	_pRotateFaceSelLis2Agent-> AcceptOnNotify ( _RotatePanel->_SelectorList007,_RotatePanel->_SelectorList007->GetListSelectNotification());

	_pRotateFaceSelLis3Agent  = new CATDialogAgent( "RotateFaceSelLis3Agent");
	_pRotateFaceSelLis3Agent-> AcceptOnNotify ( _RotatePanel->_SelectorList012,_RotatePanel->_SelectorList012->GetListSelectNotification());

	_pRotateFaceSelLis6Agent  = new CATDialogAgent( "RotateFaceSelLis6Agent");
	_pRotateFaceSelLis6Agent-> AcceptOnNotify ( _RotatePanel->_SelectorListMdRot2,_RotatePanel->_SelectorListMdRot2->GetListSelectNotification());

	_pRotateFaceSelLis7Agent  = new CATDialogAgent( "RotateFaceSelLis7Agent");
	_pRotateFaceSelLis7Agent-> AcceptOnNotify ( _RotatePanel->_SelectorListDnRot2,_RotatePanel->_SelectorListDnRot2->GetListSelectNotification());


	_pRotateFaceSelLis4Agent  = new CATDialogAgent( "RotateFaceSelLis4Agent");
	_pRotateFaceSelLis4Agent-> AcceptOnNotify ( _RotatePanel->_SelectorList008,_RotatePanel->_SelectorList008->GetListSelectNotification());

	_pRotateFaceSelLis5Agent  = new CATDialogAgent( "RotateFaceSelLis5Agent");
	_pRotateFaceSelLis5Agent-> AcceptOnNotify ( _RotatePanel->_SelectorList014,_RotatePanel->_SelectorList014->GetListSelectNotification());

	_pUpRotateFaceAgent = new CATFeatureImportAgent("UpRotateFaceAgent");
	//_pUpRotateFaceAgent->SetOrderedElementType("CATIMfBiDimResult");
	_pUpRotateFaceAgent->AddOrderedElementType("CATSurface");
	_pUpRotateFaceAgent->AddOrderedElementType("CATFace");
	_pUpRotateFaceAgent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	//_pUpRotateFaceAgent = new CATFeatureImportAgent("UpRotateFaceAgent");
	//_pUpRotateFaceAgent -> SetOrderedElementType ( "CATIMfMonoDimResult" );
	//_pUpRotateFaceAgent -> AddOrderedElementType ( "CATCurve"            );
	//_pUpRotateFaceAgent -> AddOrderedElementType ( "CATEdge"             );
	//_pUpRotateFaceAgent -> AddOrderedElementType ( "CATWire"             );
	//_pUpRotateFaceAgent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pMdRotateFaceAgent = new CATFeatureImportAgent("RotateSurfaceAgent");
	//_pMdRotateFaceAgent->SetOrderedElementType("CATIMfBiDimResult");
	_pMdRotateFaceAgent->AddOrderedElementType("CATSurface");
	_pMdRotateFaceAgent->AddOrderedElementType("CATFace");
	_pMdRotateFaceAgent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pDwRotateFaceAgent = new CATFeatureImportAgent("RotateSurfaceAgent");
	//_pDwRotateFaceAgent->SetOrderedElementType("CATIMfBiDimResult");
	_pDwRotateFaceAgent->AddOrderedElementType("CATSurface");
	_pDwRotateFaceAgent->AddOrderedElementType("CATFace");
	_pDwRotateFaceAgent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pMdRotateDirFaceAgent = new CATFeatureImportAgent("RotateSurfaceAgent");
	//_pMdRotateDirFaceAgent->SetOrderedElementType("CATIMfBiDimResult");
	_pMdRotateDirFaceAgent->AddOrderedElementType("CATSurface");
	_pMdRotateDirFaceAgent->AddOrderedElementType("CATFace");
	_pMdRotateDirFaceAgent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pMdRotateDirFaceAgent2 = new CATFeatureImportAgent("RotateSurface2Agent");
	//_pMdRotateDirFaceAgent2->SetOrderedElementType("CATIMfBiDimResult");
	_pMdRotateDirFaceAgent2->AddOrderedElementType("CATSurface");
	_pMdRotateDirFaceAgent2->AddOrderedElementType("CATFace");
	_pMdRotateDirFaceAgent2->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);


	_pDwRotateDirFaceAgent = new CATFeatureImportAgent("RotateSurfaceAgent");
	//_pDwRotateDirFaceAgent->SetOrderedElementType("CATIMfBiDimResult");
	_pDwRotateDirFaceAgent->AddOrderedElementType("CATSurface");
	_pDwRotateDirFaceAgent->AddOrderedElementType("CATFace");
	_pDwRotateDirFaceAgent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);


	_pDwRotateDirFaceAgent2 = new CATFeatureImportAgent("RotateSurfaceAgent2");
	//_pDwRotateDirFaceAgent2->SetOrderedElementType("CATIMfBiDimResult");
	_pDwRotateDirFaceAgent2->AddOrderedElementType("CATSurface");
	_pDwRotateDirFaceAgent2->AddOrderedElementType("CATFace");
	_pDwRotateDirFaceAgent2->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);


//轨道代理
	_pRollingFaceOKAgent  = new CATDialogAgent( "RollingFaceOKAgent");
	_pRollingFaceOKAgent-> AcceptOnNotify ( _RailPanel,_RailPanel->GetDiaOKNotification());

	_pRollingFaceCancleAgent  = new CATDialogAgent( "RollingFaceCancleAgent");
	_pRollingFaceCancleAgent-> AcceptOnNotify ( _RailPanel,_RailPanel->GetDiaCANCELNotification());

	_pRollingFaceCloseAgent  = new CATDialogAgent( "RollingFaceCloseAgent");//------------------
	_pRollingFaceCloseAgent-> AcceptOnNotify ( _RailPanel,_RailPanel->GetWindCloseNotification());



	_pRollingFaceSelLis1Agent  = new CATDialogAgent( "RollingFaceSelLis1Agent");
	_pRollingFaceSelLis1Agent-> AcceptOnNotify ( _RailPanel->_SelectorList007,_RailPanel->_SelectorList007->GetListSelectNotification());

	_pRollingFaceSelLis2Agent  = new CATDialogAgent( "RollingFaceSelLis2Agent");
	_pRollingFaceSelLis2Agent-> AcceptOnNotify ( _RailPanel->_SelectorList008,_RailPanel->_SelectorList008->GetListSelectNotification());

	_pRollingFaceSelLis3Agent  = new CATDialogAgent( "RollingFaceSelLis3Agent");
	_pRollingFaceSelLis3Agent-> AcceptOnNotify ( _RailPanel->_SelectorList009,_RailPanel->_SelectorList009->GetListSelectNotification());

	_pRollingFaceSelLis4Agent  = new CATDialogAgent( "RollingFaceSelLis4Agent");
	_pRollingFaceSelLis4Agent-> AcceptOnNotify ( _RailPanel->_SelectorList011,_RailPanel->_SelectorList011->GetListSelectNotification());

	_pRollingFaceSelLis5Agent  = new CATDialogAgent( "RollingFaceSelLis5Agent");
	_pRollingFaceSelLis5Agent-> AcceptOnNotify ( _RailPanel->_SelectorList017,_RailPanel->_SelectorList017->GetListSelectNotification());

	_pUpRollingFaceAgent = new CATPathElementAgent("UpRollingFaceAgent");//CATFeatureImportAgent
	//_pUpRollingFaceAgent->SetOrderedElementType("CATIMfBiDimResult");
	_pUpRollingFaceAgent->AddOrderedElementType("CATSurface");
	//_pUpRollingFaceAgent->AddOrderedElementType("CATFace");
	_pUpRollingFaceAgent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pMdRollingFaceAgent = new CATFeatureImportAgent("RollingSurfaceAgent");
	//_pMdRollingFaceAgent->SetOrderedElementType("CATIMfBiDimResult");
	_pMdRollingFaceAgent->AddOrderedElementType("CATSurface");
	_pMdRollingFaceAgent->AddOrderedElementType("CATFace");
	_pMdRollingFaceAgent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pDwRollingFaceAgent = new CATFeatureImportAgent("RollingSurfaceAgent");
	////_pDwRollingFaceAgent->SetOrderedElementType("CATIMfBiDimResult");
	_pDwRollingFaceAgent->AddOrderedElementType("CATSurface");
	_pDwRollingFaceAgent->AddOrderedElementType("CATFace");
	_pDwRollingFaceAgent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pMdBearFaceAgent = new CATFeatureImportAgent("MdBearFaceAgent");
	//_pMdBearFaceAgent->SetOrderedElementType("CATIMfBiDimResult");
	_pMdBearFaceAgent->AddOrderedElementType("CATSurface");
	_pMdBearFaceAgent->AddOrderedElementType("CATFace");
	_pMdBearFaceAgent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);


	_pDwBearFaceAgent = new CATFeatureImportAgent("DwBearFaceAgent");
	//_pDwBearFaceAgent->SetOrderedElementType("CATIMfBiDimResult");
	_pDwBearFaceAgent->AddOrderedElementType("CATSurface");
	_pDwBearFaceAgent->AddOrderedElementType("CATFace");
	_pDwBearFaceAgent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);






//铰链代理

	_pHinge1Line1Agent = new CATFeatureImportAgent("Hinge1Line1Agent");
	_pHinge1Line1Agent->SetOrderedElementType("CATIMfMonoDimResult");
	_pHinge1Line1Agent->AddOrderedElementType("CATLine");
	_pHinge1Line1Agent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pHinge1Line2Agent = new CATFeatureImportAgent("Hinge1Line2Agent");
	_pHinge1Line2Agent->SetOrderedElementType("CATIMfMonoDimResult");
	_pHinge1Line2Agent->AddOrderedElementType("CATLine");
	_pHinge1Line2Agent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pHinge1Plane1Agent = new CATFeatureImportAgent("Hinge1Plane1Agent");
	//_pHinge1Plane1Agent->SetFilter(Filter((FilterMethod)&TestCmd::Plane1IsNormalToHinge1Line1, NULL));
	_pHinge1Plane1Agent->SetFilter(Filter((FilterMethod)&TestCmd::Plane1IsInSamePrdHinge1Line1, NULL));
	_pHinge1Plane1Agent->AddOrderedElementType("CATPlane");
	_pHinge1Plane1Agent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pHinge1Plane2Agent = new CATFeatureImportAgent("Hinge1Plane2Agent");
	//_pHinge1Plane2Agent->SetFilter(Filter((FilterMethod)&TestCmd::Plane2IsNormalToHinge1Line1, NULL));
	_pHinge1Plane2Agent->SetFilter(Filter((FilterMethod)&TestCmd::Plane2IsInSamePrdHinge1Line2, NULL));
	_pHinge1Plane2Agent->AddOrderedElementType("CATPlane");
	_pHinge1Plane2Agent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);


	_pHinge2Line1Agent = new CATFeatureImportAgent("Hinge2Line1Agent");
	_pHinge2Line1Agent->SetOrderedElementType("CATIMfMonoDimResult");
	_pHinge2Line1Agent->AddOrderedElementType("CATLine");
	_pHinge2Line1Agent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pHinge2Line2Agent = new CATFeatureImportAgent("Hinge2Line2Agent");
	_pHinge2Line2Agent->SetOrderedElementType("CATIMfMonoDimResult");
	_pHinge2Line2Agent->AddOrderedElementType("CATLine");
	_pHinge2Line2Agent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pHinge2Plane1Agent = new CATFeatureImportAgent("Hinge2Plane1Agent");
	//_pHinge2Plane1Agent->SetFilter(Filter((FilterMethod)&TestCmd::Plane1IsNormalToHinge2Line1, NULL));
	_pHinge2Plane1Agent->SetFilter(Filter((FilterMethod)&TestCmd::Plane1IsInSamePrdHinge2Line1, NULL));
	_pHinge2Plane1Agent->AddOrderedElementType("CATPlane");
	_pHinge2Plane1Agent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);

	_pHinge2Plane2Agent = new CATFeatureImportAgent("Hinge2Plane2Agent");
	//_pHinge2Plane2Agent->SetFilter(Filter((FilterMethod)&TestCmd::Plane2IsNormalToHinge2Line1, NULL));
	_pHinge2Plane2Agent->SetFilter(Filter((FilterMethod)&TestCmd::Plane2IsInSamePrdHinge2Line2, NULL));
	_pHinge2Plane2Agent->AddOrderedElementType("CATPlane");
	_pHinge2Plane2Agent->SetBehavior(CATDlgEngWithPSOHSO | CATDlgEngWithPrevaluation  | CATDlgEngRepeat);


	_pHingeFaceOKAgent  = new CATDialogAgent( "HingeFaceOKAgent");
	_pHingeFaceOKAgent-> AcceptOnNotify ( _HingePanel,_HingePanel->GetDiaOKNotification());

	_pHingeFaceCancleAgent  = new CATDialogAgent( "HingeFaceCancleAgent");
	_pHingeFaceCancleAgent-> AcceptOnNotify ( _HingePanel,_HingePanel->GetDiaCANCELNotification());

	_pHingeFaceCloseAgent  = new CATDialogAgent( "HingeFaceCloseAgent");//------------------
	_pHingeFaceCloseAgent-> AcceptOnNotify ( _HingePanel,_HingePanel->GetWindCloseNotification());


	_pHinge1Line1SelLisAgent  = new CATDialogAgent( "Hinge1Line1SelLisAgent");
	_pHinge1Line1SelLisAgent-> AcceptOnNotify ( _HingePanel->_SelectorList006,_HingePanel->_SelectorList006->GetListSelectNotification());
	_pHinge1Line2SelLisAgent  = new CATDialogAgent( "Hinge1Line2SelLisAgent");
	_pHinge1Line2SelLisAgent-> AcceptOnNotify ( _HingePanel->_SelectorList012,_HingePanel->_SelectorList012->GetListSelectNotification());

	_pHinge1Plane1SelLisAgent  = new CATDialogAgent( "Hinge1Plane1SelLisAgent");
	_pHinge1Plane1SelLisAgent-> AcceptOnNotify ( _HingePanel->_SelectorList014,_HingePanel->_SelectorList014->GetListSelectNotification());
	_pHinge1Plane2SelLisAgent  = new CATDialogAgent( "Hinge1Plane2SelLisAgent");
	_pHinge1Plane2SelLisAgent-> AcceptOnNotify ( _HingePanel->_SelectorList016,_HingePanel->_SelectorList016->GetListSelectNotification());
	
	_pHinge2Line1SelLisAgent  = new CATDialogAgent( "Hinge2Line1SelLisAgent");
	_pHinge2Line1SelLisAgent-> AcceptOnNotify ( _HingePanel->_SelectorList007,_HingePanel->_SelectorList007->GetListSelectNotification());
	_pHinge2Line2SelLisAgent  = new CATDialogAgent( "Hinge2Line2SelLisAgent");
	_pHinge2Line2SelLisAgent-> AcceptOnNotify ( _HingePanel->_SelectorList018,_HingePanel->_SelectorList018->GetListSelectNotification());

	_pHinge2Plane1SelLisAgent  = new CATDialogAgent( "Hinge2Plane1SelLisAgent");
	_pHinge2Plane1SelLisAgent-> AcceptOnNotify ( _HingePanel->_SelectorList020,_HingePanel->_SelectorList020->GetListSelectNotification());
	_pHinge2Plane2SelLisAgent  = new CATDialogAgent( "Hinge2Plane2SelLisAgent");
	_pHinge2Plane2SelLisAgent-> AcceptOnNotify ( _HingePanel->_SelectorList022,_HingePanel->_SelectorList022->GetListSelectNotification());

//state定义
	CATDialogState * _pIniButtonState =GetInitialState("选择机构类型");
	_pIniButtonState->AddDialogAgent(_pRailButtonAgent);
	_pIniButtonState->AddDialogAgent(_pHingeButtonAgent);//_pRotateButtonAgent
	_pIniButtonState->AddDialogAgent(_pRotateButtonAgent);
	_pIniButtonState->AddDialogAgent(_pBodyButtonAgent);
	_pIniButtonState->AddDialogAgent(_pDoorButtonAgent);
	_pIniButtonState->AddDialogAgent(_pSweptButtonAgent);
	_pIniButtonState->AddDialogAgent(_pRefListAgent);
	_pIniButtonState->AddDialogAgent(_pPanelOKAgent);
	_pIniButtonState->AddDialogAgent(_pPanelCancelAgent);
	_pIniButtonState->AddDialogAgent(_pPanelCloseAgent);


	CATDialogState * _pRefPartSelState =AddDialogState("选择参考零件");//选择参考零件
	_pRefPartSelState->AddDialogAgent(_pRefPartAgent);
	_pRefPartSelState->AddDialogAgent(_pRefListAgent);
	_pRefPartSelState->AddDialogAgent(_pPanelOKAgent);
	_pRefPartSelState->AddDialogAgent(_pPanelCancelAgent);
	_pRefPartSelState->AddDialogAgent(_pPanelCloseAgent);



	CATDialogState * _pUpRailFacetState =AddDialogState("选择上轨道面");//等待选择上轨道面
	_pUpRailFacetState->AddDialogAgent(_pUpRollingFaceAgent);
	_pUpRailFacetState->AddDialogAgent(_pRollingFaceOKAgent);
	_pUpRailFacetState->AddDialogAgent(_pRollingFaceCloseAgent);

	_pUpRailFacetState->AddDialogAgent(_pRollingFaceCancleAgent);
	_pUpRailFacetState->AddDialogAgent(_pRollingFaceSelLis1Agent);
	_pUpRailFacetState->AddDialogAgent(_pRollingFaceSelLis2Agent);
	_pUpRailFacetState->AddDialogAgent(_pRollingFaceSelLis3Agent);
	_pUpRailFacetState->AddDialogAgent(_pRollingFaceSelLis4Agent);
	_pUpRailFacetState->AddDialogAgent(_pRollingFaceSelLis5Agent);



	CATDialogState * _pMdRailFacetState =AddDialogState("选择中轨道面");//等待选择中轨道面
	_pMdRailFacetState->AddDialogAgent(_pMdRollingFaceAgent);
	_pMdRailFacetState->AddDialogAgent(_pRollingFaceOKAgent);
	_pMdRailFacetState->AddDialogAgent(_pRollingFaceCancleAgent);
	_pMdRailFacetState->AddDialogAgent(_pRollingFaceSelLis1Agent);
	_pMdRailFacetState->AddDialogAgent(_pRollingFaceSelLis2Agent);
	_pMdRailFacetState->AddDialogAgent(_pRollingFaceSelLis3Agent);
	_pMdRailFacetState->AddDialogAgent(_pRollingFaceSelLis4Agent);
	_pMdRailFacetState->AddDialogAgent(_pRollingFaceSelLis5Agent);
	_pMdRailFacetState->AddDialogAgent(_pRollingFaceCloseAgent);

	CATDialogState * _pDwRailFacetState =AddDialogState("选择下轨道面");//等待选择下轨道面
	_pDwRailFacetState->AddDialogAgent(_pDwRollingFaceAgent);
	_pDwRailFacetState->AddDialogAgent(_pRollingFaceOKAgent);
	_pDwRailFacetState->AddDialogAgent(_pRollingFaceCancleAgent);
	_pDwRailFacetState->AddDialogAgent(_pRollingFaceSelLis1Agent);
	_pDwRailFacetState->AddDialogAgent(_pRollingFaceSelLis2Agent);
	_pDwRailFacetState->AddDialogAgent(_pRollingFaceSelLis3Agent);
	_pDwRailFacetState->AddDialogAgent(_pRollingFaceSelLis4Agent);
	_pDwRailFacetState->AddDialogAgent(_pRollingFaceSelLis5Agent);
	_pDwRailFacetState->AddDialogAgent(_pRollingFaceCloseAgent);



	CATDialogState * _pMdBearFacetState =AddDialogState("选择中承压面");//等待选择中承压面
	_pMdBearFacetState->AddDialogAgent(_pMdBearFaceAgent);
	_pMdBearFacetState->AddDialogAgent(_pRollingFaceOKAgent);
	_pMdBearFacetState->AddDialogAgent(_pRollingFaceCancleAgent);
	_pMdBearFacetState->AddDialogAgent(_pRollingFaceSelLis1Agent);
	_pMdBearFacetState->AddDialogAgent(_pRollingFaceSelLis2Agent);
	_pMdBearFacetState->AddDialogAgent(_pRollingFaceSelLis3Agent);
	_pMdBearFacetState->AddDialogAgent(_pRollingFaceSelLis4Agent);
	_pMdBearFacetState->AddDialogAgent(_pRollingFaceSelLis5Agent);
	_pMdBearFacetState->AddDialogAgent(_pRollingFaceCloseAgent);


	CATDialogState * _pDwBearFacetState =AddDialogState("选择下承压面1");//等待选择下承压面
	_pDwBearFacetState->AddDialogAgent(_pDwBearFaceAgent);
	_pDwBearFacetState->AddDialogAgent(_pRollingFaceOKAgent);
	_pDwBearFacetState->AddDialogAgent(_pRollingFaceCancleAgent);
	_pDwBearFacetState->AddDialogAgent(_pRollingFaceSelLis1Agent);
	_pDwBearFacetState->AddDialogAgent(_pRollingFaceSelLis2Agent);
	_pDwBearFacetState->AddDialogAgent(_pRollingFaceSelLis3Agent);
	_pDwBearFacetState->AddDialogAgent(_pRollingFaceSelLis4Agent);
	_pDwBearFacetState->AddDialogAgent(_pRollingFaceSelLis5Agent);
	_pDwBearFacetState->AddDialogAgent(_pRollingFaceCloseAgent);


//铰链状态

	CATDialogState * _pHinge1Line1State =AddDialogState("选择产品1.直线1");
	_pHinge1Line1State->AddDialogAgent(_pHinge1Line1Agent);
	_pHinge1Line1State->AddDialogAgent(_pHingeFaceOKAgent);
	_pHinge1Line1State->AddDialogAgent(_pHingeFaceCancleAgent);
	_pHinge1Line1State->AddDialogAgent(_pHinge1Line1SelLisAgent);
	_pHinge1Line1State->AddDialogAgent(_pHinge1Line2SelLisAgent);
	_pHinge1Line1State->AddDialogAgent(_pHinge1Plane1SelLisAgent);
	_pHinge1Line1State->AddDialogAgent(_pHinge1Plane2SelLisAgent);
	_pHinge1Line1State->AddDialogAgent(_pHinge2Line1SelLisAgent);
	_pHinge1Line1State->AddDialogAgent(_pHinge2Line2SelLisAgent);
	_pHinge1Line1State->AddDialogAgent(_pHinge2Plane1SelLisAgent);
	_pHinge1Line1State->AddDialogAgent(_pHinge2Plane2SelLisAgent);
	_pHinge1Line1State->AddDialogAgent(_pHingeFaceCloseAgent);


	CATDialogState * _pHinge1Plane1State =AddDialogState("选择产品1.平面1");
	_pHinge1Plane1State->AddDialogAgent(_pHinge1Plane1Agent);
	_pHinge1Plane1State->AddDialogAgent(_pHingeFaceOKAgent);
	_pHinge1Plane1State->AddDialogAgent(_pHingeFaceCancleAgent);
	_pHinge1Plane1State->AddDialogAgent(_pHinge1Line1SelLisAgent);
	_pHinge1Plane1State->AddDialogAgent(_pHinge1Line2SelLisAgent);
	_pHinge1Plane1State->AddDialogAgent(_pHinge1Plane1SelLisAgent);
	_pHinge1Plane1State->AddDialogAgent(_pHinge1Plane2SelLisAgent);
	_pHinge1Plane1State->AddDialogAgent(_pHinge2Line1SelLisAgent);
	_pHinge1Plane1State->AddDialogAgent(_pHinge2Line2SelLisAgent);
	_pHinge1Plane1State->AddDialogAgent(_pHinge2Plane1SelLisAgent);
	_pHinge1Plane1State->AddDialogAgent(_pHinge2Plane2SelLisAgent);
	_pHinge1Plane1State->AddDialogAgent(_pHingeFaceCloseAgent);



	CATDialogState * _pHinge1Line2State =AddDialogState("选择产品2.直线2");
	_pHinge1Line2State->AddDialogAgent(_pHinge1Line2Agent);
	_pHinge1Line2State->AddDialogAgent(_pHingeFaceOKAgent);
	_pHinge1Line2State->AddDialogAgent(_pHingeFaceCancleAgent);
	_pHinge1Line2State->AddDialogAgent(_pHinge1Line1SelLisAgent);
	_pHinge1Line2State->AddDialogAgent(_pHinge1Line2SelLisAgent);
	_pHinge1Line2State->AddDialogAgent(_pHinge1Plane1SelLisAgent);
	_pHinge1Line2State->AddDialogAgent(_pHinge1Plane2SelLisAgent);
	_pHinge1Line2State->AddDialogAgent(_pHinge2Line1SelLisAgent);
	_pHinge1Line2State->AddDialogAgent(_pHinge2Line2SelLisAgent);
	_pHinge1Line2State->AddDialogAgent(_pHinge2Plane1SelLisAgent);
	_pHinge1Line2State->AddDialogAgent(_pHinge2Plane2SelLisAgent);
	_pHinge1Line2State->AddDialogAgent(_pHingeFaceCloseAgent);


	CATDialogState * _pHinge1Plane2State =AddDialogState("选择产品2.平面2");
	_pHinge1Plane2State->AddDialogAgent(_pHinge1Plane2Agent);
	_pHinge1Plane2State->AddDialogAgent(_pHingeFaceOKAgent);
	_pHinge1Plane2State->AddDialogAgent(_pHingeFaceCancleAgent);
	_pHinge1Plane2State->AddDialogAgent(_pHinge1Line1SelLisAgent);
	_pHinge1Plane2State->AddDialogAgent(_pHinge1Line2SelLisAgent);
	_pHinge1Plane2State->AddDialogAgent(_pHinge1Plane1SelLisAgent);
	_pHinge1Plane2State->AddDialogAgent(_pHinge1Plane2SelLisAgent);
	_pHinge1Plane2State->AddDialogAgent(_pHinge2Line1SelLisAgent);
	_pHinge1Plane2State->AddDialogAgent(_pHinge2Line2SelLisAgent);
	_pHinge1Plane2State->AddDialogAgent(_pHinge2Plane1SelLisAgent);
	_pHinge1Plane2State->AddDialogAgent(_pHinge2Plane2SelLisAgent);
	_pHinge1Plane2State->AddDialogAgent(_pHingeFaceCloseAgent);





	CATDialogState * _pHinge2Line1State =AddDialogState("选择产品3.直线1");
	_pHinge2Line1State->AddDialogAgent(_pHinge2Line1Agent);
	_pHinge2Line1State->AddDialogAgent(_pHingeFaceOKAgent);
	_pHinge2Line1State->AddDialogAgent(_pHingeFaceCancleAgent);
	_pHinge2Line1State->AddDialogAgent(_pHinge1Line1SelLisAgent);
	_pHinge2Line1State->AddDialogAgent(_pHinge1Line2SelLisAgent);
	_pHinge2Line1State->AddDialogAgent(_pHinge1Plane1SelLisAgent);
	_pHinge2Line1State->AddDialogAgent(_pHinge1Plane2SelLisAgent);
	_pHinge2Line1State->AddDialogAgent(_pHinge2Line1SelLisAgent);
	_pHinge2Line1State->AddDialogAgent(_pHinge2Line2SelLisAgent);
	_pHinge2Line1State->AddDialogAgent(_pHinge2Plane1SelLisAgent);
	_pHinge2Line1State->AddDialogAgent(_pHinge2Plane2SelLisAgent);
	_pHinge2Line1State->AddDialogAgent(_pHingeFaceCloseAgent);


	CATDialogState * _pHinge2Plane1State =AddDialogState("选择产品3.平面1");
	_pHinge2Plane1State->AddDialogAgent(_pHinge2Plane1Agent);
	_pHinge2Plane1State->AddDialogAgent(_pHingeFaceOKAgent);
	_pHinge2Plane1State->AddDialogAgent(_pHingeFaceCancleAgent);
	_pHinge2Plane1State->AddDialogAgent(_pHinge1Line1SelLisAgent);
	_pHinge2Plane1State->AddDialogAgent(_pHinge1Line2SelLisAgent);
	_pHinge2Plane1State->AddDialogAgent(_pHinge1Plane1SelLisAgent);
	_pHinge2Plane1State->AddDialogAgent(_pHinge1Plane2SelLisAgent);
	_pHinge2Plane1State->AddDialogAgent(_pHinge2Line1SelLisAgent);
	_pHinge2Plane1State->AddDialogAgent(_pHinge2Line2SelLisAgent);
	_pHinge2Plane1State->AddDialogAgent(_pHinge2Plane1SelLisAgent);
	_pHinge2Plane1State->AddDialogAgent(_pHinge2Plane2SelLisAgent);
	_pHinge2Plane1State->AddDialogAgent(_pHingeFaceCloseAgent);



	CATDialogState * _pHinge2Line2State =AddDialogState("选择产品4.直线2");
	_pHinge2Line2State->AddDialogAgent(_pHinge2Line2Agent);
	_pHinge2Line2State->AddDialogAgent(_pHingeFaceOKAgent);
	_pHinge2Line2State->AddDialogAgent(_pHingeFaceCancleAgent);
	_pHinge2Line2State->AddDialogAgent(_pHinge1Line1SelLisAgent);
	_pHinge2Line2State->AddDialogAgent(_pHinge1Line2SelLisAgent);
	_pHinge2Line2State->AddDialogAgent(_pHinge1Plane1SelLisAgent);
	_pHinge2Line2State->AddDialogAgent(_pHinge1Plane2SelLisAgent);
	_pHinge2Line2State->AddDialogAgent(_pHinge2Line1SelLisAgent);
	_pHinge2Line2State->AddDialogAgent(_pHinge2Line2SelLisAgent);
	_pHinge2Line2State->AddDialogAgent(_pHinge2Plane1SelLisAgent);
	_pHinge2Line2State->AddDialogAgent(_pHinge2Plane2SelLisAgent);
	_pHinge2Line2State->AddDialogAgent(_pHingeFaceCloseAgent);


	CATDialogState * _pHinge2Plane2State =AddDialogState("选择产品4.平面2");
	_pHinge2Plane2State->AddDialogAgent(_pHinge2Plane2Agent);
	_pHinge2Plane2State->AddDialogAgent(_pHingeFaceOKAgent);
	_pHinge2Plane2State->AddDialogAgent(_pHingeFaceCancleAgent);
	_pHinge2Plane2State->AddDialogAgent(_pHinge1Line1SelLisAgent);
	_pHinge2Plane2State->AddDialogAgent(_pHinge1Line2SelLisAgent);
	_pHinge2Plane2State->AddDialogAgent(_pHinge1Plane1SelLisAgent);
	_pHinge2Plane2State->AddDialogAgent(_pHinge1Plane2SelLisAgent);
	_pHinge2Plane2State->AddDialogAgent(_pHinge2Line1SelLisAgent);
	_pHinge2Plane2State->AddDialogAgent(_pHinge2Line2SelLisAgent);
	_pHinge2Plane2State->AddDialogAgent(_pHinge2Plane1SelLisAgent);
	_pHinge2Plane2State->AddDialogAgent(_pHinge2Plane2SelLisAgent);
	_pHinge2Plane2State->AddDialogAgent(_pHingeFaceCloseAgent);















	CATDialogState * _pUpRotateFacetState =AddDialogState("选择上滚轮面");//等待选择上滚轮
	_pUpRotateFacetState->AddDialogAgent(_pUpRotateFaceAgent);
	_pUpRotateFacetState->AddDialogAgent(_pRotateFaceOKAgent);
	_pUpRotateFacetState->AddDialogAgent(_pRotateFaceCancleAgent);
	_pUpRotateFacetState->AddDialogAgent(_pRotateFaceSelLis1Agent);
	_pUpRotateFacetState->AddDialogAgent(_pRotateFaceSelLis2Agent);
	_pUpRotateFacetState->AddDialogAgent(_pRotateFaceSelLis3Agent);
	_pUpRotateFacetState->AddDialogAgent(_pRotateFaceSelLis4Agent);
	_pUpRotateFacetState->AddDialogAgent(_pRotateFaceSelLis5Agent);
	_pUpRotateFacetState->AddDialogAgent(_pRotateFaceSelLis6Agent);
	_pUpRotateFacetState->AddDialogAgent(_pRotateFaceSelLis7Agent);

	_pUpRotateFacetState->AddDialogAgent(_pRotateFaceCloseAgent);



	CATDialogState * _pMdRotateFacetState =AddDialogState("选择中滚轮承压面");//等待选择中滚轮
	_pMdRotateFacetState->AddDialogAgent(_pMdRotateFaceAgent);
	_pMdRotateFacetState->AddDialogAgent(_pRotateFaceOKAgent);
	_pMdRotateFacetState->AddDialogAgent(_pRotateFaceCancleAgent);
	_pMdRotateFacetState->AddDialogAgent(_pRotateFaceSelLis1Agent);
	_pMdRotateFacetState->AddDialogAgent(_pRotateFaceSelLis2Agent);
	_pMdRotateFacetState->AddDialogAgent(_pRotateFaceSelLis3Agent);
	_pMdRotateFacetState->AddDialogAgent(_pRotateFaceSelLis4Agent);
	_pMdRotateFacetState->AddDialogAgent(_pRotateFaceSelLis5Agent);
	_pMdRotateFacetState->AddDialogAgent(_pRotateFaceSelLis6Agent);
	_pMdRotateFacetState->AddDialogAgent(_pRotateFaceSelLis7Agent);

	_pMdRotateFacetState->AddDialogAgent(_pRotateFaceCloseAgent);

	CATDialogState * _pDwRotateFacetState =AddDialogState("选择下滚轮承压面");//等待选择下滚轮
	_pDwRotateFacetState->AddDialogAgent(_pDwRotateFaceAgent);
	_pDwRotateFacetState->AddDialogAgent(_pRotateFaceOKAgent);
	_pDwRotateFacetState->AddDialogAgent(_pRotateFaceCancleAgent);
	_pDwRotateFacetState->AddDialogAgent(_pRotateFaceSelLis1Agent);
	_pDwRotateFacetState->AddDialogAgent(_pRotateFaceSelLis2Agent);
	_pDwRotateFacetState->AddDialogAgent(_pRotateFaceSelLis3Agent);
	_pDwRotateFacetState->AddDialogAgent(_pRotateFaceSelLis4Agent);
	_pDwRotateFacetState->AddDialogAgent(_pRotateFaceSelLis5Agent);
	_pDwRotateFacetState->AddDialogAgent(_pRotateFaceSelLis6Agent);
	_pDwRotateFacetState->AddDialogAgent(_pRotateFaceSelLis7Agent);

	_pDwRotateFacetState->AddDialogAgent(_pRotateFaceCloseAgent);


	CATDialogState * _pMdRotateDirFacetState =AddDialogState("选择中滚轮导向面1");//中滚轮导向面
	_pMdRotateDirFacetState->AddDialogAgent(_pMdRotateDirFaceAgent);
	_pMdRotateDirFacetState->AddDialogAgent(_pRotateFaceOKAgent);
	_pMdRotateDirFacetState->AddDialogAgent(_pRotateFaceCancleAgent);
	_pMdRotateDirFacetState->AddDialogAgent(_pRotateFaceSelLis1Agent);
	_pMdRotateDirFacetState->AddDialogAgent(_pRotateFaceSelLis2Agent);
	_pMdRotateDirFacetState->AddDialogAgent(_pRotateFaceSelLis3Agent);
	_pMdRotateDirFacetState->AddDialogAgent(_pRotateFaceSelLis4Agent);
	_pMdRotateDirFacetState->AddDialogAgent(_pRotateFaceSelLis5Agent);
	_pMdRotateDirFacetState->AddDialogAgent(_pRotateFaceSelLis6Agent);
	_pMdRotateDirFacetState->AddDialogAgent(_pRotateFaceSelLis7Agent);

	_pMdRotateDirFacetState->AddDialogAgent(_pRotateFaceCloseAgent);

	CATDialogState * _pMdRotateDirFacetState2 =AddDialogState("选择中滚轮导向面2");//中滚轮导向面
	_pMdRotateDirFacetState2->AddDialogAgent(_pMdRotateDirFaceAgent2);
	_pMdRotateDirFacetState2->AddDialogAgent(_pRotateFaceOKAgent);
	_pMdRotateDirFacetState2->AddDialogAgent(_pRotateFaceCancleAgent);
	_pMdRotateDirFacetState2->AddDialogAgent(_pRotateFaceSelLis1Agent);
	_pMdRotateDirFacetState2->AddDialogAgent(_pRotateFaceSelLis2Agent);
	_pMdRotateDirFacetState2->AddDialogAgent(_pRotateFaceSelLis3Agent);
	_pMdRotateDirFacetState2->AddDialogAgent(_pRotateFaceSelLis4Agent);
	_pMdRotateDirFacetState2->AddDialogAgent(_pRotateFaceSelLis5Agent);
	_pMdRotateDirFacetState2->AddDialogAgent(_pRotateFaceSelLis6Agent);
	_pMdRotateDirFacetState2->AddDialogAgent(_pRotateFaceSelLis7Agent);

	_pMdRotateDirFacetState2->AddDialogAgent(_pRotateFaceCloseAgent);
	_pMdRotateDirFacetState2->AddDialogAgent(_pRotateFaceSelLis6Agent);


	CATDialogState * _pDwRotateDirFacetState =AddDialogState("选择下滚轮导向面");//下滚轮导向面
	_pDwRotateDirFacetState->AddDialogAgent(_pDwRotateDirFaceAgent);
	_pDwRotateDirFacetState->AddDialogAgent(_pRotateFaceOKAgent);
	_pDwRotateDirFacetState->AddDialogAgent(_pRotateFaceCancleAgent);
	_pDwRotateDirFacetState->AddDialogAgent(_pRotateFaceSelLis1Agent);
	_pDwRotateDirFacetState->AddDialogAgent(_pRotateFaceSelLis2Agent);
	_pDwRotateDirFacetState->AddDialogAgent(_pRotateFaceSelLis3Agent);
	_pDwRotateDirFacetState->AddDialogAgent(_pRotateFaceSelLis4Agent);
	_pDwRotateDirFacetState->AddDialogAgent(_pRotateFaceSelLis5Agent);
	_pDwRotateDirFacetState->AddDialogAgent(_pRotateFaceSelLis6Agent);
	_pDwRotateDirFacetState->AddDialogAgent(_pRotateFaceSelLis7Agent);

	_pDwRotateDirFacetState->AddDialogAgent(_pRotateFaceCloseAgent);


	CATDialogState * _pDwRotateDirFacetState2 =AddDialogState("选择下滚轮导向面2");//下滚轮导向面
	_pDwRotateDirFacetState2->AddDialogAgent(_pDwRotateDirFaceAgent2);
	_pDwRotateDirFacetState2->AddDialogAgent(_pRotateFaceOKAgent);
	_pDwRotateDirFacetState2->AddDialogAgent(_pRotateFaceCancleAgent);
	_pDwRotateDirFacetState2->AddDialogAgent(_pRotateFaceSelLis1Agent);
	_pDwRotateDirFacetState2->AddDialogAgent(_pRotateFaceSelLis2Agent);
	_pDwRotateDirFacetState2->AddDialogAgent(_pRotateFaceSelLis3Agent);
	_pDwRotateDirFacetState2->AddDialogAgent(_pRotateFaceSelLis4Agent);
	_pDwRotateDirFacetState2->AddDialogAgent(_pRotateFaceSelLis5Agent);
	_pDwRotateDirFacetState2->AddDialogAgent(_pRotateFaceSelLis6Agent);
	_pDwRotateDirFacetState2->AddDialogAgent(_pRotateFaceSelLis7Agent);

	_pDwRotateDirFacetState2->AddDialogAgent(_pRotateFaceCloseAgent);



	CATDialogState * _pBodySelState =AddDialogState("选择车身");//等待选择车身
	_pBodySelState->AddDialogAgent(_pBodyAgent);
	_pBodySelState->AddDialogAgent(_pBodyOKAgent);
	_pBodySelState->AddDialogAgent(_pBodyCancleAgent);
	_pBodySelState->AddDialogAgent(_pBodyelLis1Agent);
	_pBodySelState->AddDialogAgent(_pBodySelLis2Agent);
	_pBodySelState->AddDialogAgent(_pBodyCloseAgent);


	CATDialogState * _pBodyPartSelState =AddDialogState("选择车身固联体");//等待选择车身固联体
	_pBodyPartSelState->AddDialogAgent(_pBodyPartAgent);
	_pBodyPartSelState->AddDialogAgent(_pBodyOKAgent);
	_pBodyPartSelState->AddDialogAgent(_pBodyCancleAgent);
	_pBodyPartSelState->AddDialogAgent(_pBodyelLis1Agent);
	_pBodyPartSelState->AddDialogAgent(_pBodySelLis2Agent);
	_pBodyPartSelState->AddDialogAgent(_pBodyCloseAgent);
	_pBodyPartSelState -> AddDialogAgent ( _pdaClearSeat1Select );



	CATDialogState * _pDoorSelState =AddDialogState("选择车门");//等待选择车门
	_pDoorSelState->AddDialogAgent(_pDoorAgent);
	_pDoorSelState->AddDialogAgent(_pDoorOKAgent);
	_pDoorSelState->AddDialogAgent(_pDoorCancleAgent);
	_pDoorSelState->AddDialogAgent(_pDoorelLis1Agent);
	_pDoorSelState->AddDialogAgent(_pDoorSelLis2Agent);
	_pDoorSelState->AddDialogAgent(_pDoorCloseAgent);

	CATDialogState * _pDoorPartSelState =AddDialogState("选择车门固联体");//等待选择车门固联体
	_pDoorPartSelState->AddDialogAgent(_pDoorPartAgent);
	_pDoorPartSelState->AddDialogAgent(_pDoorOKAgent);
	_pDoorPartSelState->AddDialogAgent(_pDoorCancleAgent);
	_pDoorPartSelState->AddDialogAgent(_pDoorelLis1Agent);
	_pDoorPartSelState->AddDialogAgent(_pDoorSelLis2Agent);
	_pDoorPartSelState->AddDialogAgent(_pDoorCloseAgent);
	_pDoorPartSelState -> AddDialogAgent ( _pdaClearSeat2Select );


	CATDialogState * _pSwepTPartSelState =AddDialogState("选择包络体零件");//等待选择车门固联体
	_pSwepTPartSelState->AddDialogAgent(_pSwepTPartAgent);
	_pSwepTPartSelState->AddDialogAgent(_pSweptOKAgent);
	_pSwepTPartSelState->AddDialogAgent(_pSweptCancleAgent);
	_pSwepTPartSelState->AddDialogAgent(_pSweptelListAgent);
	_pSwepTPartSelState->AddDialogAgent(_pSweptCloseAgent);





//	主界面选择状态
	AddTransition ( _pIniButtonState , _pUpRailFacetState,IsOutputSetCondition ( _pRailButtonAgent ) ,//--------
		Action ( ( ActionMethod ) &TestCmd::OnPushButton133PushBActivateNotification ) );

	AddTransition ( _pIniButtonState , _pHinge1Line1State,IsOutputSetCondition ( _pHingeButtonAgent ) ,//--------
		Action ( ( ActionMethod ) &TestCmd::OnPushButton135PushBActivateNotification ) );

	AddTransition ( _pIniButtonState , _pUpRotateFacetState,IsOutputSetCondition ( _pRotateButtonAgent ) ,//--------
		Action ( ( ActionMethod ) &TestCmd::OnPushButton136PushBActivateNotification ) );

	AddTransition ( _pIniButtonState , _pBodySelState,IsOutputSetCondition ( _pBodyButtonAgent ) ,//--------
		Action ( ( ActionMethod ) &TestCmd::OnPushButton139PushBActivateNotification ) );

	AddTransition ( _pIniButtonState , _pDoorSelState,IsOutputSetCondition ( _pDoorButtonAgent ) ,//--------
		Action ( ( ActionMethod ) &TestCmd::OnPushButton140PushBActivateNotification ) );

	AddTransition ( _pIniButtonState , _pSwepTPartSelState,IsOutputSetCondition ( _pSweptButtonAgent ) ,//--------
		Action ( ( ActionMethod ) &TestCmd::OnPushButton186PushBActivateNotification ) );

	AddTransition ( _pIniButtonState , _pRefPartSelState,IsOutputSetCondition ( _pRefListAgent ) ,//--------
		Action ( ( ActionMethod ) &TestCmd::OnSelectorList159ListSelectNotification ) );




	AddTransition ( _pIniButtonState , NULL,IsOutputSetCondition ( _pPanelOKAgent ) ,//--------
		Action ( ( ActionMethod ) &TestCmd::OnTestDlgDiaOKNotification ) );

	AddTransition ( _pIniButtonState , NULL,IsOutputSetCondition ( _pPanelCancelAgent ) ,//--------
		Action ( ( ActionMethod ) &TestCmd::OnTestDlgDiaCANCELNotification ) );

	AddTransition ( _pIniButtonState , NULL,IsOutputSetCondition ( _pPanelCloseAgent ) ,//--------
		Action ( ( ActionMethod ) &TestCmd::OnTestDlgDiaCLOSENotification ) );



	//参考零件选择状态
	AddTransition ( _pRefPartSelState , _pRefPartSelState,IsOutputSetCondition ( _pRefListAgent ) ,//--------
		Action ( ( ActionMethod ) &TestCmd::OnSelectorList159ListSelectNotification ) );

	AddTransition ( _pRefPartSelState , _pIniButtonState,IsOutputSetCondition ( _pRefPartAgent ) ,//--------
		Action ( ( ActionMethod ) &TestCmd::ChooseRefPart ) );

	AddTransition ( _pRefPartSelState , NULL,IsOutputSetCondition ( _pPanelOKAgent ) ,//--------
		Action ( ( ActionMethod ) &TestCmd::OnTestDlgDiaOKNotification ) );

	AddTransition ( _pRefPartSelState , NULL,IsOutputSetCondition ( _pPanelCancelAgent ) ,//--------
		Action ( ( ActionMethod ) &TestCmd::OnTestDlgDiaCANCELNotification ) );

	AddTransition ( _pRefPartSelState , NULL,IsOutputSetCondition ( _pPanelCloseAgent ) ,//--------
		Action ( ( ActionMethod ) &TestCmd::OnTestDlgDiaCLOSENotification ) );


//	// 轨道选择状态

	AddTransition ( _pUpRailFacetState , _pMdRailFacetState,IsOutputSetCondition ( _pUpRollingFaceAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::ChooseUpRailSurface ) );

	AddTransition ( _pUpRailFacetState , _pUpRailFacetState,IsOutputSetCondition ( _pRollingFaceSelLis1Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList007ListSelectNotification ) );//

	AddTransition ( _pUpRailFacetState , _pMdRailFacetState,IsOutputSetCondition ( _pRollingFaceSelLis2Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList008ListSelectNotification ) );// _pRollingFaceCancleAgentChooseRailSelectList2

	AddTransition ( _pUpRailFacetState , _pDwRailFacetState,IsOutputSetCondition ( _pRollingFaceSelLis3Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList009ListSelectNotification ) );

	AddTransition ( _pUpRailFacetState , _pMdBearFacetState,IsOutputSetCondition ( _pRollingFaceSelLis4Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList011ListSelectNotification ) );

	AddTransition ( _pUpRailFacetState , _pDwBearFacetState,IsOutputSetCondition ( _pRollingFaceSelLis5Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList017ListSelectNotification ) );

	AddTransition ( _pUpRailFacetState , _pIniButtonState,IsOutputSetCondition ( _pRollingFaceOKAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailDlgDiaOKNotification ) );

	AddTransition ( _pUpRailFacetState , _pIniButtonState,IsOutputSetCondition ( _pRollingFaceCancleAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailDlgDiaCANCELNotification ) );

	AddTransition ( _pUpRailFacetState , _pIniButtonState,IsOutputSetCondition ( _pRollingFaceCloseAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailDlgDiaCLOSENotification ) );



	AddTransition ( _pMdRailFacetState , _pDwRailFacetState,IsOutputSetCondition ( _pMdRollingFaceAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::ChooseMdRailSurface ) );
	AddTransition ( _pMdRailFacetState , _pUpRailFacetState,IsOutputSetCondition ( _pRollingFaceSelLis1Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList007ListSelectNotification ) );
	AddTransition ( _pMdRailFacetState , _pMdRailFacetState,IsOutputSetCondition ( _pRollingFaceSelLis2Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList008ListSelectNotification ) );
	AddTransition ( _pMdRailFacetState , _pDwRailFacetState,IsOutputSetCondition ( _pRollingFaceSelLis3Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList009ListSelectNotification ) );
	AddTransition ( _pMdRailFacetState , _pMdBearFacetState,IsOutputSetCondition ( _pRollingFaceSelLis4Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList011ListSelectNotification ) );

	AddTransition ( _pMdRailFacetState , _pDwBearFacetState,IsOutputSetCondition ( _pRollingFaceSelLis5Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList017ListSelectNotification ) );

	AddTransition ( _pMdRailFacetState , _pIniButtonState,IsOutputSetCondition ( _pRollingFaceOKAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::OnRailDlgDiaOKNotification ) );
	AddTransition ( _pMdRailFacetState , _pIniButtonState,IsOutputSetCondition ( _pRollingFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnRailDlgDiaCANCELNotification1 ) );
	AddTransition ( _pMdRailFacetState , _pIniButtonState,IsOutputSetCondition ( _pRollingFaceCloseAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailDlgDiaCLOSENotification ) );



	AddTransition ( _pDwRailFacetState , _pDwBearFacetState,IsOutputSetCondition ( _pDwRollingFaceAgent ) ,//-----下轨道面
		Action ( ( ActionMethod ) &TestCmd::ChooseDwRailSurface ) );
	AddTransition ( _pDwRailFacetState , _pUpRailFacetState,IsOutputSetCondition ( _pRollingFaceSelLis1Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList007ListSelectNotification ) );
	AddTransition ( _pDwRailFacetState , _pMdRailFacetState,IsOutputSetCondition ( _pRollingFaceSelLis2Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList008ListSelectNotification ) );
	AddTransition ( _pDwRailFacetState , _pDwRailFacetState,IsOutputSetCondition ( _pRollingFaceSelLis3Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList009ListSelectNotification ) );
	AddTransition ( _pDwRailFacetState , _pMdBearFacetState,IsOutputSetCondition ( _pRollingFaceSelLis4Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList011ListSelectNotification ) );

	AddTransition ( _pDwRailFacetState , _pDwBearFacetState,IsOutputSetCondition ( _pRollingFaceSelLis5Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList017ListSelectNotification ) );

	AddTransition ( _pDwRailFacetState , _pIniButtonState,IsOutputSetCondition ( _pRollingFaceOKAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::OnRailDlgDiaOKNotification ) );
	AddTransition ( _pDwRailFacetState , _pIniButtonState,IsOutputSetCondition ( _pRollingFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnRailDlgDiaCANCELNotification2 ) );
	AddTransition ( _pDwRailFacetState , _pIniButtonState,IsOutputSetCondition ( _pRollingFaceCloseAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailDlgDiaCLOSENotification ) );



	AddTransition ( _pMdBearFacetState , _pMdBearFacetState,IsOutputSetCondition ( _pMdBearFaceAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::ChooseMdBearSurface ) );
	AddTransition ( _pMdBearFacetState , _pUpRailFacetState,IsOutputSetCondition ( _pRollingFaceSelLis1Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList007ListSelectNotification ) );
	AddTransition ( _pMdBearFacetState , _pMdRailFacetState,IsOutputSetCondition ( _pRollingFaceSelLis2Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList008ListSelectNotification ) );
	AddTransition ( _pMdBearFacetState , _pDwRailFacetState,IsOutputSetCondition ( _pRollingFaceSelLis3Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList009ListSelectNotification ) );
	AddTransition ( _pMdBearFacetState , _pMdBearFacetState,IsOutputSetCondition ( _pRollingFaceSelLis4Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList011ListSelectNotification ) );

	AddTransition ( _pMdBearFacetState , _pDwBearFacetState,IsOutputSetCondition ( _pRollingFaceSelLis5Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList017ListSelectNotification ) );

	AddTransition ( _pMdBearFacetState , _pIniButtonState,IsOutputSetCondition ( _pRollingFaceOKAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::OnRailDlgDiaOKNotification ) );
	AddTransition ( _pMdBearFacetState , _pIniButtonState,IsOutputSetCondition ( _pRollingFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnRailDlgDiaCANCELNotification2 ) );
	AddTransition ( _pMdBearFacetState , _pIniButtonState,IsOutputSetCondition ( _pRollingFaceCloseAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailDlgDiaCLOSENotification ) );


	AddTransition ( _pDwBearFacetState , _pDwBearFacetState,IsOutputSetCondition ( _pDwBearFaceAgent ) ,//-----下轨道承压面
		Action ( ( ActionMethod ) &TestCmd::ChooseDwBearSurface ) );
	AddTransition ( _pDwBearFacetState , _pUpRailFacetState,IsOutputSetCondition ( _pRollingFaceSelLis1Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList007ListSelectNotification ) );
	AddTransition ( _pDwBearFacetState , _pMdRailFacetState,IsOutputSetCondition ( _pRollingFaceSelLis2Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList008ListSelectNotification ) );
	AddTransition ( _pDwBearFacetState , _pDwRailFacetState,IsOutputSetCondition ( _pRollingFaceSelLis3Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList009ListSelectNotification ) );
	AddTransition ( _pDwBearFacetState , _pMdBearFacetState,IsOutputSetCondition ( _pRollingFaceSelLis4Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList011ListSelectNotification ) );

	AddTransition ( _pDwBearFacetState , _pDwBearFacetState,IsOutputSetCondition ( _pRollingFaceSelLis5Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailSelectorList017ListSelectNotification ) );

	AddTransition ( _pDwBearFacetState , _pIniButtonState,IsOutputSetCondition ( _pRollingFaceOKAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::OnRailDlgDiaOKNotification ) );
	AddTransition ( _pDwBearFacetState , _pIniButtonState,IsOutputSetCondition ( _pRollingFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnRailDlgDiaCANCELNotification2 ) );
	AddTransition ( _pDwBearFacetState , _pIniButtonState,IsOutputSetCondition ( _pRollingFaceCloseAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRailDlgDiaCLOSENotification ) );






//铰链选择状态转换

//hinge1
	AddTransition ( _pHinge1Line1State , _pHinge1Line2State,IsOutputSetCondition ( _pHinge1Line1Agent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::ChooseHinge1Line1 ) );

	AddTransition ( _pHinge1Line1State , _pHinge1Line1State,IsOutputSetCondition ( _pHinge1Line1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList006ListSelectNotification ) );
	AddTransition ( _pHinge1Line1State , _pHinge1Line2State,IsOutputSetCondition ( _pHinge1Line2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList012ListSelectNotification ) );
	AddTransition ( _pHinge1Line1State , _pHinge1Plane1State,IsOutputSetCondition ( _pHinge1Plane1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList014ListSelectNotification ) );
	AddTransition ( _pHinge1Line1State , _pHinge1Plane2State,IsOutputSetCondition ( _pHinge1Plane2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList016ListSelectNotification ) );

	AddTransition ( _pHinge1Line1State , _pHinge2Line1State,IsOutputSetCondition ( _pHinge2Line1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList007ListSelectNotification ) );
	AddTransition ( _pHinge1Line1State , _pHinge2Line2State,IsOutputSetCondition ( _pHinge2Line2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList018ListSelectNotification ) );
	AddTransition ( _pHinge1Line1State , _pHinge2Plane1State,IsOutputSetCondition ( _pHinge2Plane1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList020ListSelectNotification ) );
	AddTransition ( _pHinge1Line1State , _pHinge2Plane2State,IsOutputSetCondition ( _pHinge2Plane2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList022ListSelectNotification ) );

	AddTransition ( _pHinge1Line1State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceOKAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaOKNotification ) );
	AddTransition ( _pHinge1Line1State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaCANCELNotification ) );
	AddTransition ( _pHinge1Line1State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceCloseAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaCloseNotification ) );




	AddTransition ( _pHinge1Line2State , _pHinge1Plane1State,IsOutputSetCondition ( _pHinge1Line2Agent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::ChooseHinge1Line2 ) );

	AddTransition ( _pHinge1Line2State , _pHinge1Line1State,IsOutputSetCondition ( _pHinge1Line1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList006ListSelectNotification ) );
	AddTransition ( _pHinge1Line2State , _pHinge1Line2State,IsOutputSetCondition ( _pHinge1Line2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList012ListSelectNotification ) );
	AddTransition ( _pHinge1Line2State , _pHinge1Plane1State,IsOutputSetCondition ( _pHinge1Plane1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList014ListSelectNotification ) );
	AddTransition ( _pHinge1Line2State , _pHinge1Plane2State,IsOutputSetCondition ( _pHinge1Plane2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList016ListSelectNotification ) );

	AddTransition ( _pHinge1Line2State , _pHinge2Line1State,IsOutputSetCondition ( _pHinge2Line1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList007ListSelectNotification ) );
	AddTransition ( _pHinge1Line2State , _pHinge2Line2State,IsOutputSetCondition ( _pHinge2Line2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList018ListSelectNotification ) );
	AddTransition ( _pHinge1Line2State , _pHinge2Plane1State,IsOutputSetCondition ( _pHinge2Plane1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList020ListSelectNotification ) );
	AddTransition ( _pHinge1Line2State , _pHinge2Plane2State,IsOutputSetCondition ( _pHinge2Plane2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList022ListSelectNotification ) );

	AddTransition ( _pHinge1Line2State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceOKAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaOKNotification ) );
	AddTransition ( _pHinge1Line2State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaCANCELNotification ) );
	AddTransition ( _pHinge1Line2State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceCloseAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaCloseNotification ) );





	AddTransition ( _pHinge1Plane1State , _pHinge1Plane2State,IsOutputSetCondition ( _pHinge1Plane1Agent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::ChooseHinge1Plane1 ) );

	AddTransition ( _pHinge1Plane1State , _pHinge1Line1State,IsOutputSetCondition ( _pHinge1Line1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList006ListSelectNotification ) );
	AddTransition ( _pHinge1Plane1State , _pHinge1Line2State,IsOutputSetCondition ( _pHinge1Line2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList012ListSelectNotification ) );
	AddTransition ( _pHinge1Plane1State , _pHinge1Plane1State,IsOutputSetCondition ( _pHinge1Plane1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList014ListSelectNotification ) );
	AddTransition ( _pHinge1Plane1State , _pHinge1Plane2State,IsOutputSetCondition ( _pHinge1Plane2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList016ListSelectNotification ) );

	AddTransition ( _pHinge1Plane1State , _pHinge2Line1State,IsOutputSetCondition ( _pHinge2Line1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList007ListSelectNotification ) );
	AddTransition ( _pHinge1Plane1State , _pHinge2Line2State,IsOutputSetCondition ( _pHinge2Line2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList018ListSelectNotification ) );
	AddTransition ( _pHinge1Plane1State , _pHinge2Plane1State,IsOutputSetCondition ( _pHinge2Plane1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList020ListSelectNotification ) );
	AddTransition ( _pHinge1Plane1State , _pHinge2Plane2State,IsOutputSetCondition ( _pHinge2Plane2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList022ListSelectNotification ) );

	AddTransition ( _pHinge1Plane1State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceOKAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaOKNotification ) );
	AddTransition ( _pHinge1Plane1State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaCANCELNotification ) );
	AddTransition ( _pHinge1Plane1State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceCloseAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaCloseNotification ) );





	AddTransition ( _pHinge1Plane2State , _pHinge2Line1State,IsOutputSetCondition ( _pHinge1Plane2Agent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::ChooseHinge1Plane2 ) );

	AddTransition ( _pHinge1Plane2State , _pHinge1Line1State,IsOutputSetCondition ( _pHinge1Line1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList006ListSelectNotification ) );
	AddTransition ( _pHinge1Plane2State , _pHinge1Line2State,IsOutputSetCondition ( _pHinge1Line2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList012ListSelectNotification ) );
	AddTransition ( _pHinge1Plane2State , _pHinge1Plane1State,IsOutputSetCondition ( _pHinge1Plane1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList014ListSelectNotification ) );
	AddTransition ( _pHinge1Plane2State , _pHinge1Plane2State,IsOutputSetCondition ( _pHinge1Plane2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList016ListSelectNotification ) );

	AddTransition ( _pHinge1Plane2State , _pHinge2Line1State,IsOutputSetCondition ( _pHinge2Line1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList007ListSelectNotification ) );
	AddTransition ( _pHinge1Plane2State , _pHinge2Line2State,IsOutputSetCondition ( _pHinge2Line2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList018ListSelectNotification ) );
	AddTransition ( _pHinge1Plane2State , _pHinge2Plane1State,IsOutputSetCondition ( _pHinge2Plane1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList020ListSelectNotification ) );
	AddTransition ( _pHinge1Plane2State , _pHinge2Plane2State,IsOutputSetCondition ( _pHinge2Plane2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList022ListSelectNotification ) );

	AddTransition ( _pHinge1Plane2State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceOKAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaOKNotification ) );
	AddTransition ( _pHinge1Plane2State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaCANCELNotification ) );
	AddTransition ( _pHinge1Plane2State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceCloseAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaCloseNotification ) );






//hinge2

	AddTransition ( _pHinge2Line1State , _pHinge2Line2State,IsOutputSetCondition ( _pHinge2Line1Agent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::ChooseHinge2Line1) );

	AddTransition ( _pHinge2Line1State , _pHinge1Line1State,IsOutputSetCondition ( _pHinge1Line1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList006ListSelectNotification ) );
	AddTransition ( _pHinge2Line1State , _pHinge1Line2State,IsOutputSetCondition ( _pHinge1Line2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList012ListSelectNotification ) );
	AddTransition ( _pHinge2Line1State , _pHinge1Plane1State,IsOutputSetCondition ( _pHinge1Plane1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList014ListSelectNotification ) );
	AddTransition ( _pHinge2Line1State , _pHinge1Plane2State,IsOutputSetCondition ( _pHinge1Plane2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList016ListSelectNotification ) );

	AddTransition ( _pHinge2Line1State , _pHinge2Line1State,IsOutputSetCondition ( _pHinge2Line1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList007ListSelectNotification ) );
	AddTransition ( _pHinge2Line1State , _pHinge2Line2State,IsOutputSetCondition ( _pHinge2Line2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList018ListSelectNotification ) );
	AddTransition ( _pHinge2Line1State , _pHinge2Plane1State,IsOutputSetCondition ( _pHinge2Plane1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList020ListSelectNotification ) );
	AddTransition ( _pHinge2Line1State , _pHinge2Plane2State,IsOutputSetCondition ( _pHinge2Plane2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList022ListSelectNotification ) );

	AddTransition ( _pHinge2Line1State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceOKAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaOKNotification ) );
	AddTransition ( _pHinge2Line1State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaCANCELNotification ) );
	AddTransition ( _pHinge2Line1State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceCloseAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaCloseNotification ) );



	AddTransition ( _pHinge2Line2State , _pHinge2Plane1State,IsOutputSetCondition ( _pHinge2Line2Agent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::ChooseHinge2Line2) );

	AddTransition ( _pHinge2Line2State , _pHinge1Line1State,IsOutputSetCondition ( _pHinge1Line1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList006ListSelectNotification ) );
	AddTransition ( _pHinge2Line2State , _pHinge1Line2State,IsOutputSetCondition ( _pHinge1Line2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList012ListSelectNotification ) );
	AddTransition ( _pHinge2Line2State , _pHinge1Plane1State,IsOutputSetCondition ( _pHinge1Plane1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList014ListSelectNotification ) );
	AddTransition ( _pHinge2Line2State , _pHinge1Plane2State,IsOutputSetCondition ( _pHinge1Plane2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList016ListSelectNotification ) );

	AddTransition ( _pHinge2Line2State , _pHinge2Line1State,IsOutputSetCondition ( _pHinge2Line1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList007ListSelectNotification ) );
	AddTransition ( _pHinge2Line2State , _pHinge2Line2State,IsOutputSetCondition ( _pHinge2Line2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList018ListSelectNotification ) );
	AddTransition ( _pHinge2Line2State , _pHinge2Plane1State,IsOutputSetCondition ( _pHinge2Plane1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList020ListSelectNotification ) );
	AddTransition ( _pHinge2Line2State , _pHinge2Plane2State,IsOutputSetCondition ( _pHinge2Plane2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList022ListSelectNotification ) );

	AddTransition ( _pHinge2Line2State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceOKAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaOKNotification ) );
	AddTransition ( _pHinge2Line2State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaCANCELNotification ) );
	AddTransition ( _pHinge2Line2State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceCloseAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaCloseNotification ) );



	AddTransition ( _pHinge2Plane1State , _pHinge2Plane2State,IsOutputSetCondition ( _pHinge2Plane1Agent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::ChooseHinge2Plane1) );

	AddTransition ( _pHinge2Plane1State , _pHinge1Line1State,IsOutputSetCondition ( _pHinge1Line1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList006ListSelectNotification ) );
	AddTransition ( _pHinge2Plane1State , _pHinge1Line2State,IsOutputSetCondition ( _pHinge1Line2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList012ListSelectNotification ) );
	AddTransition ( _pHinge2Plane1State , _pHinge1Plane1State,IsOutputSetCondition ( _pHinge1Plane1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList014ListSelectNotification ) );
	AddTransition ( _pHinge2Plane1State , _pHinge1Plane2State,IsOutputSetCondition ( _pHinge1Plane2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList016ListSelectNotification ) );

	AddTransition ( _pHinge2Plane1State , _pHinge2Line1State,IsOutputSetCondition ( _pHinge2Line1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList007ListSelectNotification ) );
	AddTransition ( _pHinge2Plane1State , _pHinge2Line2State,IsOutputSetCondition ( _pHinge2Line2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList018ListSelectNotification ) );
	AddTransition ( _pHinge2Plane1State , _pHinge2Plane1State,IsOutputSetCondition ( _pHinge2Plane1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList020ListSelectNotification ) );
	AddTransition ( _pHinge2Plane1State , _pHinge2Plane2State,IsOutputSetCondition ( _pHinge2Plane2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList022ListSelectNotification ) );

	AddTransition ( _pHinge2Plane1State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceOKAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaOKNotification ) );
	AddTransition ( _pHinge2Plane1State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaCANCELNotification ) );
	AddTransition ( _pHinge2Plane1State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceCloseAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaCloseNotification ) );



	AddTransition ( _pHinge2Plane2State , _pHinge2Plane2State,IsOutputSetCondition ( _pHinge2Plane2Agent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::ChooseHinge2Plane2) );

	AddTransition ( _pHinge2Plane2State , _pHinge1Line1State,IsOutputSetCondition ( _pHinge1Line1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList006ListSelectNotification ) );
	AddTransition ( _pHinge2Plane2State , _pHinge1Line2State,IsOutputSetCondition ( _pHinge1Line2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList012ListSelectNotification ) );
	AddTransition ( _pHinge2Plane2State , _pHinge1Plane1State,IsOutputSetCondition ( _pHinge1Plane1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList014ListSelectNotification ) );
	AddTransition ( _pHinge2Plane2State , _pHinge1Plane2State,IsOutputSetCondition ( _pHinge1Plane2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList016ListSelectNotification ) );

	AddTransition ( _pHinge2Plane2State , _pHinge2Line1State,IsOutputSetCondition ( _pHinge2Line1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList007ListSelectNotification ) );
	AddTransition ( _pHinge2Plane2State , _pHinge2Line2State,IsOutputSetCondition ( _pHinge2Line2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList018ListSelectNotification ) );
	AddTransition ( _pHinge2Plane2State , _pHinge2Plane1State,IsOutputSetCondition ( _pHinge2Plane1SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList020ListSelectNotification ) );
	AddTransition ( _pHinge2Plane2State , _pHinge2Plane2State,IsOutputSetCondition ( _pHinge2Plane2SelLisAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnHingeSelectorList022ListSelectNotification ) );

	AddTransition ( _pHinge2Plane2State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceOKAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaOKNotification ) );
	AddTransition ( _pHinge2Plane2State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaCANCELNotification ) );
	AddTransition ( _pHinge2Plane2State , _pIniButtonState,IsOutputSetCondition ( _pHingeFaceCloseAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnHingeDlgDiaCloseNotification ) );



//滚轮选择状态

	AddTransition ( _pUpRotateFacetState , _pMdRotateDirFacetState,IsOutputSetCondition ( _pUpRotateFaceAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::ChooseUpRotateSurface ) );

	AddTransition ( _pUpRotateFacetState , _pUpRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis1Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList006ListSelectNotification ) );//

	AddTransition ( _pUpRotateFacetState , _pMdRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis2Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList007ListSelectNotification ) );// _pRotateFaceCancleAgentChooseRotateSelectList2

	AddTransition ( _pUpRotateFacetState , _pMdRotateDirFacetState,IsOutputSetCondition ( _pRotateFaceSelLis3Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList012ListSelectNotification ) );

	AddTransition ( _pUpRotateFacetState , _pDwRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis4Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList008ListSelectNotification ) );

	AddTransition ( _pUpRotateFacetState , _pMdRotateDirFacetState2,IsOutputSetCondition ( _pRotateFaceSelLis6Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSelectorListMdRot2ListSelectNotification ) );
	AddTransition ( _pUpRotateFacetState , _pDwRotateDirFacetState2,IsOutputSetCondition ( _pRotateFaceSelLis7Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSelectorListDnRot2ListSelectNotification ) );


	AddTransition ( _pUpRotateFacetState , _pDwRotateDirFacetState,IsOutputSetCondition ( _pRotateFaceSelLis5Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList014ListSelectNotification ) );

	AddTransition ( _pUpRotateFacetState , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceOKAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaOKNotification ) );

	AddTransition ( _pUpRotateFacetState , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceCancleAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaCANCELNotification ) );
	AddTransition ( _pUpRotateFacetState , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceCloseAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaCloseNotification ) );



	AddTransition ( _pMdRotateFacetState , _pMdRotateFacetState,IsOutputSetCondition ( _pMdRotateFaceAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::ChooseMdRotateSurface ) );
	AddTransition ( _pMdRotateFacetState , _pUpRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis1Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList006ListSelectNotification ) );
	AddTransition ( _pMdRotateFacetState , _pMdRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis2Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList007ListSelectNotification ) );
	AddTransition ( _pMdRotateFacetState , _pMdRotateDirFacetState,IsOutputSetCondition ( _pRotateFaceSelLis3Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList012ListSelectNotification ) );
	AddTransition ( _pMdRotateFacetState , _pDwRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis4Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList008ListSelectNotification ) );

	AddTransition ( _pMdRotateFacetState , _pMdRotateDirFacetState2,IsOutputSetCondition ( _pRotateFaceSelLis6Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSelectorListMdRot2ListSelectNotification ) );
	AddTransition ( _pMdRotateFacetState , _pDwRotateDirFacetState2,IsOutputSetCondition ( _pRotateFaceSelLis7Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSelectorListDnRot2ListSelectNotification ) );

	AddTransition ( _pMdRotateFacetState , _pDwRotateDirFacetState,IsOutputSetCondition ( _pRotateFaceSelLis5Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList014ListSelectNotification ) );


	AddTransition ( _pMdRotateFacetState , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceOKAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaOKNotification ) );
	AddTransition ( _pMdRotateFacetState , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaCANCELNotification ) );
	AddTransition ( _pMdRotateFacetState , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceCloseAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaCloseNotification ) );



	AddTransition ( _pDwRotateFacetState , _pDwRotateDirFacetState,IsOutputSetCondition ( _pDwRotateFaceAgent ) ,//-----下承压滚轮面
		Action ( ( ActionMethod ) &TestCmd::ChooseDwRotateSurface ) );
	AddTransition ( _pDwRotateFacetState , _pUpRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis1Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList006ListSelectNotification ) );
	AddTransition ( _pDwRotateFacetState , _pMdRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis2Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList007ListSelectNotification ) );
	AddTransition ( _pDwRotateFacetState ,_pMdRotateDirFacetState ,IsOutputSetCondition ( _pRotateFaceSelLis3Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList012ListSelectNotification ) );
	AddTransition ( _pDwRotateFacetState ,_pDwRotateFacetState ,IsOutputSetCondition ( _pRotateFaceSelLis4Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList008ListSelectNotification ) );

	AddTransition ( _pDwRotateFacetState , _pDwRotateDirFacetState,IsOutputSetCondition ( _pRotateFaceSelLis5Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList014ListSelectNotification ) );
	AddTransition ( _pDwRotateFacetState , _pMdRotateDirFacetState2,IsOutputSetCondition ( _pRotateFaceSelLis6Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSelectorListMdRot2ListSelectNotification ) );
	AddTransition ( _pDwRotateFacetState , _pDwRotateDirFacetState2,IsOutputSetCondition ( _pRotateFaceSelLis7Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSelectorListDnRot2ListSelectNotification ) );
	AddTransition ( _pDwRotateFacetState , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceOKAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaOKNotification ) );
	AddTransition ( _pDwRotateFacetState , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaCANCELNotification ) );
	AddTransition ( _pDwRotateFacetState , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceCloseAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaCloseNotification ) );










	AddTransition ( _pMdRotateDirFacetState , _pMdRotateDirFacetState2,IsOutputSetCondition ( _pMdRotateDirFaceAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::ChooseMdDirRotateSurface ) );
	AddTransition ( _pMdRotateDirFacetState , _pUpRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis1Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList006ListSelectNotification ) );
	AddTransition ( _pMdRotateDirFacetState , _pMdRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis2Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList007ListSelectNotification ) );
	AddTransition ( _pMdRotateDirFacetState ,_pMdRotateDirFacetState ,IsOutputSetCondition ( _pRotateFaceSelLis3Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList012ListSelectNotification ) );
	AddTransition ( _pMdRotateDirFacetState , _pDwRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis4Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList008ListSelectNotification ) );

	AddTransition ( _pMdRotateDirFacetState , _pDwRotateDirFacetState,IsOutputSetCondition ( _pRotateFaceSelLis5Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList014ListSelectNotification ) );
	AddTransition ( _pMdRotateDirFacetState , _pMdRotateDirFacetState2,IsOutputSetCondition ( _pRotateFaceSelLis6Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSelectorListMdRot2ListSelectNotification ) );
	AddTransition ( _pMdRotateDirFacetState , _pDwRotateDirFacetState2,IsOutputSetCondition ( _pRotateFaceSelLis7Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSelectorListDnRot2ListSelectNotification ) );
	AddTransition ( _pMdRotateDirFacetState , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceOKAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaOKNotification ) );
	AddTransition ( _pMdRotateDirFacetState , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaCANCELNotification ) );
	AddTransition ( _pMdRotateDirFacetState , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceCloseAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaCloseNotification ) );


	AddTransition ( _pMdRotateDirFacetState2 , _pDwRotateFacetState,IsOutputSetCondition ( _pMdRotateDirFaceAgent2 ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::ChooseMdDirRotateSurface2 ) );
	AddTransition ( _pMdRotateDirFacetState2 , _pUpRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis1Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList006ListSelectNotification ) );
	AddTransition ( _pMdRotateDirFacetState2 , _pMdRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis2Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList007ListSelectNotification ) );
	AddTransition ( _pMdRotateDirFacetState2 ,_pMdRotateDirFacetState ,IsOutputSetCondition ( _pRotateFaceSelLis3Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList012ListSelectNotification ) );
	AddTransition ( _pMdRotateDirFacetState2 , _pDwRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis4Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList008ListSelectNotification ) );

	AddTransition ( _pMdRotateDirFacetState2 , _pDwRotateDirFacetState,IsOutputSetCondition ( _pRotateFaceSelLis5Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList014ListSelectNotification ) );
	AddTransition ( _pMdRotateDirFacetState2 , _pMdRotateDirFacetState2,IsOutputSetCondition ( _pRotateFaceSelLis6Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSelectorListMdRot2ListSelectNotification ) );
	AddTransition ( _pMdRotateDirFacetState2 , _pDwRotateDirFacetState2,IsOutputSetCondition ( _pRotateFaceSelLis7Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSelectorListDnRot2ListSelectNotification ) );

	AddTransition ( _pMdRotateDirFacetState2 , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceOKAgent ) ,//-----_pDwRotateDirFacetState2
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaOKNotification ) );
	AddTransition ( _pMdRotateDirFacetState2 , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaCANCELNotification ) );
	AddTransition ( _pMdRotateDirFacetState2 , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceCloseAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaCloseNotification ) );






	AddTransition ( _pDwRotateDirFacetState , _pDwRotateDirFacetState2,IsOutputSetCondition ( _pDwRotateDirFaceAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::ChooseDwDirRotateSurface ) );
	AddTransition ( _pDwRotateDirFacetState , _pUpRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis1Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList006ListSelectNotification ) );
	AddTransition ( _pDwRotateDirFacetState , _pMdRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis2Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList007ListSelectNotification ) );
	AddTransition ( _pDwRotateDirFacetState , _pMdRotateDirFacetState,IsOutputSetCondition ( _pRotateFaceSelLis3Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList012ListSelectNotification ) );
	AddTransition ( _pDwRotateDirFacetState ,_pDwRotateFacetState ,IsOutputSetCondition ( _pRotateFaceSelLis4Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList008ListSelectNotification ) );

	AddTransition ( _pDwRotateDirFacetState , _pDwRotateDirFacetState,IsOutputSetCondition ( _pRotateFaceSelLis5Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList014ListSelectNotification ) );
	AddTransition ( _pDwRotateDirFacetState , _pMdRotateDirFacetState2,IsOutputSetCondition ( _pRotateFaceSelLis6Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSelectorListMdRot2ListSelectNotification ) );
	AddTransition ( _pDwRotateDirFacetState , _pDwRotateDirFacetState2,IsOutputSetCondition ( _pRotateFaceSelLis7Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSelectorListDnRot2ListSelectNotification ) );
	AddTransition ( _pDwRotateDirFacetState , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceOKAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaOKNotification ) );
	AddTransition ( _pDwRotateDirFacetState , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaCANCELNotification ) );
	AddTransition ( _pDwRotateDirFacetState , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceCloseAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaCloseNotification ) );








	AddTransition ( _pDwRotateDirFacetState2 , _pDwRotateDirFacetState2,IsOutputSetCondition ( _pDwRotateDirFaceAgent2 ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::ChooseDwDirRotateSurface2 ) );
	AddTransition ( _pDwRotateDirFacetState2 , _pUpRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis1Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList006ListSelectNotification ) );
	AddTransition ( _pDwRotateDirFacetState2 , _pMdRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis2Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList007ListSelectNotification ) );
	AddTransition ( _pDwRotateDirFacetState2 , _pMdRotateDirFacetState,IsOutputSetCondition ( _pRotateFaceSelLis3Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList012ListSelectNotification ) );
	AddTransition ( _pDwRotateDirFacetState2 ,_pDwRotateFacetState ,IsOutputSetCondition ( _pRotateFaceSelLis4Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList008ListSelectNotification ) );

	AddTransition ( _pDwRotateDirFacetState2 , _pDwRotateDirFacetState,IsOutputSetCondition ( _pRotateFaceSelLis5Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList014ListSelectNotification ) );
	AddTransition ( _pDwRotateDirFacetState2 , _pMdRotateDirFacetState2,IsOutputSetCondition ( _pRotateFaceSelLis6Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSelectorListMdRot2ListSelectNotification ) );
	AddTransition ( _pDwRotateDirFacetState2 , _pDwRotateDirFacetState2,IsOutputSetCondition ( _pRotateFaceSelLis7Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSelectorListDnRot2ListSelectNotification ) );
	AddTransition ( _pDwRotateDirFacetState2 , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceOKAgent ) ,//-----
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaOKNotification ) );
	AddTransition ( _pDwRotateDirFacetState2 , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceCancleAgent ) ,//-
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaCANCELNotification ) );
	AddTransition ( _pDwRotateDirFacetState2 , _pIniButtonState,IsOutputSetCondition ( _pRotateFaceCloseAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnRotateDlgDiaCloseNotification ) );











//车身选择状态


	AddTransition ( _pBodySelState , _pBodySelState,IsOutputSetCondition ( _pBodyAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::ChooseBody ) );

	AddTransition ( _pBodySelState , _pBodySelState,IsOutputSetCondition ( _pBodyelLis1Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnBodySelectorList006ListSelectNotification ) );//

	AddTransition ( _pBodySelState , _pBodyPartSelState,IsOutputSetCondition ( _pBodySelLis2Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnBodySelectorList007ListSelectNotification ) );// _pRotateFaceCancleAgentChooseRotateSelectList2

	//AddTransition ( _pBodySelState , _pDwRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis3Agent ) ,
	//	Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList008ListSelectNotification ) );

	AddTransition ( _pBodySelState , _pIniButtonState,IsOutputSetCondition ( _pBodyOKAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnBodyDlgDiaOKNotification ) );

	AddTransition ( _pBodySelState , _pIniButtonState,IsOutputSetCondition ( _pBodyCancleAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnBodyDlgDiaCANCELNotification ) );
	AddTransition ( _pBodySelState , _pIniButtonState,IsOutputSetCondition ( _pBodyCloseAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnBodyDlgDiaCloseNotification ) );



	AddTransition ( _pBodyPartSelState , _pBodyPartSelState,IsOutputSetCondition ( _pBodyPartAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::ChooseBodyPart ) );

	AddTransition ( _pBodyPartSelState , _pBodyPartSelState,IsOutputSetCondition ( _pdaClearSeat1Select ) ,
		Action ( ( ActionMethod ) &TestCmd::ClearOneBodyPrd ) );


	AddTransition ( _pBodyPartSelState , _pBodySelState,IsOutputSetCondition ( _pBodyelLis1Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnBodySelectorList006ListSelectNotification ) );//

	AddTransition ( _pBodyPartSelState , _pBodyPartSelState,IsOutputSetCondition ( _pBodySelLis2Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnBodySelectorList007ListSelectNotification ) );// _pRotateFaceCancleAgentChooseRotateSelectList2

	//AddTransition ( _pBodySelState , _pDwRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis3Agent ) ,
	//	Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList008ListSelectNotification ) );

	AddTransition ( _pBodyPartSelState , _pIniButtonState,IsOutputSetCondition ( _pBodyOKAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnBodyDlgDiaOKNotification ) );

	AddTransition ( _pBodyPartSelState , _pIniButtonState,IsOutputSetCondition ( _pBodyCancleAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnBodyDlgDiaCANCELNotification ) );
	AddTransition ( _pBodyPartSelState , _pIniButtonState,IsOutputSetCondition ( _pBodyCloseAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnBodyDlgDiaCloseNotification ) );

//车门选择状态



	AddTransition ( _pDoorSelState , _pDoorSelState,IsOutputSetCondition ( _pDoorAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::ChooseDoor ) );





	AddTransition ( _pDoorSelState , _pDoorSelState,IsOutputSetCondition ( _pDoorelLis1Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnDoorSelectorList005ListSelectNotification ) );//

	AddTransition ( _pDoorSelState , _pDoorPartSelState,IsOutputSetCondition ( _pDoorSelLis2Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnDoorSelectorList006ListSelectNotification ) );// _pRotateFaceCancleAgentChooseRotateSelectList2

	//AddTransition ( _pDoorSelState , _pDwRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis3Agent ) ,
	//	Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList008ListSelectNotification ) );

	AddTransition ( _pDoorSelState , _pIniButtonState,IsOutputSetCondition ( _pDoorOKAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnDoorDlgDiaOKNotification ) );

	AddTransition ( _pDoorSelState , _pIniButtonState,IsOutputSetCondition ( _pDoorCancleAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnDoorDlgDiaCANCELNotification ) );

	AddTransition ( _pDoorSelState , _pIniButtonState,IsOutputSetCondition ( _pDoorCloseAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnDoorDlgDiaCloseNotification ) );



	AddTransition ( _pDoorPartSelState , _pDoorPartSelState,IsOutputSetCondition ( _pDoorPartAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::ChooseDoorPart ) );

	AddTransition ( _pDoorPartSelState , _pDoorPartSelState,IsOutputSetCondition ( _pdaClearSeat2Select ) ,
		Action ( ( ActionMethod ) &TestCmd::ClearOneDoorPrd ) );

	AddTransition ( _pDoorPartSelState , _pDoorSelState,IsOutputSetCondition ( _pDoorelLis1Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnDoorSelectorList005ListSelectNotification ) );//

	AddTransition ( _pDoorPartSelState , _pDoorPartSelState,IsOutputSetCondition ( _pDoorSelLis2Agent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnDoorSelectorList006ListSelectNotification ) );// _pRotateFaceCancleAgentChooseRotateSelectList2

	//AddTransition ( _pDoorSelState , _pDwRotateFacetState,IsOutputSetCondition ( _pRotateFaceSelLis3Agent ) ,
	//	Action ( ( ActionMethod ) &TestCmd::OnRotateSelectorList008ListSelectNotification ) );

	AddTransition ( _pDoorPartSelState , _pIniButtonState,IsOutputSetCondition ( _pDoorOKAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnDoorDlgDiaOKNotification ) );

	AddTransition ( _pDoorPartSelState , _pIniButtonState,IsOutputSetCondition ( _pDoorCancleAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnDoorDlgDiaCANCELNotification ) );
	AddTransition ( _pDoorPartSelState , _pIniButtonState,IsOutputSetCondition ( _pDoorCloseAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnDoorDlgDiaCloseNotification ) );




//swept选择状态

	AddTransition ( _pSwepTPartSelState , _pSwepTPartSelState,IsOutputSetCondition ( _pSwepTPartAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::ChooseSwetpPart ) );

	AddTransition ( _pSwepTPartSelState , _pSwepTPartSelState,IsOutputSetCondition ( _pSweptelListAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSelectorList002ListSelectNotification ) );//

	AddTransition ( _pSwepTPartSelState , _pIniButtonState,IsOutputSetCondition ( _pSweptOKAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSweepPrtDlgDiaOKNotification ) );

	AddTransition ( _pSwepTPartSelState , _pIniButtonState,IsOutputSetCondition ( _pSweptCancleAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSweepPrtDlgDiaCANCELNotification ) );

	AddTransition ( _pSwepTPartSelState , _pIniButtonState,IsOutputSetCondition ( _pSweptCloseAgent ) ,
		Action ( ( ActionMethod ) &TestCmd::OnSweepPrtDlgDiCloseNotification ) );






	cout<<"2.5"<<endl;
	pDoc =_editor->GetDocument(); 
	cout<<"2.6"<<endl;

	CATIDocRoots *piDocRootsOnDoc = NULL;
	HRESULT rc = pDoc->QueryInterface(IID_CATIDocRoots,
		(void**) &piDocRootsOnDoc);
	cout<<"2.4"<<endl;
	if ( FAILED(rc) ) cout<<"没法得到新建product的CATIDocRoots"<<endl;

	CATListValCATBaseUnknown_var *pRootProducts =
		piDocRootsOnDoc->GiveDocRoots();
	cout<<"2.5"<<endl;
	if (NULL != pRootProducts)
		if (pRootProducts->Size())
		{  
			spRootProduct = (*pRootProducts)[1];
			delete pRootProducts;
			pRootProducts = NULL;
		}

		piDocRootsOnDoc->Release();
		piDocRootsOnDoc=NULL;
		//CATIProduct *piProductOnRoot = NULL;
		/** @anchor err_1 spRootProduct not tested before use ( if !! ) */ 
		if ( NULL_var == spRootProduct ) cout<<"没法得到CATIProduct"<<endl;
		CATUnicodeString oName ;
		spRootProduct->GetPrdInstanceName(oName);
		cout<<"所选第一个零件的实例为："<<oName<<endl;
		//rc = spRootProduct->QueryInterface(IID_CATIProduct,
		//	(void**) &piProductOnRoot);



		//CATIAsmCstSetFeature_var spCstSetFeature=NULL_var;
		//CATAsmConstraintSetServices::GetRootSet(spRootProduct->GetReferenceProduct(),spCstSetFeature,FALSE);
		//if (NULL_var!=spCstSetFeature)
		//{
		//	cout<<"得到约束集"<<endl;
		//	CAAGsiRemove(spCstSetFeature);

		//}
		//if (NULL_var==spCstSetFeature)
		//{
		//	cout<<"空的！！！！"<<endl;
		//}




		//CATIDescendants_var spRootDescendants = spRootProduct->GetReferenceProduct();
		//CATListValCATISpecObject_var ListCstChild;
		//if (!!spRootDescendants)
		//{
		//	spRootDescendants ->GetDirectChildren(CATISpecObject::ClassName(),ListCstChild);
		//	cout<<"个约束节点个数："<<ListCstChild.Size()<<endl;
		//	for (int i=1;i<=ListCstChild.Size();i++)
		//	{
		//		//CATIAsmCstSetFeature_var spCst = ListCstChild[i];
		//		//if (!!spCst)
		//		//{
		//			CATIAlias_var aliasOnCurrentPrd =  ListCstChild[i] ;
		//			if ( NULL_var != aliasOnCurrentPrd)
		//			{
		//				cout <<aliasOnCurrentPrd->GetAlias().ConvertToChar()<<endl ;
		//			}

		//		//}
		//	}
		//}








		return;


		//得到mechanism






//	AddTransition ( _pSurfaceState , _pPointState,IsOutputSetCondition ( _pSecondAgent ) ,
//		Action ( ( ActionMethod ) &TestCmd::SelectSecSelectList ) );
//
//	AddTransition ( _pPointState , _pSurfaceState,IsOutputSetCondition ( _pFirstAgent ) ,
//		Action ( ( ActionMethod ) &TestCmd::SelectFirSelectList ) );
//
//	AddTransition ( _pPointState , _pPointState,IsOutputSetCondition ( _pSecondAgent ) ,
//		Action ( ( ActionMethod ) &TestCmd::SelectSecSelectList ) );
//
//	AddTransition ( _pPointState , _pPointState,IsOutputSetCondition ( _pPointAgent ) ,
//		Action ( ( ActionMethod ) &TestCmd::ChoosePoint ) );
//
	//AddTransition ( _pIniButtonState,NULL,IsOutputSetCondition (_pTestCmdDlgCloseAgent),NULL);//这两个转移时你在没有选择任何东西，退出对话框时执行
	//AddTransition ( _pIniButtonState,NULL,IsOutputSetCondition (_pTestCmdDlgCloseAgent),NULL);
}


CATBoolean TestCmd::ChooseUpRailSurface(void * date)
{
	cout<<"ChooseUpRailSurface函数中"<<endl;


	if (NULL==_pUpRollingFaceAgent)		
	{
		cout<<"面代理为空"<<endl;
		return TRUE;
	}


	pUpRollingFacePathSel = _pUpRollingFaceAgent -> GetValue ();

	//CATPathElement *PlanePathElement=_pUpRotateFaceAgent->GetValue();//Returns the agent value. Role: The value is the path of the selected object.
	CATIProduct_var piInstanceProd = pUpRollingFacePathSel->FindElement( CATIProduct::ClassId());
	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	cout<<"所选第一个零件的实例为："<<oName<<endl;
	piInstanceProd->QueryInterface(IID_CATIProduct, (void**) &piInstanceProdOnUpRollingFace);





	if ( _HSO ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pUpRollingFacePathSel);
		_HSO -> EndAddElements ();
		//_HSO = NULL;
	}

	CATBaseUnknown *ppSelection=NULL;
	ppSelection= _pUpRotateFaceAgent->GetElementValue(_pUpRollingFaceAgent->GetValue());
	spiUpRollingSpcSurface=ppSelection;

	CATIBRepAccess * BrepOnUpRollingFace=NULL;

	HRESULT	rc = ppSelection -> QueryInterface(IID_CATIBRepAccess,(void**)&BrepOnUpRollingFace );
	if ( FAILED(rc) || ( NULL == BrepOnUpRollingFace) ) 
	{
		cout<<"失败IID_CATIBRepAccess！！！！！"<<endl;
		return TRUE;

	}

	spiUpRollingSpcOnRail=BrepOnUpRollingFace->GetLastFeature();

//
//CATIAlias_var aliasOnCurrentSet = sadfsd ;
//if ( NULL_var != aliasOnCurrentSet)
//{
//	cout << "      " << aliasOnCurrentSet->GetAlias().ConvertToChar() ;
//}
//


	if (spiUpRollingSpcSurface == NULL_var) 	//特征化操作
	{	
		CATIFeaturize_var spToFeaturize = ppSelection;	
		spiUpRollingSpcSurface = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
	}	


	CATBody_var spOffsetFaceBody=GetBodyFromFeature(spiUpRollingSpcSurface);

	CATLISTP(CATCell) facecells;
	spOffsetFaceBody->GetAllCells(facecells, 2);
	cout<<"NUMBER OF edge cell="<<facecells.Size()<<endl;
	CATFace* TopDownRollingface=(CATFace*)facecells[1];
	CATSurface *GeoDownRollingface=TopDownRollingface->GetSurface();
	int tag=GeoDownRollingface->GetPersistentTag();
	cout<<"tag值为："<<tag<<endl;
	CATUnicodeString strTag;
	strTag.BuildFromNum(tag);







	CATUnicodeString SurName;
	SurName=spiUpRollingSpcSurface->GetDisplayName();//oName

	SurName=oName+"."+SurName+strTag;
	_RailPanel->_SelectorList007->SetLine ( SurName ,0, CATDlgDataModify );



	//int iNumberOfSelectedLines[1];
	//iNumberOfSelectedLines[0]=0;
	//int iArraySize = 1;
	//int iNotify = 0;
	//_RailPanel->_SelectorList007->SetSelect(iNumberOfSelectedLines,
	//	iArraySize, iNotify);
	_RailPanel->SJDSetRailSelect(2,0);



	_pUpRollingFaceAgent->InitializeAcquisition();



	return TRUE;
}
CATBoolean TestCmd::ChooseMdRailSurface(void * date)
{
	cout<<"ChooseSurface函数中"<<endl;


	if (NULL==_pMdRollingFaceAgent)		
	{
		cout<<"面代理为空"<<endl;
		return TRUE;
	}


	pMidRollingFacePathSel = _pMdRollingFaceAgent -> GetValue ();

	//CATPathElement *PlanePathElement=_pUpRotateFaceAgent->GetValue();//Returns the agent value. Role: The value is the path of the selected object.
	CATIProduct_var piInstanceProd = pMidRollingFacePathSel->FindElement( CATIProduct::ClassId());
	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	cout<<"所选第一个零件的实例为："<<oName<<endl;
	piInstanceProd->QueryInterface(IID_CATIProduct, (void**) &piInstanceProdOnMidRollingFace);





	if ( _HSO ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pMidRollingFacePathSel);
		_HSO -> EndAddElements ();
		//_HSO = NULL;
	}

	CATBaseUnknown *ppSelection=NULL;
	ppSelection= _pMdRollingFaceAgent->GetElementValue(_pMdRollingFaceAgent->GetValue());
	spiMidRollingSpcSurface=ppSelection;

	CATIBRepAccess * BrepOnUpRollingFace=NULL;

	HRESULT	rc = ppSelection -> QueryInterface(IID_CATIBRepAccess,(void**)&BrepOnUpRollingFace );
	if ( FAILED(rc) || ( NULL == BrepOnUpRollingFace) ) 
	{
		cout<<"失败IID_CATIBRepAccess！！！！！"<<endl;
		return TRUE;

	}

	spiMidRollingSpcOnRail=BrepOnUpRollingFace->GetLastFeature();

	//
	//CATIAlias_var aliasOnCurrentSet = sadfsd ;
	//if ( NULL_var != aliasOnCurrentSet)
	//{
	//	cout << "      " << aliasOnCurrentSet->GetAlias().ConvertToChar() ;
	//}
	//


	if (spiMidRollingSpcSurface == NULL_var) 	//特征化操作
	{	
		CATIFeaturize_var spToFeaturize = ppSelection;	
		spiMidRollingSpcSurface = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
	}	



	//获取tag值
	CATBody_var spOffsetFaceBody=GetBodyFromFeature(spiMidRollingSpcSurface);

	CATLISTP(CATCell) facecells;
	spOffsetFaceBody->GetAllCells(facecells, 2);
	cout<<"NUMBER OF edge cell="<<facecells.Size()<<endl;
	CATFace* TopDownRollingface=(CATFace*)facecells[1];
	CATSurface *GeoDownRollingface=TopDownRollingface->GetSurface();
	int tag=GeoDownRollingface->GetPersistentTag();
	cout<<"tag值为："<<tag<<endl;
	CATUnicodeString strTag;
	strTag.BuildFromNum(tag);
	//获取tag值完毕





	CATUnicodeString SurName;
	SurName=spiMidRollingSpcSurface->GetDisplayName();
	SurName=oName+"."+SurName+strTag;
	_RailPanel->_SelectorList008->SetLine ( SurName ,0, CATDlgDataModify );


	//int iNumberOfSelectedLines[1];
	//iNumberOfSelectedLines[0]=0;
	//int iArraySize = 1;
	//int iNotify = 0;
	//_RailPanel->_SelectorList008->SetSelect(iNumberOfSelectedLines,
	//	iArraySize, iNotify);

	_RailPanel->SJDSetRailSelect(3,0);



	_pMdRollingFaceAgent->InitializeAcquisition();






	return TRUE;
}

CATBoolean TestCmd::ChooseDwRailSurface(void * date)
{
	cout<<"ChooseDwRailSurface函数中"<<endl;

	if (NULL==_pDwRollingFaceAgent)		
	{
		cout<<"面代理为空"<<endl;
		return TRUE;
	}


	pDownRollingFacePathSel = _pDwRollingFaceAgent -> GetValue ();

	//CATPathElement *PlanePathElement=_pUpRotateFaceAgent->GetValue();//Returns the agent value. Role: The value is the path of the selected object.
	CATIProduct_var piInstanceProd = pDownRollingFacePathSel->FindElement( CATIProduct::ClassId());
	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	cout<<"所选第一个零件的实例为："<<oName<<endl;
	piInstanceProd->QueryInterface(IID_CATIProduct, (void**) &piInstanceProdOnDownRollingFace);





	if ( _HSO ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pDownRollingFacePathSel);
		_HSO -> EndAddElements ();
		//_HSO = NULL;
	}



	CATBaseUnknown *ppSelection=NULL;
	ppSelection= _pDwRollingFaceAgent->GetElementValue(_pDwRollingFaceAgent->GetValue());
	spiDownRollingSpcSurface=ppSelection;

	CATIBRepAccess * BrepOnUpRollingFace=NULL;

	HRESULT	rc = ppSelection -> QueryInterface(IID_CATIBRepAccess,(void**)&BrepOnUpRollingFace );
	if ( FAILED(rc) || ( NULL == BrepOnUpRollingFace) ) 
	{
		cout<<"失败IID_CATIBRepAccess！！！！！"<<endl;
		return TRUE;

	}

	spiDownRollingSpcOnRail=BrepOnUpRollingFace->GetLastFeature();


	CATBody_var spDownRollingSpcOnRailFaceBody=GetBodyFromFeature(spiDownRollingSpcOnRail);

	CATLISTP(CATCell) edgecellsOnRailFaceBody;
	spDownRollingSpcOnRailFaceBody->GetAllCells(edgecellsOnRailFaceBody, 2);
	cout<<"最后特征包含的面数目="<<edgecellsOnRailFaceBody.Size()<<endl;

	CATIAlias_var aliasOnDownRollingSpcOnRail = spiDownRollingSpcOnRail ;
	if ( NULL_var != aliasOnDownRollingSpcOnRail)
	{
		cout << "包含的最后特征是：" << aliasOnDownRollingSpcOnRail->GetAlias().ConvertToChar()<<endl;
	}

	if (spiDownRollingSpcSurface == NULL_var) 	//特征化操作
	{	
		CATIFeaturize_var spToFeaturize = ppSelection;	
		spiDownRollingSpcSurface = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
	}	


	CATBody_var spOffsetFaceBody=GetBodyFromFeature(spiDownRollingSpcSurface);

	CATLISTP(CATCell) edgecells;
	spOffsetFaceBody->GetAllCells(edgecells, 2);
	cout<<"NUMBER OF edge cell="<<edgecells.Size()<<endl;

	//得到与所选面相邻的面


	CATLISTP(CATCell) FaceBoundingcells;
	edgecells[1]->GetAllCells(FaceBoundingcells, 1);


	cout<<"个数是："<<FaceBoundingcells.Size()<<endl;
	CATCell* pSelFaceCell=edgecells[1];


	//CATLISTP(CATCell) NeighborFaceCell;



	for(int currentCell=1; currentCell<=FaceBoundingcells.Size(); currentCell++)
	{
		CATCell* _piLineCell=FaceBoundingcells[currentCell];
		CATEdge * _piTempFaceEdge=(CATEdge *)_piLineCell;


		//CATLISTP(CATCell) ListNeicell;
		//HRESULT rc=pSelFaceCell->GetNeighborCells(_piTempFaceEdge,spDownRollingSpcOnRailFaceBody,ListNeicell);//得到与选面相邻的面

		//if (SUCCEEDED(rc))
		//{
		//	cout<<"成功"<<endl;
		//	cout<<"个数四："<<ListNeicell.Size()<<endl;
		//}

		CATCell *pNeighborCell=pSelFaceCell->GetNeighborCell(_piTempFaceEdge,spDownRollingSpcOnRailFaceBody);//得到与选面相邻的面

		if (NULL==pNeighborCell)
		{
			cout<<"pNeighborCell为空"<<endl;
		}
		if (NULL!=pNeighborCell)
		{
			cout<<"这个cell不为空"<<endl;
		}
		//CATFace * pSecFace=(CATFace *)pNeighborCell;
		//double mianji=0;
		//mianji= pSecFace->CalcArea();
		//cout<<"得到面积是："<<mianji<<endl;


	}


	//得到与所选面相邻的面完毕

	CATFace* TopDownRollingface=(CATFace*)edgecells[1];
	CATSurface *GeoDownRollingface=TopDownRollingface->GetSurface();
	int tag=GeoDownRollingface->GetPersistentTag();
	cout<<"tag值为："<<tag<<endl;
	CATUnicodeString strTag;
	strTag.BuildFromNum(tag);



	CATUnicodeString SurName;
	SurName=spiDownRollingSpcSurface->GetDisplayName();
	SurName=oName+"."+SurName+strTag;

	_RailPanel->_SelectorList009->SetLine ( SurName ,0, CATDlgDataModify );



	//int iNumberOfSelectedLines[1];
	//iNumberOfSelectedLines[0]=0;
	//int iArraySize = 1;
	//int iNotify = 0;
	//_RailPanel->_SelectorList009->SetSelect(iNumberOfSelectedLines,
	//	iArraySize, iNotify);
	_RailPanel->SJDSetRailSelect(4,0);



	_pDwRollingFaceAgent->InitializeAcquisition();




	return TRUE;
}
CATBoolean TestCmd::ChooseMdBearSurface(void * date)
{
	cout<<"ChooseMdBearSurface函数中"<<endl;

	//_HSO->Empty();

	//if (NULL!=_pSurfaceAgent)
	//{
	//	CATBaseUnknown *pSelection = _pSurfaceAgent->GetElementValue(_pSurfaceAgent->GetValue());

	//	_pSurfaceAgent->InitializeAcquisition();

	//	spiSurface=pSelection;
	//	if (spiSurface==NULL_var)
	//	{
	//		CATIFeaturize_var spToFeaturize = pSelection;
	//		spiSurface = spToFeaturize->FeaturizeR(MfPermanentBody |MfLastFeatureSupport |MfRelimitedFeaturization);
	//		_Panel->SetName(1,spiSurface->GetDisplayName(),0);
	//	}
	//	else
	//	{
	//		_Panel->SetName(1,spiSurface->GetDisplayName(),0);
	//	}
	//}

	//CATPathElement RootPath     = _editor->GetUIActiveObject();
	//CATPathElement *pPathBound= new CATPathElement(RootPath);
	//pPathBound->AddChildElement(spiSurface);//创建对象的CATPathElement
	//_HSO->AddElement(pPathBound);
_pMdBearFaceAgent->InitializeAcquisition();
	return TRUE;
}
CATBoolean TestCmd::ChooseDwBearSurface(void * date)//下轨道承压面
{
	cout<<"ChooseDwBearSurface函数中"<<endl;

	if (NULL==_pDwBearFaceAgent)		
	{
		cout<<"面代理为空"<<endl;
		return TRUE;
	}


	pDownBearRollingFacePathSel = _pDwBearFaceAgent -> GetValue ();

	//CATPathElement *PlanePathElement=_pUpRotateFaceAgent->GetValue();//Returns the agent value. Role: The value is the path of the selected object.
	CATIProduct_var piInstanceProd = pDownBearRollingFacePathSel->FindElement( CATIProduct::ClassId());
	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	cout<<"所选第一个零件的实例为："<<oName<<endl;
	piInstanceProd->QueryInterface(IID_CATIProduct, (void**) &piInstanceProdOnDownBearRollingFace);





	if ( _HSO ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pDownBearRollingFacePathSel);
		_HSO -> EndAddElements ();
		//_HSO = NULL;
	}

	CATBaseUnknown *ppSelection=NULL;
	ppSelection= _pDwBearFaceAgent->GetElementValue(_pDwBearFaceAgent->GetValue());
	spiDownBearRollingSpcSurface=ppSelection;

	CATIBRepAccess * BrepOnUpRollingFace=NULL;

	HRESULT	rc = ppSelection -> QueryInterface(IID_CATIBRepAccess,(void**)&BrepOnUpRollingFace );
	if ( FAILED(rc) || ( NULL == BrepOnUpRollingFace) ) 
	{
		cout<<"失败IID_CATIBRepAccess！！！！！"<<endl;
		return TRUE;

	}

	spiDownBearRollingSpcOnRail=BrepOnUpRollingFace->GetLastFeature();



	if (spiDownBearRollingSpcSurface == NULL_var) 	//特征化操作
	{	
		CATIFeaturize_var spToFeaturize = ppSelection;	
		spiDownBearRollingSpcSurface = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
	}	


	//获取tag值
	CATBody_var spOffsetFaceBody=GetBodyFromFeature(spiDownBearRollingSpcSurface);

	CATLISTP(CATCell) facecells;
	spOffsetFaceBody->GetAllCells(facecells, 2);
	cout<<"NUMBER OF edge cell="<<facecells.Size()<<endl;
	CATFace* TopDownRollingface=(CATFace*)facecells[1];
	CATSurface *GeoDownRollingface=TopDownRollingface->GetSurface();
	int tag=GeoDownRollingface->GetPersistentTag();
	cout<<"tag值为："<<tag<<endl;
	CATUnicodeString strTag;
	strTag.BuildFromNum(tag);
	//获取tag值完毕



	CATUnicodeString SurName;
	SurName=spiDownBearRollingSpcSurface->GetDisplayName();
	SurName=oName+"."+SurName+strTag;

	_RailPanel->_SelectorList017->SetLine ( SurName ,0, CATDlgDataModify );


	//int iNumberOfSelectedLines[1];
	//iNumberOfSelectedLines[0]=0;
	//int iArraySize = 1;
	//int iNotify = 0;
	//_RailPanel->_SelectorList017->SetSelect(iNumberOfSelectedLines,
	//	iArraySize, iNotify);
	_RailPanel->SJDSetRailSelect(4,0);

	_pDwBearFaceAgent->InitializeAcquisition();





	return TRUE;
}
//铰链
CATBoolean TestCmd::ChooseHinge1Line1(void * date)
{
	cout<<"ChooseHinge1Line1函数中"<<endl;


	if (NULL==_pHinge1Line1Agent)		
	{
		cout<<"_pHinge1Line1Agent代理为空"<<endl;
		return TRUE;
	}


	pHinge1Line1PathSel = _pHinge1Line1Agent -> GetValue ();

	CATIProduct_var piInstanceProd = pHinge1Line1PathSel->FindElement( CATIProduct::ClassId());
	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	srtHinge1Line1Prd=oName;
	cout<<"所选第一个零件的实例为："<<oName<<endl;


	if ( _HSO ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pHinge1Line1PathSel);
		_HSO -> EndAddElements ();
		//_HSO = NULL;
	}

	CATBaseUnknown *ppSelection=NULL;
	ppSelection= _pHinge1Line1Agent->GetElementValue(_pHinge1Line1Agent->GetValue());
	spiHinge1Line1=ppSelection;


	if (spiHinge1Line1 == NULL_var) 	//特征化操作
	{	
		CATIFeaturize_var spToFeaturize = ppSelection;	
		spiHinge1Line1 = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
	}	




	//得到所选直线的向量

	CATBody_var spPreHinge1Line1=GetBodyFromFeature(spiHinge1Line1);

	CATLISTP(CATCell) Linecells;
	spPreHinge1Line1->GetAllCells(Linecells, 1);
	cout<<"NUMBER OF edge cell="<<Linecells.Size()<<endl;
	cout<<"zheli"<<endl;
	CATEdge* pPreTopLine=(CATEdge*)Linecells[1];
	CATVertex*  oStartVertex;
	CATVertex*  oEndVertex;
	pPreTopLine->GetVertices(&oStartVertex,&oEndVertex);
	CATPoint *statPt=oStartVertex->GetPoint();
	CATPoint *endPt=oEndVertex->GetPoint();

	CATMathPoint StartMathPt;
	CATMathPoint EndMathPt;
	statPt->GetMathPoint(StartMathPt);
	endPt->GetMathPoint(EndMathPt);

	DirOnPreHinge1Line1=EndMathPt-StartMathPt;

	//得到所选直线的向量完毕





	//CATEdgeCurve *pPreEdgeCurve=pPreTopLine->GetCurve();
	//CATLine *pPreLineHinge1Line1=(CATLine *)pPreEdgeCurve;
	 //CATGeometry *pPreGeoEdge=pPreTopLine->GetGeometry();
	 //CATLine *pPreLineHinge1Line1=(CATLine *)pPreGeoEdge;


	//获取tag值
	CATBody_var spOffsetEdgeBody=GetBodyFromFeature(spiHinge1Line1);

	CATLISTP(CATCell) edgecells;
	spOffsetEdgeBody->GetAllCells(edgecells, 1);
	cout<<"NUMBER OF edge cell="<<edgecells.Size()<<endl;
	CATEdge* TopDownRollingedge=(CATEdge*)edgecells[1];
	CATEdgeCurve *GeoDownRollingface=TopDownRollingedge->GetCurve();
	int tag=GeoDownRollingface->GetPersistentTag();
	cout<<"tag值为："<<tag<<endl;
	CATUnicodeString strTag;
	strTag.BuildFromNum(tag);
	//获取tag值完毕




	CATUnicodeString SurName;
	SurName=spiHinge1Line1->GetDisplayName();
	SurName=oName+"."+SurName+strTag;
	_HingePanel->_SelectorList006->SetLine ( SurName ,0, CATDlgDataModify );



	//int iNumberOfSelectedLines[1];
	//iNumberOfSelectedLines[0]=0;
	//int iArraySize = 1;
	//int iNotify = 0;
	//_HingePanel->_SelectorList006->SetSelect(iNumberOfSelectedLines,
	//	iArraySize, iNotify);
	_HingePanel->SJDSetHingeSelect(2,0);




	_pHinge1Line1Agent->InitializeAcquisition();




	return TRUE;
}
CATBoolean TestCmd::ChooseHinge1Line2(void * date)
{
	cout<<"ChooseHinge1Line2函数中"<<endl;

	if (NULL==_pHinge1Line2Agent)		
	{
		cout<<"_pHinge1Line1Agent代理为空"<<endl;
		return TRUE;
	}


	pHinge1Line2PathSel = _pHinge1Line2Agent -> GetValue ();
	CATIProduct_var piInstanceProd = pHinge1Line2PathSel->FindElement( CATIProduct::ClassId());
	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	srtHinge1Line2Prd=oName;
	cout<<"所选第一个零件的实例为："<<oName<<endl;


	if ( _HSO ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pHinge1Line2PathSel);
		_HSO -> EndAddElements ();
		//_HSO = NULL;
	}

	CATBaseUnknown *ppSelection=NULL;
	ppSelection= _pHinge1Line2Agent->GetElementValue(_pHinge1Line2Agent->GetValue());
	spiHinge1Line2=ppSelection;


	if (spiHinge1Line2 == NULL_var) 	//特征化操作
	{	
		CATIFeaturize_var spToFeaturize = ppSelection;	
		spiHinge1Line2 = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
	}	

	//获取tag值edge
	CATBody_var spOffsetEdgeBody=GetBodyFromFeature(spiHinge1Line2);

	CATLISTP(CATCell) edgecells;
	spOffsetEdgeBody->GetAllCells(edgecells, 1);
	cout<<"NUMBER OF edge cell="<<edgecells.Size()<<endl;
	CATEdge* TopDownRollingedge=(CATEdge*)edgecells[1];
	CATEdgeCurve *GeoDownRollingface=TopDownRollingedge->GetCurve();
	int tag=GeoDownRollingface->GetPersistentTag();
	cout<<"tag值为："<<tag<<endl;
	CATUnicodeString strTag;
	strTag.BuildFromNum(tag);
	//获取tag值完毕





	CATUnicodeString SurName;
	SurName=spiHinge1Line2->GetDisplayName();
	SurName=oName+"."+SurName+strTag;
	_HingePanel->_SelectorList012->SetLine ( SurName ,0, CATDlgDataModify );

	//int iNumberOfSelectedLines[1];
	//iNumberOfSelectedLines[0]=0;
	//int iArraySize = 1;
	//int iNotify = 0;
	//_HingePanel->_SelectorList012->SetSelect(iNumberOfSelectedLines,
	//	iArraySize, iNotify);
	_HingePanel->SJDSetHingeSelect(3,0);

	_pHinge1Line2Agent->InitializeAcquisition();


	return TRUE;
}
CATBoolean TestCmd::ChooseHinge1Plane1(void * date)
{
	cout<<"ChooseHinge1Plane1函数中"<<endl;


	if (NULL==_pHinge1Plane1Agent)		
	{
		cout<<"_pHinge1Plane1Agent代理为空"<<endl;
		return TRUE;
	}


	pHinge1Plane1PathSel = _pHinge1Plane1Agent -> GetValue ();

	//CATPathElement *PlanePathElement=_pUpRotateFaceAgent->GetValue();//Returns the agent value. Role: The value is the path of the selected object.
	CATIProduct_var piInstanceProd = pHinge1Plane1PathSel->FindElement( CATIProduct::ClassId());
	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	cout<<"所选第一个零件的实例为："<<oName<<endl;
	if (oName!=srtHinge1Line1Prd)
	{
		RDCDMUBFErrorMsgBox("请选择与直线1在同一product的平面！");
		_pHinge1Plane1Agent=NULL;
		_pHinge1Plane1Agent->InitializeAcquisition();

		return TRUE;

	}
	piInstanceProd->QueryInterface(IID_CATIProduct, (void**) &piInstanceProdOnHinge1Plane1);

	if ( _HSO ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pHinge1Plane1PathSel);
		_HSO -> EndAddElements ();
		//_HSO = NULL;
	}

	CATBaseUnknown *ppSelection=NULL;
	ppSelection= _pHinge1Plane1Agent->GetElementValue(_pHinge1Plane1Agent->GetValue());
	spiHinge1Plane1=ppSelection;



	CATIBRepAccess * BrepOnHinge1Plane1=NULL;

	HRESULT	rc = ppSelection -> QueryInterface(IID_CATIBRepAccess,(void**)&BrepOnHinge1Plane1 );
	if ( FAILED(rc) || ( NULL == BrepOnHinge1Plane1) ) 
	{
		cout<<"失败IID_CATIBRepAccess！！！！！"<<endl;
		return TRUE;

	}
	spiBRepHinge1Plane1=BrepOnHinge1Plane1;

	spLastFeaOnHinge1Plane1=BrepOnHinge1Plane1->GetLastFeature();





	if (spiHinge1Plane1 == NULL_var) 	//特征化操作
	{	
		CATIFeaturize_var spToFeaturize = ppSelection;	
		spiHinge1Plane1 = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
	}	

	//获取tag值
	CATBody_var spOffsetFaceBody=GetBodyFromFeature(spiHinge1Plane1);

	CATLISTP(CATCell) facecells;
	spOffsetFaceBody->GetAllCells(facecells, 2);
	cout<<"NUMBER OF edge cell="<<facecells.Size()<<endl;
	CATFace* TopDownRollingface=(CATFace*)facecells[1];
	CATSurface *GeoDownRollingface=TopDownRollingface->GetSurface();
	int tag=GeoDownRollingface->GetPersistentTag();
	cout<<"tag值为："<<tag<<endl;
	CATUnicodeString strTag;
	strTag.BuildFromNum(tag);
	//获取tag值完毕





	CATUnicodeString SurName;
	SurName=spiHinge1Plane1->GetDisplayName();
		SurName=oName+"."+SurName+strTag;
	_HingePanel->_SelectorList014->SetLine ( SurName ,0, CATDlgDataModify );



	//int iNumberOfSelectedLines[1];
	//iNumberOfSelectedLines[0]=0;
	//int iArraySize = 1;
	//int iNotify = 0;
	//_HingePanel->_SelectorList014->SetSelect(iNumberOfSelectedLines,
	//	iArraySize, iNotify);
	_HingePanel->SJDSetHingeSelect(4,0);



	////试试
	//CATBody_var spOffsetFaceBody1=GetBodyFromFeature(spiHinge1Plane1);

	//CATLISTP(CATCell) facecells1;
	//spOffsetFaceBody1->GetAllCells(facecells1, 2);

	//CATFace* pfacePlane1=(CATFace*)facecells1[1];
	//CATGeometry* pGeoPlane1=pfacePlane1->GetGeometry();
	//CATPlane* pPlane1=(CATPlane*)pGeoPlane1;
	//CATMathPlane mathplane1;
	//pPlane1->GetAxis(mathplane1);
	//mathplane1.Dump();


	//CATIAlias_var aliasOnCurrentSet = spLastFeaOnHinge1Plane1 ;
	//if ( NULL_var != aliasOnCurrentSet)
	//{
	//	cout << "包含平面1的特征是：" << aliasOnCurrentSet->GetAlias().ConvertToChar()<<endl;
	//}
	//CATBody_var spTopLastFeaOnHinge1Plane1=GetBodyFromFeature(spLastFeaOnHinge1Plane1);

	//if (NULL_var==spTopLastFeaOnHinge1Plane1)
	//{
	//	cout<<"空！！！！！"<<endl;
	//}
	//CATLISTP(CATCell) volcells1;
	//spTopLastFeaOnHinge1Plane1->GetAllCells(volcells1, 3);
	//cout<<"体的个数："<<volcells1.Size()<<endl;
	//CATVolume_var VolumeOnMainBody=volcells1[1];

	//CATGSMOrientation om=CATGSMSameOrientation;
	//CATBoolean OutsideIn=FALSE;
	////CATBoolean SameOrNot=FALSE;
	//CATFace_var spFaceCell = pfacePlane1;
	//HRESULT rc1= SJDFaceDirectionIsInnerVolum(spFaceCell,VolumeOnMainBody,OutsideIn);//true指向体内


	//CATSurface *SelSurface=spFaceCell->GetSurface();

	//CATSurParam CenterParm;
	//spFaceCell->EstimateCenterParam(CenterParm);

	//CATMathDirection SurNormalDir=SelSurface->EvalNormal(CenterParm);//所选面的法向向量
	//if (TRUE==OutsideIn)
	//{
	//	SurNormalDir=SurNormalDir*(-1);
	//}


	//cout<<"所选面的法向向量:"<<endl;
	//SurNormalDir.Dump();


	////试试















	_pHinge1Plane1Agent->InitializeAcquisition();






	return TRUE;
}
CATBoolean TestCmd::ChooseHinge1Plane2(void * date)
{
	cout<<"ChooseHinge1Plane2函数中"<<endl;

	if (NULL==_pHinge1Plane2Agent)		
	{
		cout<<"_pHinge1Plane1Agent代理为空"<<endl;
		return TRUE;
	}


	pHinge1Plane2PathSel = _pHinge1Plane2Agent -> GetValue ();

	//CATPathElement *PlanePathElement=_pUpRotateFaceAgent->GetValue();//Returns the agent value. Role: The value is the path of the selected object.
	CATIProduct_var piInstanceProd = pHinge1Plane2PathSel->FindElement( CATIProduct::ClassId());
	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	cout<<"所选第一个零件的实例为："<<oName<<endl;
	piInstanceProd->QueryInterface(IID_CATIProduct, (void**) &piInstanceProdOnHinge1Plane2);





	if ( _HSO ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pHinge1Plane2PathSel);
		_HSO -> EndAddElements ();
		//_HSO = NULL;
	}

	CATBaseUnknown *ppSelection=NULL;
	ppSelection= _pHinge1Plane2Agent->GetElementValue(_pHinge1Plane2Agent->GetValue());
	spiHinge1Plane2=ppSelection;



	CATIBRepAccess * BrepOnHinge1Plane2=NULL;

	HRESULT	rc = ppSelection -> QueryInterface(IID_CATIBRepAccess,(void**)&BrepOnHinge1Plane2 );
	if ( FAILED(rc) || ( NULL == BrepOnHinge1Plane2) ) 
	{
		cout<<"失败IID_CATIBRepAccess！！！！！"<<endl;
		return TRUE;

	}

	spLastFeaOnHinge1Plane2=BrepOnHinge1Plane2->GetLastFeature();




	if (spiHinge1Plane2 == NULL_var) 	//特征化操作
	{	
		cout<<"选择特征为空！！！"<<endl;
		CATIFeaturize_var spToFeaturize = ppSelection;	
		spiHinge1Plane2 = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
	}	

	//获取tag值
	CATBody_var spOffsetFaceBody=GetBodyFromFeature(spiHinge1Plane2);

	CATLISTP(CATCell) facecells;
	spOffsetFaceBody->GetAllCells(facecells, 2);
	cout<<"NUMBER OF edge cell="<<facecells.Size()<<endl;
	CATFace* TopDownRollingface=(CATFace*)facecells[1];
	CATSurface *GeoDownRollingface=TopDownRollingface->GetSurface();
	int tag=GeoDownRollingface->GetPersistentTag();
	cout<<"tag值为："<<tag<<endl;
	CATUnicodeString strTag;
	strTag.BuildFromNum(tag);
	//获取tag值完毕





	CATUnicodeString SurName;
	SurName=spiHinge1Plane2->GetDisplayName();
		SurName=oName+"."+SurName+strTag;
	_HingePanel->_SelectorList016->SetLine ( SurName ,0, CATDlgDataModify );


	//int iNumberOfSelectedLines[1];
	//iNumberOfSelectedLines[0]=0;
	//int iArraySize = 1;
	//int iNotify = 0;
	//_HingePanel->_SelectorList016->SetSelect(iNumberOfSelectedLines,
	//	iArraySize, iNotify);
	_HingePanel->SJDSetHingeSelect(5,0);



	_pHinge1Plane2Agent->InitializeAcquisition();




	return TRUE;
}



CATBoolean TestCmd::ChooseHinge2Line1(void * date)
{
	cout<<"ChooseHinge2Line1函数中"<<endl;



	if (NULL==_pHinge2Line1Agent)		
	{
		cout<<"_pHinge1Line1Agent代理为空"<<endl;
		return TRUE;
	}


	pHinge2Line1PathSel = _pHinge2Line1Agent -> GetValue ();
	CATIProduct_var piInstanceProd = pHinge2Line1PathSel->FindElement( CATIProduct::ClassId());
	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	srtHinge2Line1Prd=oName;
	cout<<"所选第一个零件的实例为："<<oName<<endl;


	if ( _HSO ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pHinge2Line1PathSel);
		_HSO -> EndAddElements ();
		//_HSO = NULL;
	}

	CATBaseUnknown *ppSelection=NULL;
	ppSelection= _pHinge2Line1Agent->GetElementValue(_pHinge2Line1Agent->GetValue());
	spiHinge2Line1=ppSelection;


	if (spiHinge2Line1 == NULL_var) 	//特征化操作
	{	
		CATIFeaturize_var spToFeaturize = ppSelection;	
		spiHinge2Line1 = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
	}	


	//获取tag值edge
	CATBody_var spOffsetEdgeBody=GetBodyFromFeature(spiHinge2Line1);

	CATLISTP(CATCell) edgecells;
	spOffsetEdgeBody->GetAllCells(edgecells, 1);
	cout<<"NUMBER OF edge cell="<<edgecells.Size()<<endl;
	CATEdge* TopDownRollingedge=(CATEdge*)edgecells[1];
	CATEdgeCurve *GeoDownRollingface=TopDownRollingedge->GetCurve();
	int tag=GeoDownRollingface->GetPersistentTag();
	cout<<"tag值为："<<tag<<endl;
	CATUnicodeString strTag;
	strTag.BuildFromNum(tag);
	//获取tag值完毕



	//得到所选直线的向量

	CATBody_var spPreHinge1Line1=GetBodyFromFeature(spiHinge2Line1);

	CATLISTP(CATCell) Linecells;
	spPreHinge1Line1->GetAllCells(Linecells, 1);
	cout<<"NUMBER OF edge cell="<<Linecells.Size()<<endl;
	cout<<"zheli"<<endl;
	CATEdge* pPreTopLine=(CATEdge*)Linecells[1];
	CATVertex*  oStartVertex;
	CATVertex*  oEndVertex;
	pPreTopLine->GetVertices(&oStartVertex,&oEndVertex);
	CATPoint *statPt=oStartVertex->GetPoint();
	CATPoint *endPt=oEndVertex->GetPoint();

	CATMathPoint StartMathPt;
	CATMathPoint EndMathPt;
	statPt->GetMathPoint(StartMathPt);
	endPt->GetMathPoint(EndMathPt);

	DirOnPreHinge2Line1=EndMathPt-StartMathPt;

	//得到所选直线的向量完毕






	CATUnicodeString SurName;
	SurName=spiHinge2Line1->GetDisplayName();
		SurName=oName+"."+SurName+strTag;
	_HingePanel->_SelectorList007->SetLine ( SurName ,0, CATDlgDataModify );



	//int iNumberOfSelectedLines[1];
	//iNumberOfSelectedLines[0]=0;
	//int iArraySize = 1;
	//int iNotify = 0;
	//_HingePanel->_SelectorList007->SetSelect(iNumberOfSelectedLines,
	//	iArraySize, iNotify);
	_HingePanel->SJDSetHingeSelect(6,0);



	_pHinge2Line1Agent->InitializeAcquisition();



	return TRUE;
}
CATBoolean TestCmd::ChooseHinge2Line2(void * date)
{
	cout<<"ChooseHinge2Line2函数中"<<endl;




	if (NULL==_pHinge2Line2Agent)		
	{
		cout<<"_pHinge1Line2Agent代理为空"<<endl;
		return TRUE;
	}


	pHinge2Line2PathSel = _pHinge2Line2Agent -> GetValue ();
	CATIProduct_var piInstanceProd = pHinge2Line2PathSel->FindElement( CATIProduct::ClassId());
	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	srtHinge2Line2Prd=oName;
	cout<<"所选第一个零件的实例为："<<oName<<endl;


	if ( _HSO ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pHinge2Line2PathSel);
		_HSO -> EndAddElements ();
		//_HSO = NULL;
	}

	CATBaseUnknown *ppSelection=NULL;
	ppSelection= _pHinge2Line2Agent->GetElementValue(_pHinge2Line2Agent->GetValue());
	spiHinge2Line2=ppSelection;


	if (spiHinge2Line2 == NULL_var) 	//特征化操作
	{	
		CATIFeaturize_var spToFeaturize = ppSelection;	
		spiHinge2Line2 = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
	}	

	//获取tag值edge
	CATBody_var spOffsetEdgeBody=GetBodyFromFeature(spiHinge2Line2);

	CATLISTP(CATCell) edgecells;
	spOffsetEdgeBody->GetAllCells(edgecells, 1);
	cout<<"NUMBER OF edge cell="<<edgecells.Size()<<endl;
	CATEdge* TopDownRollingedge=(CATEdge*)edgecells[1];
	CATEdgeCurve *GeoDownRollingface=TopDownRollingedge->GetCurve();
	int tag=GeoDownRollingface->GetPersistentTag();
	cout<<"tag值为："<<tag<<endl;
	CATUnicodeString strTag;
	strTag.BuildFromNum(tag);
	//获取tag值完毕



	CATUnicodeString SurName;
	SurName=spiHinge2Line2->GetDisplayName();
	SurName=oName+"."+SurName+strTag;

	_HingePanel->_SelectorList018->SetLine ( SurName ,0, CATDlgDataModify );


	//int iNumberOfSelectedLines[1];
	//iNumberOfSelectedLines[0]=0;
	//int iArraySize = 1;
	//int iNotify = 0;
	//_HingePanel->_SelectorList018->SetSelect(iNumberOfSelectedLines,
	//	iArraySize, iNotify);
	_HingePanel->SJDSetHingeSelect(7,0);



	_pHinge2Line2Agent->InitializeAcquisition();




	return TRUE;
}
CATBoolean TestCmd::ChooseHinge2Plane1(void * date)
{
	cout<<"ChooseHinge2Plane1函数中"<<endl;




	if (NULL==_pHinge2Plane1Agent)		
	{
		cout<<"_pHinge2Plane1Agent代理为空"<<endl;
		return TRUE;
	}


	pHinge2Plane1PathSel = _pHinge2Plane1Agent -> GetValue ();

	//CATPathElement *PlanePathElement=_pUpRotateFaceAgent->GetValue();//Returns the agent value. Role: The value is the path of the selected object.
	CATIProduct_var piInstanceProd = pHinge2Plane1PathSel->FindElement( CATIProduct::ClassId());
	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	cout<<"所选第一个零件的实例为："<<oName<<endl;
	piInstanceProd->QueryInterface(IID_CATIProduct, (void**) &piInstanceProdOnHinge2Plane1);





	if ( _HSO ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pHinge2Plane1PathSel);
		_HSO -> EndAddElements ();
		//_HSO = NULL;
	}

	CATBaseUnknown *ppSelection=NULL;
	ppSelection= _pHinge2Plane1Agent->GetElementValue(_pHinge2Plane1Agent->GetValue());
	spiHinge2Plane1=ppSelection;



	CATIBRepAccess * BrepOnHinge2Plane1=NULL;

	HRESULT	rc = ppSelection -> QueryInterface(IID_CATIBRepAccess,(void**)&BrepOnHinge2Plane1 );
	if ( FAILED(rc) || ( NULL == BrepOnHinge2Plane1) ) 
	{
		cout<<"失败IID_CATIBRepAccess！！！！！"<<endl;
		return TRUE;

	}
spiBRepHinge2Plane1=BrepOnHinge2Plane1;
	spLastFeaOnHinge2Plane1=BrepOnHinge2Plane1->GetLastFeature();







	if (spiHinge2Plane1 == NULL_var) 	//特征化操作
	{	
		CATIFeaturize_var spToFeaturize = ppSelection;	
		spiHinge2Plane1 = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
	}	
	//获取tag值
	CATBody_var spOffsetFaceBody=GetBodyFromFeature(spiHinge2Plane1);

	CATLISTP(CATCell) facecells;
	spOffsetFaceBody->GetAllCells(facecells, 2);
	cout<<"NUMBER OF edge cell="<<facecells.Size()<<endl;
	CATFace* TopDownRollingface=(CATFace*)facecells[1];
	CATSurface *GeoDownRollingface=TopDownRollingface->GetSurface();
	int tag=GeoDownRollingface->GetPersistentTag();
	cout<<"tag值为："<<tag<<endl;
	CATUnicodeString strTag;
	strTag.BuildFromNum(tag);
	//获取tag值完毕


	CATUnicodeString SurName;
	SurName=spiHinge2Plane1->GetDisplayName();
	SurName=oName+"."+SurName+strTag;

	_HingePanel->_SelectorList020->SetLine ( SurName ,0, CATDlgDataModify );


	//int iNumberOfSelectedLines[1];
	//iNumberOfSelectedLines[0]=0;
	//int iArraySize = 1;
	//int iNotify = 0;
	//_HingePanel->_SelectorList020->SetSelect(iNumberOfSelectedLines,
	//	iArraySize, iNotify);

	_HingePanel->SJDSetHingeSelect(8,0);

	_pHinge2Plane1Agent->InitializeAcquisition();



	return TRUE;
}
CATBoolean TestCmd::ChooseHinge2Plane2(void * date)
{
	cout<<"ChooseHinge2Plane2函数中"<<endl;




	if (NULL==_pHinge2Plane2Agent)		
	{
		cout<<"_pHinge2Plane2Agent代理为空"<<endl;
		return TRUE;
	}


	pHinge2Plane2PathSel = _pHinge2Plane2Agent -> GetValue ();

	//CATPathElement *PlanePathElement=_pUpRotateFaceAgent->GetValue();//Returns the agent value. Role: The value is the path of the selected object.
	CATIProduct_var piInstanceProd = pHinge2Plane2PathSel->FindElement( CATIProduct::ClassId());
	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	cout<<"所选第一个零件的实例为："<<oName<<endl;
	piInstanceProd->QueryInterface(IID_CATIProduct, (void**) &piInstanceProdOnHinge2Plane2);





	if ( _HSO ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pHinge2Plane2PathSel);
		_HSO -> EndAddElements ();
		//_HSO = NULL;
	}

	CATBaseUnknown *ppSelection=NULL;
	ppSelection= _pHinge2Plane2Agent->GetElementValue(_pHinge2Plane2Agent->GetValue());
	spiHinge2Plane2=ppSelection;




	CATIBRepAccess * BrepOnHinge2Plane2=NULL;

	HRESULT	rc = ppSelection -> QueryInterface(IID_CATIBRepAccess,(void**)&BrepOnHinge2Plane2 );
	if ( FAILED(rc) || ( NULL == BrepOnHinge2Plane2) ) 
	{
		cout<<"失败IID_CATIBRepAccess！！！！！"<<endl;
		return TRUE;

	}

	spLastFeaOnHinge2Plane2=BrepOnHinge2Plane2->GetLastFeature();




	if (spiHinge2Plane2 == NULL_var) 	//特征化操作
	{	
		CATIFeaturize_var spToFeaturize = ppSelection;	
		spiHinge2Plane2 = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
	}	


	//获取tag值
	CATBody_var spOffsetFaceBody=GetBodyFromFeature(spiHinge2Plane2);

	CATLISTP(CATCell) facecells;
	spOffsetFaceBody->GetAllCells(facecells, 2);
	cout<<"NUMBER OF edge cell="<<facecells.Size()<<endl;
	CATFace* TopDownRollingface=(CATFace*)facecells[1];
	CATSurface *GeoDownRollingface=TopDownRollingface->GetSurface();
	int tag=GeoDownRollingface->GetPersistentTag();
	cout<<"tag值为："<<tag<<endl;
	CATUnicodeString strTag;
	strTag.BuildFromNum(tag);
	//获取tag值完毕




	CATUnicodeString SurName;
	SurName=spiHinge2Plane2->GetDisplayName();
	SurName=oName+"."+SurName+strTag;

	_HingePanel->_SelectorList022->SetLine ( SurName ,0, CATDlgDataModify );



	//int iNumberOfSelectedLines[1];
	//iNumberOfSelectedLines[0]=0;
	//int iArraySize = 1;
	//int iNotify = 0;
	//_HingePanel->_SelectorList022->SetSelect(iNumberOfSelectedLines,
	//	iArraySize, iNotify);
	_HingePanel->SJDSetHingeSelect(8,0);

	_pHinge2Plane2Agent->InitializeAcquisition();




	return TRUE;
}

CATBoolean TestCmd::Plane1IsInSamePrdHinge1Line1(void * date)
{

	cout<<"执行prd过滤"<<endl;

	CATBoolean IsInSamePrd=FALSE;

	if (NULL==_pHinge1Plane1Agent)		
	{
		cout<<"_pHinge1Plane1Agent代理为空"<<endl;
		IsInSamePrd=FALSE;
	}
	else
	{
		CATPathElement * pHinge1Plane1PathSel = _pHinge1Plane1Agent -> GetValue ();

		CATIProduct_var piInstanceProd = pHinge1Plane1PathSel->FindElement( CATIProduct::ClassId());
		CATUnicodeString oName ;
		piInstanceProd->GetPrdInstanceName(oName);
		if (oName==srtHinge1Line1Prd)
		{
			IsInSamePrd=TRUE;

		} 
		else
		{
			IsInSamePrd=FALSE;

		}


	}
	return IsInSamePrd;
}


CATBoolean TestCmd::Plane2IsInSamePrdHinge1Line2(void * date)
{

	cout<<"执行prd过滤"<<endl;

	CATBoolean IsInSamePrd=FALSE;

	if (NULL==_pHinge1Plane2Agent)		
	{
		cout<<"_pHinge1Plane1Agent代理为空"<<endl;
		IsInSamePrd=FALSE;
	}
	else
	{
		CATPathElement * pHinge1Plane2PathSel = _pHinge1Plane2Agent -> GetValue ();

		CATIProduct_var piInstanceProd = pHinge1Plane2PathSel->FindElement( CATIProduct::ClassId());
		CATUnicodeString oName ;
		piInstanceProd->GetPrdInstanceName(oName);
		if (oName==srtHinge1Line2Prd)
		{
			IsInSamePrd=TRUE;

		} 
		else
		{
			IsInSamePrd=FALSE;

		}


	}
	return IsInSamePrd;
}




CATBoolean TestCmd::Plane1IsInSamePrdHinge2Line1(void * date)
{

	cout<<"执行prd过滤"<<endl;

	CATBoolean IsInSamePrd=FALSE;

	if (NULL==_pHinge2Plane1Agent)		
	{
		cout<<"_pHinge1Plane1Agent代理为空"<<endl;
		IsInSamePrd=FALSE;
	}
	else
	{
		CATPathElement * pHinge2Plane1PathSel = _pHinge2Plane1Agent -> GetValue ();

		CATIProduct_var piInstanceProd = pHinge2Plane1PathSel->FindElement( CATIProduct::ClassId());
		CATUnicodeString oName ;
		piInstanceProd->GetPrdInstanceName(oName);
		if (oName==srtHinge2Line1Prd)
		{
			IsInSamePrd=TRUE;

		} 
		else
		{
			IsInSamePrd=FALSE;

		}


	}
	return IsInSamePrd;
}

CATBoolean TestCmd::Plane2IsInSamePrdHinge2Line2(void * date)
{

	cout<<"执行prd过滤"<<endl;

	CATBoolean IsInSamePrd=FALSE;

	if (NULL==_pHinge2Plane2Agent)		
	{
		cout<<"_pHinge1Plane1Agent代理为空"<<endl;
		IsInSamePrd=FALSE;
	}
	else
	{
		CATPathElement * pHinge2Plane2PathSel = _pHinge2Plane2Agent -> GetValue ();

		CATIProduct_var piInstanceProd = pHinge2Plane2PathSel->FindElement( CATIProduct::ClassId());
		CATUnicodeString oName ;
		piInstanceProd->GetPrdInstanceName(oName);
		if (oName==srtHinge2Line2Prd)
		{
			IsInSamePrd=TRUE;

		} 
		else
		{
			IsInSamePrd=FALSE;

		}


	}
	return IsInSamePrd;
}





CATBoolean TestCmd::Plane1IsNormalToHinge1Line1(void * date)
{


	cout<<"执行过滤"<<endl;

	CATBoolean IsNormal=FALSE;


	if (NULL==_pHinge1Plane1Agent)		
	{
		cout<<"_pHinge1Plane1Agent代理为空"<<endl;
		IsNormal=FALSE;
	}
	else
	{
		cout<<"代理不为空"<<endl;
		//判断所选面是否与之前选的直线垂直

		CATBaseUnknown *ppSelection=NULL;
		ppSelection= _pHinge1Plane1Agent->GetElementValue(_pHinge1Plane1Agent->GetValue());
		CATISpecObject_var spPreSlePlane=ppSelection;
		if (NULL_var==spPreSlePlane)
		{
	
			CATIFeaturize_var spToFeaturize = ppSelection;	
			spPreSlePlane = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
		

		}

		CATBody_var spPreFaceBody=GetBodyFromFeature(spPreSlePlane);

		CATLISTP(CATCell) facecells;
		spPreFaceBody->GetAllCells(facecells, 2);
		cout<<"NUMBER OF edge cell="<<facecells.Size()<<endl;
		CATFace* pPreTopface=(CATFace*)facecells[1];
		CATSurface *pSurOnPre=pPreTopface->GetSurface();
		CATPlane *pPrePlan=(CATPlane*)pSurOnPre;
		CATMathVector PrePlanNor;

		CATMathPoint PrePt;

		if (NULL!=pPrePlan)
		{



			pPrePlan->GetNormal(PrePt,PrePlanNor);

			CATBoolean IsPrll=PrePlanNor.IsParallel(DirOnPreHinge1Line1);

			if (IsPrll)
			{

				IsNormal=TRUE;

			}
			else
				IsNormal=FALSE;


		}
		else
			IsNormal=FALSE;


		//判断所选面是否与之前选的直线垂直完毕
		//IsNormal=TRUE;

	}




	return IsNormal;
}

CATBoolean TestCmd::Plane2IsNormalToHinge1Line1(void * date)
{


	cout<<"执行过滤"<<endl;

	CATBoolean IsNormal=FALSE;


	if (NULL==_pHinge1Plane2Agent)		
	{
		cout<<"_pHinge1Plane2Agent代理为空"<<endl;
		IsNormal=FALSE;
	}
	else
	{
		cout<<"代理不为空"<<endl;
		//判断所选面是否与之前选的直线垂直

		CATBaseUnknown *ppSelection=NULL;
		ppSelection= _pHinge1Plane2Agent->GetElementValue(_pHinge1Plane2Agent->GetValue());
		CATISpecObject_var spPreSlePlane=ppSelection;
		if (NULL_var==spPreSlePlane)
		{

			CATIFeaturize_var spToFeaturize = ppSelection;	
			spPreSlePlane = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);


		}

		CATBody_var spPreFaceBody=GetBodyFromFeature(spPreSlePlane);

		CATLISTP(CATCell) facecells;
		spPreFaceBody->GetAllCells(facecells, 2);
		cout<<"NUMBER OF edge cell="<<facecells.Size()<<endl;
		CATFace* pPreTopface=(CATFace*)facecells[1];
		CATSurface *pSurOnPre=pPreTopface->GetSurface();
		CATPlane *pPrePlan=(CATPlane*)pSurOnPre;
		CATMathVector PrePlanNor;

		CATMathPoint PrePt;

		if (NULL!=pPrePlan)
		{



			pPrePlan->GetNormal(PrePt,PrePlanNor);

			CATBoolean IsPrll=PrePlanNor.IsParallel(DirOnPreHinge1Line1);

			if (IsPrll)
			{

				IsNormal=TRUE;

			}
			else
				IsNormal=FALSE;


		}
		else
			IsNormal=FALSE;


		//判断所选面是否与之前选的直线垂直完毕
		//IsNormal=TRUE;

	}




	return IsNormal;
}





CATBoolean TestCmd::Plane1IsNormalToHinge2Line1(void * date)
{


	cout<<"执行过滤"<<endl;

	CATBoolean IsNormal=FALSE;


	if (NULL==_pHinge2Plane1Agent)		
	{
		cout<<"_pHinge1Plane2Agent代理为空"<<endl;
		IsNormal=FALSE;
	}
	else
	{
		cout<<"代理不为空"<<endl;
		//判断所选面是否与之前选的直线垂直

		CATBaseUnknown *ppSelection=NULL;
		ppSelection= _pHinge2Plane1Agent->GetElementValue(_pHinge2Plane1Agent->GetValue());
		CATISpecObject_var spPreSlePlane=ppSelection;
		if (NULL_var==spPreSlePlane)
		{

			CATIFeaturize_var spToFeaturize = ppSelection;	
			spPreSlePlane = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);


		}

		CATBody_var spPreFaceBody=GetBodyFromFeature(spPreSlePlane);

		CATLISTP(CATCell) facecells;
		spPreFaceBody->GetAllCells(facecells, 2);
		cout<<"NUMBER OF edge cell="<<facecells.Size()<<endl;
		CATFace* pPreTopface=(CATFace*)facecells[1];
		CATSurface *pSurOnPre=pPreTopface->GetSurface();
		CATPlane *pPrePlan=(CATPlane*)pSurOnPre;
		CATMathVector PrePlanNor;

		CATMathPoint PrePt;

		if (NULL!=pPrePlan)
		{



			pPrePlan->GetNormal(PrePt,PrePlanNor);

			CATBoolean IsPrll=PrePlanNor.IsParallel(DirOnPreHinge2Line1);

			if (IsPrll)
			{

				IsNormal=TRUE;

			}
			else
				IsNormal=FALSE;


		}
		else
			IsNormal=FALSE;


		//判断所选面是否与之前选的直线垂直完毕
		//IsNormal=TRUE;

	}




	return IsNormal;
}



CATBoolean TestCmd::Plane2IsNormalToHinge2Line1(void * date)
{


	cout<<"执行过滤"<<endl;

	CATBoolean IsNormal=FALSE;


	if (NULL==_pHinge2Plane2Agent)		
	{
		cout<<"_pHinge1Plane2Agent代理为空"<<endl;
		IsNormal=FALSE;
	}
	else
	{
		cout<<"代理不为空"<<endl;
		//判断所选面是否与之前选的直线垂直

		CATBaseUnknown *ppSelection=NULL;
		ppSelection= _pHinge2Plane2Agent->GetElementValue(_pHinge2Plane2Agent->GetValue());
		CATISpecObject_var spPreSlePlane=ppSelection;
		if (NULL_var==spPreSlePlane)
		{

			CATIFeaturize_var spToFeaturize = ppSelection;	
			spPreSlePlane = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);


		}

		CATBody_var spPreFaceBody=GetBodyFromFeature(spPreSlePlane);

		CATLISTP(CATCell) facecells;
		spPreFaceBody->GetAllCells(facecells, 2);
		cout<<"NUMBER OF edge cell="<<facecells.Size()<<endl;
		CATFace* pPreTopface=(CATFace*)facecells[1];
		CATSurface *pSurOnPre=pPreTopface->GetSurface();
		CATPlane *pPrePlan=(CATPlane*)pSurOnPre;
		CATMathVector PrePlanNor;

		CATMathPoint PrePt;

		if (NULL!=pPrePlan)
		{



			pPrePlan->GetNormal(PrePt,PrePlanNor);

			CATBoolean IsPrll=PrePlanNor.IsParallel(DirOnPreHinge2Line1);

			if (IsPrll)
			{

				IsNormal=TRUE;

			}
			else
				IsNormal=FALSE;


		}
		else
			IsNormal=FALSE;


		//判断所选面是否与之前选的直线垂直完毕
		//IsNormal=TRUE;

	}




	return IsNormal;
}




//
//CATBoolean TestCmd::SelectSecSelectList(void * date)
//{
//	cout<<"SelectSecSelectList函数中"<<endl;
//
//	if (_pSecondAgent!=NULL)
//	{
//		cout<<"_pSecondAgent!=NULL"<<endl;
//
//		_pSecondAgent->InitializeAcquisition();
//	}
//	if (_Panel->GetDlgSelectorList(1)->IsSelect(0)==TRUE)
//	{
//		cout<<"_panel->GetDlgSelectorList(1)->IsSelect(0)==TRUE"<<endl;
//
//		_Panel->GetDlgSelectorList(1)->ClearSelect();
//	}
//	return TRUE;
//}
//CATBoolean TestCmd::ChoosePoint(void * date)
//{
//	cout<<"ChoosePoint函数中"<<endl;
//
//	_HSO->Empty();
//
//	if (NULL!=_pPointAgent)
//	{
//		CATBaseUnknown *pSelection = _pPointAgent->GetElementValue(_pPointAgent->GetValue());
//
//		_pPointAgent->InitializeAcquisition();
//
//		spiPoint=pSelection;
//		if (spiPoint==NULL_var)
//		{
//			CATIFeaturize_var spToFeaturize = pSelection;
//			spiPoint = spToFeaturize->FeaturizeR(MfPermanentBody |MfLastFeatureSupport |MfRelimitedFeaturization);
//			_Panel->SetName(2,spiPoint->GetDisplayName(),0);
//		}
//		else
//		{
//			_Panel->SetName(2,spiPoint->GetDisplayName(),0);
//		}
//	}
//
//	CATPathElement RootPath     = _editor->GetUIActiveObject();
//	CATPathElement *pPathBound= new CATPathElement(RootPath);
//	pPathBound->AddChildElement(spiPoint);//创建对象的CATPathElement
//	_HSO->AddElement(pPathBound);
//
//	return TRUE;
//}

CATBoolean TestCmd::ChooseUpRotateSurface(void * date)
{
	cout<<"ChooseUpRotateSurface函数中!!!!!!!!!!!!!!!!!"<<endl;



	if (NULL==_pUpRotateFaceAgent)		
	{
		cout<<"面代理为空"<<endl;
		return TRUE;
	}


	pUpRotateFacePathSel = _pUpRotateFaceAgent -> GetValue ();

	//CATPathElement *PlanePathElement=_pUpRotateFaceAgent->GetValue();//Returns the agent value. Role: The value is the path of the selected object.
	CATIProduct_var piInstanceProd = pUpRotateFacePathSel->FindElement( CATIProduct::ClassId());
	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	cout<<"所选第一个零件的实例为："<<oName<<endl;
	piInstanceProd->QueryInterface(IID_CATIProduct, (void**) &piInstanceProdOnUpRotate);


	HRESULT r1=piInstanceProdOnUpRotate->IsReference();
	if (SUCCEEDED(r1))
	{
		cout<<"这是一个IsReference"<<endl;
	}



	if ( _HSO ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pUpRotateFacePathSel);
        _HSO -> EndAddElements ();
		//_HSO = NULL;
	}

	CATBaseUnknown *ppSelection=NULL;
	ppSelection= _pUpRotateFaceAgent->GetElementValue(_pUpRotateFaceAgent->GetValue());
	spiUpRotateSpcSurface=ppSelection;




	if (spiUpRotateSpcSurface == NULL_var) 	//特征化操作
	{	
		CATIFeaturize_var spToFeaturize = ppSelection;	
		spiUpRotateSpcSurface = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
	}	
//	SJDOutputInheritanceStructure(spiUpRotateSpcSurface);
//SJDOutputSpecObjectAllAttributes(spiUpRotateSpcSurface);



	//获取tag值
	CATBody_var spOffsetFaceBody=GetBodyFromFeature(spiUpRotateSpcSurface);

	CATLISTP(CATCell) facecells;
	spOffsetFaceBody->GetAllCells(facecells, 2);
	cout<<"NUMBER OF edge cell="<<facecells.Size()<<endl;
	CATFace* TopDownRollingface=(CATFace*)facecells[1];
	CATSurface *GeoDownRollingface=TopDownRollingface->GetSurface();
	int tag=GeoDownRollingface->GetPersistentTag();
	cout<<"tag值为："<<tag<<endl;
	CATUnicodeString strTag;
	strTag.BuildFromNum(tag);
	//获取tag值完毕








	CATUnicodeString SurName;
	SurName=spiUpRotateSpcSurface->GetDisplayName();
	SurName=oName+"."+SurName+strTag;

	_RotatePanel->_SelectorList006->SetLine ( SurName ,0, CATDlgDataModify );



	//int iNumberOfSelectedLines[1];
	//iNumberOfSelectedLines[0]=0;
	//int iArraySize = 1;
	//int iNotify = 0;
	//_RotatePanel->_SelectorList006->SetSelect(iNumberOfSelectedLines,
	//	iArraySize, iNotify);
	_RotatePanel->SJDSetRotateSelect(2,0);



	_pUpRotateFaceAgent->InitializeAcquisition();



	return TRUE;
}
CATIPrtContainer_var TestCmd::GetConFromInstancePrd(CATIProduct * InstancePrd)
{

	CATIPrtContainer_var spPrtCon=NULL_var;
	CATIProduct_var sReferenceProduct = InstancePrd->GetReferenceProduct();//不释放指针 等做connector

	cout<<"7"<<endl;
	if(NULL_var != sReferenceProduct)
	{
		cout<<"NULL_var != piInstanceProdOnRotate"<<endl;
		CATILinkableObject * piLinkableOnProduct=NULL;

		HRESULT rc = sReferenceProduct->QueryInterface(IID_CATILinkableObject, (void **)&piLinkableOnProduct);
		cout<<"8"<<endl;

		if (SUCCEEDED(rc))
		{   
			cout<<"2"<<endl;

			CATDocument *pDoc = piLinkableOnProduct-> GetDocument();
			piLinkableOnProduct->Release();
			piLinkableOnProduct=NULL;
			CATDocument * pRootDoctemp=pDoc;
			CATInit *piInitOnDoc = NULL;
			HRESULT rc = pRootDoctemp -> QueryInterface(IID_CATInit,(void**) &piInitOnDoc);

			if(SUCCEEDED(rc))
			{

				const CATIdent idCATIContainer = "CATIContainer";

				CATIContainer *piSorceRootContainer = (CATIContainer*) piInitOnDoc -> GetRootContainer(idCATIContainer);

				piInitOnDoc->Release();
				piInitOnDoc=NULL;

				//get the partcontainer
				CATIPrtContainer* piPrtContainer = NULL;
				rc = piSorceRootContainer->QueryInterface(IID_CATIPrtContainer,(void**) &piPrtContainer);

				piSorceRootContainer->Release();
				piSorceRootContainer = NULL;
				if(SUCCEEDED(rc))
				{
					cout<<"4"<<endl;
					spPrtCon=piPrtContainer;
					if (!!piPrtContainer)
					{
						piPrtContainer->Release();
						piPrtContainer=NULL;
					}




					//cout<<"选择期间成功得到part"<<endl;
					//CATIPrtPart_var spSourcePrtPart = piPrtContainer->GetPart();
				}
				else
					cout<<"container没有得到"<<endl;
			}
		}
	}
	else
	{
			RDCDMUBFErrorMsgBox("产品实例为空");
	}
	return spPrtCon;


}







CATBoolean TestCmd::ChooseMdRotateSurface(void * date)
{
	cout<<"ChooseMdRotateSurface函数中"<<endl;
	if (NULL!=_pMdRotateFaceAgent)
	{
		_pMdRotateFaceAgent->InitializeAcquisition();

	}


	return TRUE;
}
CATBoolean TestCmd::ChooseDwRotateSurface(void * date)
{
	cout<<"ChooseDwRotateSurface函数中"<<endl;


	if (NULL==_pDwRotateFaceAgent)		
	{
		cout<<"面代理为空"<<endl;
		return TRUE;
	}


	pDownBearRotateFacePathSel = _pDwRotateFaceAgent -> GetValue ();

	CATIProduct_var piInstanceProd = pDownBearRotateFacePathSel->FindElement( CATIProduct::ClassId());
	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	cout<<"所选第一个零件的实例为："<<oName<<endl;
	//piInstanceProd->QueryInterface(IID_CATIProduct, (void**) &piInstanceProdOnUpRotate);



	if ( _HSO ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pDownBearRotateFacePathSel);
		_HSO -> EndAddElements ();
		//_HSO = NULL;
	}

	CATBaseUnknown *ppSelection=NULL;
	ppSelection= _pDwRotateFaceAgent->GetElementValue(_pDwRotateFaceAgent->GetValue());
	spiDownBearRotateSpcSurface=ppSelection;




	if (spiDownBearRotateSpcSurface == NULL_var) 	//特征化操作
	{	
		CATIFeaturize_var spToFeaturize = ppSelection;	
		spiDownBearRotateSpcSurface = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
	}	
	//	SJDOutputInheritanceStructure(spiUpRotateSpcSurface);
	//SJDOutputSpecObjectAllAttributes(spiUpRotateSpcSurface);


	//获取tag值
	CATBody_var spOffsetFaceBody=GetBodyFromFeature(spiDownBearRotateSpcSurface);

	CATLISTP(CATCell) facecells;
	spOffsetFaceBody->GetAllCells(facecells, 2);
	cout<<"NUMBER OF edge cell="<<facecells.Size()<<endl;
	CATFace* TopDownRollingface=(CATFace*)facecells[1];
	CATSurface *GeoDownRollingface=TopDownRollingface->GetSurface();
	int tag=GeoDownRollingface->GetPersistentTag();
	cout<<"tag值为："<<tag<<endl;
	CATUnicodeString strTag;
	strTag.BuildFromNum(tag);
	//获取tag值完毕


	CATUnicodeString SurName;
	SurName=spiDownBearRotateSpcSurface->GetDisplayName();
	SurName=oName+"."+SurName+strTag;

	_RotatePanel->_SelectorList008->SetLine ( SurName ,0, CATDlgDataModify );


	int iNumberOfSelectedLines[1];
	iNumberOfSelectedLines[0]=0;
	int iArraySize = 1;
	int iNotify = 0;
	_RotatePanel->_SelectorList008->SetSelect(iNumberOfSelectedLines,
		iArraySize, iNotify);

	_RotatePanel->SJDSetRotateSelect(5,0);





	_pDwRotateFaceAgent->InitializeAcquisition();



	return TRUE;
}
CATBoolean TestCmd::ChooseMdDirRotateSurface2(void * date)
{
	cout<<"ChooseMdDirRotateSurface2"<<endl;
	if (NULL==_pMdRotateDirFaceAgent2)		
	{
		cout<<"面代理为空"<<endl;
		return TRUE;
	}

	cout<<"选择另一个滚轮面"<<endl;

	pMidRotateFacePathSel2 = _pMdRotateDirFaceAgent2 -> GetValue ();

	////CATPathElement *PlanePathElement=_pUpRotateFaceAgent->GetValue();//Returns the agent value. Role: The value is the path of the selected object.
	CATIProduct_var piInstanceProd = pMidRotateFacePathSel2->FindElement( CATIProduct::ClassId());
	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	cout<<"所选第一个零件的实例为："<<oName<<endl;
	//piInstanceProd->QueryInterface(IID_CATIProduct, (void**) &piInstanceProdOnMidRotate1);






	if ( _HSO ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pMidRotateFacePathSel2);
		_HSO -> EndAddElements ();
		//_HSO = NULL;
	}


	CATBaseUnknown *ppSelection=NULL;
	ppSelection= _pMdRotateDirFaceAgent2->GetElementValue(_pMdRotateDirFaceAgent2->GetValue());
	spiMidRotateSpcSurface2=ppSelection;





	if (spiMidRotateSpcSurface2 == NULL_var) 	//特征化操作
	{	
		CATIFeaturize_var spToFeaturize = ppSelection;	
		spiMidRotateSpcSurface2 = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
	}	

	//获取tag值
	CATBody_var spOffsetFaceBody=GetBodyFromFeature(spiMidRotateSpcSurface2);

	CATLISTP(CATCell) facecells;
	spOffsetFaceBody->GetAllCells(facecells, 2);
	cout<<"NUMBER OF edge cell="<<facecells.Size()<<endl;
	CATFace* TopDownRollingface=(CATFace*)facecells[1];
	CATSurface *GeoDownRollingface=TopDownRollingface->GetSurface();
	int tag=GeoDownRollingface->GetPersistentTag();
	cout<<"tag值为："<<tag<<endl;
	CATUnicodeString strTag;
	strTag.BuildFromNum(tag);
	//获取tag值完毕



	CATUnicodeString SurName;
	SurName=spiMidRotateSpcSurface2->GetDisplayName();
	SurName=oName+"."+SurName+strTag;

	_RotatePanel->_SelectorListMdRot2->SetLine ( SurName ,0, CATDlgDataModify );


	//int iNumberOfSelectedLines[1];
	//iNumberOfSelectedLines[0]=0;
	//int iArraySize = 1;
	//int iNotify = 0;
	//_RotatePanel->_SelectorListMdRot2->SetSelect(iNumberOfSelectedLines,
	//	iArraySize, iNotify);
	_RotatePanel->SJDSetRotateSelect(4,0);




	_pMdRotateDirFaceAgent2->InitializeAcquisition();

	//int a=1;
	//_RotatePanel->_SelectorList012-> SetSelect(&a,1);
	return TRUE;


}

CATBoolean TestCmd::ChooseMdDirRotateSurface(void * date)
{
	cout<<"ChooseMdDirRotateSurface函数中"<<endl;


	if (NULL==_pMdRotateDirFaceAgent)		
	{
		cout<<"面代理为空"<<endl;
		return TRUE;
	}

	//int lo=0;
	//_RotatePanel->_SelectorList012->GetSelect(&lo,1);
	//cout<<"所选行为："<<lo<<endl;







	//if ((NULL!=pMidRotateFacePathSel1&&NULL==pMidRotateFacePathSel2)||(NULL!=pMidRotateFacePathSel1&&NULL!=pMidRotateFacePathSel2&&lo==1))
	//{


		//cout<<"选择另一个滚轮面"<<endl;

		//pMidRotateFacePathSel2 = _pMdRotateDirFaceAgent -> GetValue ();







		//if ( _HSO ) 
		//{
		//	_HSO -> Empty();
		//	_HSO -> AddElements (pMidRotateFacePathSel2);
		//	_HSO -> EndAddElements ();
		//}


		//CATBaseUnknown *ppSelection=NULL;
		//ppSelection= _pMdRotateDirFaceAgent->GetElementValue(_pMdRotateDirFaceAgent->GetValue());
		//spiMidRotateSpcSurface2=ppSelection;





		//if (spiMidRotateSpcSurface2 == NULL_var) 	//特征化操作
		//{	
		//	CATIFeaturize_var spToFeaturize = ppSelection;	
		//	spiMidRotateSpcSurface2 = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
		//}	

		//CATUnicodeString SurName;
		//SurName=spiMidRotateSpcSurface2->GetDisplayName();
		//_RotatePanel->_SelectorList012->SetLine ( SurName ,0, CATDlgDataModify );


		//_pMdRotateDirFaceAgent->InitializeAcquisition();

		//return TRUE;

	//}
	//else
	//{


		cout<<"第一个"<<endl;
		pMidRotateFacePathSel1 = _pMdRotateDirFaceAgent -> GetValue ();

		CATIProduct_var piInstanceProd = pMidRotateFacePathSel1->FindElement( CATIProduct::ClassId());
		CATUnicodeString oName ;
		piInstanceProd->GetPrdInstanceName(oName);
		cout<<"所选第一个零件的实例为："<<oName<<endl;
		piInstanceProd->QueryInterface(IID_CATIProduct, (void**) &piInstanceProdOnMidRotate1);


		HRESULT r1=piInstanceProdOnMidRotate1->IsReference();
		if (SUCCEEDED(r1))
		{
			cout<<"这是一个IsReference"<<endl;
		}



		if ( _HSO ) 
		{
			_HSO -> Empty();
			_HSO -> AddElements (pMidRotateFacePathSel1);
			_HSO -> EndAddElements ();
		}

		CATBaseUnknown *ppSelection=NULL;
		ppSelection= _pMdRotateDirFaceAgent->GetElementValue(_pMdRotateDirFaceAgent->GetValue());
		spiMidRotateSpcSurface1=ppSelection;




		if (spiMidRotateSpcSurface1 == NULL_var) 	//特征化操作
		{	
			CATIFeaturize_var spToFeaturize = ppSelection;	
			spiMidRotateSpcSurface1 = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
		}	
		//获取tag值
		CATBody_var spOffsetFaceBody=GetBodyFromFeature(spiMidRotateSpcSurface1);

		CATLISTP(CATCell) facecells;
		spOffsetFaceBody->GetAllCells(facecells, 2);
		cout<<"NUMBER OF edge cell="<<facecells.Size()<<endl;
		CATFace* TopDownRollingface=(CATFace*)facecells[1];
		CATSurface *GeoDownRollingface=TopDownRollingface->GetSurface();
		int tag=GeoDownRollingface->GetPersistentTag();
		cout<<"tag值为："<<tag<<endl;
		CATUnicodeString strTag;
		strTag.BuildFromNum(tag);
		//获取tag值完毕


		CATUnicodeString SurName;
		SurName=spiMidRotateSpcSurface1->GetDisplayName();
		SurName=oName+"."+SurName+strTag;

		_RotatePanel->_SelectorList012->SetLine ( SurName ,0, CATDlgDataModify );



		//int iNumberOfSelectedLines[1];
		//iNumberOfSelectedLines[0]=0;
		//int iArraySize = 1;
		//int iNotify = 0;
		//_RotatePanel->_SelectorList012->SetSelect(iNumberOfSelectedLines,
		//	iArraySize, iNotify);
		_RotatePanel->SJDSetRotateSelect(3,0);



		_pMdRotateDirFaceAgent->InitializeAcquisition();



		return TRUE;


	//}

}
CATBoolean TestCmd::ChooseDwDirRotateSurface2(void * date)
{
	cout<<"ChooseDwDirRotateSurface2"<<endl;

	cout<<"选择另一个滚轮面"<<endl;

	pDownRotateFacePathSel2 = _pDwRotateDirFaceAgent2 -> GetValue ();

	////CATPathElement *PlanePathElement=_pUpRotateFaceAgent->GetValue();//Returns the agent value. Role: The value is the path of the selected object.
	CATIProduct_var piInstanceProd = pDownRotateFacePathSel2->FindElement( CATIProduct::ClassId());
	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	cout<<"所选第一个零件的实例为："<<oName<<endl;
	//piInstanceProd->QueryInterface(IID_CATIProduct, (void**) &piInstanceProdOnMidRotate1);






	if ( _HSO ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pDownRotateFacePathSel2);
		_HSO -> EndAddElements ();
		//_HSO = NULL;
	}


	CATBaseUnknown *ppSelection=NULL;
	ppSelection= _pDwRotateDirFaceAgent2->GetElementValue(_pDwRotateDirFaceAgent2->GetValue());
	spiDownRotateSpcSurface2=ppSelection;





	if (spiDownRotateSpcSurface2 == NULL_var) 	//特征化操作
	{	
		CATIFeaturize_var spToFeaturize = ppSelection;	
		spiDownRotateSpcSurface2 = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
	}	


	//获取tag值
	CATBody_var spOffsetFaceBody=GetBodyFromFeature(spiDownRotateSpcSurface2);

	CATLISTP(CATCell) facecells;
	spOffsetFaceBody->GetAllCells(facecells, 2);
	cout<<"NUMBER OF edge cell="<<facecells.Size()<<endl;
	CATFace* TopDownRollingface=(CATFace*)facecells[1];
	CATSurface *GeoDownRollingface=TopDownRollingface->GetSurface();
	int tag=GeoDownRollingface->GetPersistentTag();
	cout<<"tag值为："<<tag<<endl;
	CATUnicodeString strTag;
	strTag.BuildFromNum(tag);
	//获取tag值完毕




	CATUnicodeString SurName;
	SurName=spiDownRotateSpcSurface2->GetDisplayName();
	SurName=oName+"."+SurName+strTag;

	_RotatePanel->_SelectorListDnRot2->SetLine ( SurName ,0, CATDlgDataModify );



	//int iNumberOfSelectedLines[1];
	//iNumberOfSelectedLines[0]=0;
	//int iArraySize = 1;
	//int iNotify = 0;
	//_RotatePanel->_SelectorListDnRot2->SetSelect(iNumberOfSelectedLines,
	//	iArraySize, iNotify);
	_RotatePanel->SJDSetRotateSelect(6,0);


	_pDwRotateDirFaceAgent2->InitializeAcquisition();

	//int a=1;
	//_RotatePanel->_SelectorList012-> SetSelect(&a,1);
	return TRUE;


}
CATBoolean TestCmd::ChooseDwDirRotateSurface(void * date)
{
	cout<<"ChooseDwDirRotateSurface函数中"<<endl;


	if (NULL==_pDwRotateDirFaceAgent)		
	{
		cout<<"面代理为空"<<endl;
		return TRUE;
	}

	//int lo=0;
	//_RotatePanel->_SelectorList014->GetSelect(&lo,1);
	//cout<<"所选行为："<<lo<<endl;




	//	if ((NULL==pMidRotateFacePathSel1)||(NULL!=pMidRotateFacePathSel1&&NULL!=pMidRotateFacePathSel2&&lo==0))



	//if ((NULL!=pDownRotateFacePathSel1&&NULL==pDownRotateFacePathSel2)||(NULL!=pDownRotateFacePathSel1&&NULL!=pDownRotateFacePathSel2&&lo==1))
	//{


		//cout<<"选择另一个滚轮面"<<endl;

		//pDownRotateFacePathSel2 = _pDwRotateDirFaceAgent -> GetValue ();

		//////CATPathElement *PlanePathElement=_pUpRotateFaceAgent->GetValue();//Returns the agent value. Role: The value is the path of the selected object.
		////CATIProduct_var piInstanceProd = pMidRotateFacePathSel2->FindElement( CATIProduct::ClassId());
		////CATUnicodeString oName ;
		////piInstanceProd->GetPrdInstanceName(oName);
		////cout<<"所选第一个零件的实例为："<<oName<<endl;
		////piInstanceProd->QueryInterface(IID_CATIProduct, (void**) &piInstanceProdOnMidRotate1);






		//if ( _HSO ) 
		//{
		//	_HSO -> Empty();
		//	_HSO -> AddElements (pDownRotateFacePathSel2);
		//	_HSO -> EndAddElements ();
		//	//_HSO = NULL;
		//}


		//CATBaseUnknown *ppSelection=NULL;
		//ppSelection= _pDwRotateDirFaceAgent->GetElementValue(_pDwRotateDirFaceAgent->GetValue());
		//spiDownRotateSpcSurface2=ppSelection;





		//if (spiDownRotateSpcSurface2 == NULL_var) 	//特征化操作
		//{	
		//	CATIFeaturize_var spToFeaturize = ppSelection;	
		//	spiDownRotateSpcSurface2 = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
		//}	

		//CATUnicodeString SurName;
		//SurName=spiDownRotateSpcSurface2->GetDisplayName();
		//_RotatePanel->_SelectorList014->SetLine ( SurName ,0, CATDlgDataModify );


		//_pDwRotateDirFaceAgent->InitializeAcquisition();

		////int a=1;
		////_RotatePanel->_SelectorList012-> SetSelect(&a,1);
		//return TRUE;

	//}
	//else
	//{


		cout<<"第一个"<<endl;
		pDownRotateFacePathSel1 = _pDwRotateDirFaceAgent -> GetValue ();

		//CATPathElement *PlanePathElement=_pUpRotateFaceAgent->GetValue();//Returns the agent value. Role: The value is the path of the selected object.
		CATIProduct_var piInstanceProd = pDownRotateFacePathSel1->FindElement( CATIProduct::ClassId());
		CATUnicodeString oName ;
		piInstanceProd->GetPrdInstanceName(oName);
		cout<<"所选第一个零件的实例为："<<oName<<endl;
		piInstanceProd->QueryInterface(IID_CATIProduct, (void**) &piInstanceProdOnDownRotate1);


		HRESULT r1=piInstanceProdOnDownRotate1->IsReference();
		if (SUCCEEDED(r1))
		{
			cout<<"这是一个IsReference"<<endl;
		}



		if ( _HSO ) 
		{
			_HSO -> Empty();
			_HSO -> AddElements (pDownRotateFacePathSel1);
			_HSO -> EndAddElements ();
			//_HSO = NULL;
		}

		CATBaseUnknown *ppSelection=NULL;
		ppSelection= _pDwRotateDirFaceAgent->GetElementValue(_pDwRotateDirFaceAgent->GetValue());
		spiDownRotateSpcSurface1=ppSelection;




		if (spiDownRotateSpcSurface1 == NULL_var) 	//特征化操作
		{	
			CATIFeaturize_var spToFeaturize = ppSelection;	
			spiDownRotateSpcSurface1 = spToFeaturize->FeaturizeR(MfPermanentBody |MfSelectingFeatureSupport |MfFunctionalFeaturization);
		}	
		//获取tag值
		CATBody_var spOffsetFaceBody=GetBodyFromFeature(spiDownRotateSpcSurface1);

		CATLISTP(CATCell) facecells;
		spOffsetFaceBody->GetAllCells(facecells, 2);
		cout<<"NUMBER OF edge cell="<<facecells.Size()<<endl;
		CATFace* TopDownRollingface=(CATFace*)facecells[1];
		CATSurface *GeoDownRollingface=TopDownRollingface->GetSurface();
		int tag=GeoDownRollingface->GetPersistentTag();
		cout<<"tag值为："<<tag<<endl;
		CATUnicodeString strTag;
		strTag.BuildFromNum(tag);
		//获取tag值完毕

		CATUnicodeString SurName;
		SurName=spiDownRotateSpcSurface1->GetDisplayName();
		SurName=oName+"."+SurName+strTag;

		_RotatePanel->_SelectorList014->SetLine ( SurName ,0, CATDlgDataModify );


		//int iNumberOfSelectedLines[1];
		//iNumberOfSelectedLines[0]=0;
		//int iArraySize = 1;
		//int iNotify = 0;
		//_RotatePanel->_SelectorList014->SetSelect(iNumberOfSelectedLines,
		//	iArraySize, iNotify);
		_RotatePanel->SJDSetRotateSelect(6,0);


		_pDwRotateDirFaceAgent->InitializeAcquisition();


		//int a=0;
		//_RotatePanel->_SelectorList012-> SetSelect(&a,1);

		return TRUE;


	//}


	//return TRUE;
}


CATIPrtContainer_var TestCmd::GetPrtContainer()//
{
	CATIPrtContainer_var spPartContainer = NULL_var;

	CATFrmEditor * pEditor =CATFrmEditor::GetCurrentEditor();
	CATPathElement spPath = pEditor->GetUIActiveObject();
	CATBaseUnknown* pcurrbase = spPath.CurrentElement( );
	CATILinkableObject *piLinkableObject = NULL;
	HRESULT rc = pcurrbase->QueryInterface(IID_CATILinkableObject,(void**)& piLinkableObject);

	CATDocument * pDocument = NULL ;
	pDocument = piLinkableObject->GetDocument();
	piLinkableObject->Release();
	piLinkableObject = NULL ;

	CATInit_var spInit = pDocument;
	spPartContainer = (CATIPrtContainer*) spInit -> GetRootContainer("CATIPrtContainer");
	return spPartContainer;
}
CATIGSMTool_var TestCmd::CreateGSMTool(const CATUnicodeString& iName,CATIPrtContainer_var iFeatCont)
{
	cout<<"创建GSMTool函数中"<<endl;

		  CATIPrtContainer      *      piPartContainer=iFeatCont;
	if(piPartContainer==NULL_var)
	{
		cout<<"请先进入零件编辑模块,然后在对该模型进行操作!!!"<<endl;
		CATDlgNotify * pWarnBox= new CATDlgNotify((CATApplicationFrame::GetApplicationFrame())->GetMainWindow(),"提示",CATDlgNfyInformation);
		pWarnBox->SetText("请先进入零件编辑模块,然后在对该模型进行操作!!!");
		pWarnBox->SetVisibility(CATDlgShow);
		return NULL_var;
	}
	else
	{
		//CATIGSMFactory_var spGsmFact; 
		//if ( NULL_var !=piPartContainer  ) 
		//{ 
		//	CATIGSMFactory * _pFact =NULL; 
		//	HRESULT rc = piPartContainer -> QueryInterface(IID_CATIGSMFactory ,(void**)&_pFact);
		//	if (SUCCEEDED(rc) )
		//	{
		//		spGsmFact = _pFact;
		//	}
		//}

		CATIGSMTool_var spTool;
		CATIPrtPart_var spPrtPart = piPartContainer->GetPart(); 

		CATISpecObject_var spParentForGSMTool = spPrtPart;
		if (NULL_var != spParentForGSMTool)
		{
			CATIMechanicalRootFactory_var spMechRoot = piPartContainer;
			CATIDescendants_var spPartAsDescendants = spPrtPart;
			CATLISTV(CATISpecObject_var) BodyListDesc;  
			spPartAsDescendants->GetAllChildren("CATIMechanicalTool", BodyListDesc);
			for(int curSetIdx=1; curSetIdx<=BodyListDesc.Size(); curSetIdx++)
			{
				CATBaseUnknown_var CurrentSet = BodyListDesc[curSetIdx];
				CATIAlias_var aliasOnCurrentSet = CurrentSet;
				if (aliasOnCurrentSet->GetAlias() ==iName )
				{
					spTool = CurrentSet;
					break;
				}
			}
			if (NULL_var == spTool )
			{
				spTool = spMechRoot->CreateGSMTool(iName,spParentForGSMTool);
				spPrtPart->SetCurrentFeature(spTool);
			}
			if (NULL_var != spTool )
			{
				spPrtPart->SetCurrentFeature(spTool);
			}
		}
		return spTool;
	}
}
HRESULT TestCmd::ObjectUpdate(const CATISpecObject_var& ispSpec)
{
	if (NULL_var!=ispSpec)
	{
		CATTry
		{
			ispSpec->Update();
		}
		CATCatch(CATMfErrUpdate,error)
		{
			cerr<<"Update Error:"<<(error->GetDiagnostic()).ConvertToChar()<<endl;
			//CATDlgNotify * pPromptBox=new CATDlgNotify((CATApplicationFrame::GetApplicationFrame())->GetMainWindow(),"更新错误",CATDlgNfyError);
			//pPromptBox->SetText(error->GetDiagnostic());
			//pPromptBox->SetVisibility(CATDlgShow);
			return E_FAIL;
		}
		CATCatch(CATError,error)
		{
			cout<<"update error!"<<endl;
			//CATDlgNotify * pPromptBox=new CATDlgNotify((CATApplicationFrame::GetApplicationFrame())->GetMainWindow(),"更新错误",CATDlgNfyError);
			//pPromptBox->SetTitle(error->GetNLSSource());
			//pPromptBox->SetText(error->GetNLSMessage());
			//pPromptBox->SetVisibility(CATDlgShow);
			::Flush(error);
			return E_FAIL;
		}
		CATEndTry
	}
	return S_OK;
}

HRESULT TestCmd::InsertInProceduralView(const CATISpecObject_var& ispObjectToAppend, const CATISpecObject_var& ispInputParent)//---------------做什么的
{
	HRESULT rc=E_FAIL;
	CATIGSMProceduralView_var curobj=ispObjectToAppend;
	if (NULL_var!=curobj)
	{
		rc=curobj->InsertInProceduralView(ispInputParent);
	}
	if (FAILED(rc))
	{
		cout<<"插入特征失败!"<<endl;
	}
	return rc;
}

void TestCmd::TestCmdCANCEL(CATCommand *cmd, CATNotification *evt, CATCommandClientData data)
{
	cout<<"TestCmdCANCEL函数中"<<endl;


	if (_Panel!=NULL)
	{
		_Panel->RequestDelayedDestruction();
		_Panel=NULL;
	}
	RequestDelayedDestruction();
}

//dlg响应
void TestCmd::OnPushButton133PushBActivateNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here

	//_RailPanel=new RailDlg();
	//_RailPanel->Build();
cout<<"OnPushButton133PushBActivateNotification"<<endl;
	if (_pRailButtonAgent!=NULL)
	{
		_pRailButtonAgent->InitializeAcquisition();
	}
	_RailPanel->SetVisibility(CATDlgShow);

}


//-------------------------------------------------------------------------
// Callback on ListSelect of _SelectorList171
//-------------------------------------------------------------------------
void TestCmd::OnSelectorList171ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	cout<<"点选选框"<<endl;
}


//-------------------------------------------------------------------------
// Callback on DiaCLOSE of _TestCmd
//-------------------------------------------------------------------------
void TestCmd::OnTestDlgDiaCLOSENotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	if (_Panel!=NULL)
	{
		_Panel->RequestDelayedDestruction();
		_Panel=NULL;
	}
	RequestDelayedDestruction();
}


//-------------------------------------------------------------------------
// Callback on DiaCANCEL of _TestDlg
//-------------------------------------------------------------------------
void TestCmd::OnTestDlgDiaCANCELNotification()
{
	// Add your code here
cout<<"OnTestDlgDiaCANCELNotification"<<endl;
	if (_Panel!=NULL)
	{
		_Panel->RequestDelayedDestruction();
		_Panel=NULL;
	}
	RequestDelayedDestruction();
	//_pcmd->RequestDelayedDestruction();
}


//-------------------------------------------------------------------------
// Callback on DiaOK of _TestDlg
//-------------------------------------------------------------------------
void TestCmd::OnTestDlgDiaOKNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	cout<<"ok响应"<<endl;
	// Add your code here
	if (_Panel!=NULL)
	{
		_Panel->RequestDelayedDestruction();
		_Panel=NULL;
	}
	RequestDelayedDestruction();
}

//-------------------------------------------------------------------------
// Callback on PushBActivate of _PushButton135
//-------------------------------------------------------------------------
void TestCmd::OnPushButton135PushBActivateNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//_HingePanel=new HingeDlg();
	//_HingePanel->Build();
	cout<<"OnPushButton135PushBActivateNotification"<<endl;
	
		if (NULL!=_pHingeButtonAgent)
		{
			_pHingeButtonAgent->InitializeAcquisition();
		}
	_HingePanel->SetVisibility(CATDlgShow);
}


//-------------------------------------------------------------------------
// Callback on PushBActivate of _PushButton136
//-------------------------------------------------------------------------
void TestCmd::OnPushButton136PushBActivateNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//_RotatePanel=new RotateDlg();
	//_RotatePanel->Build();
	if (NULL!=_pRotateButtonAgent)
	{
		_pRotateButtonAgent->InitializeAcquisition();
	}
	_RotatePanel->SetVisibility(CATDlgShow);
}


//-------------------------------------------------------------------------
// Callback on PushBActivate of _PushButton137
//-------------------------------------------------------------------------
void TestCmd::OnPushButton137PushBActivateNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	_RotateHingePanel=new RotateHingeDlg();
	_RotateHingePanel->Build();
	_RotateHingePanel->SetVisibility(CATDlgShow);
}


//-------------------------------------------------------------------------
// Callback on PushBActivate of _PushButton166
//-------------------------------------------------------------------------
void TestCmd::OnPushButton166PushBActivateNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	m_pFileSaver = new CATDlgFile(_Panel,"输入文件名称",CATDlgWndModal|CATDlgFileSave);
	CATUnicodeString nameExtension ="包络文件(*.cgr)";
	CATString filterExtension="*.cgr";
	m_pFileSaver->SetFilterStrings(&nameExtension, &filterExtension, 1);
	m_pFileSaver->SetVisibility(CATDlgShow);


	AddAnalyseNotificationCB(m_pFileSaver, 
		m_pFileSaver->GetDiaOKNotification(), 
		(CATCommandMethod)&TestCmd::ClickSaveOK, 
		NULL);   

}


void TestCmd::ClickSaveOK(CATCommand         * iSendingCommand, 
						  CATNotification      * iSentNotification, 
						  CATCommandClientData   iUsefulData)
{
	cout<<"点击保存"<<endl;
	m_pFileSaver->GetSelection(CgrFilePath);
	cout<<"cgr路径："<<CgrFilePath<<endl;
	m_pFileSaver->GetSelection(ExcelFileDirectory);//GetDirectory
	cout<<"excel路径是："<<ExcelFileDirectory<<endl;

	cout<<CgrFilePath<<endl;
	//if(strFileName.SearchSubString(".xlsx")+4 != strFileName.GetLengthInChar())
	//{
	//	strFileName+=".xlsx";
	//} 
	CgrFilePath+=".cgr";



	

	_Panel->_Editor185->SetText(CgrFilePath);
	if(m_pFileSaver!=NULL)
	{
		m_pFileSaver->RequestDelayedDestruction();
		m_pFileSaver=NULL;
	}

}
//-------------------------------------------------------------------------
// Callback on PushBActivate of _PushButton139
//-------------------------------------------------------------------------
void TestCmd::OnPushButton139PushBActivateNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	if (NULL!=_pBodyButtonAgent)
	{
		_pBodyButtonAgent->InitializeAcquisition();
	}
	_BodyPanel->SetVisibility(CATDlgShow);
}



//-------------------------------------------------------------------------
// Callback on PushBActivate of _PushButton140
//-------------------------------------------------------------------------
void TestCmd::OnPushButton140PushBActivateNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//RDCDMUBFErrorMsgBox("提示信息");
	if (NULL!=_pDoorButtonAgent)
	{
		_pDoorButtonAgent->InitializeAcquisition();
	}
	_DoorPanel->SetVisibility(CATDlgShow);
}


//-------------------------------------------------------------------------
// Callback on PushBActivate of _PushButton144
//-------------------------------------------------------------------------
void TestCmd::OnPushButton144PushBActivateNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{

	////警告

	cout<<"点击生成机构"<<endl;
	enum MenchanicalType {PointCurve, PointSurface}; 
	MenchanicalType UsingType=PointSurface;//点线


	if (NULL_var==spiUpRotateSpcSurface||NULL_var==spiUpRollingSpcSurface)
	{
		RDCDMUBFErrorMsgBox("请先选择上轨道面或上滚轮！");
		return;

	}

	if (NULL_var==spiMidRotateSpcSurface1||NULL_var==spiMidRollingSpcSurface)
	{
		RDCDMUBFErrorMsgBox("请先选择中轨道面或中滚轮！");
		return;

	}
	if (NULL_var==spiMidRotateSpcSurface2||NULL_var==spiMidRollingSpcSurface)
	{
		RDCDMUBFErrorMsgBox("请先选择中轨道面或中滚轮！");
		return;

	}


	if (NULL_var==spiDownRotateSpcSurface1||NULL_var==spiDownRollingSpcSurface)
	{
		RDCDMUBFErrorMsgBox("请先选择下轨道面或下滚轮！");
		return;

	}

	if (NULL_var==spiDownRotateSpcSurface2||NULL_var==spiDownRollingSpcSurface)
	{
		RDCDMUBFErrorMsgBox("请先选择下轨道面或下滚轮！");
		return;

	}
	if (NULL_var==spiHinge1Line1)
	{
		RDCDMUBFErrorMsgBox("请先选择产品1轴线！");
		return;

	}
	if (NULL_var==spiHinge1Line2)
	{
		RDCDMUBFErrorMsgBox("请先选择产品1第2条轴线！");
		return;

	}
	if (NULL_var==spiHinge1Plane1)
	{
		RDCDMUBFErrorMsgBox("请先选择产品1平面！");
		return;

	}
	if (NULL_var==spiHinge1Plane2)
	{
		RDCDMUBFErrorMsgBox("请先选择产品1第二平面！");
		return;

	}
	if (NULL_var==spiHinge2Line1)
	{
		RDCDMUBFErrorMsgBox("请先选择产品2轴线！");
		return;

	}
	if (NULL_var==spiHinge2Line2)
	{
		RDCDMUBFErrorMsgBox("请先选择产品2第2条轴线！");
		return;

	}
	if (NULL_var==spiHinge2Plane1)
	{
		RDCDMUBFErrorMsgBox("请先选择产品2平面！");
		return;

	}
	if (NULL_var==spiHinge2Plane2)
	{
		RDCDMUBFErrorMsgBox("请先选择产品2第2平面！");
		return;

	}





	if (UsingType==PointSurface)
	{
		//点面副的情况
		if (NULL_var==spiDownBearRotateSpcSurface||NULL_var==spiDownBearRollingSpcSurface)
		{
			RDCDMUBFErrorMsgBox("请先选择下承压轨道面或下承压滚轮！");
			return;

		}
	}


	////警告完毕


	_Panel->_PushButton192->SetSensitivity(CATDlgEnable);




//删除装配树上原有的约束





	CATIAsmCstSetFeature_var rootSet;

	// does the root set exist ? if not, create it
	HRESULT hr_root = CATAsmConstraintSetServices::GetRootSet( spRootProduct, rootSet, TRUE );

	if ( SUCCEEDED( hr_root ) && NULL_var != rootSet)
	{

		CATLISTV(CATBaseUnknown_var) cstChildrenList;
		HRESULT rc = rootSet->ListCstChildren(cstChildrenList);
		int nbCst = cstChildrenList.Size();
		for (int cc=1; cc<= nbCst; cc++)
		{
			CATIAlias_var alias(cstChildrenList[cc]);
			if (NULL_var != alias)
			{
				CATUnicodeString cstName = alias->GetAlias();
				printf("Constraints under set root : %d / %d %s\n", cc, nbCst, (const char*) cstName);

				//CATISpecObject_var spCstToRemove=cstChildrenList[cc];

				LifeCycleObject_var LCO = cstChildrenList[cc];
				LCO -> remove();


			}


		}



		LifeCycleObject_var LCO = rootSet;
		LCO -> remove();





	}


	cout<<"删除原有约束结束！"<<endl;


	//删除装配树上原有的约束完毕








	//// Add your code here 模拟仿真按钮

	//CATIPrtContainer_var spUpRotateCon=GetConFromInstancePrd(piInstanceProdOnUpRotate);
	//CATIGSMFactory* pGSMFactOnUpRotate=NULL;
	//HRESULT rc=spUpRotateCon->QueryInterface(IID_CATIGSMFactory,(void**)&pGSMFactOnUpRotate);
	//if (FAILED(rc)) {cout<<"通过新建Part的Container查询CATIGSMFactory 失败"<<endl;}


	//CATICkeParmFactory_var spParmFactoryOnUpRotate=NULL_var;
	//rc=spUpRotateCon->QueryInterface(IID_CATICkeParmFactory,(void**)&spParmFactoryOnUpRotate);
	////CATIParmDictionary_var spParamDict = CATCkeGlobalFunctions::GetParmDictionary();


	//CATIGSMTool_var spGSMToolUpRotate=CreateGSMTool("滚轮中心",spUpRotateCon);
	//CATBody_var TopRotateBody=GetBodyFromFeature(spiUpRotateSpcSurface);







	//	CATLISTP(CATCell) IntersecFccells;
	//	TopRotateBody->GetAllCells(IntersecFccells, 2);
	//	cout<<"NUMBER OF PtCELL="<<IntersecFccells.Size()<<endl;



	//	CATCell* pFaceCell=IntersecFccells[1];
	//	CATFace* pFace=(CATFace*)pFaceCell;
	//	CATSurface* pSurface=pFace->GetSurface(NULL);
	//	CATSurParam* pSurEndParm =new CATSurParam();
	//	CATSurParam* pSurStartParm =new CATSurParam();
	//	pSurface->GetEndLimit(*pSurEndParm);
	//	pSurface->GetStartLimit(*pSurStartParm);
	//	double EndParamU=pSurEndParm->GetParamU();
	//	double EndParamV=pSurEndParm->GetParamV();
	//	double StartParamU=pSurStartParm->GetParamU();
	//	double StartParamV=pSurStartParm->GetParamV();




	//	CATMathPoint PtOnSp1;
	//	CATMathPoint PtOnSp2;
	//	CATMathPoint PtOnSp3;
	//	CATMathPoint PtOnSp4;
	//	double CoodOfPt[12]={0,0,0,0,0,0,0,0,0,0,0,0};

	//	CATSurParam* pSurParm =new CATSurParam();
	//	*pSurParm=pSurface->CreateParam(StartParamU,StartParamV);// (EndParamU-StartParamU)/3+  (EndParamV-StartParamV)/3+
	//	pSurface->EvalPoint(*pSurParm,PtOnSp1);
	//	PtOnSp1.GetCoord(CoodOfPt[0],CoodOfPt[1],CoodOfPt[2]);




	//	*pSurParm=pSurface->CreateParam((EndParamU-StartParamU)*2/3+StartParamU,(EndParamV-StartParamV)/3+StartParamV);//   
	//	pSurface->EvalPoint(*pSurParm,PtOnSp2);
	//	PtOnSp2.GetCoord(CoodOfPt[3],CoodOfPt[4],CoodOfPt[5]);



	//	*pSurParm=pSurface->CreateParam((EndParamU-StartParamU)/3+StartParamU,(EndParamV-StartParamV)*2/3+StartParamV);//   
	//	pSurface->EvalPoint(*pSurParm,PtOnSp3);
	//	PtOnSp3.GetCoord(CoodOfPt[6],CoodOfPt[7],CoodOfPt[8]);


	//	*pSurParm=pSurface->CreateParam((EndParamU-StartParamU)*2/3+StartParamU,(EndParamV-StartParamV)*2/3+StartParamV);//   
	//	pSurface->EvalPoint(*pSurParm,PtOnSp4);
	//	PtOnSp4.GetCoord(CoodOfPt[9],CoodOfPt[10],CoodOfPt[11]);


	//	//求球面圆心的四个输入点坐标不能在同一平面上

	//		double x=0,y=0,z=0;
	//		get_xyz(CoodOfPt[0],CoodOfPt[1],CoodOfPt[2],CoodOfPt[3],
	//			CoodOfPt[4],CoodOfPt[5],CoodOfPt[6],CoodOfPt[7],CoodOfPt[8],CoodOfPt[9],CoodOfPt[10],CoodOfPt[11],x,y,z);
	//		cout<<"x坐标："<<x<<"y坐标："<<y<<"z坐标："<<z<<endl;







	//CATICkeParm_var Xe = spParmFactoryOnUpRotate->CreateLength ( "X", x/1000 );
	//CATICkeParm_var Ye = spParmFactoryOnUpRotate->CreateLength ( "Y", y/1000 );
	//CATICkeParm_var Ze = spParmFactoryOnUpRotate->CreateLength ( "Z", z/1000 );
	//CATIGSMPointCoord_var spPointED = pGSMFactOnUpRotate->CreatePoint(Xe,Ye,Ze); 

	//spiUpRotatCenter=spPointED;

	//ObjectUpdate(spiUpRotatCenter);
	//InsertInProceduralView(spiUpRotatCenter,spGSMToolUpRotate);

















	//CATIParmDictionary_var spParamDict = CATCkeGlobalFunctions::GetParmDictionary();


	//CATIPrtContainer_var spUpRollingCon=GetConFromInstancePrd(piInstanceProdOnUpRollingFace);

	//CATIGSMTool_var spGSMToolUpRollingFace=CreateGSMTool("运动面",spUpRollingCon);
	//CATBody_var TopSelFaceBody=GetBodyFromFeature(spiUpRollingSpcSurface);

	//CATBody_var TopRailBody=GetBodyFromFeature(spiUpRollingSpcOnRail);


	//CATIGSMFactory* pGSMFactOnUpRollingFace=NULL;
	//rc=spUpRollingCon->QueryInterface(IID_CATIGSMFactory,(void**)&pGSMFactOnUpRollingFace);
	//if (FAILED(rc)) {cout<<"通过新建Part的Container查询CATIGSMFactory 失败"<<endl;}

	//CATICkeParmFactory* spCkeParmFactoryOnUpRollingFace;
	//rc=spUpRollingCon->QueryInterface(IID_CATICkeParmFactory,(void**)&spCkeParmFactoryOnUpRollingFace);
	//if (FAILED(rc)) {cout<<"通过新建Part的Container查询spCkeParmFactory 失败"<<endl;}


	//CATLISTP(CATCell) BodyEdgecells;
	//TopRailBody->GetAllCells(BodyEdgecells, 1);
	//cout<<"NUMBER OF BodyEdcells="<<BodyEdgecells.Size()<<endl;

	//CATLISTP(CATCell) BodyFacecells;
	//TopRailBody->GetAllCells(BodyFacecells, 2);
	//cout<<"NUMBER OF BodyFacecells="<<BodyFacecells.Size()<<endl;




	//CATLISTP(CATCell) FaceBoundingcells;
	//TopSelFaceBody->GetAllCells(FaceBoundingcells, 1);
	//cout<<"NUMBER OF edgeCELL="<<FaceBoundingcells.Size()<<endl;

	//CATMathPoint MathPointOfLine;
	//CATLISTP(CATCell) Edcells;
	//TopSelFaceBody->GetAllCells(Edcells, 2);
	//cout<<"NUMBER OF face CELL="<<Edcells.Size()<<endl;
	//CATCell* pSelFaceCell=Edcells[1];





	//CATLISTP(CATCell) RailFacecells;//轨道拓展面

	//RailFacecells.Append(pSelFaceCell);








	////判断最长边及其边界点的连续性 选择连续点作为下一个面的搜索输入(这里要求所选面的长边反应轨道走向)
	//CATCell* _piLongestEdgeCell=NULL;

	//double tempLen=0;
	//for(int currentCell=1; currentCell<=FaceBoundingcells.Size(); currentCell++)
	//{

	//	CATEdge * _piCurrentEdge=(CATEdge *)FaceBoundingcells[currentCell];

	//	double lengthofneighbor=_piCurrentEdge->CalcLength();
	//	cout<<"长度为："<<lengthofneighbor<<endl;

	//	if (lengthofneighbor>tempLen)
	//	{
	//		tempLen=lengthofneighbor;
	//		_piLongestEdgeCell=FaceBoundingcells[currentCell];
	//	}

	//}

	//cout<<"tempLen="<<tempLen<<endl;

	//CATEdge * _piLongestEdgeOnSelFace=(CATEdge *)_piLongestEdgeCell;

	//CATVertex * _pEndPtCell1=NULL;
	//CATVertex * _pEndPtCell2=NULL;
	//_piLongestEdgeOnSelFace->GetVertices(&_pEndPtCell1,&_pEndPtCell2);

	//CATVertex * _pPreConnectPtCell=_pEndPtCell1;

	//if ((!IsEndPt(_pEndPtCell1,_piLongestEdgeOnSelFace,TopRailBody))&&(!IsEndPt(_pEndPtCell2,_piLongestEdgeOnSelFace,TopRailBody)))
	//{
	//	RDCDMUBFErrorMsgBox("所选面不是轨道起始面，请重新选择！");
	//	if (_pRollingFaceOKAgent!=NULL)
	//	{
	//		_pRollingFaceOKAgent->InitializeAcquisition();
	//	}
	//	_RailPanel->SetVisibility(CATDlgHide);
	//	return;
	//}

	//if (IsEndPt(_pEndPtCell1,_piLongestEdgeOnSelFace,TopRailBody))
	//{

	//	_pPreConnectPtCell=_pEndPtCell2;
	//}






	////得到下一个面之后，从这个面的edge中找到轨道方向上的最后一个edge，针对T字形拓扑线结构，并且得到末端点

	//CATLISTP(CATCell) FaceEdgecells;
	//pSelFaceCell->GetAllCells(FaceEdgecells, 1);
	//cout<<"这个相邻面包含的拓扑线数目："<<FaceEdgecells.Size()<<endl;



	//CATVertex *_pPostConnectPtCell=_pPreConnectPtCell;
	//CATCell *NextConnectEdgeCell=_piLongestEdgeCell;
	//CATTopGeoContinuity ContiOrNot;

	//CATBoolean IsEnd=FALSE;
	//while (FALSE==IsEnd)
	//{

	//	cout<<"开始循环1~~~~~~~~~~~~~~~~~~~~~~~~~~~~"<<endl;
	//	CATMathVector datumVec=EvalTangentVec(_pPostConnectPtCell,(CATEdge *)NextConnectEdgeCell);//第一个临边末端点的方向向量

	//	for(int currentCell=1; currentCell<=FaceEdgecells.Size(); currentCell++)
	//	{



	//		if (((CATCell *)_pPostConnectPtCell)->IsOnBorder(FaceEdgecells[currentCell])&&FaceEdgecells[currentCell]!=NextConnectEdgeCell)//可以加上  &&FaceEdgecells[currentCell]！=NextConnectEdgeCell
	//		{

	//			_pPostConnectPtCell->EvalSharpness((CATEdge *)NextConnectEdgeCell,(CATEdge *)FaceEdgecells[currentCell],ContiOrNot,NULL,NULL,NULL,5*CATPI/180);
	//			if (ContiOrNot==CATSmooth)//判断下一个相邻边末端点的向量是否与前一个差距太大，排除末端有倒圆特征的情况
	//			{




	//				CATEdge * _ptempEdge=NULL;
	//				cout<<"此Edge不是最后一个edge\t"<<ContiOrNot<<endl;
	//				_ptempEdge=(CATEdge *)FaceEdgecells[currentCell];
	//				CATLISTP(CATCell) EndPtcells;
	//				_ptempEdge->GetAllCells(EndPtcells, 0);
	//				CATVertex * _pTempPtCell=(CATVertex *)EndPtcells[1];

	//				if (_pTempPtCell==_pPostConnectPtCell)
	//				{
	//					_pTempPtCell=(CATVertex *)EndPtcells[2];
	//				}

	//				//_pPostConnectPtCell=_pTempPtCell;




	//				CATMathVector NextVec=EvalTangentVec(_pTempPtCell,_ptempEdge);//第一个临边末端点的方向向量
	//				double angel=NextVec.GetAngleTo(datumVec);
	//				cout<<"这个角度是："<<angel*180/CATPI<<endl;


	//				if (angel*180/CATPI>30&&angel*180/CATPI<150)
	//				{
	//					cout<<"角度偏移太大"<<endl;
	//					IsEnd=TRUE;
	//					break;


	//				}
	//				else
	//				{
	//					cout<<"找到下一个面内临边"<<endl;
	//					_pPostConnectPtCell=_pTempPtCell;
	//					NextConnectEdgeCell=_ptempEdge;
	//					break;

	//				}





	//			}
	//			else
	//				IsEnd=TRUE;

	//		}



	//	}
	//	cout<<"结束循环1~~~~~~~~~~~~~~~~~~~~~~~~~~~~"<<endl;

	//}










	//if (!IsEndPt(_pPostConnectPtCell,(CATEdge *)NextConnectEdgeCell,TopRailBody))
	//{

	//	cout<<"不是终点"<<endl;

	//	//循环找到剩下的所有相邻面
	//	CATFace *nface=(CATFace *)pSelFaceCell;
	//	CATEdge *ConnectEdge=(CATEdge *)NextConnectEdgeCell;
	//	CATVertex *ConnectPtOnNextFace=(CATVertex *)_pPostConnectPtCell;

	//	//CATEdge *outConnectEdge=NULL;
	//	//int e=1;
	//	while (!IsEndPt(ConnectPtOnNextFace,ConnectEdge,TopRailBody))
	//	{
	//		double lengthofneighbor=ConnectEdge->CalcLength();
	//		cout<<"运算前长度为："<<lengthofneighbor<<endl;

	//		nface=GetNextFace(nface,ConnectEdge,ConnectPtOnNextFace,TopRailBody);

	//		//cout<<c<<endl;
	//		cout<<"11"<<endl;
	//		if (NULL==nface)
	//		{
	//			cout<<"主函数临边null"<<endl;
	//			break;
	//		}
	//		lengthofneighbor=ConnectEdge->CalcLength();
	//		cout<<"运算后长度为："<<lengthofneighbor<<endl;



	//		RailFacecells.Append(nface);

	//	}




	//}

	//CATLISTV(CATISpecObject_var) LISTSCur;


	//for (int i=1;i<=RailFacecells.Size();i++)
	//{
	//	CATIBRepAccess_var spBRepEdge = CATBRepDecodeCellInBody( RailFacecells[i], TopRailBody );

	//	CATIFeaturize_var FCell = spBRepEdge;
	//	CATISpecObject_var spSpecFace = FCell->FeaturizeR( MfPermanentBody|	MfLastFeatureSupport | 	MfRelimitedFeaturization);
	//	ObjectUpdate(spSpecFace);

	//	CATIGSMExtractSolide_var spExtractSurface003 = pGSMFactOnUpRollingFace->CreateExtractSolide(spSpecFace, ExtractSolide_NoPropag);
	//	CATISpecObject_var NewExSurface003 = spExtractSurface003;
	//	ObjectUpdate(NewExSurface003);
	//	InsertInProceduralView(NewExSurface003,spGSMToolUpRollingFace);
	//	LISTSCur.Append(NewExSurface003);
	//	HideSpecObj(NewExSurface003);

	//}

	////CATICkeParm_var spGapThreshold =spCkeParmFactory->CreateLength("thod",0.002/1000);
	//CATIGSMAssemble_var spExtrapolCur = pGSMFactOnUpRollingFace -> CreateAssemble(LISTSCur, NULL_var, TRUE);
	//CATISpecObject_var NewExSurface003 = spExtrapolCur;
	//ObjectUpdate(NewExSurface003);
	//InsertInProceduralView(NewExSurface003,spGSMToolUpRollingFace);
	//HideSpecObj(NewExSurface003);


	////SJDOutputInheritanceStructure(NewExSurface003);

	//if (NULL_var==spiUpRotatCenter)
	//{
	//	RDCDMUBFErrorMsgBox("请先选择滚轮中心！");
	//	if (_pRollingFaceOKAgent!=NULL)
	//	{
	//		_pRollingFaceOKAgent->InitializeAcquisition();
	//	}
	//	_RailPanel->SetVisibility(CATDlgHide);
	//	return;

	//}


	////CATIMeasurable_var spiMeasureCen=spiUpRotatCenter;



	////CATIMeasurableInContext_var spiMeasureCenContext=spiUpRotatCenter;
	////CATIMeasurable_var spiMeasureCen=spiUpRotatCenter;
	////CATMathAxis UpRotateAxis;
	////rc=spiMeasureCenContext->GetAxisSystemFromMeasurable(UpRotateAxis);
	////CATMathPoint p1OnPt;
	////CATMathPoint p2OnRailFace;

	////double mindis=0;
	////CATIMeasurableInContext_var spiMeasureRail=NewExSurface003;
	////spiMeasureRail->MinimumDistance(spiMeasureCen,UpRotateAxis,mindis,p1OnPt,p2OnRailFace);

	//double mindis=0;
	//mindis=GetMinDistance(NewExSurface003,spiUpRotatCenter);


	//cout<<"最小间距是："<<mindis<<endl;




	//CATICkeParm_var spiOffsetDisParm= spCkeParmFactoryOnUpRollingFace->CreateDimension(spParamDict->FindMagnitude("LENGTH"),"偏移",mindis/1000);
	//CATIGSMOffset_var spiGSMOffset=pGSMFactOnUpRollingFace->CreateOffset(NewExSurface003,spiOffsetDisParm,TRUE,FALSE);
	//CATISpecObject_var spiOffsetSpecRail=spiGSMOffset;





	//ObjectUpdate(spiOffsetSpecRail);

	//double disafter=GetMinDistance(spiOffsetSpecRail,spiUpRotatCenter);;
	//cout<<"偏移后的距离："<<disafter<<endl;
	//if (disafter>0.01)
	//{
	//	cout<<"偏移方向错误 反向"<<endl;
	//	CATBoolean Invert=FALSE;
	//	spiGSMOffset->GetInvertDirection(Invert);
	//	if (Invert)
	//	{

	//		Invert=FALSE;
	//		spiGSMOffset->SetInvertDirection(Invert);
	//	} 
	//	else
	//	{
	//		Invert=TRUE;
	//		spiGSMOffset->SetInvertDirection(Invert);

	//	}

	//}
	//ObjectUpdate(spiOffsetSpecRail);

	//InsertInProceduralView(spiOffsetSpecRail,spGSMToolUpRollingFace);
	////system("pause");







	////计算轨道面上的运行曲线

	////从偏移导轨面上找到最长边，以最长边为基准向两侧拓展到端部，生成运行轨迹线并偏移

	//CATBody_var spOffsetFaceBody=GetBodyFromFeature(spiOffsetSpecRail);

	//CATLISTP(CATCell) edgecells;
	//spOffsetFaceBody->GetAllCells(edgecells, 1);
	//cout<<"NUMBER OF edge cell="<<edgecells.Size()<<endl;




	//CATCell* _piLongestOffsetEdgeCell=NULL;

	//double tempLenEg=0;
	//for(int currentCell=1; currentCell<=edgecells.Size(); currentCell++)
	//{

	//	CATEdge * _piCurrentEdge=(CATEdge *)edgecells[currentCell];

	//	double lengthofneighbor=_piCurrentEdge->CalcLength();
	//	cout<<"长度为："<<lengthofneighbor<<endl;

	//	if (lengthofneighbor>tempLenEg)
	//	{
	//		tempLenEg=lengthofneighbor;
	//		_piLongestOffsetEdgeCell=edgecells[currentCell];
	//	}

	//}


	//CATLISTP(CATCell) RailEdgecells;//轨道边界
	//RailEdgecells.Append(_piLongestOffsetEdgeCell);


	//CATLISTP(CATCell) LongestEdgePtcells;
	//_piLongestOffsetEdgeCell->GetAllCells(LongestEdgePtcells, 0);


	//cout<<"边界点的个数："<<LongestEdgePtcells.Size()<<endl;
	////system("pause");

	//CATVertex* LongestEdgePtcells1=(CATVertex*)LongestEdgePtcells[1];
	//CATVertex* LongestEdgePtcells2=(CATVertex*)LongestEdgePtcells[2];


	//CATCell *NextRailConnectEdgeCell=_piLongestOffsetEdgeCell;


	//if (NULL==LongestEdgePtcells1||NULL==LongestEdgePtcells2)
	//{
	//	cout<<"有空的"<<endl;
	//	system("pause");


	//}


	////int u=2;
	////while(u--)
	////{


	////	cout<<"u="<<u<<endl;

	////if (u==0)
	////{
	////	cout<<"这里"<<endl;

	////	NextRailConnectPtCell=LongestEdgePtcells1;
	////	cout<<"这里   1"<<endl;

	////}


	//CATVertex* NextRailConnectPtCell=LongestEdgePtcells2;

	//CATTopGeoContinuity ContiOrNot1;

	//CATBoolean IsEnd1=FALSE;

	//while (FALSE==IsEnd1)
	//{

	//	CATMathVector datumVec=EvalTangentVec(NextRailConnectPtCell,(CATEdge *)NextRailConnectEdgeCell);//第一个临边末端点的方向向量

	//	int currentCell=1;
	//	CATBoolean hastan=FALSE;
	//	for(; currentCell<=edgecells.Size(); currentCell++)
	//	{


	//		if (((CATCell *)NextRailConnectPtCell)->IsOnBorder(edgecells[currentCell])&&edgecells[currentCell]!=NextRailConnectEdgeCell)//可以加上  &&FaceEdgecells[currentCell]！=NextConnectEdgeCell
	//		{

	//			CATAngle lsdlg=0;
	//			NextRailConnectPtCell->EvalSharpness((CATEdge *)NextRailConnectEdgeCell,(CATEdge *)edgecells[currentCell],ContiOrNot1,&lsdlg,NULL,NULL,5*CATPI/180);
	//			cout<<"连接的角度："<<lsdlg*180/CATPI<<endl;
	//			if (ContiOrNot1==CATSmooth)//判断下一个相邻边末端点的向量是否与前一个差距太大，排除末端有倒圆特征的情况
	//			{


	//				hastan=true;

	//				CATEdge * _ptempEdge=NULL;
	//				cout<<"此Edge不是最后一个edge\t"<<ContiOrNot1<<endl;
	//				_ptempEdge=(CATEdge *)edgecells[currentCell];
	//				CATLISTP(CATCell) EndPtcells;
	//				_ptempEdge->GetAllCells(EndPtcells, 0);
	//				CATVertex * _pTempPtCell=(CATVertex *)EndPtcells[1];

	//				if (_pTempPtCell==NextRailConnectPtCell)
	//				{
	//					_pTempPtCell=(CATVertex *)EndPtcells[2];
	//				}

	//				CATMathVector NextVec=EvalTangentVec(_pTempPtCell,_ptempEdge);//第一个临边末端点的方向向量
	//				double angel=NextVec.GetAngleTo(datumVec);
	//				cout<<"这个角度是："<<angel*180/CATPI<<endl;


	//				if (angel*180/CATPI>30&&angel*180/CATPI<150)
	//				{
	//					cout<<"角度偏移太大"<<endl;
	//					IsEnd1=TRUE;
	//					break;


	//				}
	//				else
	//				{
	//					cout<<"找到下一个面内临边"<<endl;
	//					NextRailConnectPtCell=_pTempPtCell;
	//					NextRailConnectEdgeCell=_ptempEdge;
	//					RailEdgecells.Append(_ptempEdge);

	//					break;

	//				}


	//			}


	//		}



	//	}


	//	cout<<"结束循环1~~~~~~~~~~~~~~~~~~~~~~~~~~~~"<<endl;


	//	if (currentCell==edgecells.Size()+1&&hastan==FALSE)
	//	{
	//		IsEnd1=TRUE;
	//	}
	//}









	////对另一个顶点

	//CATVertex* NextRailConnectPtCell1=LongestEdgePtcells1;

	//NextRailConnectEdgeCell=_piLongestOffsetEdgeCell;


	////system("pause");

	//IsEnd1=FALSE;

	//while (FALSE==IsEnd1)
	//{
	//	cout<<"这里   4"<<endl;

	//	CATMathVector datumVec=EvalTangentVec(NextRailConnectPtCell1,(CATEdge *)NextRailConnectEdgeCell);//第一个临边末端点的方向向量
	//	cout<<"这里   5"<<endl;

	//	int currentCell=1;
	//	CATBoolean hastan=FALSE;
	//	for(; currentCell<=edgecells.Size(); currentCell++)
	//	{


	//		if (((CATCell *)NextRailConnectPtCell1)->IsOnBorder(edgecells[currentCell])&&edgecells[currentCell]!=NextRailConnectEdgeCell)//可以加上  &&FaceEdgecells[currentCell]！=NextConnectEdgeCell
	//		{

	//			CATAngle lsdlg=0;
	//			NextRailConnectPtCell1->EvalSharpness((CATEdge *)NextRailConnectEdgeCell,(CATEdge *)edgecells[currentCell],ContiOrNot1,&lsdlg,NULL,NULL,5*CATPI/180);
	//			cout<<"连接的角度："<<lsdlg*180/CATPI<<endl;
	//			if (ContiOrNot1==CATSmooth)//判断下一个相邻边末端点的向量是否与前一个差距太大，排除末端有倒圆特征的情况
	//			{


	//				hastan=true;

	//				CATEdge * _ptempEdge=NULL;
	//				cout<<"此Edge不是最后一个edge\t"<<ContiOrNot1<<endl;
	//				_ptempEdge=(CATEdge *)edgecells[currentCell];
	//				CATLISTP(CATCell) EndPtcells;
	//				_ptempEdge->GetAllCells(EndPtcells, 0);
	//				CATVertex * _pTempPtCell=(CATVertex *)EndPtcells[1];

	//				if (_pTempPtCell==NextRailConnectPtCell1)
	//				{
	//					_pTempPtCell=(CATVertex *)EndPtcells[2];
	//				}

	//				CATMathVector NextVec=EvalTangentVec(_pTempPtCell,_ptempEdge);//第一个临边末端点的方向向量
	//				double angel=NextVec.GetAngleTo(datumVec);
	//				cout<<"这个角度是："<<angel*180/CATPI<<endl;


	//				if (angel*180/CATPI>30&&angel*180/CATPI<150)
	//				{
	//					cout<<"角度偏移太大"<<endl;
	//					IsEnd1=TRUE;
	//					break;


	//				}
	//				else
	//				{
	//					cout<<"找到下一个面内临边"<<endl;
	//					NextRailConnectPtCell1=_pTempPtCell;
	//					NextRailConnectEdgeCell=_ptempEdge;
	//					RailEdgecells.Append(_ptempEdge);

	//					break;

	//				}


	//			}


	//		}



	//	}


	//	cout<<"结束循环1~~~~~~~~~~~~~~~~~~~~~~~~~~~~"<<endl;


	//	if (currentCell==edgecells.Size()+1&&hastan==FALSE)
	//	{
	//		IsEnd1=TRUE;
	//	}
	//}























	//CATLISTV(CATISpecObject_var) LISTRunCur0;

	//for (int i=1;i<=RailEdgecells.Size();i++)
	//{
	//	CATIBRepAccess_var spBRepEdge = CATBRepDecodeCellInBody( RailEdgecells[i], spOffsetFaceBody );

	//	CATIFeaturize_var FCell = spBRepEdge;
	//	CATISpecObject_var spSpecFace = FCell->FeaturizeR( MfPermanentBody|	MfLastFeatureSupport | 	MfRelimitedFeaturization);
	//	ObjectUpdate(spSpecFace);

	//	CATIGSMExtractSolide_var spExtractSurface003 = pGSMFactOnUpRollingFace->CreateExtractSolide(spSpecFace, ExtractSolide_NoPropag);
	//	CATISpecObject_var NewExSurface003 = spExtractSurface003;
	//	ObjectUpdate(NewExSurface003);
	//	InsertInProceduralView(NewExSurface003,spGSMToolUpRollingFace);
	//	LISTRunCur0.Append(NewExSurface003);
	//	HideSpecObj(NewExSurface003);
	//}

	//CATIGSMAssemble_var spLISTRunCur = pGSMFactOnUpRollingFace -> CreateAssemble(LISTRunCur0, NULL_var, TRUE);
	//CATISpecObject_var spPreSpecRunningCur = spLISTRunCur;
	//ObjectUpdate(spPreSpecRunningCur);
	//InsertInProceduralView(spPreSpecRunningCur,spGSMToolUpRollingFace);
	//HideSpecObj(spPreSpecRunningCur);




	//double LtL=0;
	//LtL=GetMinDistance(spPreSpecRunningCur,spiUpRotatCenter);




	//CATICkeParm_var spiCurvOffsetDisParm= spCkeParmFactoryOnUpRollingFace->CreateDimension(spParamDict->FindMagnitude("LENGTH"),"偏移",LtL/1000);


	//CATIGSMCurvePar_var  spiRunningCurvePar=pGSMFactOnUpRollingFace->CreateCurvePar(spPreSpecRunningCur, 
	//	spiOffsetSpecRail, 
	//	spiCurvOffsetDisParm, 
	//	FALSE);
	//CATISpecObject_var spiRunningCurve = spiRunningCurvePar;
	//ObjectUpdate(spiRunningCurve);


	//double disafter1=GetMinDistance(spiRunningCurve,spiUpRotatCenter);
	//cout<<"偏移后的距离："<<disafter1<<endl;
	//if (disafter1>0.01)
	//{
	//	cout<<"偏移方向错误 反向"<<endl;
	//	CATBoolean Invert=FALSE;
	//	spiRunningCurvePar->GetInvertDirection(Invert);
	//	if (Invert)
	//	{

	//		Invert=FALSE;
	//		spiRunningCurvePar->SetInvertDirection(Invert);
	//	} 
	//	else
	//	{
	//		Invert=TRUE;
	//		spiRunningCurvePar->SetInvertDirection(Invert);

	//	}
	//	ObjectUpdate(spiRunningCurve);

	//}


	//InsertInProceduralView(spiRunningCurve,spGSMToolUpRollingFace);

	////轨迹线计算完毕









//计算运动副元素

	CATISpecObject_var spiUpRunningCurve = NULL_var;
	CalRunningEle(spiUpRotateSpcSurface,piInstanceProdOnUpRotate,piInstanceProdOnUpRollingFace,spiUpRollingSpcSurface,spiUpRollingSpcOnRail,spiUpRotatCenter,spiUpRunningCurve,0);





	CATISpecObject_var spiMidRunningCurve = NULL_var;


	CalRunningEle(spiMidRotateSpcSurface1,piInstanceProdOnMidRotate1,piInstanceProdOnMidRollingFace,spiMidRollingSpcSurface,spiMidRollingSpcOnRail,spiMidRotatCenter1,spiMidRunningCurve,1);



	CATISpecObject_var spiMidRotatCenter2 = NULL_var;
	CATISpecObject_var spiMidRunningSurface2= NULL_var;
	CalRunningEle(spiMidRotateSpcSurface2,piInstanceProdOnMidRotate1,piInstanceProdOnMidRollingFace,spiMidRollingSpcSurface,spiMidRollingSpcOnRail,spiMidRotatCenter2,spiMidRunningSurface2,0);



	CATISpecObject_var spiDownRotatCenter1 = NULL_var;
	CATISpecObject_var spiDownRunningSurface1= NULL_var;
	CATISpecObject_var spiDownRunningCurve1= NULL_var;

	if (UsingType==PointSurface)
	{
		cout<<"1"<<endl;
		CalRunningEle(spiDownRotateSpcSurface1,piInstanceProdOnDownRotate1,piInstanceProdOnDownRollingFace,spiDownRollingSpcSurface,spiDownRollingSpcOnRail,spiDownRotatCenter1,spiDownRunningSurface1,0);

	} 
	else
	{
		cout<<"2"<<endl;

		CalRunningEle(spiDownRotateSpcSurface1,piInstanceProdOnDownRotate1,piInstanceProdOnDownRollingFace,spiDownRollingSpcSurface,spiDownRollingSpcOnRail,spiDownRotatCenter1,spiDownRunningCurve1,1);

	}


	CATISpecObject_var spiDownRotatCenter2 = NULL_var;
	CATISpecObject_var spiDownRunningSurface2= NULL_var;
	CalRunningEle(spiDownRotateSpcSurface2,piInstanceProdOnDownRotate1,piInstanceProdOnDownRollingFace,spiDownRollingSpcSurface,spiDownRollingSpcOnRail,spiDownRotatCenter2,spiDownRunningSurface2,0);

	CATISpecObject_var spiDownBearRotatCenter = NULL_var;
	CATISpecObject_var spiDownBearRunningSurface= NULL_var;
	if (UsingType==PointSurface)
	{
		CalRunningEle(spiDownBearRotateSpcSurface,piInstanceProdOnDownRotate1,piInstanceProdOnDownBearRollingFace,spiDownBearRollingSpcSurface,spiDownBearRollingSpcOnRail,spiDownBearRotatCenter,spiDownBearRunningSurface,0);

	}




	CATIKinMechanismFactory* piDocumentAsMechanismFactory = NULL;
	if (SUCCEEDED(pDoc->QueryInterface(IID_CATIKinMechanismFactory, (void**)&piDocumentAsMechanismFactory)))
	{
		if (SUCCEEDED(piDocumentAsMechanismFactory->CreateInstance(&piMechanism)))
		{

			CreatePointSurfaceJoint(spiUpRotatCenter,piInstanceProdOnUpRotate,spiUpRunningCurve,piInstanceProdOnUpRollingFace);



			CreatePointCurveJoint(spiMidRotatCenter1,piInstanceProdOnMidRotate1,spiMidRunningCurve,piInstanceProdOnMidRollingFace,TRUE);
			CreatePointSurfaceJoint(spiMidRotatCenter2,piInstanceProdOnMidRotate1,spiMidRunningSurface2,piInstanceProdOnMidRollingFace);





			if (UsingType==PointSurface)//	if (UsingType==PointSurface)

			{
			CreatePointSurfaceJoint(spiDownRotatCenter1,piInstanceProdOnDownRotate1,spiDownRunningSurface1,piInstanceProdOnDownRollingFace);
			CreatePointSurfaceJoint(spiDownBearRotatCenter,piInstanceProdOnDownRotate1,spiDownBearRunningSurface,piInstanceProdOnDownBearRollingFace);

			}
			else
			CreatePointCurveJoint(spiDownRotatCenter1,piInstanceProdOnDownRotate1,spiDownRunningCurve1,piInstanceProdOnDownRollingFace,FALSE);


			CreatePointSurfaceJoint(spiDownRotatCenter2,piInstanceProdOnDownRotate1,spiDownRunningSurface2,piInstanceProdOnDownRollingFace);






			CreateRevoluteJoint(spiHinge1Line1,spiHinge1Line2,spiHinge1Plane1,spiBRepHinge1Plane1,spLastFeaOnHinge1Plane1,spLastFeaOnHinge1Plane2,piInstanceProdOnHinge1Plane1,piInstanceProdOnHinge1Plane2);//spiHinge1Plane2
			CreateRevoluteJoint(spiHinge2Line1,spiHinge2Line2,spiHinge2Plane1,spiBRepHinge2Plane1,spLastFeaOnHinge2Plane1,spLastFeaOnHinge2Plane2,piInstanceProdOnHinge2Plane1,piInstanceProdOnHinge2Plane2);
			for (int i=1;i<=LISTProdOfBody.Size();i++)
			{
				CreateRigidJoint(spBodyPrd,LISTProdOfBody[i]);

			}


			for (int i=1;i<=LISTProdOfDoor.Size();i++)
			{
				CreateRigidJoint(spDoorPrd,LISTProdOfDoor[i]);

			}

			boolean iCreateConstraintsForFixed = 1;
			CATIProduct * piFixPrd=NULL;
			HRESULT rc7 = spBodyPrd->QueryInterface(IID_CATIProduct,(void **) &piFixPrd);

			HRESULT HR = piMechanism->SetFixedProduct(piFixPrd,iCreateConstraintsForFixed);

		}
	}


	RDCDMUBFInformationMsgBox("机构建立完毕！");

	cout<<"建立接合完毕"<<endl;//告知用户建立完毕





}

//-------------------------------------------------------------------------
// Callback on PushBActivate of _PushButton187
//-------------------------------------------------------------------------
void TestCmd::OnPushButton187PushBActivateNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here

	CATDlgPushButton * pButton = (CATDlgPushButton *) cmd ;
	if ( (NULL != pButton ) && (NULL !=_Panel->_Frame158) )
	{
		if( TRUE == _IsMoreWindowOpen)
		{
			// To do that, reset the attachment 
			_Panel->ResetAttachment(_Panel->_Frame158);         

			// hide the more panel
			_Panel->_Frame158->SetVisibility(CATDlgHide);         

			pButton->SetTitle (_MoreMsg);

			_IsMoreWindowOpen= FALSE;
		}
		else
		{
			// To do that, define a new tabulation
			_Panel->SetHorizontalAttachment(20, CATDlgTopOrLeft, _Panel->_Frame158, NULL);
			//SetVerticalAttachment(20, CATDlgTopOrLeft, _Frame158,NULL);

			// show the more panel
			_Panel->_Frame158->SetVisibility(CATDlgShow);         

			pButton->SetTitle (_LessMsg);

			_IsMoreWindowOpen = TRUE;
		}
	}
}


//-------------------------------------------------------------------------
// Callback on TabSelect of _TabContainer068
//-------------------------------------------------------------------------
void TestCmd::OnTabContainer068TabSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here

	//if( TRUE == _IsMoreWindowOpen)
	//{
	//	// To do that, reset the attachment 
	//	ResetAttachment(_Frame158);         

	//	// hide the more panel
	//	_Frame158->SetVisibility(CATDlgHide);         
	//	_PushButton187->SetTitle (_MoreMsg);


	//	_IsMoreWindowOpen= FALSE;
	//}

}
//错误信息
void TestCmd::RDCDMUBFErrorMsgBox(const char* pMsg, CATDialog* pParent)
{
	CATDialog* pCurParent=pParent;
	if(pParent==NULL)
	{
		pCurParent=(CATApplicationFrame::GetApplicationFrame())->GetMainWindow();
	}
	CATDlgNotify *p=new CATDlgNotify (pCurParent,"ErrorMsgBox", CATDlgNfyError);
	p->DisplayBlocked(pMsg,"错误");
	p->RequestDelayedDestruction();
	p=NULL;
}

//提示信息
void TestCmd::RDCDMUBFInformationMsgBox(const char* pMsg, CATDialog* pParent)
{
	CATDialog* pCurParent=pParent;
	if(pParent==NULL)
	{
		pCurParent=(CATApplicationFrame::GetApplicationFrame())->GetMainWindow();
	}
	CATDlgNotify *p=new CATDlgNotify (pCurParent,"Information",CATDlgNfyInformation);
	p->DisplayBlocked(pMsg,"提示");
	p->RequestDelayedDestruction();
	p=NULL;
}

CATNavigation2DViewer * TestCmd::GetViewer2D(int EleType)
{

	switch (EleType)
	{
	case 1:
		return _Viewer2DRail;
	case 2:
		return _Viewer2DHinge;
	case 3:
		return _Viewer2DRotate;
	case 4:
		return _Viewer2DRotateHinge;
	case 5:
		return _Viewer2DBody;
	case 6:
		return _Viewer2DDoor;

	default:
		{
			return NULL;

		}

	}
}

//-------------------------------------------------------------------------
// Callback on ListSelect of _SelectorList007
//-------------------------------------------------------------------------
void TestCmd::OnRailSelectorList007ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	cout<<"OnRailSelectorList007ListSelectNotification"<<endl;
//_pRollingFaceSelLis1Agent->InitializeAcquisition();

	if ( _HSO||NULL!=pUpRollingFacePathSel ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pUpRollingFacePathSel);
		_HSO -> EndAddElements ();

	}

if (NULL!=_pRollingFaceSelLis1Agent)
{
	_pRollingFaceSelLis1Agent->InitializeAcquisition();
}

	// Add your code here

if (_RailPanel->_SelectorList009->IsSelect(0)==TRUE)
{

	_RailPanel->_SelectorList009->ClearSelect();
}
if (_RailPanel->_SelectorList008->IsSelect(0)==TRUE)
{

	_RailPanel->_SelectorList008->ClearSelect();
}

if (_RailPanel->_SelectorList011->IsSelect(0)==TRUE)
{

	_RailPanel->_SelectorList011->ClearSelect();
}
if (_RailPanel->_SelectorList017->IsSelect(0)==TRUE)
{

	_RailPanel->_SelectorList017->ClearSelect();
}



//
//

//_RailPanel->SetHorizontalAttachment(20, CATDlgTopOrLeft, _RailPanel->_Frame019, NULL);

_RailPanel->_Label018-> SetIconName("shangdaogui");

_RailPanel->_Label018->Refresh();
_RailPanel->Refresh();





	//_RailPanel->_SelectorList009->ClearSelect();
	//_RailPanel->_SelectorList008->ClearSelect();



	//if( !!_pImageRep ) {
	//	GetViewer2D(1)->RemoveRep((CAT2DRep *)_pImageRep);
	//	_pImageRep->Destroy(); _pImageRep = NULL;

	//	GetViewer2D(1)->Draw();
	//}


	//CATUnicodeString fullFilePath=CATUnicodeString("e:\\项目\\上汽商用车\\滑移门\\afterdlgFailed\\Test\\Example\\MyFrame\\CNext\\resources\\graphic\\icons\\normal\\上导轨.png");
	//CATPixelImage *pPixelImage=CATPixelImage::CreateFromFile(CATString(fullFilePath.ConvertToChar()));
	//if( !!pPixelImage ) {
	//	float positionCoord[2]={0.,0.};
	//	_pImageRep=new CAT2DImagePixelRep(positionCoord,pPixelImage,2);

	//	GetViewer2D(1)->AddRep((CAT2DRep *)_pImageRep);

	//	GetViewer2D(1)->Reframe();

	//	delete pPixelImage; pPixelImage = NULL;
	//}



	return;
}


//-------------------------------------------------------------------------
// Callback on ListSelect of _SelectorList008
//-------------------------------------------------------------------------
void TestCmd::OnRailSelectorList008ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here pMidRollingFacePathSel
	if ( _HSO||NULL!=pMidRollingFacePathSel ) 
	{
		cout<<"1"<<endl;
		_HSO -> Empty();
		cout<<"2222"<<endl;

		if (NULL==pMidRollingFacePathSel)
		{
			cout<<"NULL==pMidRollingFacePathSel"<<endl;
		}

		_HSO -> AddElements (pMidRollingFacePathSel);
		cout<<"3"<<endl;

		_HSO -> EndAddElements ();
		cout<<"4"<<endl;


	}
	if (NULL!=_pRollingFaceSelLis2Agent)
	{
		_pRollingFaceSelLis2Agent->InitializeAcquisition();
	}
	if (_RailPanel->_SelectorList009->IsSelect(0)==TRUE)
	{

		_RailPanel->_SelectorList009->ClearSelect();
	}
	if (_RailPanel->_SelectorList007->IsSelect(0)==TRUE)
	{

		_RailPanel->_SelectorList007->ClearSelect();
	}
	if (_RailPanel->_SelectorList011->IsSelect(0)==TRUE)
	{

		_RailPanel->_SelectorList011->ClearSelect();
	}
	if (_RailPanel->_SelectorList017->IsSelect(0)==TRUE)
	{

		_RailPanel->_SelectorList017->ClearSelect();
	}
	//_RailPanel->_SelectorList009->ClearSelect();
	//_RailPanel->_SelectorList007->ClearSelect();

	_RailPanel->_Label018-> SetIconName("zhongdaogui");
	_RailPanel->_Label018->Refresh();
	_RailPanel->Refresh();



	//if( !!_pImageRep ) {
	//	GetViewer2D(1)->RemoveRep((CAT2DRep *)_pImageRep);
	//	_pImageRep->Destroy(); _pImageRep = NULL;

	//	GetViewer2D(1)->Draw();
	//}


	//CATUnicodeString fullFilePath=CATUnicodeString("e:\\项目\\上汽商用车\\滑移门\\afterdlgFailed\\Test\\Example\\MyFrame\\CNext\\resources\\graphic\\icons\\normal\\中导轨.png");
	//CATPixelImage *pPixelImage=CATPixelImage::CreateFromFile(CATString(fullFilePath.ConvertToChar()));
	//if( !!pPixelImage ) {
	//	float positionCoord[2]={0.,0.};
	//	_pImageRep=new CAT2DImagePixelRep(positionCoord,pPixelImage,2);

	//	GetViewer2D(1)->AddRep((CAT2DRep *)_pImageRep);

	//	GetViewer2D(1)->Reframe();

	//	delete pPixelImage; pPixelImage = NULL;
	//}


}


//-------------------------------------------------------------------------
// Callback on ListSelect of _SelectorList009
//-------------------------------------------------------------------------
void TestCmd::OnRailSelectorList009ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{

cout<<"OnRailSelectorList009ListSelectNotification"<<endl;
	if ( _HSO||NULL!=pDownRollingFacePathSel ) 
	{
		_HSO -> Empty();
		if (NULL==pDownRollingFacePathSel)
		{
			cout<<"高亮2为空"<<endl;
		}
		_HSO -> AddElements (pDownRollingFacePathSel);
		_HSO -> EndAddElements ();

	}

_pRollingFaceSelLis3Agent->InitializeAcquisition();
	// Add your code here
if (_RailPanel->_SelectorList008->IsSelect(0)==TRUE)
{

	_RailPanel->_SelectorList008->ClearSelect();
}
if (_RailPanel->_SelectorList007->IsSelect(0)==TRUE)
{

	_RailPanel->_SelectorList007->ClearSelect();
}
if (_RailPanel->_SelectorList011->IsSelect(0)==TRUE)
{

	_RailPanel->_SelectorList011->ClearSelect();
}
if (_RailPanel->_SelectorList017->IsSelect(0)==TRUE)
{

	_RailPanel->_SelectorList017->ClearSelect();
}
	//_RailPanel->_SelectorList007->ClearSelect();
	//_RailPanel->_SelectorList008->ClearSelect();

_RailPanel->_Label018-> SetIconName("xiadaogui");

_RailPanel->_Label018->Refresh();
_RailPanel->Refresh();



	//cout<<"点选selectlist09"<<endl;
	//if( !!_pImageRep ) {
	//	GetViewer2D(1)->RemoveRep((CAT2DRep *)_pImageRep);
	//	_pImageRep->Destroy(); _pImageRep = NULL;

	//	GetViewer2D(1)->Draw();
	//}


	//CATUnicodeString fullFilePath=CATUnicodeString("e:\\项目\\上汽商用车\\滑移门\\afterdlgFailed\\Test\\Example\\MyFrame\\CNext\\resources\\graphic\\icons\\normal\\下导轨.png");
	//CATPixelImage *pPixelImage=CATPixelImage::CreateFromFile(CATString(fullFilePath.ConvertToChar()));
	//if( !!pPixelImage ) {
	//	float positionCoord[2]={0.,0.};
	//	_pImageRep=new CAT2DImagePixelRep(positionCoord,pPixelImage,2);

	//	GetViewer2D(1)->AddRep((CAT2DRep *)_pImageRep);

	//	GetViewer2D(1)->Reframe();

	//	delete pPixelImage; pPixelImage = NULL;
	//}

	return;
}
void TestCmd::OnRailSelectorList011ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	_pRollingFaceSelLis4Agent->InitializeAcquisition();
	// Add your code here
	if (_RailPanel->_SelectorList008->IsSelect(0)==TRUE)
	{

		_RailPanel->_SelectorList008->ClearSelect();
	}
	if (_RailPanel->_SelectorList007->IsSelect(0)==TRUE)
	{

		_RailPanel->_SelectorList007->ClearSelect();
	}
	if (_RailPanel->_SelectorList009->IsSelect(0)==TRUE)
	{

		_RailPanel->_SelectorList009->ClearSelect();
	}
	if (_RailPanel->_SelectorList017->IsSelect(0)==TRUE)
	{

		_RailPanel->_SelectorList017->ClearSelect();
	}
	//_RailPanel->_SelectorList007->ClearSelect();
	//_RailPanel->_SelectorList008->ClearSelect();

	_RailPanel->_Label018-> SetIconName("chengyamian");

	_RailPanel->_Label018->Refresh();
	_RailPanel->Refresh();



	//cout<<"点选selectlist11"<<endl;
	//if( !!_pImageRep ) {
	//	GetViewer2D(1)->RemoveRep((CAT2DRep *)_pImageRep);
	//	_pImageRep->Destroy(); _pImageRep = NULL;

	//	GetViewer2D(1)->Draw();
	//}


	//CATUnicodeString fullFilePath=CATUnicodeString("e:\\项目\\上汽商用车\\滑移门\\afterdlgFailed\\Test\\Example\\MyFrame\\CNext\\resources\\graphic\\icons\\normal\\承压面.png");
	//CATPixelImage *pPixelImage=CATPixelImage::CreateFromFile(CATString(fullFilePath.ConvertToChar()));
	//if( !!pPixelImage ) {
	//	float positionCoord[2]={0.,0.};
	//	_pImageRep=new CAT2DImagePixelRep(positionCoord,pPixelImage,2);

	//	GetViewer2D(1)->AddRep((CAT2DRep *)_pImageRep);

	//	GetViewer2D(1)->Reframe();

	//	delete pPixelImage; pPixelImage = NULL;
	//}

	return;
}

void TestCmd::OnRailSelectorList017ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	_pRollingFaceSelLis5Agent->InitializeAcquisition();
	if ( _HSO||NULL!=pDownBearRollingFacePathSel ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pDownBearRollingFacePathSel);
		_HSO -> EndAddElements ();

	}
	// Add your code here
	if (_RailPanel->_SelectorList008->IsSelect(0)==TRUE)
	{

		_RailPanel->_SelectorList008->ClearSelect();
	}
	if (_RailPanel->_SelectorList007->IsSelect(0)==TRUE)
	{

		_RailPanel->_SelectorList007->ClearSelect();
	}
	if (_RailPanel->_SelectorList009->IsSelect(0)==TRUE)
	{

		_RailPanel->_SelectorList009->ClearSelect();
	}
	if (_RailPanel->_SelectorList011->IsSelect(0)==TRUE)
	{

		_RailPanel->_SelectorList011->ClearSelect();
	}
	//_RailPanel->_SelectorList007->ClearSelect();
	//_RailPanel->_SelectorList008->ClearSelect();


	_RailPanel->_Label018-> SetIconName("chengyamian");

	_RailPanel->_Label018->Refresh();
	_RailPanel->Refresh();


	//cout<<"点选selectlist017"<<endl;
	//if( !!_pImageRep ) {
	//	GetViewer2D(1)->RemoveRep((CAT2DRep *)_pImageRep);
	//	_pImageRep->Destroy(); _pImageRep = NULL;

	//	GetViewer2D(1)->Draw();
	//}


	//CATUnicodeString fullFilePath=CATUnicodeString("e:\\项目\\上汽商用车\\滑移门\\afterdlgFailed\\Test\\Example\\MyFrame\\CNext\\resources\\graphic\\icons\\normal\\承压面.png");
	//CATPixelImage *pPixelImage=CATPixelImage::CreateFromFile(CATString(fullFilePath.ConvertToChar()));
	//if( !!pPixelImage ) {
	//	float positionCoord[2]={0.,0.};
	//	_pImageRep=new CAT2DImagePixelRep(positionCoord,pPixelImage,2);

	//	GetViewer2D(1)->AddRep((CAT2DRep *)_pImageRep);

	//	GetViewer2D(1)->Reframe();

	//	delete pPixelImage; pPixelImage = NULL;
	//}

	return;
}

//-------------------------------------------------------------------------
// Callback on DiaCANCEL of _RailDlg
//-------------------------------------------------------------------------
void TestCmd::OnRailDlgDiaCANCELNotification(void * date)
{
	cout<<"上轨道对话框取消按钮。。。"<<endl;
	// Add your code here
	if ( _HSO ) 
	{
		_HSO -> Empty();}
	if (_pRollingFaceCancleAgent!=NULL)
	{
		_pRollingFaceCancleAgent->InitializeAcquisition();
	}
	_RailPanel->SetVisibility(CATDlgHide);
	//RequestDelayedDestruction();
}
void TestCmd::OnRailDlgDiaCANCELNotification1(void * date)
{
	cout<<"上轨道对话框取消按钮1。。。"<<endl;
	// Add your code here
	if ( _HSO ) 
	{
		_HSO -> Empty();}
	if (_pRollingFaceCancleAgent!=NULL)
	{
		_pRollingFaceCancleAgent->InitializeAcquisition();
	}
	_RailPanel->SetVisibility(CATDlgHide);
	//RequestDelayedDestruction();
}
void TestCmd::OnRailDlgDiaCANCELNotification2(void * date)
{
	cout<<"上轨道对话框取消按钮2。。。"<<endl;
	// Add your code here
	if ( _HSO ) 
	{
		_HSO -> Empty();}
	if (_pRollingFaceCancleAgent!=NULL)
	{
		_pRollingFaceCancleAgent->InitializeAcquisition();
	}
	_RailPanel->SetVisibility(CATDlgHide);
	//RequestDelayedDestruction();
}


//-------------------------------------------------------------------------
// Callback on DiaOK of _RailDlg
//-------------------------------------------------------------------------
void TestCmd::OnRailDlgDiaOKNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//RequestDelayedDestruction();

	//检查输入是否完备

	if ( _HSO ) 
	{
		_HSO -> Empty();}


	if (_pRollingFaceOKAgent!=NULL)
	{
		_pRollingFaceOKAgent->InitializeAcquisition();
	}
	_RailPanel->SetVisibility(CATDlgHide);


	CATUnicodeString  strSel1;
	_RailPanel->_SelectorList007->GetLine(strSel1,0);
	CATUnicodeString  strSel2;
	_RailPanel->_SelectorList008->GetLine(strSel2,0);
	CATUnicodeString  strSel3;
	_RailPanel->_SelectorList009->GetLine(strSel3,0);
	//CATUnicodeString  strSel4;
	//_RailPanel->_SelectorList011->GetLine(strSel4,0);
	CATUnicodeString  strSel5;
	_RailPanel->_SelectorList017->GetLine(strSel5,0);

	if (strSel1!="未选择"&&strSel2!="未选择"&&strSel3!="未选择"&&strSel5!="未选择")
	{
		_Panel->_SelectorList171->SetLine("已选完",0,CATDlgDataModify);

	}

}


//-------------------------------------------------------------------------
// Callback on DiaCLOSE of _RailDlg
//-------------------------------------------------------------------------
void TestCmd::OnRailDlgDiaCLOSENotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//RequestDelayedDestruction();
	cout<<"OnRailDlgDiaCLOSENotification"<<endl;
	if ( _HSO ) 
	{
		_HSO -> Empty();}
	if (_pRollingFaceCloseAgent!=NULL)
	{
		_pRollingFaceCloseAgent->InitializeAcquisition();
	}
	_RailPanel->SetVisibility(CATDlgHide);

}

//hinge响应
void TestCmd::OnHingeSelectorList006ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here pHinge1Line1PathSel

	if ( _HSO||NULL!=pHinge1Line1PathSel ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pHinge1Line1PathSel);
		_HSO -> EndAddElements ();

	}
	if (_pHinge1Line1SelLisAgent!=NULL)
	{
		_pHinge1Line1SelLisAgent->InitializeAcquisition();
	}

	_HingePanel->_SelectorList007->ClearSelect();
	//_HingePanel->_SelectorList006->ClearSelect();
	_HingePanel->_SelectorList012->ClearSelect();
	_HingePanel->_SelectorList014->ClearSelect();
	_HingePanel->_SelectorList016->ClearSelect();
	_HingePanel->_SelectorList018->ClearSelect();
	_HingePanel->_SelectorList020->ClearSelect();
	_HingePanel->_SelectorList022->ClearSelect();

	cout<<"点选selectlist06"<<endl;

	_HingePanel->_Label027-> SetIconName("zhixiana");

	_HingePanel->_Label027->Refresh();
	_HingePanel->Refresh();



	//if( !!_pImageRep ) {
	//	GetViewer2D(2)->RemoveRep((CAT2DRep *)_pImageRep);
	//	_pImageRep->Destroy(); _pImageRep = NULL;

	//	GetViewer2D(2)->Draw();
	//}


	//CATUnicodeString fullFilePath=CATUnicodeString("e:\\项目\\上汽商用车\\滑移门\\afterdlgFailed\\Test\\Example\\MyFrame\\CNext\\resources\\graphic\\icons\\normal\\上铰链.png");
	//CATPixelImage *pPixelImage=CATPixelImage::CreateFromFile(CATString(fullFilePath.ConvertToChar()));
	//if( !!pPixelImage ) {
	//	float positionCoord[2]={0.,0.};
	//	_pImageRep=new CAT2DImagePixelRep(positionCoord,pPixelImage,2);

	//	GetViewer2D(2)->AddRep((CAT2DRep *)_pImageRep);

	//	GetViewer2D(2)->Reframe();

	//	delete pPixelImage; pPixelImage = NULL;
	//}



	return;
}
//CATNavigation2DViewer * HingeDlg::GetViewer2D()
//{
//	return _Viewer2DHinge;
//}
//-------------------------------------------------------------------------
// Callback on ListSelect of _SelectorList007
//-------------------------------------------------------------------------
void TestCmd::OnHingeSelectorList007ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here pHinge2Line1PathSel
	if ( _HSO||NULL!=pHinge2Line1PathSel ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pHinge2Line1PathSel);
		_HSO -> EndAddElements ();

	}
	if (_pHinge2Line1SelLisAgent!=NULL)
	{
		_pHinge2Line1SelLisAgent->InitializeAcquisition();
	}
	//_HingePanel->_SelectorList007->ClearSelect();
	_HingePanel->_SelectorList006->ClearSelect();

	_HingePanel->_SelectorList012->ClearSelect();
	_HingePanel->_SelectorList014->ClearSelect();
	_HingePanel->_SelectorList016->ClearSelect();
	_HingePanel->_SelectorList018->ClearSelect();
	_HingePanel->_SelectorList020->ClearSelect();
	_HingePanel->_SelectorList022->ClearSelect();




	_HingePanel->_Label027-> SetIconName("xiazhixiana");

	_HingePanel->_Label027->Refresh();
	_HingePanel->Refresh();
	//if( !!_pImageRep ) {
	//	GetViewer2D(2)->RemoveRep((CAT2DRep *)_pImageRep);
	//	_pImageRep->Destroy(); _pImageRep = NULL;

	//	GetViewer2D(2)->Draw();
	//}


	//CATUnicodeString fullFilePath=CATUnicodeString("e:\\项目\\上汽商用车\\滑移门\\afterdlgFailed\\Test\\Example\\MyFrame\\CNext\\resources\\graphic\\icons\\normal\\中铰链.png");
	//CATPixelImage *pPixelImage=CATPixelImage::CreateFromFile(CATString(fullFilePath.ConvertToChar()));
	//if( !!pPixelImage ) {
	//	float positionCoord[2]={0.,0.};
	//	_pImageRep=new CAT2DImagePixelRep(positionCoord,pPixelImage,2);

	//	GetViewer2D(2)->AddRep((CAT2DRep *)_pImageRep);

	//	GetViewer2D(2)->Reframe();

	//	delete pPixelImage; pPixelImage = NULL;
	//}



	return;

}

void TestCmd::OnHingeSelectorList012ListSelectNotification (CATCommand *, CATNotification* , CATCommandClientData data)
{

	//pHinge1Line2PathSel


	if ( _HSO||NULL!=pHinge1Line2PathSel ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pHinge1Line2PathSel);
		_HSO -> EndAddElements ();

	}
	if (_pHinge1Line2SelLisAgent!=NULL)
	{
		_pHinge1Line2SelLisAgent->InitializeAcquisition();
	}
	_HingePanel->_SelectorList007->ClearSelect();
	_HingePanel->_SelectorList006->ClearSelect();
	//_HingePanel->_SelectorList012->ClearSelect();
	_HingePanel->_SelectorList014->ClearSelect();
	_HingePanel->_SelectorList016->ClearSelect();
	_HingePanel->_SelectorList018->ClearSelect();
	_HingePanel->_SelectorList020->ClearSelect();
	_HingePanel->_SelectorList022->ClearSelect();

	_HingePanel->_Label027-> SetIconName("zhixianb");

	_HingePanel->_Label027->Refresh();
	_HingePanel->Refresh();
}
void TestCmd::OnHingeSelectorList014ListSelectNotification (CATCommand *, CATNotification* , CATCommandClientData data)
{

	//pHinge1Plane1PathSel

	if ( _HSO||NULL!=pHinge1Plane1PathSel ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pHinge1Plane1PathSel);
		_HSO -> EndAddElements ();

	}
	if (_pHinge1Plane1SelLisAgent!=NULL)
	{
		_pHinge1Plane1SelLisAgent->InitializeAcquisition();
	}
	_HingePanel->_SelectorList007->ClearSelect();
	_HingePanel->_SelectorList006->ClearSelect();
	_HingePanel->_SelectorList012->ClearSelect();
	//_HingePanel->_SelectorList014->ClearSelect();
	_HingePanel->_SelectorList016->ClearSelect();
	_HingePanel->_SelectorList018->ClearSelect();
	_HingePanel->_SelectorList020->ClearSelect();
	_HingePanel->_SelectorList022->ClearSelect();
	_HingePanel->_Label027-> SetIconName("pingmiana");

	_HingePanel->_Label027->Refresh();
	_HingePanel->Refresh();
}
void TestCmd::OnHingeSelectorList016ListSelectNotification (CATCommand *, CATNotification* , CATCommandClientData data)
{



	if ( _HSO||NULL!=pHinge1Plane2PathSel ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pHinge1Plane2PathSel);
		_HSO -> EndAddElements ();

	}


	if (_pHinge1Plane2SelLisAgent!=NULL)
	{
		_pHinge1Plane2SelLisAgent->InitializeAcquisition();
	}
	_HingePanel->_SelectorList007->ClearSelect();
	_HingePanel->_SelectorList006->ClearSelect();
	_HingePanel->_SelectorList012->ClearSelect();
	_HingePanel->_SelectorList014->ClearSelect();
	//_HingePanel->_SelectorList016->ClearSelect();
	_HingePanel->_SelectorList018->ClearSelect();
	_HingePanel->_SelectorList020->ClearSelect();
	_HingePanel->_SelectorList022->ClearSelect();
	_HingePanel->_Label027-> SetIconName("pingmianb");

	_HingePanel->_Label027->Refresh();
	_HingePanel->Refresh();
}

void TestCmd::OnHingeSelectorList018ListSelectNotification (CATCommand *, CATNotification* , CATCommandClientData data)
{
	if ( _HSO||NULL!=pHinge2Line2PathSel ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pHinge2Line2PathSel);
		_HSO -> EndAddElements ();

	}

	if (_pHinge2Line2SelLisAgent!=NULL)
	{
		_pHinge2Line2SelLisAgent->InitializeAcquisition();
	}
	_HingePanel->_SelectorList007->ClearSelect();
	_HingePanel->_SelectorList006->ClearSelect();
	_HingePanel->_SelectorList012->ClearSelect();
	_HingePanel->_SelectorList014->ClearSelect();
	_HingePanel->_SelectorList016->ClearSelect();
	//_HingePanel->_SelectorList018->ClearSelect();
	_HingePanel->_SelectorList020->ClearSelect();
	_HingePanel->_SelectorList022->ClearSelect();
	_HingePanel->_Label027-> SetIconName("xiazhixianb");

	_HingePanel->_Label027->Refresh();
	_HingePanel->Refresh();
}

void TestCmd::OnHingeSelectorList020ListSelectNotification (CATCommand *, CATNotification* , CATCommandClientData data)
{

	if ( _HSO||NULL!=pHinge2Plane1PathSel ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pHinge2Plane1PathSel);
		_HSO -> EndAddElements ();

	}

	if (_pHinge2Plane1SelLisAgent!=NULL)
	{
		_pHinge2Plane1SelLisAgent->InitializeAcquisition();
	}
	_HingePanel->_SelectorList007->ClearSelect();
	_HingePanel->_SelectorList006->ClearSelect();
	_HingePanel->_SelectorList012->ClearSelect();
	_HingePanel->_SelectorList014->ClearSelect();
	_HingePanel->_SelectorList016->ClearSelect();
	_HingePanel->_SelectorList018->ClearSelect();
	//_HingePanel->_SelectorList020->ClearSelect();
	_HingePanel->_SelectorList022->ClearSelect();
	_HingePanel->_Label027-> SetIconName("xiapingmiana");

	_HingePanel->_Label027->Refresh();
	_HingePanel->Refresh();
}
void TestCmd::OnHingeSelectorList022ListSelectNotification (CATCommand *, CATNotification* , CATCommandClientData data)
{
	if ( _HSO||NULL!=pHinge2Plane2PathSel ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pHinge2Plane2PathSel);
		_HSO -> EndAddElements ();

	}

	if (_pHinge2Plane2SelLisAgent!=NULL)
	{
		_pHinge2Plane2SelLisAgent->InitializeAcquisition();
	}
	_HingePanel->_SelectorList007->ClearSelect();
	_HingePanel->_SelectorList006->ClearSelect();
	_HingePanel->_SelectorList012->ClearSelect();
	_HingePanel->_SelectorList014->ClearSelect();
	_HingePanel->_SelectorList016->ClearSelect();
	_HingePanel->_SelectorList018->ClearSelect();
	_HingePanel->_SelectorList020->ClearSelect();
	//_HingePanel->_SelectorList022->ClearSelect();
	_HingePanel->_Label027-> SetIconName("xiapingmianb");

	_HingePanel->_Label027->Refresh();
	_HingePanel->Refresh();
}

//-------------------------------------------------------------------------
// Callback on DiaOK of _HingeDlg
//-------------------------------------------------------------------------
void TestCmd::OnHingeDlgDiaOKNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//RequestDelayedDestruction();

	if ( _HSO ) 
	{
		_HSO -> Empty();}
if (_pHingeFaceOKAgent!=NULL)
{
	_pHingeFaceOKAgent->InitializeAcquisition();
}
_HingePanel->SetVisibility(CATDlgHide);



CATUnicodeString  strSel1;
_HingePanel->_SelectorList006->GetLine(strSel1,0);
CATUnicodeString  strSel2;
_HingePanel->_SelectorList012->GetLine(strSel2,0);
CATUnicodeString  strSel3;
_HingePanel->_SelectorList014->GetLine(strSel3,0);
CATUnicodeString  strSel4;
_HingePanel->_SelectorList016->GetLine(strSel4,0);
CATUnicodeString  strSel5;
_HingePanel->_SelectorList007->GetLine(strSel5,0);
CATUnicodeString  strSel6;
_HingePanel->_SelectorList018->GetLine(strSel6,0);
CATUnicodeString  strSel7;
_HingePanel->_SelectorList020->GetLine(strSel7,0);
CATUnicodeString  strSel8;
_HingePanel->_SelectorList022->GetLine(strSel8,0);




if (strSel1!="未选择"&&strSel2!="未选择"&&strSel3!="未选择"&&strSel4!="未选择"&&strSel5!="未选择"&&strSel6!="未选择"&&strSel7!="未选择"&&strSel8!="未选择")
{
	_Panel->_SelectorList172->SetLine("已选完",0,CATDlgDataModify);

}






}


//-------------------------------------------------------------------------
// Callback on DiaCANCEL of _HingeDlg
//-------------------------------------------------------------------------
void TestCmd::OnHingeDlgDiaCANCELNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//RequestDelayedDestruction();
	if ( _HSO ) 
	{
		_HSO -> Empty();}
	if (_pHingeFaceCancleAgent!=NULL)
	{
		_pHingeFaceCancleAgent->InitializeAcquisition();
	}
	_HingePanel->SetVisibility(CATDlgHide);


}
void TestCmd::OnHingeDlgDiaCloseNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//RequestDelayedDestruction();
	if ( _HSO ) 
	{
		_HSO -> Empty();}
	if (_pHingeFaceCloseAgent!=NULL)
	{
		_pHingeFaceCloseAgent->InitializeAcquisition();
	}
	_HingePanel->SetVisibility(CATDlgHide);


}



void TestCmd::OnRotateSelectorList006ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	if ( _HSO||NULL!=pUpRotateFacePathSel ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pUpRotateFacePathSel);
		_HSO -> EndAddElements ();

	}

	if (NULL!=_pRotateFaceSelLis1Agent)
	{
		_pRotateFaceSelLis1Agent->InitializeAcquisition();
	}

	// Add your code here

	if (_RotatePanel->_SelectorList007->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList007->ClearSelect();
	}
	if (_RotatePanel->_SelectorList008->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList008->ClearSelect();
	}
	if (_RotatePanel->_SelectorList012->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList012->ClearSelect();
	}
	if (_RotatePanel->_SelectorList014->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList014->ClearSelect();
	}
	if (_RotatePanel->_SelectorListMdRot2->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorListMdRot2->ClearSelect();
	}
	if (_RotatePanel->_SelectorListDnRot2->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorListDnRot2->ClearSelect();
	}
	// Add your code here
	_RotatePanel->_SelectorList007->ClearSelect();
	_RotatePanel->_SelectorList008->ClearSelect();




	_RotatePanel->_Label015-> SetIconName("shanggunlun");

	_RotatePanel->_Label015->Refresh();
	_RotatePanel->Refresh();





	//cout<<"点选selectlist06"<<endl;
	//if( !!_pImageRep ) {
	//	GetViewer2D(3)->RemoveRep((CAT2DRep *)_pImageRep);
	//	_pImageRep->Destroy(); _pImageRep = NULL;

	//	GetViewer2D(3)->Draw();
	//}


	//CATUnicodeString fullFilePath=CATUnicodeString("e:\\项目\\上汽商用车\\滑移门\\afterdlgFailed\\Test\\Example\\MyFrame\\CNext\\resources\\graphic\\icons\\normal\\滚轮高亮.png");
	//CATPixelImage *pPixelImage=CATPixelImage::CreateFromFile(CATString(fullFilePath.ConvertToChar()));
	//if( !!pPixelImage ) {
	//	float positionCoord[2]={0.,0.};
	//	_pImageRep=new CAT2DImagePixelRep(positionCoord,pPixelImage,2);

	//	GetViewer2D(3)->AddRep((CAT2DRep *)_pImageRep);

	//	GetViewer2D(3)->Reframe();

	//	delete pPixelImage; pPixelImage = NULL;
	//}



	return;
}


//-------------------------------------------------------------------------
// Callback on ListSelect of _SelectorList007
//-------------------------------------------------------------------------
void TestCmd::OnRotateSelectorList007ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{


	if ( _HSO ) 
	{
		_HSO -> Empty();
	}
	if (NULL!=_pRotateFaceSelLis2Agent)
	{
		_pRotateFaceSelLis2Agent->InitializeAcquisition();
	}

	// Add your code here

	if (_RotatePanel->_SelectorList006->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList006->ClearSelect();
	}
	if (_RotatePanel->_SelectorList008->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList008->ClearSelect();
	}
	if (_RotatePanel->_SelectorList012->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList012->ClearSelect();
	}
	if (_RotatePanel->_SelectorList014->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList014->ClearSelect();
	}
	if (_RotatePanel->_SelectorListMdRot2->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorListMdRot2->ClearSelect();
	}
	if (_RotatePanel->_SelectorListDnRot2->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorListDnRot2->ClearSelect();
	}
	// Add your code here
	//_RotatePanel->_SelectorList006->ClearSelect();
	//_RotatePanel->_SelectorList008->ClearSelect();





	//if( !!_pImageRep ) {
	//	GetViewer2D(3)->RemoveRep((CAT2DRep *)_pImageRep);
	//	_pImageRep->Destroy(); _pImageRep = NULL;

	//	GetViewer2D(3)->Draw();
	//}


	//CATUnicodeString fullFilePath=CATUnicodeString("e:\\项目\\上汽商用车\\滑移门\\afterdlgFailed\\Test\\Example\\MyFrame\\CNext\\resources\\graphic\\icons\\normal\\中滚轮2.png");
	//CATPixelImage *pPixelImage=CATPixelImage::CreateFromFile(CATString(fullFilePath.ConvertToChar()));
	//if( !!pPixelImage ) {
	//	float positionCoord[2]={0.,0.};
	//	_pImageRep=new CAT2DImagePixelRep(positionCoord,pPixelImage,2);

	//	GetViewer2D(3)->AddRep((CAT2DRep *)_pImageRep);

	//	GetViewer2D(3)->Reframe();

	//	delete pPixelImage; pPixelImage = NULL;
	//}



	return;
}


//-------------------------------------------------------------------------
// Callback on ListSelect of _SelectorList008
//-------------------------------------------------------------------------
void TestCmd::OnRotateSelectorList008ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	cout<<"OnRotateSelectorList008ListSelectNotification"<<endl;

	if ( _HSO||NULL!=pDownBearRotateFacePathSel ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pDownBearRotateFacePathSel);
		_HSO -> EndAddElements ();

	}
	if (NULL!=_pRotateFaceSelLis4Agent)
	{
		_pRotateFaceSelLis4Agent->InitializeAcquisition();
	}

	// Add your code here

	if (_RotatePanel->_SelectorList006->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList006->ClearSelect();
	}
	if (_RotatePanel->_SelectorList007->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList007->ClearSelect();
	}
	if (_RotatePanel->_SelectorList012->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList012->ClearSelect();
	}
	if (_RotatePanel->_SelectorList014->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList014->ClearSelect();
	}
	if (_RotatePanel->_SelectorListMdRot2->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorListMdRot2->ClearSelect();
	}
	if (_RotatePanel->_SelectorListDnRot2->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorListDnRot2->ClearSelect();
	}
	// Add your code here
	_RotatePanel->_SelectorList007->ClearSelect();
	_RotatePanel->_SelectorList006->ClearSelect();



	_RotatePanel->_Label015-> SetIconName("chengya");

	_RotatePanel->_Label015->Refresh();
	_RotatePanel->Refresh();




	//if( !!_pImageRep ) {
	//	GetViewer2D(3)->RemoveRep((CAT2DRep *)_pImageRep);
	//	_pImageRep->Destroy(); _pImageRep = NULL;

	//	GetViewer2D(3)->Draw();
	//}


	//CATUnicodeString fullFilePath=CATUnicodeString("e:\\项目\\上汽商用车\\滑移门\\afterdlgFailed\\Test\\Example\\MyFrame\\CNext\\resources\\graphic\\icons\\normal\\下滚轮2.png");
	//CATPixelImage *pPixelImage=CATPixelImage::CreateFromFile(CATString(fullFilePath.ConvertToChar()));
	//if( !!pPixelImage ) {
	//	float positionCoord[2]={0.,0.};
	//	_pImageRep=new CAT2DImagePixelRep(positionCoord,pPixelImage,2);

	//	GetViewer2D(3)->AddRep((CAT2DRep *)_pImageRep);

	//	GetViewer2D(3)->Reframe();

	//	delete pPixelImage; pPixelImage = NULL;
	//}



	return;
}


void TestCmd::OnRotateSelectorList012ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{

	cout<<"OnRotateSelectorList012ListSelectNotification"<<endl;

	if ( _HSO||NULL!=pMidRotateFacePathSel1 ) 
	{
		_HSO -> Empty();
		if (NULL==pMidRotateFacePathSel1)
		{
			cout<<"pMidRotateFacePathSel1为空！！！！"<<endl;
		}
		_HSO -> AddElements (pMidRotateFacePathSel1);
		_HSO -> EndAddElements ();

	}

	if (NULL!=_pRotateFaceSelLis3Agent)
	{
		_pRotateFaceSelLis3Agent->InitializeAcquisition();
	}

	// Add your code here

	if (_RotatePanel->_SelectorList006->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList006->ClearSelect();
	}
	if (_RotatePanel->_SelectorList007->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList007->ClearSelect();
	}
	if (_RotatePanel->_SelectorList008->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList008->ClearSelect();
	}
	if (_RotatePanel->_SelectorList014->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList014->ClearSelect();
	}
	if (_RotatePanel->_SelectorListMdRot2->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorListMdRot2->ClearSelect();
	}
	if (_RotatePanel->_SelectorListDnRot2->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorListDnRot2->ClearSelect();
	}
	// Add your code here
	_RotatePanel->_SelectorList007->ClearSelect();
	_RotatePanel->_SelectorList006->ClearSelect();



	_RotatePanel->_Label015-> SetIconName("daoxianga");

	_RotatePanel->_Label015->Refresh();
	_RotatePanel->Refresh();


	//if( !!_pImageRep ) {
	//	GetViewer2D(3)->RemoveRep((CAT2DRep *)_pImageRep);
	//	_pImageRep->Destroy(); _pImageRep = NULL;

	//	GetViewer2D(3)->Draw();
	//}


	//CATUnicodeString fullFilePath=CATUnicodeString("e:\\项目\\上汽商用车\\滑移门\\afterdlgFailed\\Test\\Example\\MyFrame\\CNext\\resources\\graphic\\icons\\normal\\承压轮.png");
	//CATPixelImage *pPixelImage=CATPixelImage::CreateFromFile(CATString(fullFilePath.ConvertToChar()));
	//if( !!pPixelImage ) {
	//	float positionCoord[2]={0.,0.};
	//	_pImageRep=new CAT2DImagePixelRep(positionCoord,pPixelImage,2);

	//	GetViewer2D(3)->AddRep((CAT2DRep *)_pImageRep);

	//	GetViewer2D(3)->Reframe();

	//	delete pPixelImage; pPixelImage = NULL;
	//}



	return;
}

void TestCmd::OnRotateSelectorList014ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{

	if (NULL!=_pRotateFaceSelLis5Agent)
	{
		_pRotateFaceSelLis5Agent->InitializeAcquisition();
	}
	if ( _HSO||NULL!=pDownRotateFacePathSel1 ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pDownRotateFacePathSel1);
		_HSO -> EndAddElements ();

	}
	// Add your code here

	if (_RotatePanel->_SelectorList006->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList006->ClearSelect();
	}
	if (_RotatePanel->_SelectorList007->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList007->ClearSelect();
	}
	if (_RotatePanel->_SelectorList008->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList008->ClearSelect();
	}
	if (_RotatePanel->_SelectorList012->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList012->ClearSelect();
	}
	if (_RotatePanel->_SelectorListMdRot2->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorListMdRot2->ClearSelect();
	}
	if (_RotatePanel->_SelectorListDnRot2->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorListDnRot2->ClearSelect();
	}
	// Add your code here
	_RotatePanel->_SelectorList007->ClearSelect();
	_RotatePanel->_SelectorList006->ClearSelect();



	_RotatePanel->_Label015-> SetIconName("daoxianga");

	_RotatePanel->_Label015->Refresh();
	_RotatePanel->Refresh();


	//if( !!_pImageRep ) {
	//	GetViewer2D(3)->RemoveRep((CAT2DRep *)_pImageRep);
	//	_pImageRep->Destroy(); _pImageRep = NULL;

	//	GetViewer2D(3)->Draw();
	//}


	//CATUnicodeString fullFilePath=CATUnicodeString("e:\\项目\\上汽商用车\\滑移门\\afterdlgFailed\\Test\\Example\\MyFrame\\CNext\\resources\\graphic\\icons\\normal\\承压轮.png");
	//CATPixelImage *pPixelImage=CATPixelImage::CreateFromFile(CATString(fullFilePath.ConvertToChar()));
	//if( !!pPixelImage ) {
	//	float positionCoord[2]={0.,0.};
	//	_pImageRep=new CAT2DImagePixelRep(positionCoord,pPixelImage,2);

	//	GetViewer2D(3)->AddRep((CAT2DRep *)_pImageRep);

	//	GetViewer2D(3)->Reframe();

	//	delete pPixelImage; pPixelImage = NULL;
	//}



	return;
}


//-------------------------------------------------------------------------
// Callback on DiaOK of _RotateDlg
//-------------------------------------------------------------------------
void TestCmd::OnRotateDlgDiaOKNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here  _pRotateFaceOKAgent
	if ( _HSO ) 
	{
		_HSO -> Empty();}

	if (_pRotateFaceOKAgent!=NULL)
	{
		_pRotateFaceOKAgent->InitializeAcquisition();
	}
	_RotatePanel->SetVisibility(CATDlgHide);



	//CATUnicodeString  strSel1;
	//_RotatePanel->_SelectorList007->GetLine(strSel1,0);
	CATUnicodeString  strSel2;
	_RotatePanel->_SelectorList008->GetLine(strSel2,0);
	CATUnicodeString  strSel3;
	_RotatePanel->_SelectorList006->GetLine(strSel3,0);
	CATUnicodeString  strSel4;
	_RotatePanel->_SelectorList012->GetLine(strSel4,0);
	CATUnicodeString  strSel5;
	_RotatePanel->_SelectorList014->GetLine(strSel5,0);
	CATUnicodeString  strSel6;
	_RotatePanel->_SelectorListMdRot2->GetLine(strSel6,0);
	CATUnicodeString  strSel7;
	_RotatePanel->_SelectorListDnRot2->GetLine(strSel7,0);

	if (strSel2!="未选择"&&strSel3!="未选择"&&strSel4!="未选择"&&strSel5!="未选择"&&strSel6!="未选择"&&strSel7!="未选择")
	{
		_Panel->_SelectorList173->SetLine("已选完",0,CATDlgDataModify);

	}






}


//-------------------------------------------------------------------------
// Callback on DiaCANCEL of _RotateDlg
//-------------------------------------------------------------------------
void TestCmd::OnRotateDlgDiaCANCELNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	if ( _HSO ) 
	{
		_HSO -> Empty();}
	if (_pRotateFaceCancleAgent!=NULL)
	{
		_pRotateFaceCancleAgent->InitializeAcquisition();
	}
	_RotatePanel->SetVisibility(CATDlgHide);


}
void TestCmd::OnRotateDlgDiaCloseNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	if ( _HSO ) 
	{
		_HSO -> Empty();}
	if (_pRotateFaceCloseAgent!=NULL)
	{
		_pRotateFaceCloseAgent->InitializeAcquisition();
	}
	_RotatePanel->SetVisibility(CATDlgHide);


}
void TestCmd::OnBodySelectorList006ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//_BodyPanel->_SelectorList007->ClearSelect();

	_BodyPanel->_Label008-> SetIconName("cheshen");
	_BodyPanel->_Label008->Refresh();
	_BodyPanel->Refresh();
	if ( _HSO ) 
	{
		_HSO -> Empty();
	}
	if (_BodyPanel->_SelectorList007->IsSelect(0)==TRUE)
	{

		_BodyPanel->_SelectorList007->ClearSelect();
	}

	if (NULL!=_pBodyelLis1Agent)
	{
		_pBodyelLis1Agent->InitializeAcquisition();
	}
	cout<<"点选selectlist51"<<endl;


	_BodyPanel->_Label008-> SetIconName("cheshen");

	_BodyPanel->_Label008->Refresh();
	_BodyPanel->Refresh();



	//if( !!_pImageRep ) {
	//	GetViewer2D(5)->RemoveRep((CAT2DRep *)_pImageRep);
	//	_pImageRep->Destroy(); _pImageRep = NULL;

	//	GetViewer2D(5)->Draw();
	//}


	//CATUnicodeString fullFilePath=CATUnicodeString("e:\\项目\\上汽商用车\\滑移门\\afterdlgFailed\\Test\\Example\\MyFrame\\CNext\\resources\\graphic\\icons\\normal\\车身.png");
	//CATPixelImage *pPixelImage=CATPixelImage::CreateFromFile(CATString(fullFilePath.ConvertToChar()));
	//if( !!pPixelImage ) {
	//	float positionCoord[2]={0.,0.};
	//	_pImageRep=new CAT2DImagePixelRep(positionCoord,pPixelImage,2);

	//	GetViewer2D(5)->AddRep((CAT2DRep *)_pImageRep);

	//	GetViewer2D(5)->Reframe();

	//	delete pPixelImage; pPixelImage = NULL;
	//}



	return;
}


//-------------------------------------------------------------------------
// Callback on ListSelect of _SelectorList007
//-------------------------------------------------------------------------
void TestCmd::OnBodySelectorList007ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//_SelectorList006->ClearSelect();

	if ( _HSO ) 
	{
		_HSO -> Empty();
	}

	if (_BodyPanel->_SelectorList006->IsSelect(0)==TRUE)
	{

		_BodyPanel->_SelectorList006->ClearSelect();
	}
	_BodyPanel->_Label008->SetTitle("cheshenguidao");
	_BodyPanel->_Label008->Refresh();
	_BodyPanel->Refresh();


	cout<<"点选selectlist07"<<endl;
	//if( !!_pImageRep ) {
	//	GetViewer2D(5)->RemoveRep((CAT2DRep *)_pImageRep);
	//	_pImageRep->Destroy(); _pImageRep = NULL;

	//	GetViewer2D(5)->Draw();
	//}


	//CATUnicodeString fullFilePath=CATUnicodeString("e:\\项目\\上汽商用车\\滑移门\\afterdlgFailed\\Test\\Example\\MyFrame\\CNext\\resources\\graphic\\icons\\normal\\上导轨.png");
	//CATPixelImage *pPixelImage=CATPixelImage::CreateFromFile(CATString(fullFilePath.ConvertToChar()));
	//if( !!pPixelImage ) {
	//	float positionCoord[2]={0.,0.};
	//	_pImageRep=new CAT2DImagePixelRep(positionCoord,pPixelImage,2);

	//	GetViewer2D(5)->AddRep((CAT2DRep *)_pImageRep);

	//	GetViewer2D(5)->Reframe();

	//	delete pPixelImage; pPixelImage = NULL;
	//}
	if (NULL!=_pBodySelLis2Agent)
	{
		_pBodySelLis2Agent->InitializeAcquisition();
	}



	return;
}


//-------------------------------------------------------------------------
// Callback on DiaCANCEL of _BodyDlg
//-------------------------------------------------------------------------
void TestCmd::OnBodyDlgDiaCANCELNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//RequestDelayedDestruction();
	if ( _HSO ) 
	{
		_HSO -> Empty();}
	if (_pBodyCancleAgent!=NULL)
	{
		_pBodyCancleAgent->InitializeAcquisition();
	}
	_BodyPanel->SetVisibility(CATDlgHide);

}
void TestCmd::OnBodyDlgDiaCloseNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//RequestDelayedDestruction();
	if ( _HSO ) 
	{
		_HSO -> Empty();}
	if (_pBodyCloseAgent!=NULL)
	{
		_pBodyCloseAgent->InitializeAcquisition();
	}
	_BodyPanel->SetVisibility(CATDlgHide);

}

//-------------------------------------------------------------------------
// Callback on DiaOK of _BodyDlg
//-------------------------------------------------------------------------
void TestCmd::OnBodyDlgDiaOKNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//RequestDelayedDestruction();
	if ( _HSO ) 
	{
		_HSO -> Empty();}
	if (_pBodyOKAgent!=NULL)
	{
		_pBodyOKAgent->InitializeAcquisition();
	}
	_BodyPanel->SetVisibility(CATDlgHide);



	CATUnicodeString  strSel1;
	_BodyPanel->_SelectorList006->GetLine(strSel1,0);
	CATUnicodeString  strSel2;
	_BodyPanel->_SelectorList007->GetLine(strSel2,0);
	CATUnicodeString  strSel3;
	_BodyPanel->_SelectorList007->GetLine(strSel3,1);
	CATUnicodeString  strSel4;
	_BodyPanel->_SelectorList007->GetLine(strSel4,2);

	if (strSel1!="未选择"&&strSel2!="未选择"&&strSel3!="未选择"&&strSel4!="未选择")//至少选择上中下三个轨道
	{
		_Panel->_SelectorList175->SetLine("已选完",0,CATDlgDataModify);

	}


}


//-------------------------------------------------------------------------
// Callback on DiaCLOSE of _BodyDlg
//-------------------------------------------------------------------------
//void TestCmd::OnBodyDlgDiaCLOSENotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
//{
//	// Add your code here
//	RequestDelayedDestruction();
//}

CATBoolean TestCmd::ChooseBody(void * date)
{
	cout<<"ChooseSurface函数中"<<endl;


	if (NULL!=_pBodyAgent)
	{
		CATBaseUnknown *pSelection = _pBodyAgent->GetElementValue();//_pBodyAgent->GetValue()

		_pBodyAgent->InitializeAcquisition();

		spBodyPrd=pSelection;


		CATIAlias_var aliasOnCurrentPrd = spBodyPrd ;
		if ( NULL_var != aliasOnCurrentPrd)
		{
			cout <<aliasOnCurrentPrd->GetAlias().ConvertToChar() ;
		}
		_BodyPanel->_SelectorList006->SetLine ( aliasOnCurrentPrd->GetAlias() ,0, CATDlgDataModify );//aliasOnCurrentPrd->GetAlias()
	}
	return TRUE;
}
CATBoolean TestCmd::ClearOneBodyPrd(void * date)
{
	_pdaClearSeat1Select->InitializeAcquisition();
	int iRow=0;

	int iTab=0;
	int numberSelected=0;

	numberSelected =_BodyPanel->_SelectorList007->GetSelect(&iTab,1);
	cout<<"所选行="<<numberSelected<<endl;
	iTab++;
	if (LISTProdOfBody.Size()>0)
		LISTProdOfBody.RemovePosition(iTab);

	_BodyPanel->_SelectorList007->ClearLine();
	if (LISTProdOfBody.Size()==0)//没有仪表板面了
	{
		_BodyPanel->_SelectorList007->SetLine("No Selection");
		_BodyPanel->_SelectorList007->SetSelect(&iRow,1);
	}
	else
	{
		for (int i = 1;i<=LISTProdOfBody.Size();i++)
			_BodyPanel->_SelectorList007->SetLine(CATIAlias_var(LISTProdOfBody[i])->GetAlias());
	}
	return TRUE;

}


CATBoolean TestCmd::ChooseBodyPart(void * date)
{
	cout<<"ChooseSurface函数中"<<endl;

	//_BodyPanel->_Label008->SetTitle("shangdaogui");
	//_BodyPanel->_Label008->Refresh();
	//_BodyPanel->Refresh();

	if (NULL!=_pBodyPartAgent)
	{
		CATBaseUnknown *pSelection = _pBodyPartAgent->GetElementValue();//_pBodyAgent->GetValue()

		_pBodyPartAgent->InitializeAcquisition();

		CATIProduct_var spBodyPrd=pSelection;

		LISTProdOfBody.Append(spBodyPrd);
		cout<<"NUMBER OF body part="<<LISTProdOfBody.Size()<<endl;

		CATIAlias_var aliasOnCurrentPrd = spBodyPrd ;
		if ( NULL_var != aliasOnCurrentPrd)
		{
			cout <<aliasOnCurrentPrd->GetAlias().ConvertToChar() ;
		}
		_BodyPanel->_SelectorList007->SetLine ( aliasOnCurrentPrd->GetAlias() ,LISTProdOfBody.Size()-1, CATDlgDataModify );//aliasOnCurrentPrd->GetAlias()
	}


	return TRUE;
}


void TestCmd::OnDoorSelectorList005ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//_SelectorList006->ClearSelect();
	if ( _HSO ) 
	{
		_HSO -> Empty();
	}
	if (_DoorPanel->_SelectorList006->IsSelect(0)==TRUE)
	{

		_DoorPanel->_SelectorList006->ClearSelect();
	}

	cout<<"点选selectlist05"<<endl;
	_DoorPanel->_Label007-> SetIconName("chemen");

	_DoorPanel->_Label007->Refresh();
	_DoorPanel->Refresh();

	//if( !!_pImageRep ) {
	//	GetViewer2D(6)->RemoveRep((CAT2DRep *)_pImageRep);
	//	_pImageRep->Destroy(); _pImageRep = NULL;

	//	GetViewer2D(6)->Draw();
	//}


	//CATUnicodeString fullFilePath=CATUnicodeString("e:\\项目\\上汽商用车\\滑移门\\afterdlgFailed\\Test\\Example\\MyFrame\\CNext\\resources\\graphic\\icons\\normal\\车门.png");
	//CATPixelImage *pPixelImage=CATPixelImage::CreateFromFile(CATString(fullFilePath.ConvertToChar()));
	//if( !!pPixelImage ) {
	//	float positionCoord[2]={0.,0.};
	//	_pImageRep=new CAT2DImagePixelRep(positionCoord,pPixelImage,2);

	//	GetViewer2D(6)->AddRep((CAT2DRep *)_pImageRep);

	//	GetViewer2D(6)->Reframe();

	//	delete pPixelImage; pPixelImage = NULL;
	//}

	if (NULL!=_pDoorelLis1Agent)
	{
		_pDoorelLis1Agent->InitializeAcquisition();
	}

	return;

}


//-------------------------------------------------------------------------
// Callback on ListSelect of _SelectorList006
//-------------------------------------------------------------------------
void TestCmd::OnDoorSelectorList006ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//_SelectorList005->ClearSelect();
	_DoorPanel->_Label007-> SetIconName("chemenjiaolian");
	_DoorPanel->_Label007->Refresh();
	_DoorPanel->Refresh();

	if ( _HSO ) 
	{
		_HSO -> Empty();
	}
	if (_DoorPanel->_SelectorList005->IsSelect(0)==TRUE)
	{

		_DoorPanel->_SelectorList005->ClearSelect();
	}
	cout<<"点选selectlist06"<<endl;
	//if( !!_pImageRep ) {
	//	GetViewer2D(6)->RemoveRep((CAT2DRep *)_pImageRep);
	//	_pImageRep->Destroy(); _pImageRep = NULL;

	//	GetViewer2D(6)->Draw();
	//}


	//CATUnicodeString fullFilePath=CATUnicodeString("e:\\项目\\上汽商用车\\滑移门\\afterdlgFailed\\Test\\Example\\MyFrame\\CNext\\resources\\graphic\\icons\\normal\\上导轨.png");
	//CATPixelImage *pPixelImage=CATPixelImage::CreateFromFile(CATString(fullFilePath.ConvertToChar()));
	//if( !!pPixelImage ) {
	//	float positionCoord[2]={0.,0.};
	//	_pImageRep=new CAT2DImagePixelRep(positionCoord,pPixelImage,2);

	//	GetViewer2D(6)->AddRep((CAT2DRep *)_pImageRep);

	//	GetViewer2D(6)->Reframe();

	//	delete pPixelImage; pPixelImage = NULL;
	//}


	if (NULL!=_pDoorSelLis2Agent)
	{
		_pDoorSelLis2Agent->InitializeAcquisition();
	}

	return;

}


//-------------------------------------------------------------------------
// Callback on DiaCANCEL of _DoorDlg
//-------------------------------------------------------------------------
void TestCmd::OnDoorDlgDiaCANCELNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//RequestDelayedDestruction();
	if ( _HSO ) 
	{
		_HSO -> Empty();}
	if (_pDoorCancleAgent!=NULL)
	{
		_pDoorCancleAgent->InitializeAcquisition();
	}
	_DoorPanel->SetVisibility(CATDlgHide);
}

void TestCmd::OnDoorDlgDiaCloseNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//RequestDelayedDestruction();
	if ( _HSO ) 
	{
		_HSO -> Empty();}
	if (_pDoorCloseAgent!=NULL)
	{
		_pDoorCloseAgent->InitializeAcquisition();
	}
	_DoorPanel->SetVisibility(CATDlgHide);
}

//-------------------------------------------------------------------------
// Callback on DiaOK of _DoorDlg
//-------------------------------------------------------------------------
void TestCmd::OnDoorDlgDiaOKNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	//RequestDelayedDestruction();
	if ( _HSO ) 
	{
		_HSO -> Empty();}
	if (_pDoorOKAgent!=NULL)
	{
		_pDoorOKAgent->InitializeAcquisition();
	}
	_DoorPanel->SetVisibility(CATDlgHide);



	CATUnicodeString  strSel1;
	_DoorPanel->_SelectorList005->GetLine(strSel1,0);
	CATUnicodeString  strSel2;
	_DoorPanel->_SelectorList006->GetLine(strSel2,0);
	CATUnicodeString  strSel3;
	_DoorPanel->_SelectorList006->GetLine(strSel3,1);
	CATUnicodeString  strSel4;
	_DoorPanel->_SelectorList006->GetLine(strSel4,2);

	if (strSel1!="未选择"&&strSel2!="未选择"&&strSel3!="未选择"&&strSel4!="未选择")//至少选择上中下三个轨道
	{
		_Panel->_SelectorList176->SetLine("已选完",0,CATDlgDataModify);

	}


}


//-------------------------------------------------------------------------
// Callback on DiaCLOSE of _DoorDlg
//-------------------------------------------------------------------------
//void TestCmd::OnDoorDlgDiaCLOSENotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
//{
//	// Add your code here
//	RequestDelayedDestruction();
//}
//




CATBoolean TestCmd::ChooseDoor(void * date)
{
	cout<<"ChooseDoor函数中"<<endl;

	if (NULL!=_pDoorAgent)
	{
		CATBaseUnknown *pSelection = _pDoorAgent->GetElementValue();//_pBodyAgent->GetValue()

		_pDoorAgent->InitializeAcquisition();

		spDoorPrd=pSelection;


		CATIAlias_var aliasOnCurrentPrd = spDoorPrd ;
		if ( NULL_var != aliasOnCurrentPrd)
		{
			cout <<aliasOnCurrentPrd->GetAlias().ConvertToChar() ;
		}
		_DoorPanel->_SelectorList005->SetLine ( aliasOnCurrentPrd->GetAlias() ,0, CATDlgDataModify );//aliasOnCurrentPrd->GetAlias()
	}

	return TRUE;
}
CATBoolean TestCmd::ClearOneDoorPrd(void * date)
{
	_pdaClearSeat2Select->InitializeAcquisition();
	int iRow=0;

	int iTab=0;
	int numberSelected=0;

	numberSelected =_DoorPanel->_SelectorList006->GetSelect(&iTab,1);
	cout<<"所选行="<<numberSelected<<endl;
	iTab++;
	if (LISTProdOfDoor.Size()>0)
		LISTProdOfDoor.RemovePosition(iTab);

	_DoorPanel->_SelectorList006->ClearLine();
	if (LISTProdOfDoor.Size()==0)//没有仪表板面了
	{
		_DoorPanel->_SelectorList006->SetLine("No Selection");
		_DoorPanel->_SelectorList006->SetSelect(&iRow,1);
	}
	else
	{
		for (int i = 1;i<=LISTProdOfDoor.Size();i++)
			_DoorPanel->_SelectorList006->SetLine(CATIAlias_var(LISTProdOfDoor[i])->GetAlias());
	}
	return TRUE;

}
CATBoolean TestCmd::ChooseDoorPart(void * date)
{
	cout<<"ChooseDoorPart函数中"<<endl;



	if (NULL!=_pDoorPartAgent)
	{
		CATBaseUnknown *pSelection = _pDoorPartAgent->GetElementValue();//_pBodyAgent->GetValue()

		_pDoorPartAgent->InitializeAcquisition();

		CATIProduct_var spBodyPrd=pSelection;

		LISTProdOfDoor.Append(spBodyPrd);
		cout<<"NUMBER OF body part="<<LISTProdOfDoor.Size()<<endl;

		CATIAlias_var aliasOnCurrentPrd = spBodyPrd ;
		if ( NULL_var != aliasOnCurrentPrd)
		{
			cout <<aliasOnCurrentPrd->GetAlias().ConvertToChar() ;
		}
		_DoorPanel->_SelectorList006->SetLine ( aliasOnCurrentPrd->GetAlias() ,LISTProdOfDoor.Size()-1, CATDlgDataModify );//aliasOnCurrentPrd->GetAlias()
	}

	if (LISTProdOfDoor.Size()==1)
	{
		_DoorPanel->_Label007-> SetIconName("chemenjiaolian");
		_DoorPanel->_Label007->Refresh();
		_DoorPanel->Refresh();
	}
	if (LISTProdOfDoor.Size()==2)
	{
		_DoorPanel->_Label007-> SetIconName("chemenjiaolian1");
		_DoorPanel->_Label007->Refresh();
		_DoorPanel->Refresh();
	}
	if (LISTProdOfDoor.Size()==3)
	{
		_DoorPanel->_Label007-> SetIconName("chemenjiaolian2");
		_DoorPanel->_Label007->Refresh();
		_DoorPanel->Refresh();
	}



	return TRUE;
}


CATBody_var TestCmd::GetBodyFromFeature(const CATISpecObject_var& ispFeature)
{
	CATBody_var spBody = NULL_var;
	do {
		if( !ispFeature ) {
			break;
		}
		CATIMfBRep_var spBRepOnFeature = ispFeature;
		if( !!spBRepOnFeature ) {
			spBody = spBRepOnFeature->GetBody();
		}
		else {
			CATIGeometricalElement_var spGeometricalElementOnFeature = ispFeature;
			if( !spGeometricalElementOnFeature ) {
				break;
			}
			spBody = spGeometricalElementOnFeature->GetBodyResult();
		}
		if( !spBody ) {
			break;
		}
	} while(FALSE);
	return spBody;


}


void TestCmd::get_xyz(double x1,double y1,double z1,
			 double x2,double y2,double z2,
			 double x3,double y3,double z3,
			 double x4,double y4,double z4,
			 double &x,double &y,double &z)//空间四点确定球心坐标(克莱姆法则)
{
	double a11,a12,a13,a21,a22,a23,a31,a32,a33,b1,b2,b3,d,d1,d2,d3;
	a11=2*(x2-x1); a12=2*(y2-y1); a13=2*(z2-z1);
	a21=2*(x3-x2); a22=2*(y3-y2); a23=2*(z3-z2);
	a31=2*(x4-x3); a32=2*(y4-y3); a33=2*(z4-z3);
	b1=x2*x2-x1*x1+y2*y2-y1*y1+z2*z2-z1*z1;
	b2=x3*x3-x2*x2+y3*y3-y2*y2+z3*z3-z2*z2;
	b3=x4*x4-x3*x3+y4*y4-y3*y3+z4*z4-z3*z3;
	d=a11*a22*a33+a12*a23*a31+a13*a21*a32-a11*a23*a32-a12*a21*a33-a13*a22*a31;
	d1=b1*a22*a33+a12*a23*b3+a13*b2*a32-b1*a23*a32-a12*b2*a33-a13*a22*b3;
	d2=a11*b2*a33+b1*a23*a31+a13*a21*b3-a11*a23*b3-b1*a21*a33-a13*b2*a31;
	d3=a11*a22*b3+a12*b2*a31+b1*a21*a32-a11*b2*a32-a12*a21*b3-b1*a22*a31;
	x=d1/d;
	y=d2/d;
	z=d3/d;
}
CATBoolean TestCmd::IsEndPt(CATVertex * VtToTest,CATEdge *EdgeContainVt, CATBody_var BodyContainEd  )
{

	CATBoolean isEnd=TRUE;
	CATMathVector datumVec=EvalTangentVec(VtToTest,(CATEdge *)EdgeContainVt);//第一个临边末端点的方向向量


	CATLISTP(CATCell) EdgeList;

	GetPtNeighborEdgeCells(VtToTest,BodyContainEd,EdgeList);

	CATTopGeoContinuity ContiOrNot;
	for(int currentCell=1; currentCell<=EdgeList.Size(); currentCell++)
	{

		CATEdge * piNeighborEdge=(CATEdge *)EdgeList[currentCell];


		VtToTest->EvalSharpness(EdgeContainVt,piNeighborEdge,ContiOrNot,NULL,NULL,NULL,5*CATPI/180);
		if (ContiOrNot==CATSmooth)
		{
			cout<<"找到相切的Edge\t"<<ContiOrNot<<endl;
				isEnd=FALSE;
				break;

			//CATLISTP(CATCell) EndPtcells;
			//piNeighborEdge->GetAllCells(EndPtcells, 0);
			//CATVertex * _pTempPtCell=(CATVertex *)EndPtcells[1];

			//if (_pTempPtCell==VtToTest)
			//{
			//	_pTempPtCell=(CATVertex *)EndPtcells[2];
			//}


			//CATMathVector NextVec=EvalTangentVec(_pTempPtCell,piNeighborEdge);//第一个临边末端点的方向向量
			//double angel=NextVec.GetAngleTo(datumVec);
			//cout<<"判断是否为终点 这个角度是："<<angel*180/CATPI<<endl;


			//if (angel*180/CATPI>30&&angel*180/CATPI<150)
			//{
			//	cout<<"角度偏移太大"<<endl;
			//	isEnd=TRUE;
			//	//break;


			//}
			//else
			//{
			//	isEnd=FALSE;
			//	break;

			//}





		}

		//if (ContiOrNot==CATSharp)
		//{
		//	cout<<"找到不相切的Edge\t"<<ContiOrNot<<endl;
		//	isSharp=TRUE;
		//	break;
		//}

	}


	return isEnd;


}
void TestCmd::GetPtNeighborEdgeCells( CATVertex * icell ,CATBody_var BodyToFindIn,CATLISTP(CATCell)&  oResult)
{

	CATLISTP(CATCell) BodyEdgecells;
	BodyToFindIn->GetAllCells(BodyEdgecells, 1);
	CATBoolean lying=FALSE;


	//CATLISTP(CATCell) NeighborEdgeCell;

	for(int currentCell=1; currentCell<=BodyEdgecells.Size(); currentCell++)
	{


		lying=((CATCell *)icell)->IsOnBorder(BodyEdgecells[currentCell]);

		if (lying)
		{
			//cout<<"找到一个所在边"<<endl;
			oResult.Append(BodyEdgecells[currentCell]);

		}
	}
	//cout<<"临边个数"<<oResult.Size()<<endl;



}

void TestCmd::GetNeighborFace(CATFace * iTheFaceBody,CATBody_var BodyContainFace,CATLISTP(CATCell)&  oResultFace)
{
	//CATLISTP(CATCell) Facecells;
	//iTheFaceBody->GetAllCells(Facecells, 2);
	//cout<<"NUMBER OF face CELL="<<Edcells.Size()<<endl;

	CATLISTP(CATCell) FaceBoundingcells;
	iTheFaceBody->GetAllCells(FaceBoundingcells, 1);


	CATCell* pSelFaceCell=iTheFaceBody;


	//CATLISTP(CATCell) NeighborFaceCell;



	for(int currentCell=1; currentCell<=FaceBoundingcells.Size(); currentCell++)
	{
		CATCell* _piLineCell=FaceBoundingcells[currentCell];
		CATEdge * _piTempFaceEdge=(CATEdge *)_piLineCell;

		CATCell *pNeighborCell=pSelFaceCell->GetNeighborCell(_piTempFaceEdge,BodyContainFace);//得到与选面相邻的面

		oResultFace.Append(pNeighborCell);

	}


}


CATMathVector TestCmd::EvalTangentVec(CATVertex *EndPt,CATEdge *EdgeContainPt)
{


	CATPointOnEdgeCurve * PointOnEdgeCurve= EndPt->GetGeometryOnEdge(EdgeContainPt);

	CATEdgeCurve* edgeCurve=EdgeContainPt->GetCurve();

	CATCrvParam a;
	PointOnEdgeCurve->GetParamOn((CATCurve *)edgeCurve,a);

	double b=a.GetParam();
	//cout<<"参数值为："<<b<<endl;

	CATMathVector TangVec;
	EdgeContainPt->EvalTangent(a,TangVec);
	//TangVec.Dump();
	return TangVec;
}

CATFace * TestCmd::GetNextFace(CATFace * &ioStartFace,CATEdge * &ioConnectEdge,CATVertex * &ioConnectPt,CATBody_var BodyContainFace)
{

	if (BodyContainFace==NULL_var)
	{
		cout<<"BodyContainFace为空"<<endl;
		return NULL;
	}
	//*a=*a+1;

	cout<<"进入GetNextFace"<<endl;

	CATMathVector datumVec=EvalTangentVec(ioConnectPt,ioConnectEdge);
	datumVec.Dump();

	CATLISTP(CATCell) NeighborEdgeCell;
	GetPtNeighborEdgeCells(ioConnectPt,BodyContainFace,NeighborEdgeCell);
	cout<<"点的临边个数"<<NeighborEdgeCell.Size()<<endl;


	CATCell* NextConnectEdgeCell=NULL;//得到与输入edge相邻边但不一定为下一条边 有可能是下一长边中的第一段
	for(int currentCell=1; currentCell<=NeighborEdgeCell.Size(); currentCell++)
	{

		if (NeighborEdgeCell[currentCell]==NULL)
		{
			cout<<"NeighborEdgeCell[currentCell]==NULL"<<endl;
			continue;
		}




		CATMathVector tempVec=EvalTangentVec(ioConnectPt,(CATEdge *)NeighborEdgeCell[currentCell]);
		double angel=tempVec.GetAngleTo(datumVec);

		cout<<"角度是："<<angel*180/CATPI<<endl;
		if (angel*180/CATPI<1||fabs(angel*180/CATPI-180)<1)//angel*180/CATPI  (angel*180/CATPI<1||fabs(angel*180/CATPI-180)<1)
		{
			cout<<"有平行"<<endl;
		}
		if ((angel*180/CATPI<1||fabs(angel*180/CATPI-180)<1)&&(NeighborEdgeCell[currentCell]!=ioConnectEdge))//(tempVec==datumVec)
		{

			cout<<"2"<<endl;

			NextConnectEdgeCell=NeighborEdgeCell[currentCell];
		}


	}











//oConnectEdge=(CATEdge *)NextConnectEdgeCell;

double lengthofneighbor=ioConnectEdge->CalcLength();
cout<<"长度为："<<lengthofneighbor<<endl;

       if (NULL==NextConnectEdgeCell)
       {
		   cout<<"没找到相切临边"<<endl;
		   return NULL;
       }



	CATLISTP(CATCell) EndPtcells;
	NextConnectEdgeCell->GetAllCells(EndPtcells, 0);
	CATVertex * _pPostConnectPtCell=(CATVertex *)EndPtcells[1];//下一条短边的下一个端点

	if (_pPostConnectPtCell==ioConnectPt)
	{
		_pPostConnectPtCell=(CATVertex *)EndPtcells[2];
	}









	CATLISTP(CATCell) NeighborFaceCell;

	GetNeighborFace(ioStartFace,BodyContainFace,NeighborFaceCell);
	cout<<"相邻面的个数："<<NeighborFaceCell.Size()<<endl;

	cout<<"444"<<endl;

	CATFace *pSecFace=NULL;
	for(int currentCell=1; currentCell<=NeighborFaceCell.Size(); currentCell++)
	{

		double mianji=0;
		if (NeighborFaceCell[currentCell]==NULL)
		{
			cout<<"NeighborFaceCell[currentCell]==NULL"<<endl;//这里因为在选择单片体面的时候list中有的值为空，判断为空的话就找下一个
			continue;
		}
		CATFace * thisface=(CATFace *)NeighborFaceCell[currentCell];

		if (NULL==thisface)
		{
			cout<<"thisface为空！"<<endl;
			return NULL;
		}
		mianji=thisface->CalcArea();
		cout<<"area："<<mianji<<endl;


		CATLISTP(CATCell) FaceEdgecells;
		NeighborFaceCell[currentCell]->GetAllCells(FaceEdgecells, 1);
		//cout<<"这个相邻面包含的拓扑线数目："<<FaceEdgecells.Size()<<endl;
		for(int j=1; j<=FaceEdgecells.Size(); j++)
		{
			if (NextConnectEdgeCell==FaceEdgecells[j])
			{
				cout<<"找到所依附的面"<<endl;
				//RailFacecells.Append(NeighborFaceCell[currentCell]);
				pSecFace=(CATFace *)NeighborFaceCell[currentCell];

				//CATIBRepAccess_var spBRepEdge = CATBRepDecodeCellInBody( NeighborFaceCell[currentCell], BodyContainFace );


				double mianji=0;
				mianji= pSecFace->CalcArea();
				cout<<"得到面积是："<<mianji<<endl;
				//CATIFeaturize_var FCell = spBRepEdge;
				//CATISpecObject_var spSpecFace = FCell->FeaturizeR( MfPermanentBody|	MfLastFeatureSupport | 	MfRelimitedFeaturization);
				//ObjectUpdate(spSpecFace);

				//CATIGSMExtractSolide_var spExtractSurface003 = pGSMFact->CreateExtractSolide(spSpecFace, ExtractSolide_NoPropag);
				//CATISpecObject_var NewExSurface003 = spExtractSurface003;
				//ObjectUpdate(NewExSurface003);
				//InsertInProceduralView(NewExSurface003,spGSMToolUpRotate);





			}
		}



	}


	//得到下一个面之后，从这个面的edge中找到轨道方向上的最后一个edge，针对T字形拓扑线结构，并且得到末端点

	CATLISTP(CATCell) FaceEdgecells;
	pSecFace->GetAllCells(FaceEdgecells, 1);
	cout<<"这个相邻面包含的拓扑线数目："<<FaceEdgecells.Size()<<endl;



	CATTopGeoContinuity ContiOrNot;

	CATBoolean IsEnd=FALSE;
	while (FALSE==IsEnd)
	{

		cout<<"开始循环1~~~~~~~~~~~~~~~~~~~~~~~~~~~~"<<endl;
			CATMathVector datumVec=EvalTangentVec(_pPostConnectPtCell,(CATEdge *)NextConnectEdgeCell);//第一个临边末端点的方向向量

		for(int currentCell=1; currentCell<=FaceEdgecells.Size(); currentCell++)
		{



			if (((CATCell *)_pPostConnectPtCell)->IsOnBorder(FaceEdgecells[currentCell])&&FaceEdgecells[currentCell]!=NextConnectEdgeCell)//可以加上  &&FaceEdgecells[currentCell]！=NextConnectEdgeCell
			{

				_pPostConnectPtCell->EvalSharpness((CATEdge *)NextConnectEdgeCell,(CATEdge *)FaceEdgecells[currentCell],ContiOrNot,NULL,NULL,NULL,5*CATPI/180);
				if (ContiOrNot==CATSmooth)//判断下一个相邻边末端点的向量是否与前一个差距太大，排除末端有倒圆特征的情况
				{




					CATEdge * _ptempEdge=NULL;
					cout<<"此Edge不是最后一个edge\t"<<ContiOrNot<<endl;
					_ptempEdge=(CATEdge *)FaceEdgecells[currentCell];
					CATLISTP(CATCell) EndPtcells;
					_ptempEdge->GetAllCells(EndPtcells, 0);
					CATVertex * _pTempPtCell=(CATVertex *)EndPtcells[1];

					if (_pTempPtCell==_pPostConnectPtCell)
					{
						_pTempPtCell=(CATVertex *)EndPtcells[2];
					}

					//_pPostConnectPtCell=_pTempPtCell;




					CATMathVector NextVec=EvalTangentVec(_pTempPtCell,_ptempEdge);//第一个临边末端点的方向向量
					double angel=NextVec.GetAngleTo(datumVec);
					cout<<"这个角度是1："<<angel*180/CATPI<<endl;


					if (angel*180/CATPI>30&&angel*180/CATPI<150)
					{
						cout<<"角度偏移太大"<<endl;
						IsEnd=TRUE;
						break;


					}
					else
					{
						cout<<"找到下一个面内临边"<<endl;
						_pPostConnectPtCell=_pTempPtCell;
						NextConnectEdgeCell=_ptempEdge;
						break;

					}





				}
				else
					IsEnd=TRUE;

			}



		}
		cout<<"结束循环1~~~~~~~~~~~~~~~~~~~~~~~~~~~~"<<endl;

	}

ioConnectPt=_pPostConnectPtCell;
ioConnectEdge=(CATEdge *)NextConnectEdgeCell;



return pSecFace;

}
void TestCmd::HideSpecObj(CATISpecObject_var ispSObject)
{
	CATIVisPropertiesAbstract *spVisButton = NULL;
	//	CATIVisProperties_var spVisButton = ispSObject;
	HRESULT rc = ispSObject->QueryInterface(IID_CATIVisProperties,(void **)& spVisButton);
	if (SUCCEEDED(rc))
	{
		CATVisPropertiesValues VisPropertySign;
		VisPropertySign.SetShowAttr(CATNoShowAttr);	
		spVisButton -> SetPropertiesAtt(VisPropertySign, CATVPShow, CATVPGlobalType, 0, 0);
		spVisButton -> Release();
		spVisButton = NULL;
	}	
}
HRESULT TestCmd::SJDOutputInheritanceStructure(CATISpecObject_var ispiSpecOnObject)
{
	HRESULT rc=E_FAIL;

	if( !ispiSpecOnObject ) return rc;

	CATIInstance_var spiInstance=ispiSpecOnObject;

	CATIType *piType=NULL;
	if( !!spiInstance ) { piType = spiInstance->Type(); }

	CATUnicodeString outResult;
	if( !!piType ) {
		CATIType *piSuperType=NULL;
		CATUnicodeString typeName;
		do {
			typeName = piType->Name();
			piSuperType = piType->SuperType();

			piType->Release();  piType = NULL;

			if( !!piSuperType )
				outResult = outResult + typeName + CATUnicodeString(" -> ");
			else
				outResult = outResult + typeName;

			piType = piSuperType;

		}while( !!piType );

		rc = S_OK;
	}
	else { outResult = "* No Found *"; }

	cout << outResult.ConvertToChar() << endl;

	return rc;
}



HRESULT TestCmd::SJDOutputSpecObjectAllAttributes(CATISpecObject_var ispiSpecObject)
{
	HRESULT rc=E_FAIL;

	if( !ispiSpecObject ) return rc;

	//Get the type and super type
	CATUnicodeString strTypeOfSpecObject,strSuperTypeOfSpecObject;
	strTypeOfSpecObject = ispiSpecObject->GetType();
	strSuperTypeOfSpecObject = ispiSpecObject->GetSuperType();
	cout << "== > Type: " << strTypeOfSpecObject.ConvertToChar() << ", Super Type: " << strSuperTypeOfSpecObject.ConvertToChar() << endl;

	CATListValCATUnicodeString *listAttName=NULL;
	CATISpecAttrAccess_var spiSpecAccess=ispiSpecObject;
	if( !!spiSpecAccess ) { listAttName = spiSpecAccess->ListAttrNames(); }

	if( !listAttName || listAttName->Size() < 1 ) return rc;

	CATUnicodeString attName;
	CATUnicodeString attValue;
	CATUnicodeString strAttType;
	CATUnicodeString strAttQuality;
	CATAttrKind attType;
	CATAttrInOut attQuality;
	CATISpecAttrKey *piAttKey=NULL;

	//octet octValue;
	CATBoolean boolValue;
	CATISpecObject *piSpecObject=NULL;
	CATIAlias_var spiAlias=NULL_var;

	//For external object
	CATILinkableObject *piLinkObject=NULL;
	CATDocument *pDocLinked=NULL;

	for(int i=1;i<=listAttName->Size();i++) {
		attName = (*listAttName)[i];
		piAttKey = spiSpecAccess->GetAttrKey(attName.ConvertToChar());
		if( !piAttKey ) continue;

		//Get Quality of the attribute
		attQuality = spiSpecAccess->GetQuality(piAttKey);
		strAttQuality = SJDChangeAttributeQualityToString(attQuality);

		//Get type of the attribute
		attType = piAttKey->GetType();
		strAttType = SJDChangeAttributeTypeToString(attType);

		//Get value of the attribute
		attValue = " ";
		if( attType == tk_double ) {
			attValue.BuildFromNum(spiSpecAccess->GetDouble(piAttKey));
		}
		else if( attType == tk_string ) {
			attValue = spiSpecAccess->GetString(piAttKey);
		}
		else if( attType == tk_integer ) {
			attValue.BuildFromNum(spiSpecAccess->GetInteger(piAttKey));
		}
		else if( attType == tk_octet ) {
			//octValue = spiSpecAccess->GetOctet(piAttKey);
			//attValue = octValue;
		}
		else if( attType == tk_boolean ) {
			boolValue = spiSpecAccess->GetBoolean(piAttKey);
			if( TRUE == boolValue )
				attValue = "TRUE";
			else
				attValue = "FALSE";
		}
		else if( attType == tk_specobject ) {
			piSpecObject = spiSpecAccess->GetSpecObject(piAttKey);
			spiAlias = piSpecObject;
			if( !!spiAlias ) {
				attValue = spiAlias->GetAlias();
			}
			if( !!piSpecObject ) {
				piSpecObject->Release();  piSpecObject = NULL;
			}
		}
		else if( attType == tk_component ) {
			piSpecObject = spiSpecAccess->GetSpecObject(piAttKey);
			spiAlias = piSpecObject;
			if( !!spiAlias ) {
				attValue = spiAlias->GetAlias();
			}
			if( !!piSpecObject ) {
				piSpecObject->Release();  piSpecObject = NULL;
			}
		}
		else if( attType == tk_list ) {
			attType = spiSpecAccess->GetListType(piAttKey);
			strAttType = strAttType + CATUnicodeString(" -> ") + SJDChangeAttributeTypeToString(attType);

			attValue = SJDGetAttributeListValue(spiSpecAccess,piAttKey);
		}
		else if( attType == tk_external ) {
			/*rc = spiSpecAccess->GetExternalObject(piAttKey,CATFlavorParam::ANYWHERE,&piLinkObject);
			if( SUCCEEDED(rc) && !!piLinkObject ) {
			pDocLinked = piLinkObject->GetDocument();
			if( !!pDocLinked )
			attValue = pDocLinked->StorageName();
			else
			cout << "==> GeneralClass: Get LinkObject error !" << endl;
			piLinkObject->Release();  piLinkObject = NULL;
			}
			else
			cout << "==> GeneralClass: Get ExternalObject error !" << endl;*/
		}
		piAttKey->Release();  piAttKey = NULL;

		cout << "  ==> Attribute name: " << attName.ConvertToChar() << endl;
		cout << "    Value  : " << attValue.ConvertToChar() << endl;
		cout << "    Type   : " << strAttType.ConvertToChar() << endl;
		cout << "    Quality: " << strAttQuality.ConvertToChar() << endl;
	}

	delete listAttName;  listAttName = NULL;

	return rc;
}

CATUnicodeString TestCmd::SJDChangeAttributeTypeToString(CATAttrKind iAttType)
{
	CATUnicodeString attTypeString(" ");
	if( iAttType == tk_double )
		attTypeString = "tk_double";
	else if( iAttType == tk_string )
		attTypeString = "tk_string";
	else if( iAttType == tk_integer )
		attTypeString = "tk_integer";
	else if( iAttType == tk_octet )
		attTypeString = "tk_octet";
	else if( iAttType == tk_boolean )
		attTypeString = "tk_boolean";
	else if( iAttType == tk_specobject )
		attTypeString = "tk_specobject";
	else if( iAttType == tk_component )
		attTypeString = "tk_component";
	else if( iAttType == tk_list )
		attTypeString = "tk_list";
	else if( iAttType == tk_external )
		attTypeString = "tk_external";

	return attTypeString;
}

CATUnicodeString TestCmd::SJDChangeAttributeQualityToString(CATAttrInOut iAttQuality)
{
	CATUnicodeString attQualityString(" ");

	if( iAttQuality == sp_IN )
		attQualityString = "sp_IN";
	else if( iAttQuality == sp_OUT )
		attQualityString = "sp_OUT";
	else if( iAttQuality == sp_NEUTRAL )
		attQualityString = "sp_NEUTRAL";
	else
		attQualityString = "* Unknown *";

	return attQualityString;
}

CATUnicodeString TestCmd::SJDGetAttributeListValue(CATISpecAttrAccess_var ispiAttrAccess,CATISpecAttrKey_var ispiAttrKey)
{
	CATUnicodeString attValue(" ");

	//Check the input parameters
	if( !ispiAttrAccess || !ispiAttrKey ) return attValue;

	//Get the size of list
	int numValue=ispiAttrAccess->GetListSize(ispiAttrKey);
	if( numValue < 1 ) return attValue;

	//Get the type of the list attribute
	CATAttrKind attType=ispiAttrAccess->GetListType(ispiAttrKey);

	CATUnicodeString tmpValue;
	if( attType == tk_double ) {
		double dValue;
		for(int i=1;i<=numValue;i++) {
			dValue = ispiAttrAccess->GetDouble(ispiAttrKey,i);
			tmpValue.BuildFromNum(dValue);
			if( i ==  1 )
				attValue = tmpValue;
			else
				attValue = attValue + CATUnicodeString(",") + tmpValue;
		}
	}
	else if( attType == tk_string ) {
		for(int i=1;i<=numValue;i++) {
			tmpValue = ispiAttrAccess->GetString(ispiAttrKey,i);
			if( i ==  1 )
				attValue = tmpValue;
			else
				attValue = attValue + CATUnicodeString(",") + tmpValue;
		}
	}
	else if( attType == tk_integer ) {
		int iValue;
		for(int i=1;i<=numValue;i++) {
			iValue = ispiAttrAccess->GetInteger(ispiAttrKey,i);
			tmpValue.BuildFromNum(iValue);
			if( i ==  1 )
				attValue = tmpValue;
			else
				attValue = attValue + CATUnicodeString(",") + tmpValue;
		}
	}
	else if( attType == tk_octet ) {
		//octValue = spiSpecAccess->GetOctet(piAttKey);
		//attValue = octValue;
	}
	else if( attType == tk_boolean ) {
		CATBoolean bValue;
		for(int i=1;i<=numValue;i++) {
			bValue = ispiAttrAccess->GetInteger(ispiAttrKey,i);
			if( bValue == TRUE )
				tmpValue = "True";
			else
				tmpValue = "False";
			if( i ==  1 )
				attValue = tmpValue;
			else
				attValue = attValue + CATUnicodeString(",") + tmpValue;
		}
	}
	else if( attType == tk_specobject || attType == tk_component ) {
		CATISpecObject *piSpecObj=NULL;
		CATIAlias_var spiAlais=NULL_var;
		for(int i=1;i<=numValue;i++) {
			piSpecObj = ispiAttrAccess->GetSpecObject(ispiAttrKey,i);
			if( !piSpecObj ) continue;

			spiAlais = piSpecObj;
			tmpValue = spiAlais->GetAlias();

			piSpecObj->Release();  piSpecObj = NULL;

			if( i ==  1 )
				attValue = tmpValue;
			else
				attValue = attValue + CATUnicodeString(",") + tmpValue;
		}
	}
	else if( attType == tk_external ) {
	}

	return attValue;
}

void  TestCmd::CreatePointCurveJoint(CATISpecObject_var spPoint,CATIProduct * piInstanceProdOnPoint,CATISpecObject_var spCurve,CATIProduct * piInstanceProdOnCurve,CATBoolean WeatherMiddleRail)
{

	//创建机构

	CATLISTP(CATBaseUnknown) iConnectorList;

	//piInstanceProdOnRotate


	CATBaseUnknown* papiUnknownOnLineConnector2 = NULL;

	CATILinkableObject *pLinkRotateCenter = NULL;

	if( spPoint != NULL_var )
	{
		HRESULT rc = spPoint->QueryInterface(IID_CATILinkableObject ,(void **) &pLinkRotateCenter);
		if ( SUCCEEDED(rc) ) 
		{
			CATIConnector* spConnectorOnCenter = NULL;
			int xCreation = 0;

			HRESULT hr = ::GetProductConnector(pLinkRotateCenter, piInstanceProdOnPoint, spRootProduct, 0, spConnectorOnCenter, xCreation);
			if (SUCCEEDED(hr))
			{
				cout<<"成功生成RotateCenter connector"<<endl;
			}

			//old: GetProductConnector(spLinkableOnLine,(*pProductList)[i],spRootProduct);//
			if (spConnectorOnCenter)
			{
				cout<<"得到spConnectorOnCenter"<<endl;

				// Store the connector as a CATBaseUnknown
				HRESULT HR = spConnectorOnCenter->QueryInterface(IID_CATBaseUnknown, (void**)&papiUnknownOnLineConnector2);
				iConnectorList.Append(papiUnknownOnLineConnector2);
				papiUnknownOnLineConnector2->Release();
				papiUnknownOnLineConnector2 = NULL;
			}

		}
	}


	CATBaseUnknown* papiUnknownOnLineConnector = NULL;

	CATILinkableObject *pLinkRunningCurve = NULL;

	if( spCurve != NULL_var )
	{
		HRESULT rc = spCurve->QueryInterface(IID_CATILinkableObject ,(void **) &pLinkRunningCurve);
		if ( SUCCEEDED(rc) ) 
		{
			CATIConnector* spConnectorOnLine = NULL;
			int xCreation = 0;

			HRESULT HR =::GetProductConnector(pLinkRunningCurve, piInstanceProdOnCurve, spRootProduct, 0, spConnectorOnLine, xCreation);
			//old: GetProductConnector(spLinkableOnLine,(*pProductList)[i],spRootProduct);//
			if (spConnectorOnLine)
			{
				cout<<"得到spConnectorOnLine0"<<endl;
				// Store the connector as a CATBaseUnknown
				HR = spConnectorOnLine->QueryInterface(IID_CATBaseUnknown, (void**)&papiUnknownOnLineConnector);
				iConnectorList.Append(papiUnknownOnLineConnector);
				papiUnknownOnLineConnector->Release();
				papiUnknownOnLineConnector = NULL;
			}

		}
	}





	//cout<<"connecter数目："<<iConnectorList.Size()<<endl;
	//CATIKinMechanism* piMechanism = NULL;
	//CATIKinMechanismFactory* piDocumentAsMechanismFactory = NULL;
	//if (SUCCEEDED(pDoc->QueryInterface(IID_CATIKinMechanismFactory, (void**)&piDocumentAsMechanismFactory)))
	//{
	//	if (SUCCEEDED(piDocumentAsMechanismFactory->CreateInstance(&piMechanism)))
	//	{

			//====================================================================================
			// 5 - Create the joint
			//====================================================================================

			// Cylindrical joint from connectors
			CATIKinJoint* piJoint = NULL;
			const char* jointType = CATKinPointCurveJoint;
			boolean iCreateConstraintsForJoint = 1;
			if (SUCCEEDED(piMechanism->AddJoint(jointType,&iConnectorList, iCreateConstraintsForJoint, &piJoint))&&WeatherMiddleRail==TRUE)
			{

				//============================================================================
				// 6 - Create the length command
				//============================================================================
				CATIKinCmd* piCmd = NULL;
				const char* cmdType = CATKinLengthCmd;
				if (SUCCEEDED(piMechanism->AddCommand(piJoint, cmdType, &piCmd)))
				{
					cout<<"成功添加命令"<<endl;
					piCmd->Release();
					piCmd = NULL;
				}
				piJoint->Release();
				piJoint = NULL;
			}


			//====================================================================================
			// 7 - Create the fixed product
			//====================================================================================
			//boolean iCreateConstraintsForFixed = 1;
			//HRESULT HR = piMechanism->SetFixedProduct(piInstanceProdOnUpRollingFace,iCreateConstraintsForFixed);
			//piFixedProduct->Release();
			//piFixedProduct = NULL;
	//		piMechanism->Release();
	//		piMechanism = NULL;
	//	}
	//	piDocumentAsMechanismFactory->Release();
	//	piDocumentAsMechanismFactory = NULL;
	//}

	//piDocRootsOnDocument->Release();
	//piDocRootsOnDocument = NULL;






}


void TestCmd::CreatePointSurfaceJoint(CATISpecObject_var spPoint,CATIProduct * piInstanceProdOnPoint,CATISpecObject_var spSurface,CATIProduct * piInstanceProdOnSurface)
{

	//创建机构

	CATLISTP(CATBaseUnknown) iConnectorList;

	//piInstanceProdOnRotate


	CATBaseUnknown* papiUnknownOnLineConnector2 = NULL;

	CATILinkableObject *pLinkRotateCenter = NULL;

	if( spPoint != NULL_var )
	{
		HRESULT rc = spPoint->QueryInterface(IID_CATILinkableObject ,(void **) &pLinkRotateCenter);
		if ( SUCCEEDED(rc) ) 
		{
			CATIConnector* spConnectorOnCenter = NULL;
			int xCreation = 0;

			HRESULT hr = ::GetProductConnector(pLinkRotateCenter, piInstanceProdOnPoint, spRootProduct, 0, spConnectorOnCenter, xCreation);
			if (SUCCEEDED(hr))
			{
				cout<<"成功生成RotateCenter connector"<<endl;
			}

			//old: GetProductConnector(spLinkableOnLine,(*pProductList)[i],spRootProduct);//
			if (spConnectorOnCenter)
			{
				cout<<"得到spConnectorOnCenter"<<endl;

				// Store the connector as a CATBaseUnknown
				HRESULT HR = spConnectorOnCenter->QueryInterface(IID_CATBaseUnknown, (void**)&papiUnknownOnLineConnector2);
				iConnectorList.Append(papiUnknownOnLineConnector2);
				papiUnknownOnLineConnector2->Release();
				papiUnknownOnLineConnector2 = NULL;
			}

		}
	}


	CATBaseUnknown* papiUnknownOnLineConnector = NULL;

	CATILinkableObject *pLinkRunningSurface = NULL;

	if( spSurface != NULL_var )
	{
		HRESULT rc = spSurface->QueryInterface(IID_CATILinkableObject ,(void **) &pLinkRunningSurface);
		if ( SUCCEEDED(rc) ) 
		{
			CATIConnector* spConnectorOnLine = NULL;
			int xCreation = 0;

			HRESULT HR =::GetProductConnector(pLinkRunningSurface, piInstanceProdOnSurface, spRootProduct, 0, spConnectorOnLine, xCreation);
			//old: GetProductConnector(spLinkableOnLine,(*pProductList)[i],spRootProduct);//
			if (spConnectorOnLine)
			{
				cout<<"得到spConnectorOnLine4"<<endl;
				// Store the connector as a CATBaseUnknown
				HR = spConnectorOnLine->QueryInterface(IID_CATBaseUnknown, (void**)&papiUnknownOnLineConnector);
				cout<<"1"<<endl;

				iConnectorList.Append(papiUnknownOnLineConnector);
				cout<<"2"<<endl;

				papiUnknownOnLineConnector->Release();
				cout<<"3"<<endl;

				papiUnknownOnLineConnector = NULL;
				cout<<"4"<<endl;

			}

		}
	}





	//cout<<"connecter数目："<<iConnectorList.Size()<<endl;
	//CATIKinMechanism* piMechanism = NULL;
	//CATIKinMechanismFactory* piDocumentAsMechanismFactory = NULL;
	//if (SUCCEEDED(pDoc->QueryInterface(IID_CATIKinMechanismFactory, (void**)&piDocumentAsMechanismFactory)))
	//{
	//	if (SUCCEEDED(piDocumentAsMechanismFactory->CreateInstance(&piMechanism)))
	//	{

			//====================================================================================
			// 5 - Create the joint
			//====================================================================================

			// Cylindrical joint from connectors
			CATIKinJoint* piJoint = NULL;
			const char* jointType = CATKinPointSurfaceJoint;
			boolean iCreateConstraintsForJoint = 1;

			cout<<"5"<<endl;
			piMechanism->AddJoint(jointType,&iConnectorList, iCreateConstraintsForJoint, &piJoint);
			cout<<"5.1"<<endl;
			if (!!piJoint)
			{
				cout<<"6"<<endl;



				//============================================================================
				// 6 - Create the length command
				//============================================================================
				CATIKinCmd* piCmd = NULL;
				const char* cmdType = CATKinLengthCmd;
				if (SUCCEEDED(piMechanism->AddCommand(piJoint, cmdType, &piCmd)))
				{
					cout<<"成功添加命令"<<endl;
					piCmd->Release();
					piCmd = NULL;
				}

				// Get the parameters of the joint
				double* parm = NULL;
				int oSize = 0;

				piJoint->GetJointValues(&parm,&oSize);
				cout<<"osize="<<oSize<<endl;
				piJoint->Release();
				piJoint = NULL;
			}


			//====================================================================================
			// 7 - Create the fixed product
			//====================================================================================
			//boolean iCreateConstraintsForFixed = 1;
			//HRESULT HR = piMechanism->SetFixedProduct(piInstanceProdOnUpRollingFace,iCreateConstraintsForFixed);
			//piFixedProduct->Release();
			//piFixedProduct = NULL;
	//		piMechanism->Release();
	//		piMechanism = NULL;
	//	}
	//	piDocumentAsMechanismFactory->Release();
	//	piDocumentAsMechanismFactory = NULL;
	//}

	//piDocRootsOnDocument->Release();
	//piDocRootsOnDocument = NULL;



}




void TestCmd::CalRunningEle(CATISpecObject_var ispSpecRotate,CATIProduct *InstancePrdOnRotate,CATIProduct *InstancePrdOnRail,CATISpecObject_var ispSpecRailSurface,CATISpecObject_var spiRollingSpcOnRail,CATISpecObject_var& ospRotateCenter,CATISpecObject_var& ospRunningEle,CATBoolean CurveOrSur)//1代表curve
{

	CATIPrtContainer_var spUpRotateCon=GetConFromInstancePrd(InstancePrdOnRotate);
	CATIGSMFactory* pGSMFactOnUpRotate=NULL;
	HRESULT rc=spUpRotateCon->QueryInterface(IID_CATIGSMFactory,(void**)&pGSMFactOnUpRotate);
	if (FAILED(rc)) {cout<<"通过新建Part的Container查询CATIGSMFactory 失败"<<endl;}


	CATICkeParmFactory_var spParmFactoryOnUpRotate=NULL_var;
	rc=spUpRotateCon->QueryInterface(IID_CATICkeParmFactory,(void**)&spParmFactoryOnUpRotate);
	//CATIParmDictionary_var spParamDict = CATCkeGlobalFunctions::GetParmDictionary();


	CATIGSMTool_var spGSMToolUpRotate=CreateGSMTool("滚轮中心",spUpRotateCon);





	CATBody_var TopRotateBody=GetBodyFromFeature(ispSpecRotate);
	CATLISTP(CATCell) IntersecFccells;
	TopRotateBody->GetAllCells(IntersecFccells, 2);
	cout<<"NUMBER OF PtCELL="<<IntersecFccells.Size()<<endl;



	CATCell* pFaceCell=IntersecFccells[1];
	CATFace* pFace=(CATFace*)pFaceCell;
	CATSurface* pSurface=pFace->GetSurface(NULL);
	CATSurParam* pSurEndParm =new CATSurParam();
	CATSurParam* pSurStartParm =new CATSurParam();
	pSurface->GetEndLimit(*pSurEndParm);
	pSurface->GetStartLimit(*pSurStartParm);
	double EndParamU=pSurEndParm->GetParamU();
	double EndParamV=pSurEndParm->GetParamV();
	double StartParamU=pSurStartParm->GetParamU();
	double StartParamV=pSurStartParm->GetParamV();




	CATMathPoint PtOnSp1;
	CATMathPoint PtOnSp2;
	CATMathPoint PtOnSp3;
	CATMathPoint PtOnSp4;
	double CoodOfPt[12]={0,0,0,0,0,0,0,0,0,0,0,0};

	CATSurParam* pSurParm =new CATSurParam();
	*pSurParm=pSurface->CreateParam(StartParamU,StartParamV);// (EndParamU-StartParamU)/3+  (EndParamV-StartParamV)/3+
	pSurface->EvalPoint(*pSurParm,PtOnSp1);
	PtOnSp1.GetCoord(CoodOfPt[0],CoodOfPt[1],CoodOfPt[2]);




	*pSurParm=pSurface->CreateParam((EndParamU-StartParamU)*2/3+StartParamU,(EndParamV-StartParamV)/3+StartParamV);//   
	pSurface->EvalPoint(*pSurParm,PtOnSp2);
	PtOnSp2.GetCoord(CoodOfPt[3],CoodOfPt[4],CoodOfPt[5]);



	*pSurParm=pSurface->CreateParam((EndParamU-StartParamU)/3+StartParamU,(EndParamV-StartParamV)*2/3+StartParamV);//   
	pSurface->EvalPoint(*pSurParm,PtOnSp3);
	PtOnSp3.GetCoord(CoodOfPt[6],CoodOfPt[7],CoodOfPt[8]);


	*pSurParm=pSurface->CreateParam((EndParamU-StartParamU)*2/3+StartParamU,(EndParamV-StartParamV)*2/3+StartParamV);//   
	pSurface->EvalPoint(*pSurParm,PtOnSp4);
	PtOnSp4.GetCoord(CoodOfPt[9],CoodOfPt[10],CoodOfPt[11]);


	//求球面圆心的四个输入点坐标不能在同一平面上

	double x=0,y=0,z=0;
	get_xyz(CoodOfPt[0],CoodOfPt[1],CoodOfPt[2],CoodOfPt[3],
		CoodOfPt[4],CoodOfPt[5],CoodOfPt[6],CoodOfPt[7],CoodOfPt[8],CoodOfPt[9],CoodOfPt[10],CoodOfPt[11],x,y,z);
	cout<<"x坐标："<<x<<"y坐标："<<y<<"z坐标："<<z<<endl;





	////包围盒方法得到中心点

	//CATBody_var spTopBodyUpRotateSpcSurface=GetBodyFromFeature(ispSpecRotate);
	//if (NULL_var==spTopBodyUpRotateSpcSurface)
	//{
	//	cout<<"空！！！！！"<<endl;
	//}
	//CATLISTP(CATCell) volcells1;
	//spTopBodyUpRotateSpcSurface->GetAllCells(volcells1, 2);
	//cout<<"mian的个数："<<volcells1.Size()<<endl;


	//CATFace* revFace=(CATFace*)volcells1[1];
	//CATSurface *SelSurface=revFace->GetSurface();
	//CATRevolutionSurface *piRevSur=NULL;

	//CATMathBox surbox;
	//CATSurLimits limOnSelSur;
	//SelSurface->GetLimits(limOnSelSur);
	//SelSurface->GetBox(limOnSelSur,surbox);
	//CATMathPoint boxcenter;
	//HRESULT can=surbox.GetBoxCenter(boxcenter);
	//boxcenter.Dump();
	//double x=0,y=0,z=0;

	//boxcenter.GetCoord(x,y,z);
	////包围盒方法得到中心点完毕


	CATICkeParm_var Xe = spParmFactoryOnUpRotate->CreateLength ( "X", x/1000 );
	CATICkeParm_var Ye = spParmFactoryOnUpRotate->CreateLength ( "Y", y/1000 );
	CATICkeParm_var Ze = spParmFactoryOnUpRotate->CreateLength ( "Z", z/1000 );
	cout<<"1"<<endl;
	CATIGSMPointCoord_var spPointED = pGSMFactOnUpRotate->CreatePoint(Xe,Ye,Ze); 
	cout<<"2"<<endl;

	ospRotateCenter=spPointED;

	rc=ObjectUpdate(ospRotateCenter);
	if (FAILED(rc))
	{
		RDCDMUBFErrorMsgBox("滚轮中心运算出错！");
			return;
	}
	cout<<"3"<<endl;

	InsertInProceduralView(ospRotateCenter,spGSMToolUpRotate);
	cout<<"4"<<endl;










	CATIParmDictionary_var spParamDict = CATCkeGlobalFunctions::GetParmDictionary();
	cout<<"5"<<endl;


	//system("pause");
	if (NULL==InstancePrdOnRail)
	{
		cout<<"InstancePrdOnRail为空"<<endl;
	}
	CATIPrtContainer_var spUpRollingCon=GetConFromInstancePrd(InstancePrdOnRail);
	cout<<"6"<<endl;

	CATIGSMTool_var spGSMToolUpRollingFace=CreateGSMTool("运动面",spUpRollingCon);
	cout<<"7"<<endl;

	CATBody_var TopSelFaceBody=GetBodyFromFeature(ispSpecRailSurface);

	CATBody_var TopRailBody=GetBodyFromFeature(spiRollingSpcOnRail);


	CATIGSMFactory* pGSMFactOnUpRollingFace=NULL;
	rc=spUpRollingCon->QueryInterface(IID_CATIGSMFactory,(void**)&pGSMFactOnUpRollingFace);
	if (FAILED(rc)) {cout<<"通过新建Part的Container查询CATIGSMFactory 失败"<<endl;}

	CATICkeParmFactory* spCkeParmFactoryOnUpRollingFace;
	rc=spUpRollingCon->QueryInterface(IID_CATICkeParmFactory,(void**)&spCkeParmFactoryOnUpRollingFace);
	if (FAILED(rc)) {cout<<"通过新建Part的Container查询spCkeParmFactory 失败"<<endl;}


	CATLISTP(CATCell) BodyEdgecells;
	TopRailBody->GetAllCells(BodyEdgecells, 1);
	cout<<"NUMBER OF BodyEdcells="<<BodyEdgecells.Size()<<endl;

	CATLISTP(CATCell) BodyFacecells;
	TopRailBody->GetAllCells(BodyFacecells, 2);
	cout<<"NUMBER OF BodyFacecells="<<BodyFacecells.Size()<<endl;




	CATLISTP(CATCell) FaceBoundingcells;
	TopSelFaceBody->GetAllCells(FaceBoundingcells, 1);
	cout<<"NUMBER OF edgeCELL="<<FaceBoundingcells.Size()<<endl;

	CATMathPoint MathPointOfLine;
	CATLISTP(CATCell) Edcells;
	TopSelFaceBody->GetAllCells(Edcells, 2);
	cout<<"NUMBER OF face CELL="<<Edcells.Size()<<endl;
	CATCell* pSelFaceCell=Edcells[1];





	CATLISTP(CATCell) RailFacecells;//轨道拓展面

	RailFacecells.Append(pSelFaceCell);








	//判断最长边及其边界点的连续性 选择连续点作为下一个面的搜索输入(这里要求所选面的长边反应轨道走向)
	CATCell* _piLongestEdgeCell=NULL;

	double tempLen=0;
	for(int currentCell=1; currentCell<=FaceBoundingcells.Size(); currentCell++)
	{

		CATEdge * _piCurrentEdge=(CATEdge *)FaceBoundingcells[currentCell];

		double lengthofneighbor=_piCurrentEdge->CalcLength();
		cout<<"长度为："<<lengthofneighbor<<endl;

		if (lengthofneighbor>tempLen)
		{
			tempLen=lengthofneighbor;
			_piLongestEdgeCell=FaceBoundingcells[currentCell];
		}

	}

	cout<<"tempLen="<<tempLen<<endl;

	CATEdge * _piLongestEdgeOnSelFace=(CATEdge *)_piLongestEdgeCell;

	CATVertex * _pEndPtCell1=NULL;
	CATVertex * _pEndPtCell2=NULL;
	_piLongestEdgeOnSelFace->GetVertices(&_pEndPtCell1,&_pEndPtCell2);

	CATVertex * _pPreConnectPtCell=_pEndPtCell1;

	if ((!IsEndPt(_pEndPtCell1,_piLongestEdgeOnSelFace,TopRailBody))&&(!IsEndPt(_pEndPtCell2,_piLongestEdgeOnSelFace,TopRailBody)))
	{
		RDCDMUBFErrorMsgBox("所选面不是轨道起始面，请重新选择！");
		if (_pRollingFaceOKAgent!=NULL)
		{
			_pRollingFaceOKAgent->InitializeAcquisition();
		}
		_RailPanel->SetVisibility(CATDlgHide);
		return;
	}

	if (IsEndPt(_pEndPtCell1,_piLongestEdgeOnSelFace,TopRailBody))
	{

		_pPreConnectPtCell=_pEndPtCell2;
	}






	//得到下一个面之后，从这个面的edge中找到轨道方向上的最后一个edge，针对T字形拓扑线结构，并且得到末端点

	CATLISTP(CATCell) FaceEdgecells;
	pSelFaceCell->GetAllCells(FaceEdgecells, 1);
	cout<<"这个相邻面包含的拓扑线数目："<<FaceEdgecells.Size()<<endl;



	CATVertex *_pPostConnectPtCell=_pPreConnectPtCell;
	CATCell *NextConnectEdgeCell=_piLongestEdgeCell;
	CATTopGeoContinuity ContiOrNot;

	CATBoolean IsEnd=FALSE;
	while (FALSE==IsEnd)
	{

		cout<<"开始循环1~~~~~~~~~~~~~~~~~~~~~~~~~~~~"<<endl;
		CATMathVector datumVec=EvalTangentVec(_pPostConnectPtCell,(CATEdge *)NextConnectEdgeCell);//第一个临边末端点的方向向量

		for(int currentCell=1; currentCell<=FaceEdgecells.Size(); currentCell++)
		{



			if (((CATCell *)_pPostConnectPtCell)->IsOnBorder(FaceEdgecells[currentCell])&&FaceEdgecells[currentCell]!=NextConnectEdgeCell)//可以加上  &&FaceEdgecells[currentCell]！=NextConnectEdgeCell
			{

				_pPostConnectPtCell->EvalSharpness((CATEdge *)NextConnectEdgeCell,(CATEdge *)FaceEdgecells[currentCell],ContiOrNot,NULL,NULL,NULL,5*CATPI/180);
				if (ContiOrNot==CATSmooth)//判断下一个相邻边末端点的向量是否与前一个差距太大，排除末端有倒圆特征的情况
				{




					CATEdge * _ptempEdge=NULL;
					cout<<"此Edge不是最后一个edge\t"<<ContiOrNot<<endl;
					_ptempEdge=(CATEdge *)FaceEdgecells[currentCell];
					CATLISTP(CATCell) EndPtcells;
					_ptempEdge->GetAllCells(EndPtcells, 0);
					CATVertex * _pTempPtCell=(CATVertex *)EndPtcells[1];

					if (_pTempPtCell==_pPostConnectPtCell)
					{
						_pTempPtCell=(CATVertex *)EndPtcells[2];
					}

					//_pPostConnectPtCell=_pTempPtCell;




					CATMathVector NextVec=EvalTangentVec(_pTempPtCell,_ptempEdge);//第一个临边末端点的方向向量
					double angel=NextVec.GetAngleTo(datumVec);
					cout<<"这个角度是2："<<angel*180/CATPI<<endl;


					if (angel*180/CATPI>30&&angel*180/CATPI<150)
					{
						cout<<"角度偏移太大"<<endl;
						IsEnd=TRUE;
						break;


					}
					else
					{
						cout<<"找到下一个面内临边"<<endl;
						_pPostConnectPtCell=_pTempPtCell;
						NextConnectEdgeCell=_ptempEdge;
						break;

					}





				}
				else
					IsEnd=TRUE;

			}



		}
		cout<<"结束循环1~~~~~~~~~~~~~~~~~~~~~~~~~~~~"<<endl;

	}










	if (!IsEndPt(_pPostConnectPtCell,(CATEdge *)NextConnectEdgeCell,TopRailBody))
	{

		cout<<"不是终点"<<endl;

		//循环找到剩下的所有相邻面
		CATFace *nface=(CATFace *)pSelFaceCell;
		CATEdge *ConnectEdge=(CATEdge *)NextConnectEdgeCell;
		CATVertex *ConnectPtOnNextFace=(CATVertex *)_pPostConnectPtCell;

		//CATEdge *outConnectEdge=NULL;
		//int e=1;
		while (!IsEndPt(ConnectPtOnNextFace,ConnectEdge,TopRailBody))
		{
			double lengthofneighbor=ConnectEdge->CalcLength();
			cout<<"运算前长度为："<<lengthofneighbor<<endl;

			nface=GetNextFace(nface,ConnectEdge,ConnectPtOnNextFace,TopRailBody);

			//cout<<c<<endl;
			cout<<"11"<<endl;
			if (NULL==nface)
			{
				cout<<"主函数临边null"<<endl;
				break;
			}
			lengthofneighbor=ConnectEdge->CalcLength();
			cout<<"length after cal"<<lengthofneighbor<<endl;//运算后长度为：



			RailFacecells.Append(nface);

		}




	}

	CATLISTV(CATISpecObject_var) LISTSCur;


	for (int i=1;i<=RailFacecells.Size();i++)
	{
		CATIBRepAccess_var spBRepEdge = CATBRepDecodeCellInBody( RailFacecells[i], TopRailBody );

		CATIFeaturize_var FCell = spBRepEdge;
		CATISpecObject_var spSpecFace = FCell->FeaturizeR( MfPermanentBody|	MfLastFeatureSupport | 	MfRelimitedFeaturization);
		HRESULT rc=ObjectUpdate(spSpecFace);
		if (FAILED(rc))
		{
			RDCDMUBFErrorMsgBox("运算出错！");
				return;
		}
		CATIGSMExtractSolide_var spExtractSurface003 = pGSMFactOnUpRollingFace->CreateExtractSolide(spSpecFace, ExtractSolide_NoPropag);
		CATISpecObject_var NewExSurface003 = spExtractSurface003;
		rc=ObjectUpdate(NewExSurface003);
		if (FAILED(rc))
		{
			RDCDMUBFErrorMsgBox("运算出错！");
				return;
		}
		InsertInProceduralView(NewExSurface003,spGSMToolUpRollingFace);
		LISTSCur.Append(NewExSurface003);
		HideSpecObj(NewExSurface003);

	}




		//CATICkeParm_var spGapThreshold =spCkeParmFactory->CreateLength("thod",0.002/1000);
		CATIGSMAssemble_var spExtrapolCur = pGSMFactOnUpRollingFace -> CreateAssemble(LISTSCur, NULL_var, TRUE);
		CATISpecObject_var NewExSurface003 = spExtrapolCur;
		rc=ObjectUpdate(NewExSurface003);
		if (FAILED(rc))
		{
			RDCDMUBFErrorMsgBox("运算出错！");
				return;
		}
		InsertInProceduralView(NewExSurface003,spGSMToolUpRollingFace);
		HideSpecObj(NewExSurface003);


		//SJDOutputInheritanceStructure(NewExSurface003);

		if (NULL_var==ospRotateCenter)
		{
			RDCDMUBFErrorMsgBox("请先选择滚轮中心！");
			if (_pRollingFaceOKAgent!=NULL)
			{
				_pRollingFaceOKAgent->InitializeAcquisition();
			}
			_RailPanel->SetVisibility(CATDlgHide);
			return;

		}



		double mindis=0;
		mindis=GetMinDistance(NewExSurface003,ospRotateCenter,InstancePrdOnRail,InstancePrdOnRotate);


		cout<<"最小间距是可能错误的地方："<<mindis<<endl;

		CATICkeParm_var spiOffsetDisParm= spCkeParmFactoryOnUpRollingFace->CreateDimension(spParamDict->FindMagnitude("LENGTH"),"偏移",mindis/1000);
		CATIGSMOffset_var spiGSMOffset=pGSMFactOnUpRollingFace->CreateOffset(NewExSurface003,spiOffsetDisParm,TRUE,FALSE);
		CATISpecObject_var spiOffsetSpecRail=spiGSMOffset;



		HRESULT rc3=S_FALSE;
		rc3=ObjectUpdate(spiOffsetSpecRail);


		double disafter=GetMinDistance(spiOffsetSpecRail,ospRotateCenter,InstancePrdOnRail,InstancePrdOnRotate);;
		cout<<"偏移后的距离："<<disafter<<endl;
		if (disafter>0.01)
		{
			cout<<"偏移方向错误 反向"<<endl;
			CATBoolean Invert=FALSE;
			spiGSMOffset->GetInvertDirection(Invert);
			if (Invert)
			{

				Invert=FALSE;
				spiGSMOffset->SetInvertDirection(Invert);
			} 
			else
			{
				Invert=TRUE;
				spiGSMOffset->SetInvertDirection(Invert);

			}

		}
		HRESULT rc4=S_FALSE;
		rc4=ObjectUpdate(spiOffsetSpecRail);

		while(FAILED(rc3)||FAILED(rc4))
		{

			CAAGsiRemove(spiOffsetSpecRail);
			CAAGsiRemove(NewExSurface003);
			int a=LISTSCur.Size();
			cout<<"之前里面有的面片数："<<a<<endl;
			LISTSCur.RemovePosition(a);
			a=LISTSCur.Size();
			cout<<"之后里面有的面片数："<<a<<endl;
		//system("pause");


		spExtrapolCur = pGSMFactOnUpRollingFace -> CreateAssemble(LISTSCur, NULL_var, TRUE);
		NewExSurface003 = spExtrapolCur;
		HRESULT rc=ObjectUpdate(NewExSurface003);
		if (FAILED(rc))
		{
			RDCDMUBFErrorMsgBox("运算出错！");
				return;
		}
		InsertInProceduralView(NewExSurface003,spGSMToolUpRollingFace);
		HideSpecObj(NewExSurface003);


		//SJDOutputInheritanceStructure(NewExSurface003);

		if (NULL_var==ospRotateCenter)
		{
			RDCDMUBFErrorMsgBox("请先选择滚轮中心！");
			if (_pRollingFaceOKAgent!=NULL)
			{
				_pRollingFaceOKAgent->InitializeAcquisition();
			}
			_RailPanel->SetVisibility(CATDlgHide);
			return;

		}



		//double mindis=0;
		mindis=GetMinDistance(NewExSurface003,ospRotateCenter,InstancePrdOnRail,InstancePrdOnRotate);


		cout<<"最小间距是："<<mindis<<endl;

		spiOffsetDisParm= spCkeParmFactoryOnUpRollingFace->CreateDimension(spParamDict->FindMagnitude("LENGTH"),"偏移",mindis/1000);
		spiGSMOffset=pGSMFactOnUpRollingFace->CreateOffset(NewExSurface003,spiOffsetDisParm,TRUE,FALSE);
		spiOffsetSpecRail=spiGSMOffset;



		//HRESULT rc3=S_FALSE;
		rc3=ObjectUpdate(spiOffsetSpecRail);

		if (FAILED(rc3))
		{
			continue;
		}

		disafter=GetMinDistance(spiOffsetSpecRail,ospRotateCenter,InstancePrdOnRail,InstancePrdOnRotate);;
		cout<<"偏移后的距离："<<disafter<<endl;
		if (disafter>0.01)
		{
			cout<<"偏移方向错误 反向"<<endl;
			CATBoolean Invert=FALSE;
			spiGSMOffset->GetInvertDirection(Invert);
			if (Invert)
			{

				Invert=FALSE;
				spiGSMOffset->SetInvertDirection(Invert);
			} 
			else
			{
				Invert=TRUE;
				spiGSMOffset->SetInvertDirection(Invert);

			}

		}
		//HRESULT rc4=S_FALSE;
		rc4=ObjectUpdate(spiOffsetSpecRail);
		if (FAILED(rc4))
		{
			RDCDMUBFErrorMsgBox("运算出错！");
				return;
		}

		}
		//while(FAILED(rc3))
		//{}

	//while(FAILED(rc3))
	//{

	//}




	InsertInProceduralView(spiOffsetSpecRail,spGSMToolUpRollingFace);
	//system("pause");

	if (0==CurveOrSur)
	{
		ospRunningEle=spiOffsetSpecRail;
		return;

	}






	//计算轨道面上的运行曲线

	//从偏移导轨面上找到最长边，以最长边为基准向两侧拓展到端部，生成运行轨迹线并偏移

	CATBody_var spOffsetFaceBody=GetBodyFromFeature(spiOffsetSpecRail);

	CATLISTP(CATCell) edgecells;
	spOffsetFaceBody->GetAllCells(edgecells, 1);
	cout<<"NUMBER OF edge cell="<<edgecells.Size()<<endl;




	CATCell* _piLongestOffsetEdgeCell=NULL;

	double tempLenEg=0;
	for(int currentCell=1; currentCell<=edgecells.Size(); currentCell++)
	{

		CATEdge * _piCurrentEdge=(CATEdge *)edgecells[currentCell];

		double lengthofneighbor=_piCurrentEdge->CalcLength();
		cout<<"长度为："<<lengthofneighbor<<endl;

		if (lengthofneighbor>tempLenEg)
		{
			tempLenEg=lengthofneighbor;
			_piLongestOffsetEdgeCell=edgecells[currentCell];
		}

	}


	CATLISTP(CATCell) RailEdgecells;//轨道边界
	RailEdgecells.Append(_piLongestOffsetEdgeCell);


	CATLISTP(CATCell) LongestEdgePtcells;
	_piLongestOffsetEdgeCell->GetAllCells(LongestEdgePtcells, 0);


	cout<<"边界点的个数："<<LongestEdgePtcells.Size()<<endl;
	//system("pause");

	CATVertex* LongestEdgePtcells1=(CATVertex*)LongestEdgePtcells[1];
	CATVertex* LongestEdgePtcells2=(CATVertex*)LongestEdgePtcells[2];


	CATCell *NextRailConnectEdgeCell=_piLongestOffsetEdgeCell;


	if (NULL==LongestEdgePtcells1||NULL==LongestEdgePtcells2)
	{
		cout<<"有空的"<<endl;
		system("pause");


	}


	//int u=2;
	//while(u--)
	//{


	//	cout<<"u="<<u<<endl;

	//if (u==0)
	//{
	//	cout<<"这里"<<endl;

	//	NextRailConnectPtCell=LongestEdgePtcells1;
	//	cout<<"这里   1"<<endl;

	//}


	CATVertex* NextRailConnectPtCell=LongestEdgePtcells2;

	CATTopGeoContinuity ContiOrNot1;

	CATBoolean IsEnd1=FALSE;

	while (FALSE==IsEnd1)
	{

		CATMathVector datumVec=EvalTangentVec(NextRailConnectPtCell,(CATEdge *)NextRailConnectEdgeCell);//第一个临边末端点的方向向量

		int currentCell=1;
		CATBoolean hastan=FALSE;
		for(; currentCell<=edgecells.Size(); currentCell++)
		{


			if (((CATCell *)NextRailConnectPtCell)->IsOnBorder(edgecells[currentCell])&&edgecells[currentCell]!=NextRailConnectEdgeCell)//可以加上  &&FaceEdgecells[currentCell]！=NextConnectEdgeCell
			{

				CATAngle lsdlg=0;
				NextRailConnectPtCell->EvalSharpness((CATEdge *)NextRailConnectEdgeCell,(CATEdge *)edgecells[currentCell],ContiOrNot1,&lsdlg,NULL,NULL,5*CATPI/180);
				cout<<"连接的角度："<<lsdlg*180/CATPI<<endl;
				if (ContiOrNot1==CATSmooth)//判断下一个相邻边末端点的向量是否与前一个差距太大，排除末端有倒圆特征的情况
				{


					hastan=true;

					CATEdge * _ptempEdge=NULL;
					cout<<"此Edge不是最后一个edge\t"<<ContiOrNot1<<endl;
					_ptempEdge=(CATEdge *)edgecells[currentCell];
					CATLISTP(CATCell) EndPtcells;
					_ptempEdge->GetAllCells(EndPtcells, 0);
					CATVertex * _pTempPtCell=(CATVertex *)EndPtcells[1];

					if (_pTempPtCell==NextRailConnectPtCell)
					{
						_pTempPtCell=(CATVertex *)EndPtcells[2];
					}

					CATMathVector NextVec=EvalTangentVec(_pTempPtCell,_ptempEdge);//第一个临边末端点的方向向量
					double angel=NextVec.GetAngleTo(datumVec);
					cout<<"这个角度是3："<<angel*180/CATPI<<endl;


					if (angel*180/CATPI>60&&angel*180/CATPI<120)//angel*180/CATPI>30&&angel*180/CATPI<150
					{
						cout<<"角度偏移太大"<<endl;
						IsEnd1=TRUE;
						break;


					}
					else
					{
						cout<<"找到下一个面内临边"<<endl;
						NextRailConnectPtCell=_pTempPtCell;
						NextRailConnectEdgeCell=_ptempEdge;
						RailEdgecells.Append(_ptempEdge);

						break;

					}


				}


			}



		}


		cout<<"结束循环1~~~~~~~~~~~~~~~~~~~~~~~~~~~~"<<endl;


		if (currentCell==edgecells.Size()+1&&hastan==FALSE)
		{
			IsEnd1=TRUE;
		}
	}









	//对另一个顶点

	CATVertex* NextRailConnectPtCell1=LongestEdgePtcells1;

	NextRailConnectEdgeCell=_piLongestOffsetEdgeCell;


	//system("pause");

	IsEnd1=FALSE;

	while (FALSE==IsEnd1)
	{
		cout<<"这里   4"<<endl;

		CATMathVector datumVec=EvalTangentVec(NextRailConnectPtCell1,(CATEdge *)NextRailConnectEdgeCell);//第一个临边末端点的方向向量
		cout<<"这里   5"<<endl;

		int currentCell=1;
		CATBoolean hastan=FALSE;
		for(; currentCell<=edgecells.Size(); currentCell++)
		{


			if (((CATCell *)NextRailConnectPtCell1)->IsOnBorder(edgecells[currentCell])&&edgecells[currentCell]!=NextRailConnectEdgeCell)//可以加上  &&FaceEdgecells[currentCell]！=NextConnectEdgeCell
			{

				CATAngle lsdlg=0;
				NextRailConnectPtCell1->EvalSharpness((CATEdge *)NextRailConnectEdgeCell,(CATEdge *)edgecells[currentCell],ContiOrNot1,&lsdlg,NULL,NULL,5*CATPI/180);
				cout<<"连接的角度："<<lsdlg*180/CATPI<<endl;
				if (ContiOrNot1==CATSmooth)//判断下一个相邻边末端点的向量是否与前一个差距太大，排除末端有倒圆特征的情况
				{


					hastan=true;

					CATEdge * _ptempEdge=NULL;
					cout<<"此Edge不是最后一个edge\t"<<ContiOrNot1<<endl;
					_ptempEdge=(CATEdge *)edgecells[currentCell];
					CATLISTP(CATCell) EndPtcells;
					_ptempEdge->GetAllCells(EndPtcells, 0);
					CATVertex * _pTempPtCell=(CATVertex *)EndPtcells[1];

					if (_pTempPtCell==NextRailConnectPtCell1)
					{
						_pTempPtCell=(CATVertex *)EndPtcells[2];
					}

					CATMathVector NextVec=EvalTangentVec(_pTempPtCell,_ptempEdge);//第一个临边末端点的方向向量
					double angel=NextVec.GetAngleTo(datumVec);
					cout<<"这个角度是4："<<angel*180/CATPI<<endl;


					if (angel*180/CATPI>80&&angel*180/CATPI<100)//angel*180/CATPI>30&&angel*180/CATPI<150 这里因为中轨道拐角较大 将范围变大
					{
						cout<<"角度偏移太大"<<endl;
						IsEnd1=TRUE;
						break;


					}
					else
					{
						cout<<"找到下一个面内临边"<<endl;
						NextRailConnectPtCell1=_pTempPtCell;
						NextRailConnectEdgeCell=_ptempEdge;
						RailEdgecells.Append(_ptempEdge);

						break;

					}


				}


			}



		}


		cout<<"结束循环1~~~~~~~~~~~~~~~~~~~~~~~~~~~~"<<endl;


		if (currentCell==edgecells.Size()+1&&hastan==FALSE)
		{
			IsEnd1=TRUE;
		}
	}























	CATLISTV(CATISpecObject_var) LISTRunCur0;

	for (int i=1;i<=RailEdgecells.Size();i++)
	{
		CATIBRepAccess_var spBRepEdge = CATBRepDecodeCellInBody( RailEdgecells[i], spOffsetFaceBody );

		CATIFeaturize_var FCell = spBRepEdge;
		CATISpecObject_var spSpecFace = FCell->FeaturizeR( MfPermanentBody|	MfLastFeatureSupport | 	MfRelimitedFeaturization);
		HRESULT rc=ObjectUpdate(spSpecFace);
		if (FAILED(rc))
		{
			RDCDMUBFErrorMsgBox("运算出错！");
				return;
		}

		CATIGSMExtractSolide_var spExtractSurface003 = pGSMFactOnUpRollingFace->CreateExtractSolide(spSpecFace, ExtractSolide_NoPropag);
		CATISpecObject_var NewExSurface003 = spExtractSurface003;
		rc=ObjectUpdate(NewExSurface003);
		if (FAILED(rc))
		{
			RDCDMUBFErrorMsgBox("运算出错！");
				return;
		}
		InsertInProceduralView(NewExSurface003,spGSMToolUpRollingFace);
		LISTRunCur0.Append(NewExSurface003);
		HideSpecObj(NewExSurface003);
	}

	CATIGSMAssemble_var spLISTRunCur = pGSMFactOnUpRollingFace -> CreateAssemble(LISTRunCur0, NULL_var, TRUE);
	CATISpecObject_var spPreSpecRunningCur = spLISTRunCur;
	rc=ObjectUpdate(spPreSpecRunningCur);
	if (FAILED(rc))
	{
		RDCDMUBFErrorMsgBox("运算出错！");
			return;
	}
	InsertInProceduralView(spPreSpecRunningCur,spGSMToolUpRollingFace);
	HideSpecObj(spPreSpecRunningCur);




	double LtL=0;
	LtL=GetMinDistance(spPreSpecRunningCur,ospRotateCenter,InstancePrdOnRail,InstancePrdOnRotate);




	CATICkeParm_var spiCurvOffsetDisParm= spCkeParmFactoryOnUpRollingFace->CreateDimension(spParamDict->FindMagnitude("LENGTH"),"偏移",LtL/1000);


	CATIGSMCurvePar_var  spiRunningCurvePar=pGSMFactOnUpRollingFace->CreateCurvePar(spPreSpecRunningCur, 
		spiOffsetSpecRail, 
		spiCurvOffsetDisParm, 
		FALSE);
	CATISpecObject_var spiRunningCurve = spiRunningCurvePar;
	rc=ObjectUpdate(spiRunningCurve);
	if (FAILED(rc))
	{
		RDCDMUBFErrorMsgBox("运算出错！");
			return;
	}


	double disafter1=GetMinDistance(spiRunningCurve,ospRotateCenter,InstancePrdOnRail,InstancePrdOnRotate);
	cout<<"偏移后的距离："<<disafter1<<endl;
	if (disafter1>0.01)
	{
		cout<<"偏移方向错误 反向"<<endl;
		CATBoolean Invert=FALSE;
		spiRunningCurvePar->GetInvertDirection(Invert);
		if (Invert)
		{

			Invert=FALSE;
			spiRunningCurvePar->SetInvertDirection(Invert);
		} 
		else
		{
			Invert=TRUE;
			spiRunningCurvePar->SetInvertDirection(Invert);

		}
		HRESULT rc=ObjectUpdate(spiRunningCurve);
		if (FAILED(rc))
		{
			RDCDMUBFErrorMsgBox("运算出错！");
				return;
		}

	}


	InsertInProceduralView(spiRunningCurve,spGSMToolUpRollingFace);

	//轨迹线计算完毕

ospRunningEle=spiRunningCurve;

}

HRESULT TestCmd::CAAGsiRemove ( CATISpecObject_var SpecToRemove) 
{
	HRESULT rc = E_FAIL; 
	if (!!SpecToRemove) { 
		//evenement de remise a jour de la visu
		//CATIModelEvents_var IME(SpecToRemove);
		//if(!!IME) 
		//{
		//	CATDelete info(SpecToRemove->GetImpl());
		//	IME->Dispatch(info);
		//}

		//destruction
		CATISpecObject_var father = SpecToRemove->GetFather();
		if (father!=NULL_var)
		{
			father->Release();
			CATIDescendants_var IDes = father;
			IDes->RemoveChild (SpecToRemove);
		}
		else
		{
			LifeCycleObject_var LCO = SpecToRemove;
			LCO -> remove();
		}
		rc = S_OK ; 
	}
	return rc ;
}
void TestCmd::CreateRigidJoint(CATIProduct_var spPrd1,CATIProduct_var spPrd2)
{

	CATLISTP(CATBaseUnknown) iConnectorList;

	CATILinkableObject *pLinkRotateCenter = NULL;


		HRESULT rc = spPrd1->QueryInterface(IID_CATILinkableObject ,(void **) &pLinkRotateCenter);
		if ( SUCCEEDED(rc) ) 
			cout<<"成功转化"<<endl;



	CATBaseUnknown* papiUnknownOnLineConnector1 = NULL;
	HRESULT HR1 = spPrd1->QueryInterface(IID_CATBaseUnknown, (void**)&papiUnknownOnLineConnector1);
	cout<<"3"<<endl;

	CATBaseUnknown* papiUnknownOnLineConnector2 = NULL;
	HRESULT HR2 = spPrd2->QueryInterface(IID_CATBaseUnknown, (void**)&papiUnknownOnLineConnector2);

	if (SUCCEEDED(HR1)&&SUCCEEDED(HR2))
	{

		cout<<"固定转化成功"<<endl;

		iConnectorList.Append(papiUnknownOnLineConnector1);
		iConnectorList.Append(papiUnknownOnLineConnector2);
		papiUnknownOnLineConnector1->Release();
		papiUnknownOnLineConnector1 = NULL;

		papiUnknownOnLineConnector2->Release();
		papiUnknownOnLineConnector2 = NULL;
		CATIKinJoint* piJoint = NULL;
		const char* jointType = CATKinRigidJoint;
		boolean iCreateConstraintsForJoint = 1;
		if (SUCCEEDED(piMechanism->AddJoint(jointType,&iConnectorList, iCreateConstraintsForJoint, &piJoint)))
		{

			cout<<"成功生成固定接合"<<endl;
			piJoint->Release();
			piJoint = NULL;
		}
	}

}
void TestCmd::CreateRevoluteJoint(CATISpecObject_var spLine1,CATISpecObject_var spLine2,CATISpecObject_var spPlane1,CATIBRepAccess_var spiBRepHinge1Plane1,CATISpecObject_var spLastFeaOnPlane1,CATISpecObject_var spLastFeaOnPlane2,CATIProduct_var spPrd1,CATIProduct_var spPrd2)
{
//
//
//	//double a=GetMinDistance(spPlane1,spPlane2);
//	//cout<<"两个面之间的距离是："<<a<<endl;
//
//	cout<<"调用旋转接合函数"<<endl;

//	CATBody_var spOffsetFaceBody1=GetBodyFromFeature(spPlane1);
//
//	CATLISTP(CATCell) facecells1;
//	spOffsetFaceBody1->GetAllCells(facecells1, 2);
//
//	CATFace* pfacePlane1=(CATFace*)facecells1[1];
//	CATGeometry* pGeoPlane1=pfacePlane1->GetGeometry();
//
//	if (pGeoPlane1->IsATypeOf(CATPlaneType))
//	{
//		cout<<"1是平面!!!!!!!!!!!!!"<<endl;
//	}
//	else if (pGeoPlane1->IsATypeOf(CATPlaneManifoldType))
//	{
//		cout<<"1 CATPlaneManifoldType"<<endl;
//	}
//
//
//
//
//	CATSurface* pSurface1=pfacePlane1->GetSurface(NULL);
//	CATSurParam* pSurEndParm1 =new CATSurParam();
//	CATSurParam* pSurStartParm1 =new CATSurParam();
//	pSurface1->GetEndLimit(*pSurEndParm1);
//	pSurface1->GetStartLimit(*pSurStartParm1);
//	double EndParamU1=pSurEndParm1->GetParamU();
//	double EndParamV1=pSurEndParm1->GetParamV();
//	double StartParamU1=pSurStartParm1->GetParamU();
//	double StartParamV1=pSurStartParm1->GetParamV();
//
//
//
//
//	CATMathPoint PtOnSp11;
//	CATMathPoint PtOnSp12;
//	CATMathPoint PtOnSp13;
//
//	double CoodOfPt1[12]={0,0,0,0,0,0,0,0,0,0,0,0};
//
//	CATSurParam* pSurParm1 =new CATSurParam();
//	*pSurParm1=pSurface1->CreateParam(StartParamU1,StartParamV1);// (EndParamU-StartParamU)/3+  (EndParamV-StartParamV)/3+
//	pSurface1->EvalPoint(*pSurParm1,PtOnSp11);
//	PtOnSp11.GetCoord(CoodOfPt1[0],CoodOfPt1[1],CoodOfPt1[2]);
//
//
//
//
//	*pSurParm1=pSurface1->CreateParam((EndParamU1-StartParamU1)*2/3+StartParamU1,(EndParamV1-StartParamV1)/3+StartParamV1);//   
//	pSurface1->EvalPoint(*pSurParm1,PtOnSp12);
//	PtOnSp12.GetCoord(CoodOfPt1[3],CoodOfPt1[4],CoodOfPt1[5]);
//
//
//
//	*pSurParm1=pSurface1->CreateParam((EndParamU1-StartParamU1)/3+StartParamU1,(EndParamV1-StartParamV1)*2/3+StartParamV1);//   
//	pSurface1->EvalPoint(*pSurParm1,PtOnSp13);
//	PtOnSp13.GetCoord(CoodOfPt1[6],CoodOfPt1[7],CoodOfPt1[8]);
//
//
//
//	CATMathPlane mathplane1(PtOnSp11,PtOnSp12,PtOnSp13);
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//	CATIAlias_var aliasOnCurrentSet = spLastFeaOnPlane1 ;
//	if ( NULL_var != aliasOnCurrentSet)
//	{
//		cout << "包含平面1的特征是：" << aliasOnCurrentSet->GetAlias().ConvertToChar()<<endl;
//	}
//	CATBody_var spTopLastFeaOnHinge1Plane1=GetBodyFromFeature(spLastFeaOnPlane1);
//	if (NULL_var==spTopLastFeaOnHinge1Plane1)
//	{
//		cout<<"空！！！！！"<<endl;
//	}
//	CATLISTP(CATCell) volcells1;
//	spTopLastFeaOnHinge1Plane1->GetAllCells(volcells1, 3);
//	cout<<"体的个数："<<volcells1.Size()<<endl;
//
//
//	CATVolume_var VolumeOnMainBody=NULL_var;
//	if (0==volcells1.Size())
//	{
//		cout<<"没有实体体积"<<endl;
//
//		CATIPrtContainer_var spPrd1Con=GetConFromInstancePrd(spPrd1);
//		CATIPrtFactory_var spPrtFactOnPrtCont(spPrd1Con);
//		CATISpecObject_var spCloseSur=spPrtFactOnPrtCont->CreateVolumicCloseSurface(spLastFeaOnPlane1);
//		HRESULT rc=ObjectUpdate(spCloseSur);
//		if (FAILED(rc))
//		{
//			RDCDMUBFErrorMsgBox("运算出错！");
//				return;
//		}
//		cout<<"3"<<endl;
//
//		CATBody_var spTopLastFeaOnPrtPlane1=GetBodyFromFeature(spCloseSur);
//
//		CATLISTP(CATCell) volcells1;
//		spTopLastFeaOnPrtPlane1->GetAllCells(volcells1, 3);
//		cout<<"体的个数："<<volcells1.Size()<<endl;
//		VolumeOnMainBody=volcells1[1];
//
//	}
//	else
//	VolumeOnMainBody=volcells1[1];
//
//
//
//
//
//
//if (NULL_var==VolumeOnMainBody)
//{
//	cout<<"没有得到volume"<<endl;
//	return;
//}
//	CATGSMOrientation om=CATGSMSameOrientation;
//	CATBoolean OutsideIn=FALSE;
//	//CATBoolean SameOrNot=FALSE;
//	CATFace_var spFaceCell = pfacePlane1;
//	HRESULT rc1= SJDFaceDirectionIsInnerVolum(spFaceCell,VolumeOnMainBody,OutsideIn);//true指向体内
//
//
//	CATSurface *SelSurface=spFaceCell->GetSurface();
//
//	CATSurParam CenterParm;
//	spFaceCell->EstimateCenterParam(CenterParm);
//
//	CATMathDirection SurNormalDir=SelSurface->EvalNormal(CenterParm);//所选面的法向向量
//	if (TRUE==OutsideIn)
//	{
//		SurNormalDir=SurNormalDir*(-1);
//	}
//
//
//	cout<<"所选面1的法向向量:"<<endl;
//	SurNormalDir.Dump();
//
//
//
//
//
//
//
//
//
//	CATBody_var spOffsetFaceBody2=GetBodyFromFeature(spPlane2);
//
//	CATLISTP(CATCell) facecells2;
//	spOffsetFaceBody2->GetAllCells(facecells2, 2);
//
//	CATFace* pfacePlane2=(CATFace*)facecells2[1];
//
//
//
//	CATGeometry* pGeoPlane2=pfacePlane2->GetGeometry();
//
//
//	if (pGeoPlane2->IsATypeOf(CATPlaneType))
//	{
//		cout<<"平面!!!!!!!!!!!!!"<<endl;
//	}
//	else if (pGeoPlane2->IsATypeOf(CATPlaneManifoldType))
//	{
//		cout<<"CATPlaneManifoldType"<<endl;
//	}
//	else if (pGeoPlane2->IsATypeOf(CATGeometryType))
//	{
//		cout<<"CATGeometryType!!!!!!!!!!!!"<<endl;
//	}
//
//
//
//	CATSurface* pSurface=pfacePlane2->GetSurface(NULL);
//	CATSurParam* pSurEndParm =new CATSurParam();
//	CATSurParam* pSurStartParm =new CATSurParam();
//	pSurface->GetEndLimit(*pSurEndParm);
//	pSurface->GetStartLimit(*pSurStartParm);
//	double EndParamU=pSurEndParm->GetParamU();
//	double EndParamV=pSurEndParm->GetParamV();
//	double StartParamU=pSurStartParm->GetParamU();
//	double StartParamV=pSurStartParm->GetParamV();
//
//
//
//
//	CATMathPoint PtOnSp1;
//	CATMathPoint PtOnSp2;
//	CATMathPoint PtOnSp3;
//
//	double CoodOfPt[12]={0,0,0,0,0,0,0,0,0,0,0,0};
//
//	CATSurParam* pSurParm =new CATSurParam();
//	*pSurParm=pSurface->CreateParam(StartParamU,StartParamV);// (EndParamU-StartParamU)/3+  (EndParamV-StartParamV)/3+
//	pSurface->EvalPoint(*pSurParm,PtOnSp1);
//	PtOnSp1.GetCoord(CoodOfPt[0],CoodOfPt[1],CoodOfPt[2]);
//
//
//
//
//	*pSurParm=pSurface->CreateParam((EndParamU-StartParamU)*2/3+StartParamU,(EndParamV-StartParamV)/3+StartParamV);//   
//	pSurface->EvalPoint(*pSurParm,PtOnSp2);
//	PtOnSp2.GetCoord(CoodOfPt[3],CoodOfPt[4],CoodOfPt[5]);
//
//
//
//	*pSurParm=pSurface->CreateParam((EndParamU-StartParamU)/3+StartParamU,(EndParamV-StartParamV)*2/3+StartParamV);//   
//	pSurface->EvalPoint(*pSurParm,PtOnSp3);
//	PtOnSp3.GetCoord(CoodOfPt[6],CoodOfPt[7],CoodOfPt[8]);
//
//
//
//
//
//	//cout<<"4"<<endl;
//
//	//CATPlane* pPlane2=(CATPlane*)pGeoPlane2;
//	//if (NULL==pPlane2)
//	//{
//	//	cout<<"pPlane2为空"<<endl;
//	//}
//	CATMathPlane mathplane2(PtOnSp1,PtOnSp2,PtOnSp3);
//
//	//pPlane2->GetAxis(mathplane2);
//
//	mathplane2.Dump();
//	CATMathVector Vector2;
//	mathplane2.GetNormal(Vector2);
//	cout<<"平面2的方向是："<<endl;
//	Vector2.Dump();
//
//
//
//
//	CATBody_var spTopLastFeaOnHinge1Plane2=GetBodyFromFeature(spLastFeaOnPlane2);
//
//	if (NULL_var==spTopLastFeaOnHinge1Plane2)
//	{
//		cout<<"空！！！！！"<<endl;
//	}
//	CATLISTP(CATCell) volcells2;
//	spTopLastFeaOnHinge1Plane2->GetAllCells(volcells2, 3);
//	cout<<"体的个数："<<volcells2.Size()<<endl;              //解决由于是断参曲面无法得到volume的情况
//
//
//	CATVolume_var VolumeOnMainBody2=NULL_var;
//	if (0==volcells2.Size())
//	{
//		CATIPrtContainer_var spPrd2Con=GetConFromInstancePrd(spPrd2);
//		CATIPrtFactory_var spPrtFactOnPrtCont2(spPrd2Con);
//		CATISpecObject_var spCloseSur2=spPrtFactOnPrtCont2->CreateVolumicCloseSurface(spLastFeaOnPlane2);
//		HRESULT rc=ObjectUpdate(spCloseSur2);
//		if (FAILED(rc))
//		{
//			RDCDMUBFErrorMsgBox("旋转接合运算出错！");
//				return;
//		}
//		cout<<"3"<<endl;
//
//		CATBody_var spTopLastFeaOnPrtPlane2=GetBodyFromFeature(spCloseSur2);
//
//		CATLISTP(CATCell) volcells2;
//		spTopLastFeaOnPrtPlane2->GetAllCells(volcells2, 3);
//		cout<<"体的个数："<<volcells2.Size()<<endl;
//		VolumeOnMainBody2=volcells2[1];
//
//	} 
//	else
//	{
//		VolumeOnMainBody2=volcells2[1];
//
//	}
//
//
//
//
//
//	if (NULL_var==VolumeOnMainBody2)
//	{
//		cout<<"没有得到volume"<<endl;
//		return;
//	}
//	//CATGSMOrientation om=CATGSMSameOrientation;
//	CATBoolean OutsideIn2=FALSE;
//	//CATBoolean SameOrNot=FALSE;
//	CATFace_var spFaceCell2 = pfacePlane2;
//	HRESULT rc2= SJDFaceDirectionIsInnerVolum(spFaceCell2,VolumeOnMainBody2,OutsideIn2);//true指向体内
//
//
//	CATSurface *SelSurface2=spFaceCell2->GetSurface();
//
//	CATSurParam CenterParm2;
//	spFaceCell2->EstimateCenterParam(CenterParm2);
//
//	CATMathDirection SurNormalDir2=SelSurface2->EvalNormal(CenterParm2);//所选面的法向向量
//	if (TRUE==OutsideIn2)
//	{
//		SurNormalDir2=SurNormalDir2*(-1);
//	}
//
//
//	cout<<"所选面2的法向向量:"<<endl;
//	SurNormalDir2.Dump();
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//	CATIMovable *piMovableOnInstance1 = NULL;
//	HRESULT rc5 = spPrd1 -> QueryInterface (IID_CATIMovable,
//		(void**) &piMovableOnInstance1);
//	CATMathTransformation absolutePosition1;
//	piMovableOnInstance1 -> GetAbsPosition(absolutePosition1 );
//	cout<<"产品1的绝对位置矩阵是："<<endl;
//	absolutePosition1.Dump();
//
//	CATMathPlane mathplanetrans1=absolutePosition1*mathplane1;
//	cout<<"转换后的平面1是："<<endl;
//	mathplanetrans1.Dump();
//
//
//
//	CATIMovable *piMovableOnInstance2 = NULL;
//	rc5 = spPrd2 -> QueryInterface (IID_CATIMovable,
//		(void**) &piMovableOnInstance2);
//	CATMathTransformation absolutePosition2;
//	piMovableOnInstance2 -> GetAbsPosition(absolutePosition2 );
//	cout<<"产品1的绝对位置矩阵是："<<endl;
//	absolutePosition2.Dump();
//
//	CATMathPlane mathplanetrans2=absolutePosition2*mathplane2;
//	cout<<"转换后的平面2是："<<endl;
//	mathplanetrans2.Dump();
//
//
//
//	CATMathPoint OrigMathPt2;
//	mathplanetrans2.GetOrigin(OrigMathPt2);
//	double dis=mathplanetrans1.DistanceTo(OrigMathPt2);
//	cout<<"两个平面之间的距离是："<<dis<<endl;
//
//
//
//
//	CATMathPoint resultPt2to1;
//	mathplanetrans1.Project(OrigMathPt2,resultPt2to1);
//
//	CATMathVector SecVec=resultPt2to1-OrigMathPt2;
//
//	double sameOrNotDir=-(SurNormalDir*SecVec);
//	if (0==volcells2.Size()&&0==volcells1.Size())
//	{
//		sameOrNotDir=sameOrNotDir*(-1);
//	}
//	cout<<"值得正负为："<<sameOrNotDir<<endl;
//



	CATLISTP(CATBaseUnknown) iConnectorList;


	CATBaseUnknown* papiUnknownOnLineConnector1 = NULL;

	CATILinkableObject *pLinkLine1 = NULL;

	if( spLine1 != NULL_var )
	{
		HRESULT rc = spLine1->QueryInterface(IID_CATILinkableObject ,(void **) &pLinkLine1);
		if ( SUCCEEDED(rc) ) 
		{
			CATIConnector* spConnectorOnLine1 = NULL;
			int xCreation = 0;

			HRESULT HR =::GetProductConnector(pLinkLine1, spPrd1, spRootProduct, 0, spConnectorOnLine1, xCreation);
			//old: GetProductConnector(spLinkableOnLine,(*pProductList)[i],spRootProduct);//
			if (spConnectorOnLine1)
			{

				//CATMathTransformation* matrix1;
				//matrix1=spConnectorOnLine1->GiveContext();
				//cout<<"spConnectorOnLine1:";
				//matrix1->Dump();
				cout<<"得到spConnectorOnLine1"<<endl;
				// Store the connector as a CATBaseUnknown
				HR = spConnectorOnLine1->QueryInterface(IID_CATBaseUnknown, (void**)&papiUnknownOnLineConnector1);
				iConnectorList.Append(papiUnknownOnLineConnector1);
				papiUnknownOnLineConnector1->Release();
				papiUnknownOnLineConnector1 = NULL;
			}

		}
	}






	//piInstanceProdOnRotate


	CATBaseUnknown* papiUnknownOnLineConnector2 = NULL;

	CATILinkableObject *pLinkLine2 = NULL;

	if( spLine2 != NULL_var )
	{
		HRESULT rc = spLine2->QueryInterface(IID_CATILinkableObject ,(void **) &pLinkLine2);
		if ( SUCCEEDED(rc) ) 
		{
			CATIConnector* spConnectorOnLine2 = NULL;
			int xCreation = 0;

			HRESULT hr = ::GetProductConnector(pLinkLine2, spPrd2, spRootProduct, 0, spConnectorOnLine2, xCreation);
			if (SUCCEEDED(hr))
			{
				cout<<"成功生成spConnectorOnLine2"<<endl;
			}

			//old: GetProductConnector(spLinkableOnLine,(*pProductList)[i],spRootProduct);//
			if (spConnectorOnLine2)
			{
				cout<<"得到spConnectorOnLine2"<<endl;

				//CATMathTransformation* matrix2;
				//matrix2=spConnectorOnLine2->GiveContext();
				//cout<<"spConnectorOnLine2:";
				//matrix2->Dump();
				// Store the connector as a CATBaseUnknown
				HRESULT HR = spConnectorOnLine2->QueryInterface(IID_CATBaseUnknown, (void**)&papiUnknownOnLineConnector2);
				iConnectorList.Append(papiUnknownOnLineConnector2);
				papiUnknownOnLineConnector2->Release();
				papiUnknownOnLineConnector2 = NULL;
			}

		}
	}



	CATBaseUnknown* papiUnknownOnPlaneConnector1 = NULL;

	CATILinkableObject *pLinkPlane1 = NULL;

	if( spPlane1 != NULL_var )
	{
		HRESULT rc = spPlane1->QueryInterface(IID_CATILinkableObject ,(void **) &pLinkPlane1);
		if ( SUCCEEDED(rc) ) 
		{
			CATIConnector* spConnectorOnPlane1 = NULL;
			int xCreation = 0;

			HRESULT HR =::GetProductConnector(pLinkPlane1, spPrd1, spRootProduct, 0, spConnectorOnPlane1, xCreation);
			//old: GetProductConnector(spLinkableOnLine,(*pProductList)[i],spRootProduct);//
			if (spConnectorOnPlane1)
			{
				//CATMathTransformation* matrix3;
				//matrix3=spConnectorOnPlane1->GiveContext();
				//cout<<"spConnectorOnPlane1:";
				//matrix3->Dump();
				cout<<"得到spConnectorOnPlane1"<<endl;
				// Store the connector as a CATBaseUnknown
				HR = spConnectorOnPlane1->QueryInterface(IID_CATBaseUnknown, (void**)&papiUnknownOnPlaneConnector1);
				iConnectorList.Append(papiUnknownOnPlaneConnector1);
				papiUnknownOnPlaneConnector1->Release();
				papiUnknownOnPlaneConnector1 = NULL;
			}

		}
	}

////用复制过来的面代替第二个选择面
//	CATIPrtContainer_var spPrd1Con=GetConFromInstancePrd(spPrd1);
//
//
//
//
//	CATIGSMTool_var spGSMToolExtractPlane=CreateGSMTool("提取面",spPrd1Con);
//	CATISpecObject_var spSpecGSMToolExtractPlane=spGSMToolExtractPlane;
//
//
//	CATIGSMFactory* pGSMFactOnPrd1=NULL;
//	HRESULT rc=spPrd1Con->QueryInterface(IID_CATIGSMFactory,(void**)&pGSMFactOnPrd1);
//	if (FAILED(rc)) {cout<<"通过新建Part的Container查询CATIGSMFactory 失败"<<endl;}
//
//	CATIGSMExtractSolide_var spExtractPlane1 = pGSMFactOnPrd1->CreateExtractSolide(spPlane1, ExtractSolide_NoPropag);
//	CATISpecObject_var spSpecNewExPlane1 = spExtractPlane1;
//	rc=ObjectUpdate(spSpecNewExPlane1);
//	if (FAILED(rc))
//	{
//		RDCDMUBFErrorMsgBox("提取出错！");
//		return;
//	}
//	InsertInProceduralView(spSpecNewExPlane1,spSpecGSMToolExtractPlane);
//	HideSpecObj(spSpecNewExPlane1);
//
//	CATIPrtContainer_var spPrd2Con=GetConFromInstancePrd(spPrd2);
//
//
//	CATIGSMTool_var spGSMToolCopyPlane=CreateGSMTool("复制面",spPrd2Con);
//	CATISpecObject_var spSpecGSMToolCopyPlane=spGSMToolCopyPlane;
//
//	CATISpecObject_var spSpecCopyedPlane=NULL_var;
//
//
//	spSpecCopyedPlane=CopyWithLink(spPrd1,spSpecNewExPlane1,spPrd2,spSpecGSMToolCopyPlane,FALSE);
//	if (NULL_var==spSpecCopyedPlane)
//	{
//					RDCDMUBFErrorMsgBox("提取出错！");
//					return;
//
//	}
//	rc=ObjectUpdate(spSpecCopyedPlane);
//	if (FAILED(rc))
//	{
//		RDCDMUBFErrorMsgBox("复制出错！");
//		return;
//	}
//
//	UpdateProduct(spPrd1);
//	UpdateProduct(spPrd2);
//	UpdateProduct(spRootProduct);
//
//	//用复制过来的面代替第二个选择面完毕





	//用复制过来的面代替第二个选择面
	//CATIPrtContainer_var spPrd1Con=GetConFromInstancePrd(piInstanceProdOnHinge1Plane1);




	//CATIGSMTool_var spGSMToolExtractPlane=CreateGSMTool("提取面",spPrd1Con);
	//CATISpecObject_var spSpecGSMToolExtractPlane=spGSMToolExtractPlane;


	//CATIGSMFactory* pGSMFactOnPrd1=NULL;
	//HRESULT rc=spPrd1Con->QueryInterface(IID_CATIGSMFactory,(void**)&pGSMFactOnPrd1);
	//if (FAILED(rc)) {cout<<"通过新建Part的Container查询CATIGSMFactory 失败"<<endl;}

	//CATIGSMExtractSolide_var spExtractPlane1 = pGSMFactOnPrd1->CreateExtractSolide(spiHinge1Plane1, ExtractSolide_NoPropag);
	//CATISpecObject_var spSpecNewExPlane1 = spExtractPlane1;
	//rc=ObjectUpdate(spSpecNewExPlane1);
	//if (FAILED(rc))
	//{
	//	RDCDMUBFErrorMsgBox("提取出错！");
	//	return;
	//}
	//InsertInProceduralView(spSpecNewExPlane1,spSpecGSMToolExtractPlane);
	//HideSpecObj(spSpecNewExPlane1);
	//UpdateProduct(piInstanceProdOnHinge1Plane1);





	CATIPrtContainer_var spPrd2Con=GetConFromInstancePrd(piInstanceProdOnHinge1Plane2);


	CATIGSMTool_var spGSMToolCopyPlane=CreateGSMTool("复制面",spPrd2Con);
	CATISpecObject_var spSpecGSMToolCopyPlane=spGSMToolCopyPlane;

	CATISpecObject_var spSpecCopyedPlane=NULL_var;


	spSpecCopyedPlane=CopyWithLinkOnBRep(piInstanceProdOnHinge1Plane1,spiBRepHinge1Plane1,piInstanceProdOnHinge1Plane2,spSpecGSMToolCopyPlane,FALSE);
	if (NULL_var==spSpecCopyedPlane)
	{
		RDCDMUBFErrorMsgBox("提取出错！");
		return;

	}
	HRESULT rc=ObjectUpdate(spSpecCopyedPlane);
	if (FAILED(rc))
	{
		RDCDMUBFErrorMsgBox("复制出错！");
		return;
	}

	HideSpecObj(spSpecCopyedPlane);

	CATIAlias_var aliasOnCopyedPlane = spSpecCopyedPlane ;
	if ( NULL_var != aliasOnCopyedPlane)
	{
		cout <<aliasOnCopyedPlane->GetAlias().ConvertToChar() ;
	}


	//CATIGSMFactory* pGSMFactOnPrd2=NULL;
	//rc=spPrd2Con->QueryInterface(IID_CATIGSMFactory,(void**)&pGSMFactOnPrd2);
	//if (FAILED(rc)) {cout<<"通过新建Part的Container查询CATIGSMFactory 失败"<<endl;}

	//CATIGSMExtractSolide_var spExtractPlane2 = pGSMFactOnPrd2->CreateExtractSolide(spSpecCopyedPlane, ExtractSolide_NoPropag);
	//CATISpecObject_var spSpecNewExPlane2 = spExtractPlane2;
	//rc=ObjectUpdate(spSpecNewExPlane2);
	//if (FAILED(rc))
	//{
	//	RDCDMUBFErrorMsgBox("提取复制面出错！");
	//	return;
	//}
	//InsertInProceduralView(spSpecNewExPlane2,spSpecGSMToolCopyPlane);




	UpdateProduct(piInstanceProdOnHinge1Plane2);
	UpdateProduct(spRootProduct);

	CATISpecObject_var spCopyedPlane1OnPrd2=NULL_var;

	//抽取对象
	CATBody_var spBodyOnCopyedPlane=GetBodyFromFeature(spSpecCopyedPlane);
	CATLISTP(CATCell) lstResultOnCopyedPlane;
	spBodyOnCopyedPlane->GetAllCells(lstResultOnCopyedPlane,2);
	CATIBRepAccess_var spBRepOnCell = CATBRepDecodeCellInBody(lstResultOnCopyedPlane[1], spBodyOnCopyedPlane);
	CATIFeaturize_var spFeaturizeOnCopyedPlane = spBRepOnCell;
	if(spFeaturizeOnCopyedPlane!=NULL_var)
	{
		spCopyedPlane1OnPrd2=spFeaturizeOnCopyedPlane->FeaturizeR( MfPermanentBody|	MfLastFeatureSupport | 	MfRelimitedFeaturization);
	}


	////得到所选直线的向量


		CATBody_var spOffsetFaceBody1=GetBodyFromFeature(spPlane1);
	
		CATLISTP(CATCell) facecells1;
		spOffsetFaceBody1->GetAllCells(facecells1, 2);
	
		CATFace* pfacePlane1=(CATFace*)facecells1[1];

	
		CATSurface* pSurface1=pfacePlane1->GetSurface(NULL);
		CATSurParam* pSurEndParm1 =new CATSurParam();
		CATSurParam* pSurStartParm1 =new CATSurParam();
		pSurface1->GetEndLimit(*pSurEndParm1);
		pSurface1->GetStartLimit(*pSurStartParm1);
		double EndParamU1=pSurEndParm1->GetParamU();
		double EndParamV1=pSurEndParm1->GetParamV();
		double StartParamU1=pSurStartParm1->GetParamU();
		double StartParamV1=pSurStartParm1->GetParamV();
	
	
	
	
		CATMathPoint PtOnSp11;
		CATMathPoint PtOnSp12;
		CATMathPoint PtOnSp13;
	
		double CoodOfPt1[12]={0,0,0,0,0,0,0,0,0,0,0,0};
	
		CATSurParam* pSurParm1 =new CATSurParam();
		*pSurParm1=pSurface1->CreateParam(StartParamU1,StartParamV1);// (EndParamU-StartParamU)/3+  (EndParamV-StartParamV)/3+
		pSurface1->EvalPoint(*pSurParm1,PtOnSp11);
		PtOnSp11.GetCoord(CoodOfPt1[0],CoodOfPt1[1],CoodOfPt1[2]);
	
	
	
	
		*pSurParm1=pSurface1->CreateParam((EndParamU1-StartParamU1)*2/3+StartParamU1,(EndParamV1-StartParamV1)/3+StartParamV1);//   
		pSurface1->EvalPoint(*pSurParm1,PtOnSp12);
		PtOnSp12.GetCoord(CoodOfPt1[3],CoodOfPt1[4],CoodOfPt1[5]);
	
	
	
		*pSurParm1=pSurface1->CreateParam((EndParamU1-StartParamU1)/3+StartParamU1,(EndParamV1-StartParamV1)*2/3+StartParamV1);//   
		pSurface1->EvalPoint(*pSurParm1,PtOnSp13);
		PtOnSp13.GetCoord(CoodOfPt1[6],CoodOfPt1[7],CoodOfPt1[8]);
	
	
	
		CATMathPlane mathplane1(PtOnSp11,PtOnSp12,PtOnSp13);
	
		CATMathVector vecIni;
		mathplane1.GetNormal(vecIni);

	

	////得到所选直线的向量完毕
	//CATMathVector vecIni(1,1,1);



	CATIMovable_var spMoveOnPrd1=spPrd1;
	CATMathTransformation tranBeforJointPrd1;
	//CATMathVector vecIni(1,1,1);
	CATMathVector vecBefore;

	if (NULL_var!=spMoveOnPrd1)
	{
		spMoveOnPrd1->GetAbsPosition(tranBeforJointPrd1);
		vecBefore=tranBeforJointPrd1*vecIni;

		vecBefore.Dump();

	}
	//用复制过来的面代替第二个选择面完毕






	CATBaseUnknown* papiUnknownOnPlaneConnector2 = NULL;

	CATILinkableObject *pLinkPlane2 = NULL;

	if( spCopyedPlane1OnPrd2 != NULL_var )//spPlane2 spSpecCopyedPlane
	{
		HRESULT rc =spCopyedPlane1OnPrd2 ->QueryInterface(IID_CATILinkableObject ,(void **) &pLinkPlane2);//spPlane2
		if ( SUCCEEDED(rc) ) 
		{
			CATIConnector* spConnectorOnPlane2 = NULL;
			int xCreation = 0;

			HRESULT HR =::GetProductConnector(pLinkPlane2, spPrd2, spRootProduct, 0, spConnectorOnPlane2, xCreation);
			//old: GetProductConnector(spLinkableOnLine,(*pProductList)[i],spRootProduct);//
			if (spConnectorOnPlane2)
			{
				//CATMathTransformation* matrix4;
				//matrix4=spConnectorOnPlane2->GiveContext();
				//cout<<"spConnectorOnPlane2:";
				//matrix4->Dump();
				cout<<"得到spConnectorOnPlane2"<<endl;
				// Store the connector as a CATBaseUnknown
				HR = spConnectorOnPlane2->QueryInterface(IID_CATBaseUnknown, (void**)&papiUnknownOnPlaneConnector2);
				iConnectorList.Append(papiUnknownOnPlaneConnector2);
				papiUnknownOnPlaneConnector2->Release();
				papiUnknownOnPlaneConnector2 = NULL;
			}

		}
	}


	//cout<<"connecter数目："<<iConnectorList.Size()<<endl;
	//CATIKinMechanism* piMechanism = NULL;
	//CATIKinMechanismFactory* piDocumentAsMechanismFactory = NULL;
	//if (SUCCEEDED(pDoc->QueryInterface(IID_CATIKinMechanismFactory, (void**)&piDocumentAsMechanismFactory)))
	//{
	//	if (SUCCEEDED(piDocumentAsMechanismFactory->CreateInstance(&piMechanism)))
	//	{

	//====================================================================================
	// 5 - Create the joint
	//====================================================================================

	// Cylindrical joint from connectors
	CATIKinJoint* piJoint = NULL;
	const char* jointType = CATKinRevoluteJoint;
	boolean iCreateConstraintsForJoint = 1;
	cout<<"1111111"<<endl;
	HRESULT rcMe=piMechanism->AddJoint(jointType,&iConnectorList, iCreateConstraintsForJoint, &piJoint);
	if (FAILED(rcMe))
	{
		cout<<"旋转接合生成失败！"<<endl;
	}
	if (SUCCEEDED(rcMe))
	{
		cout<<"旋转接合生成成功！"<<endl;

	}
	if (!!piJoint)
	{
		cout<<"成功生成旋转接合"<<endl;
		//============================================================================
		// 6 - Create the length command
		//============================================================================
		//CATIKinCmd* piCmd = NULL;
		//const char* cmdType = CATKinLengthCmd;
		//if (SUCCEEDED(piMechanism->AddCommand(piJoint, cmdType, &piCmd)))
		//{
		//	cout<<"成功添加命令"<<endl;
		//	piCmd->Release();
		//	piCmd = NULL;
		CATLISTP(CATBaseUnknown)*  oConstraints=NULL;
		piJoint->GetConstraints(&oConstraints);
		cout<<"约束个数："<<oConstraints->Size()<<endl;
		//}
		CATICst* JointCon=NULL;
		HRESULT rc1 = (*oConstraints)[2]->QueryInterface(IID_CATICst ,(void **) &JointCon);
		if (SUCCEEDED(rc1))
		{
			cout<<"成功得到constraint"<<endl;
			CATCstType a=JointCon->GetCstType();
			if (CstType_Distance==a)//如果是偏移约束 则替换第二个面 spCopyedPlane1
			{
				cout<<"这个是偏移约束"<<endl;

				//CATBaseUnknown_var spBuPlane=NULL_var;
				//spBuPlane=spCopyedPlane1;
				//if (NULL_var!=spBuPlane)
				//{
				//	cout<<"spBuPlane不为空"<<endl;
				//	HRESULT rc=JointCon->SetElement(2,spBuPlane);
				//	if (FAILED(rc))
				//	{
				//		cout<<"替换第二个面你失败！！"<<endl;
				//	}

				//}

			}
			if (CstType_On==a)
			{
				cout<<"这个是相合约束"<<endl;
			}
			if (NULL==JointCon)
			{
				cout<<"旋转接合为空！！！！"<<endl;
				return;
			}
			cout<<"1"<<endl;
			JointCon->SetRealValue(0);//sameOrNotDir
			cout<<"2"<<endl;

			//double OriVal=SurNormalDir2*SurNormalDir;
			CATCstAttrType type=CATCstAttr_Orientation ;
			CATCstAttrVal Ori=CATCstVal_Orient_Same;
			JointCon->SetCstAttrValue(type,Ori);

			//if (CATCstVal_Orient_Same==Ori)
			//{
			//	cout<<"是同向的"<<endl;
			//}
			//if (CATCstVal_Orient_Opposite==Ori)
			//{
			//	cout<<"是反向的"<<endl;

			//}
		}

		piMechanism->UpdateAllJoints();
		if (NULL_var!=spMoveOnPrd1)
		{
			spMoveOnPrd1->GetAbsPosition(tranBeforJointPrd1);
			CATMathVector vecAfter;
			vecAfter=tranBeforJointPrd1*vecIni;
			vecAfter.Dump();
			CATAngle angleAfterTrans;
			angleAfterTrans=vecBefore.GetAngleTo(vecAfter);
			cout<<"连接的角度："<<angleAfterTrans*180/CATPI<<endl;
			cout<<"相减的值："<<angleAfterTrans*180/CATPI-180<<endl;
			double ro=fabs(angleAfterTrans*180/CATPI-180);
			int m=static_cast<int>(angleAfterTrans*180/CATPI);
			if (ro<1)//CATCstVal_Orient_Opposite
			{
				cout<<"接合翻转"<<endl;
				CATCstAttrType type=CATCstAttr_Orientation ;
				CATCstAttrVal Ori=CATCstVal_Orient_Opposite;
				JointCon->SetCstAttrValue(type,Ori);
				piMechanism->UpdateAllJoints();
				UpdateProduct(spRootProduct);

			}

		}
		piJoint->Release();
		piJoint = NULL;

	}

}


HRESULT TestCmd::SJDFaceDirectionIsInnerVolum(CATFace_var ispFace,CATVolume_var ispVolume,CATBoolean &oResult)
{
	HRESULT rc=E_FAIL;
	oResult = FALSE;

	//Check the input parameters
	if( !ispFace || !ispVolume ) return rc;

	//获取面(Face)的法向是指向体内还是体外
	CATSide faceSide=ispFace->GetMatterSide((CATCell *)ispVolume);
	//获取面(Face)与曲面(Surface)的法向是否同向
	CATOrientation cellOrient=ispFace->GetGeometryOrientation();

	//判断面的法向是否指向体内
	if( faceSide == CATSideLeft ) {  //Face的方向指向体内
		if( cellOrient == CATOrientationPositive ) //Face与Surface同向
			oResult = TRUE;  //法向指向体内
		else
			oResult = FALSE; //法向执行体外
	}
	else if( faceSide == CATSideRight ) { //Face的方向指向体外
		if( cellOrient == CATOrientationPositive ) //Face与Surface同向
			oResult = FALSE;  //法向指向体外
		else
			oResult = TRUE; //法向指向体内
	}

	return S_OK;
}

void TestCmd::OnPushButton192PushBActivateNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	_isFirstActive = FALSE;

	_Panel->SetVisibility(CATDlgHide);


	this->RequestStatusChange(CATCommandMsgDesactivated);



	CATCommand *pDSCmd=NULL;  //CATShapeDesignPointHdr    //CATHybridPartPoint
	HRESULT rc=::CATAfrStartCommand("CATSimulationExperimentHdr",pDSCmd);
	if( !!pDSCmd ) {
		int RC = pDSCmd->RequestStatusChange(CATCommandMsgRequestSharedMode);
	}


	_Panel->_PushButton195->SetSensitivity(CATDlgEnable);

}

void TestCmd::OnPushButton195PushBActivateNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	_isFirstReplay = FALSE;

	_Panel->SetVisibility(CATDlgHide);


	this->RequestStatusChange(CATCommandMsgDesactivated);



	CATCommand *pDSCmd=NULL;  //CATShapeDesignPointHdr    //CATHybridPartPoint
	HRESULT rc=::CATAfrStartCommand("CATSimulationCompileHdr",pDSCmd);//CATSimulationReplayHdr
	if( !!pDSCmd ) {
		int RC = pDSCmd->RequestStatusChange(CATCommandMsgRequestSharedMode);
	}
	_Panel->_PushButton187->SetSensitivity(CATDlgEnable);

}



CATStatusChangeRC TestCmd::Activate( CATCommand*  iFromClient,CATNotification*  iNotification)
{
	cout<<"执行这个"<<endl;
	HRESULT rc=E_FAIL;

	if( !!_Panel ) {
		_Panel->SetVisibility(CATDlgShow);
	}

	if( !_isFirstActive ) {

		_isFirstActive = TRUE;
	}
	if( !_isFirstReplay ) {

		_isFirstReplay = TRUE;
	}

	return CATStatusChangeRCCompleted;
}

void TestCmd::OnPushButton196PushBActivateNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here 生成包络按钮


	if (ExcelFileDirectory=="")
	{
		RDCDMUBFErrorMsgBox("请先选择储存位置！");
		return;

	}

	if (NULL_var==spSelPrdOnSweptPrd||spRefPrd==NULL_var)
	{
		RDCDMUBFErrorMsgBox("请先选择包络及参考零件！");
		return;
	}


	CATMathPoint MinOnSwept;
	CATMathPoint MathPtONFixed;
	CATIKinMechanism* piMechanism2 = NULL;
	CATIKinMechanismFactory* piMechanism2FactoryOnDocument = NULL;
	HRESULT HR = pDoc->QueryInterface(IID_CATIKinMechanismFactory,(void**)&piMechanism2FactoryOnDocument);
	if (SUCCEEDED(HR))
	{
		CATLISTP(CATBaseUnknown) ListOfMechanisms;
		HR = piMechanism2FactoryOnDocument->ListInstances (ListOfMechanisms);
		if (SUCCEEDED(HR))
		{
			// Read all the mechanisms of the document
			int nbMechanisms = ListOfMechanisms.Size();
			CATBaseUnknown * pMechanism_bu = NULL;

			pMechanism_bu = ListOfMechanisms[nbMechanisms];//最初用的是pMechanism_bu = ListOfMechanisms[1];
			CATUnicodeString fixedprd;
			double UpperLimit1=0;
			if (pMechanism_bu &&
				SUCCEEDED(pMechanism_bu->QueryInterface(IID_CATIKinMechanism,(void**)&piMechanism2)))
			{



				CATLISTP(CATBaseUnknown)* cmdList = NULL;
				CATBaseUnknown * pCmd_bu = NULL;
				HR = piMechanism2->GetCmdList(&cmdList);
				if (SUCCEEDED(HR) && cmdList)
				{
					cout << "   Command" <<endl << flush;

					int nbCmds = cmdList->Size();
					for (int l = 1;l<=nbCmds;l++)
					{
						cout << "      " << l << " : ";
						CATIKinCmd* piCmd = NULL;
						pCmd_bu = (*cmdList)[l];

						if (pCmd_bu)
						{
							if (SUCCEEDED(pCmd_bu->QueryInterface(IID_CATIKinCmd,(void**)&piCmd)))
							{

								// Get the command type
								const char* cmdType = NULL;
								HR =piCmd->GetType(&cmdType);
								if (SUCCEEDED(HR)) 
								{
									cout << cmdType << "; ";
								}

								// Get the joint associated to the command
								CATIKinJoint* papiAssociatedJoint = NULL; 
								HR =piCmd->GetJoint(&papiAssociatedJoint);
								if (SUCCEEDED(HR))
								{



									cout<< "joint Ok;";

									int exis=0;
									papiAssociatedJoint->GetUpperLimit1(&exis,&UpperLimit1);//得到点线运动长度
									cout<<"exis="<<exis<<endl;
									cout<<"dis="<<UpperLimit1<<endl;

									papiAssociatedJoint->Release();
									papiAssociatedJoint = NULL;
								}
								cout << endl << flush;
								piCmd->Release();
								piCmd = NULL;
							}
							pCmd_bu->Release();
							pCmd_bu = NULL;
						}
					}
					cout << "   EndCommand" << endl << flush;

					// Get the value of each command of the mechanism
					//        CATListOfDouble ListCommandValue;
					//HR = piMechanism->GetCmdValues(&ListCommandValue);
					//        if (SUCCEEDED(HR))
					//        {
					//          outputFile << "   Command values : ";
					//          for (int l = 0; l < ListCommandValue.Size(); l++) {outputFile << ListCommandValue[l] << "; ";}
					//          outputFile << endl << flush;
					//        }
					if (cmdList)
					{
						delete cmdList;
						cmdList = NULL;
					}
				}






				//创建距离节点
				CATIProduct_var spSweptFeatureToMeasureVB=LISTProdOfSwepTPart[1];


				CATIAProduct * iVBProductRoot=NULL;
				HRESULT rc = spRootProduct->QueryInterface(IID_CATIAProduct, (void **)&iVBProductRoot);
				if(FAILED(rc) || iVBProductRoot==NULL)
				{
					cout<<"Failed QI iVBProductRoot"<<endl;
					return;
				}
				else
					cout<<"Succeed QI iVBProductRoot"<<endl;

				CATBaseDispatch  *iBaseTechnologicalObjectOnGroups = NULL;
				CATBaseDispatch  *iBaseTechnologicalObjectOnDistances = NULL;


				CATBSTR bstrGroups;
				CATUnicodeString strUni="Groups";
				strUni.ConvertToBSTR(&bstrGroups);//strFullPath



				CATBSTR bstrDistances;
				CATUnicodeString strUniDis="Distances";
				strUniDis.ConvertToBSTR(&bstrDistances);//strFullPath


				rc=iVBProductRoot->GetTechnologicalObject(bstrGroups,iBaseTechnologicalObjectOnGroups);
				if (SUCCEEDED(rc)&&iBaseTechnologicalObjectOnGroups != NULL)
				{
					cout<<"得到iBaseTechnologicalObjectOnGroups"<<endl;
				}
				rc=iVBProductRoot->GetTechnologicalObject(bstrDistances,iBaseTechnologicalObjectOnDistances);
				if (SUCCEEDED(rc)&&iBaseTechnologicalObjectOnDistances != NULL)
				{
					cout<<"得到iBaseTechnologicalObjectOnDistances"<<endl;
				}


				CATIADistances *piDistancesObj=NULL;
				rc = iBaseTechnologicalObjectOnDistances->QueryInterface(IID_CATIADistances, (void **)&piDistancesObj);
				if(FAILED(rc) || piDistancesObj==NULL)
				{
					cout<<"Failed QI piDistancesObj"<<endl;
					return;
				}
				else
					cout<<"Succeed QI piDistancesObj"<<endl;

				CATIADistance *piDistance=NULL;
				piDistancesObj->Add(piDistance);
				CatDistanceComputationType DisCompType;
				DisCompType=catDistanceComputationTypeBetweenTwo;

				piDistance->put_ComputationType(DisCompType);

				CatDistanceMeasureType MeaType;
				MeaType=catDistanceMeasureTypeMinimum;
				piDistance->put_MeasureType(MeaType);




				CATIAGroups *piGroupsRoot=NULL;
				rc = iBaseTechnologicalObjectOnGroups->QueryInterface(IID_CATIAGroups, (void **)&piGroupsRoot);
				if(FAILED(rc) || piGroupsRoot==NULL)
				{
					cout<<"Failed QI piGroupsRoot"<<endl;
					return;
				}
				else
					cout<<"Succeed QI piGroupsRoot"<<endl;
				CATIAGroup *piGroupsSwept=NULL;
				CATIAGroup *piGroupsRef=NULL;
				piGroupsRoot->Add(piGroupsSwept);
				piGroupsRoot->Add(piGroupsRef);


				CATBaseDispatch *piBaseSweptPrd=NULL;
				rc = spSweptFeatureToMeasureVB->QueryInterface(IID_CATBaseDispatch, (void **)&piBaseSweptPrd);
				CATBaseDispatch *piBaseRefPrd=NULL;
				rc = spRefPrd->QueryInterface(IID_CATBaseDispatch, (void **)&piBaseRefPrd);


				if (NULL==piBaseSweptPrd||NULL==piBaseRefPrd)
				{
					cout<<"product为空"<<endl;
				}


				piGroupsSwept->AddExplicit(piBaseSweptPrd);
				piGroupsRef->AddExplicit(piBaseRefPrd);



				//piGroupsSwept->put_ExtractMode (1);
				//piGroupsRef->put_ExtractMode (1);
				//piGroupsSwept->FillSelWithExtract();
				//piGroupsRef->FillSelWithExtract();

				piDistance->put_FirstGroup(piGroupsSwept);
				piDistance->put_SecondGroup(piGroupsRef);

				piDistance->Compute();
				double minVBDis=0;
				piDistance->get_Value(minVBDis);
				cout<<"最小距离是："<<minVBDis<<endl;




				//return;

				//创建距离节点完毕



					//Get the value of each command of the mechanism
					int size=1;
					double* InitListCommandValue;
					HR = piMechanism2->GetCmdValues(&size,&InitListCommandValue);
					if (SUCCEEDED(HR))
					{
						cout << "   Command values : ";
						cout << *InitListCommandValue << "; ";
						cout << endl << flush;
					}





					vector<double> d_vec;

					CATLISTV(CATMathPoint) MathPtOfSwept;
					CATLISTV(CATMathPoint) MathPtOfFixed;

					int step=_Panel->_Editor168 -> GetIntegerValue();
					double mindisVB=0;


					double CoordOfSwept[3]={0,0,0};
					double CoordOfRef[3]={0,0,0};

					CATSafeArrayVariant * pArrayVariantOfSwept = BuildSafeArrayVariant(CoordOfSwept, 3);
					CATSafeArrayVariant * pArrayVariantOfRef = BuildSafeArrayVariant(CoordOfRef, 3);



					for (int i=1;i<=step;i++)//100
					{


						////测量工具的方法测距
						//double mindis=0;
						//CATIProduct_var spSweptFeatureToMeasure=LISTProdOfSwepTPart[1];
						//CATMathPoint p1OnSwept;
						//CATMathPoint p2OnRefPrd;
						//HRESULT ri=GetDistanceBetweenProductsAtPosition(spRefPrd,spSweptFeatureToMeasure,mindis,p1OnSwept,p2OnRefPrd);
						//if(FAILED(ri))
						//{
						//	cout<<"测距失败！"<<endl;
						//}
						//MathPtOfSwept.Append(p1OnSwept);
						//MathPtOfFixed.Append(p2OnRefPrd);

						////测量工具的方法测距完毕




						//DMU测距方法


						piDistance->Compute();
						piDistance->get_Value(mindisVB);

						piDistance->GetFirstPointCoordinates(*pArrayVariantOfSwept);
						piDistance->GetSecondPointCoordinates(*pArrayVariantOfRef);

						ConvertSafeArrayVariant(pArrayVariantOfSwept,CoordOfSwept,3);
						ConvertSafeArrayVariant(pArrayVariantOfRef,CoordOfRef,3);

						CATMathPoint p1OnSwept(CoordOfSwept);
						CATMathPoint p2OnRefPrd(CoordOfRef);

						MathPtOfSwept.Append(p1OnSwept);
						MathPtOfFixed.Append(p2OnRefPrd);



						//DMU测距方法完毕




						d_vec.push_back(mindisVB);
						cout<<"距离为："<<mindisVB<<endl;



						double a=UpperLimit1/step*i;
						double* ListCommandValueToSet=&a;

						piMechanism2->SetCmdValues(1,ListCommandValueToSet);

					}
					//piMechanism2->SetCmdValues(1,InitListCommandValue);//放置在初始位置

//return;

					//vector <double>::iterator it;
					double tempMin=d_vec[0];
					int index=0;

					for (int i=0; i<d_vec.size(); i++)
					{
						if (tempMin>d_vec[i])
						{
							tempMin=d_vec[i];
							index=i;

						}
					}
					cout<<"最小距离为："<<tempMin<<endl;
					cout<<"位置为："<<index*UpperLimit1/step<<endl;
					double posMin=index*UpperLimit1/step;
					double *MinDoorPos=&posMin;

					piMechanism2->SetCmdValues(1,MinDoorPos);//放置在距离最小的位置
					piDistance->Compute();

					CATUnicodeString strMinDis;
					CATUnicodeString strDoorPos;

					strMinDis.BuildFromNum(tempMin);
					strDoorPos.BuildFromNum(index*UpperLimit1/step);

					cout<<"1"<<endl;
					strMinDis=strMinDis+"mm";
					strDoorPos=strDoorPos+"mm";

					_Panel->_Editor163 -> SetText(strMinDis);
					_Panel->_Editor170 -> SetText(strDoorPos);
					cout<<"2"<<endl;


					MinOnSwept=MathPtOfSwept[index+1];
					MathPtONFixed=MathPtOfFixed[index+1];

					cout<<"3"<<endl;





					////向excel写数据

					//cout<<"写excel"<<endl;
					//ExcelFileDirectory+="\\MinDistanseTable.xlsx";
					////CString strFile = _T("D:\\MinDistanseTable.xlsx");
					//CString strFile =ExcelFileDirectory.ConvertToChar();
					//cout<<"合成excel文件的路径是："<<ExcelFileDirectory<<endl;

					////system("pause");

					//COleVariant 
					//	covTrue((short)TRUE), 
					//	covFalse((short)FALSE), 
					//	covOptional((long)DISP_E_PARAMNOTFOUND,   VT_ERROR); 

					//_Application app;
					//_Workbook book;
					//Workbooks books;
					//_Worksheet sheet;
					//Worksheets sheets;
					//Range range;
					//CFont font;

					//if (!app.CreateDispatch(_T("Excel.Application")))
					//{
					//	::MessageBox( NULL, _T( "Create Excel Service Failed！" ), _T( "Error！" ), MB_OK | MB_ICONERROR);
					//}


					//books.AttachDispatch(app.GetWorkbooks());//可代替上面一行

					//book.AttachDispatch(books.Add(covOptional),true); //可代替上面一行
					//sheets.AttachDispatch(book.GetWorksheets(),true); //可代替上面一行
					//sheet.AttachDispatch(sheets.GetItem(_variant_t("sheet1")),true); //可代替上面一行



					//////下面两行，是向A1中写入"Yeah!I can write data to excel!"
					//range = sheet.GetRange(COleVariant(_T("A1")),COleVariant(_T("A1"))); 
					////range.SetValue2(COleVariant(_T("Yeah!I can write data to excel!")));

					//////下面是向第二行的前十个单元格中输入1到10，十个数字
					////for(long i=1;i<11;i++)
					////	range.SetItem(_variant_t((long)2),_variant_t((long)i),_variant_t((long)i));


					//int currentcount;
					//currentcount =d_vec.size();
					//cout<<"行数为："<<currentcount<<endl;

					//if (currentcount==0)
					//{
					//	cout<<"这里？"<<endl;
					//	CString war="无记录";
					//	AfxMessageBox(war);
					//	return;
					//}
					//else
					//{

					//	//写表头
					//	CATUnicodeString oCellHead[2];

					//	oCellHead[0]="滑移门位置";
					//	oCellHead[1]="最小间距";

					//	//cout<<oCellContent[0]<<endl;

					//	CString strFileName3 = oCellHead[0].ConvertToChar();
					//	//cout<<strFileName1<<endl;
					//	CString strFileName4 = oCellHead[1].ConvertToChar();
					//	//cout<<strFileName2<<endl;


					//	range.SetItem(_variant_t((long)1),_variant_t(1),_variant_t(strFileName3));

					//	CString strExcelItem1 = oCellHead[1].ConvertToChar();//_variant_t(strFileName2)

					//	range.SetItem(_variant_t((long)1),_variant_t(2),_variant_t(strFileName4));

					//	//写表头完毕



					//	CATUnicodeString oCellContent[2];

					//	for (int i=0;i<currentcount;i++)
					//	{
					//		//_Panel->_MultiList012->GetColumnItem(0, oCellContent[0], i);
					//		//_Panel->_MultiList012->GetColumnItem(1, oCellContent[1], i);
					//		oCellContent[0].BuildFromNum(i*UpperLimit1/step);
					//		oCellContent[1].BuildFromNum(d_vec[i]);

					//		//cout<<oCellContent[0]<<endl;

					//		CString strFileName1 = oCellContent[0].ConvertToChar();
					//		//cout<<strFileName1<<endl;
					//		CString strFileName2 = oCellContent[1].ConvertToChar();
					//		//cout<<strFileName2<<endl;


					//		range.SetItem(_variant_t((long)i+2),_variant_t(1),_variant_t(strFileName1));

					//		CString strExcelItem1 = oCellContent[1].ConvertToChar();//_variant_t(strFileName2)

					//		range.SetItem(_variant_t((long)i+2),_variant_t(2),_variant_t(strFileName2));


					//	}

					//}



					//////折线图
					////_Chart          chart;  
					////ChartObjects    chartobjects;  
					////Charts          charts;  
					////LPDISPATCH      lpDisp;  
					////VARIANT var; // ChartWizard needs a Variant for the Source range.  


					////long left, top, width, height;  
					////left = 150;  
					////top = 10;  
					////width = 350;  
					////height = 250;  

					////lpDisp = sheet.ChartObjects(covOptional); 
					////ASSERT(lpDisp); 
					////chartobjects.AttachDispatch(lpDisp); 

					////ChartObject chartobject = chartobjects.Add(left, top, width, height); 
					////chart.AttachDispatch(chartobject.GetChart()); 
					////chart.SetChartType(4); // xlXYScatterLines = 74 
					////var.vt = VT_DISPATCH; 




					////int RowUp=2;
					////int RowDown=currentcount+1;

					////CATUnicodeString strRowUp;
					////strRowUp.BuildFromNum(RowUp);

					////CATUnicodeString strRowDown;
					////strRowDown.BuildFromNum(RowDown);


					////CATUnicodeString strA="A";
					////CATUnicodeString strB="B";

					////CATUnicodeString strXValuesUp=strA+strRowUp;
					////CString cstrXValuesUp =strXValuesUp.ConvertToChar();

					////CATUnicodeString strXValuesDown=strA+strRowDown;
					////CString cstrXValuesDown =strXValuesDown.ConvertToChar();


					////CATUnicodeString strYValuesUp=strB+strRowUp;
					////CString cstrYValuesUp =strYValuesUp.ConvertToChar();

					////CATUnicodeString strYValuesDown=strB+strRowDown;
					////CString cstrYValuesDown =strYValuesDown.ConvertToChar();



					////SeriesCollection serc = chart.SeriesCollection(covOptional); 
					////Series sercies = serc.NewSeries(); 
					////lpDisp = sheet.GetRange(_variant_t(cstrXValuesUp), _variant_t(cstrXValuesDown)); 
					////var.pdispVal = lpDisp; 
					////sercies.SetXValues(var); 

					////lpDisp = sheet.GetRange(_variant_t(cstrYValuesUp), _variant_t(cstrYValuesDown)); 
					////var.pdispVal = lpDisp; 
					////sercies.SetValues(var); 
					////CString strSerciesName ="系列";

					////sercies.SetName(strSerciesName); 



					//////chart.ChartWizard(covOptional,                    // Source.  
					//////	covOptional,  // Gallery: 3d Column.  
					//////	covOptional,             // Format, use default.  
					//////	covOptional,   // PlotBy: xlRows.  
					//////	covOptional,   // CategoryLabels.  
					//////	covOptional,   // SeriesLabels.  
					//////	covOptional,  // HasLegend.  
					//////	_variant_t("最小间隙运动曲线图"),  // Title.  
					//////	_variant_t("滑移门位置"),    // CategoryTitle.  
					//////	_variant_t("最小间距"),  // ValueTitles.  
					//////	covOptional              // ExtraTitle.  
					//////	);  



					//////chart.Location(2, _variant_t("Sheet2")); 
					//////chart.SetHasTitle(TRUE); 

					////CString strChartTitle ="最小间隙运动曲线图";

					////ChartTitle charttitle = chart.GetChartTitle(); 
					////charttitle.SetText(strChartTitle); 

					////Axis axis = chart.Axes(_variant_t((long)1), 1); 
					////axis.SetHasTitle(TRUE); 
					////AxisTitle axistitle = axis.GetAxisTitle(); 
					////CString strXTitle ="滑移门位置（mm）";

					////axistitle.SetText(strXTitle); 

					////axis = chart.Axes(_variant_t((long)2), 1); 
					////axis.SetHasTitle(TRUE); 
					////axistitle = axis.GetAxisTitle();
					////CString strYTitle ="最小间距（mm）";

					////axistitle.SetText(strYTitle); 
					//////app.SetDisplayAlerts(false);


					//////折线图






					////设置列宽
					//range = sheet.GetRange(COleVariant(_T("A1")),COleVariant(_T("J1")));
					//range.SetColumnWidth(_variant_t((long)10));

					////显示表格
					//app.SetVisible(TRUE);

					////保存
					//book.SaveCopyAs(COleVariant(strFile)); 
					//book.SetSaved(true);

					////结尾，释放
					//book.ReleaseDispatch();   
					//books.ReleaseDispatch();
					//sheet.ReleaseDispatch(); 
					//sheets.ReleaseDispatch(); 
					//app.ReleaseDispatch();
					//app.Quit(); 
					//d_vec.clear();

					////向excel写数据完毕



					//新方法写excel
					SJDExcelClass Excel;
					CATBoolean createxcel=Excel.CreateExcel();
					if (createxcel)
					{
						//CATUnicodeString FileName = "D:\\MinDistanseTable1.xlsx";

						//CATBoolean Open=Excel.OpenExcel(FileName);


						CString strChartTitle ="最小间隙运动曲线图";
						CString strXTitle ="X标题";
						CString strYTitle ="Y标题";



						//获取时间
						time_t rawtime;

						time ( &rawtime );
						//printf("%ld\n", &rawtime);
						//printf ( "The current local time is: %s", ctime (&rawtime) );

						char * time = ctime(&rawtime);
						//ctime(&rawtime) : time_t/timestampe -> "Www Mmm dd hh:mm:ss yyyy" format
						cout<< time << endl;
						//printf("%s", asctime(gmtime(&rawtime)));// asctime(gmtime(&rawtime)) = ctime(&rawtime);
						//here gmtime(&rawtime) : time_t(timpstampe) -> struct tm
						//here asctime(gmtime) : struct tm -> "Www Mmm dd hh:mm:ss yyyy" format 


						struct tm * ptm;
						ptm = gmtime(&rawtime);

						cout<<(ptm->tm_year + 1900)<<"year "<<(ptm->tm_mon + 1)<<"month "<<(ptm->tm_mday)<<"day "<<(ptm
							->tm_hour)<<":"<<(ptm->tm_min)<<":"<<(ptm->tm_sec)<<endl;
						CATUnicodeString timeyear;
						CATUnicodeString timemonth;
						CATUnicodeString timeday;
						CATUnicodeString timehour;
						CATUnicodeString timemin;
						CATUnicodeString timesec;

						timeyear.BuildFromNum(ptm->tm_year + 1900);
						timemonth.BuildFromNum(ptm->tm_mon + 1);
						timeday.BuildFromNum(ptm->tm_mday);
						timehour.BuildFromNum(ptm->tm_hour+8);
						timemin.BuildFromNum(ptm->tm_min);
						timesec.BuildFromNum(ptm->tm_sec);




						CATUnicodeString timestamp;
						//timestamp.BuildFromNum(i);
						timestamp=timeyear+timemonth+timeday+timehour+timemin+timesec;
						//获取时间完毕




						ExcelFileDirectory=ExcelFileDirectory+timestamp+".xlsx";
						CATUnicodeString oCellHead[2];

						oCellHead[0]="滑移门位置";
						oCellHead[1]="最小间距";

						Excel.WriteCellData(1,1,oCellHead[0]);
						Excel.WriteCellData(1,2,oCellHead[1]);

						cout<<"1"<<endl;
						for (int i=0;i<d_vec.size();i++)
						{
						Excel.WriteCellDoubleData(i+2, 1,i*UpperLimit1/step);       //E
						Excel.WriteCellDoubleData(i+2, 2,d_vec[i]);       //E

						}

						//Excel.CreatChartObjects(100,10,350,250,"A2:A10",strChartTitle,strXTitle,strYTitle);
						cout<<"2"<<endl;

						Excel.CreatLineChartObjects(130,10,350,250,d_vec.size(),strChartTitle,strXTitle,strYTitle);

						Excel.SaveExcelFile(ExcelFileDirectory.CastToCharPtr(), TRUE);



					}


					//新方法写excel完毕








					////做出最近距离点





					////固定零件上的

					//cout<<"得到container之前"<<endl;

					//CATIPrtContainer_var spRefPrdCon=GetConFromInstancePrd(spRefPrd);
					//if (NULL_var==spRefPrdCon)
					//{
					//	cout<<"不能得到container"<<endl;
					//	return;
					//}
					//cout<<"得到container之后"<<endl;

					//CATIGSMFactory* pGSMFactOnRefPrd=NULL;
					//HRESULT rcCont=spRefPrdCon->QueryInterface(IID_CATIGSMFactory,(void**)&pGSMFactOnRefPrd);
					//if (FAILED(rcCont)) {cout<<"通过新建Part的Container查询CATIGSMFactory 失败"<<endl;}


					//CATICkeParmFactory_var spParmFactoryOnRefPrd=NULL_var;
					//rcCont=spRefPrdCon->QueryInterface(IID_CATICkeParmFactory,(void**)&spParmFactoryOnRefPrd);
					////CATIParmDictionary_var spParamDict = CATCkeGlobalFunctions::GetParmDictionary();


					//CATIGSMTool_var spGSMToolRefPrd=CreateGSMTool("参考零件最近点",spRefPrdCon);




					////double *TransRef=new double[12];
					////piMechanism2->GetProductMotion(spRefPrd,&TransRef);
					////CATMathTransformation RefPrtPosition(TransRef);
					////CATMathTransformation InverseRefPrtPosition;

					////RefPrtPosition.Inverse(InverseRefPrtPosition);
					////CATMathPoint ParmMathPtONFixed=InverseRefPrtPosition*MathPtONFixed;



					//CATICkeParm_var Xe = spParmFactoryOnRefPrd->CreateLength ( "X", MathPtONFixed.GetX()/1000 );
					//CATICkeParm_var Ye = spParmFactoryOnRefPrd->CreateLength ( "Y", MathPtONFixed.GetY()/1000);
					//CATICkeParm_var Ze = spParmFactoryOnRefPrd->CreateLength ( "Z", MathPtONFixed.GetZ()/1000 );
					//cout<<"1"<<endl;
					//CATIGSMPointCoord_var spPointOnRefPrd = pGSMFactOnRefPrd->CreatePoint(Xe,Ye,Ze); 
					//cout<<"2"<<endl;

					//CATISpecObject_var spiOnRefPrd=spPointOnRefPrd;

					//ObjectUpdate(spiOnRefPrd);
					//cout<<"3"<<endl;

					//InsertInProceduralView(spiOnRefPrd,spGSMToolRefPrd);



					//////固定零件内做扫略零件的最近点
					////CATICkeParm_var Xe2 = spParmFactoryOnRefPrd->CreateLength ( "X", MinOnSwept.GetX()/1000 );
					////CATICkeParm_var Ye2 = spParmFactoryOnRefPrd->CreateLength ( "Y", MinOnSwept.GetY()/1000);
					////CATICkeParm_var Ze2 = spParmFactoryOnRefPrd->CreateLength ( "Z", MinOnSwept.GetZ()/1000 );
					////cout<<"1"<<endl;
					////CATIGSMPointCoord_var spPointOnRefPrd2 = pGSMFactOnRefPrd->CreatePoint(Xe2,Ye2,Ze2); 
					////cout<<"2"<<endl;

					////CATISpecObject_var spiOnRefPrd2=spPointOnRefPrd2;

					////ObjectUpdate(spiOnRefPrd2);
					////cout<<"3"<<endl;

					////InsertInProceduralView(spiOnRefPrd2,spGSMToolRefPrd);










					////扫略零件



					//CATIPrtContainer_var spSwepPrdCon=GetConFromInstancePrd(spSelPrdOnSweptPrd);
					//CATIGSMFactory* pGSMFactOnSwpPrd=NULL;
					//HRESULT rcCont1=spSwepPrdCon->QueryInterface(IID_CATIGSMFactory,(void**)&pGSMFactOnSwpPrd);
					//if (FAILED(rcCont1)) {cout<<"通过新建Part的Container查询CATIGSMFactory 失败"<<endl;}


					//CATICkeParmFactory_var spParmFactoryOnSwpPrd=NULL_var;
					//rcCont1=spSwepPrdCon->QueryInterface(IID_CATICkeParmFactory,(void**)&spParmFactoryOnSwpPrd);


					//CATIGSMTool_var spGSMToolSwepPrd=CreateGSMTool("扫略零件最近点",spSwepPrdCon);


					//CATICkeParm_var Xe1 = spParmFactoryOnSwpPrd->CreateLength ( "X", MinOnSwept.GetX()/1000 );
					//CATICkeParm_var Ye1 = spParmFactoryOnSwpPrd->CreateLength ( "Y", MinOnSwept.GetY()/1000);
					//CATICkeParm_var Ze1 = spParmFactoryOnSwpPrd->CreateLength ( "Z", MinOnSwept.GetZ()/1000 );
					//cout<<"1"<<endl;
					//CATIGSMPointCoord_var spPointOnSwepPrd = pGSMFactOnSwpPrd->CreatePoint(Xe1,Ye1,Ze1); 
					//cout<<"2"<<endl;

					//CATISpecObject_var spiOnSwepPrd=spPointOnSwepPrd;

					//ObjectUpdate(spiOnSwepPrd);
					//cout<<"3"<<endl;

					//InsertInProceduralView(spiOnSwepPrd,spGSMToolSwepPrd);


					////扫略零件建点完毕






					////做出最近距离点完毕


				piMechanism2->Release();
				piMechanism2 = NULL;





			}

			// Release the elements of the list
			for (int i = 1;i<=nbMechanisms;i++)
			{
				pMechanism_bu = ListOfMechanisms[i];
				if (pMechanism_bu)
				{
					pMechanism_bu->Release();
					pMechanism_bu = NULL;
				}
			}
			ListOfMechanisms.RemoveAll();
			cout<<"4"<<endl;

		}
		piMechanism2FactoryOnDocument->Release();
		piMechanism2FactoryOnDocument = NULL;
		cout<<"5"<<endl;

	}



//return;


	//1、获得Replay
	//ReplayFactory
	CATIReplayFactory * piReplayFactory = NULL;
	HRESULT rc = pDoc->QueryInterface(IID_CATIReplayFactory, (void**)&piReplayFactory);
	if(FAILED(rc) || piReplayFactory==NULL)
	{
		cout<<"Failed QI piReplayFactory"<<endl;
		return;
	}
	else
		cout<<"Succeed QI piReplayFactory"<<endl;

	//Replay List
	CATIReplayList* piListOfReplays = new CATIReplayList();
	rc = piReplayFactory->ListReplays (piListOfReplays);
	if(FAILED(rc))
	{
		cout<<"Failed ListReplays"<<endl;
		return;
	}

	//first Replay
	CATIReplay * piReplay = NULL;
	if( piListOfReplays->Size() > 0 ) 
	{
		piReplay = (*piListOfReplays)[1];
		if(piReplay==NULL)
		{
			cout<<"piReplay == NULL"<<endl;
			return;
		}
	}
	delete piListOfReplays;
	piListOfReplays = NULL;

	CATIAReplay * piCATIAReplay = NULL;
	rc = piReplay->QueryInterface(IID_CATIAReplay, (void **)&piCATIAReplay);
	if(FAILED(rc) || piCATIAReplay==NULL)
	{
		cout<<"Failed QI piCATIAReplay"<<endl;
		return;
	}
	else
		cout<<"Succeed QI piCATIAReplay"<<endl;

	//2、获得需要创建包络的product	
	//CATIProduct_var spRootPrd = spRootProduct;//获得Root Product
	//CATListValCATBaseUnknown_var * pListPrd = spRootPrd->GetAllChildren();

	CATIProduct_var spPrdSweptRef;
	spPrdSweptRef = spFixedProduct;
	if (NULL_var==spPrdSweptRef)
	{
		cout<<"NULL_var==spPrdSweptRef"<<endl;
	}

	CATIAProduct * iProductReference=NULL;
	rc = spPrdSweptRef->QueryInterface(IID_CATIAProduct, (void **)&iProductReference);
	if(FAILED(rc) || iProductReference==NULL)
	{
		cout<<"Failed QI iProductReference"<<endl;
		return;
	}
	else
		cout<<"Succeed QI iProductReference"<<endl;

	//CATUnicodeString strInstanceName;
	//for(int i=1; i<=pListPrd->Size(); i++)
	//{
	//	spPrdSwept = (*pListPrd)[i];

	//	spPrdSwept->GetPrdInstanceName(strInstanceName);
	//	cout<<strInstanceName<<endl;

	//	if(strInstanceName=="Rod.1")
	//		spPrdSwept1 = spPrdSwept;
	//	//if(strInstanceName=="Rod.2")
	//	//	spPrdSwept2 = spPrdSwept;
	//	//if(strInstanceName=="Rod.4")
	//	//	spPrdSwept3 = spPrdSwept;
	//}

	//3、获得创建包络的接口
	//SweptVolumeFactory
	CATISweptVolumeFactory * piSweptVolumeFactory = NULL;
	rc = pDoc->QueryInterface(IID_CATISweptVolumeFactory, (void **)&piSweptVolumeFactory);
	if(FAILED(rc) || piSweptVolumeFactory==NULL)
	{
		cout<<"Failed QI piSweptVolumeFactory"<<endl;
		return;
	}
	else
		cout<<"Succeed QI piSweptVolumeFactory"<<endl;

	//4、创建包络

	//CATBaseDispatch * iBaseDispatch2 = NULL;
	//rc = spPrdSwept2->QueryInterface(IID_CATBaseDispatch, (void**)&iBaseDispatch2);
	//if(FAILED(rc) || iBaseDispatch2==NULL)
	//{
	//	cout<<"Failed QI iBaseDispatch2"<<endl;
	//	return TRUE;
	//}
	//else
	//	cout<<"Succeed QI iBaseDispatch2"<<endl;

	//CATBaseDispatch * iBaseDispatch3 = NULL;
	//rc = spPrdSwept3->QueryInterface(IID_CATBaseDispatch, (void**)&iBaseDispatch3);
	//if(FAILED(rc) || iBaseDispatch3==NULL)
	//{
	//	cout<<"Failed QI iBaseDispatch3"<<endl;
	//	return TRUE;
	//}
	//else
	//	cout<<"Succeed QI iBaseDispatch3"<<endl;


	//输入列表
	//将需要创建包络的product转为basedispatch格式

	int NumOfSwepTPart=LISTProdOfSwepTPart.Size();
	cout<<"需要计算的包络体个数："<<NumOfSwepTPart<<endl;
	CATBaseDispatch ** iObjectArray = new CATBaseDispatch *[NumOfSwepTPart];

	for (int i=0;i<NumOfSwepTPart;i++)
	{

		CATIProduct_var spPrdSwept1;
		//CATIProduct_var spPrdSwept2;
		//CATIProduct_var spPrdSwept3;

		spPrdSwept1 = LISTProdOfSwepTPart[i+1];
		if (NULL_var==spPrdSwept1)
		{
			cout<<"NULL_var==spPrdSwept1"<<endl;
		}

		CATBaseDispatch * iBaseDispatch1 = NULL;
		rc = spPrdSwept1->QueryInterface(IID_CATBaseDispatch, (void**)&iBaseDispatch1);
		if(FAILED(rc) || iBaseDispatch1==NULL)
		{
			cout<<"Failed QI iBaseDispatch1"<<endl;
			return;
		}
		else
			cout<<"Succeed QI iBaseDispatch1"<<endl;


		if (iBaseDispatch1==NULL)
		{
			cout<<"Failed QI iBaseDispatch1"<<endl;

		}

		iObjectArray[i] = iBaseDispatch1;

		//cout<<"0.1"<<endl;
		//iBaseDispatch1 -> Release();
		//cout<<"0.2"<<endl;

		//iBaseDispatch1 = NULL;
		//cout<<"0.3"<<endl;


	}
	//iObjectArray[1] = iBaseDispatch2;
	//iObjectArray[2] = iBaseDispatch3;
	cout<<"0.4"<<endl;
	CATSafeArrayVariant * pArrayVariant = BuildSafeArrayVariant((const CATBaseDispatch **)iObjectArray, NumOfSwepTPart);

	cout<<"1"<<endl;

	//输出列表
	CATBaseDispatch ** iObjectArrayOut = new CATBaseDispatch *[NumOfSwepTPart];
	for (int i=0;i<NumOfSwepTPart;i++)
	{
		iObjectArrayOut[i] = NULL;


	}
	//iObjectArrayOut[1] = NULL;
	//iObjectArrayOut[2] = NULL;
	CATSafeArrayVariant * oSweptVolumeDocuments=
		::BuildSafeArrayVariant((const CATBaseDispatch **)iObjectArrayOut,NumOfSwepTPart);

	cout<<"2"<<endl;

	//CATSafeArrayVariant oSweptVolumeDocuments;
	//创建包络
	//CATSafeArrayVariant oSweptVolumeDocuments;
	if (NULL==piCATIAReplay)
	{
		cout<<"NULL==piCATIAReplay"<<endl;
	}
	if (NULL==iProductReference)
	{
		cout<<"NULL==iProductReference"<<endl;
	}
	cout<<"ComputeSweptVolumesFromReplay之前"<<endl;
	rc = piSweptVolumeFactory->ComputeSweptVolumesFromReplay(piCATIAReplay, 
		*pArrayVariant,iProductReference, 0, 0.200000, 0, 0, -1.000000, -1.000000, -1.000000, *oSweptVolumeDocuments);
	cout<<"ComputeSweptVolumesFromReplay之后"<<endl;

	cout<<"3"<<endl;
	if(FAILED(rc))
	{
		cout<<"Failed ComputeSweptVolumesFromReplay"<<endl;
		RDCDMUBFErrorMsgBox("生成包络体失败");
		return;
	}
	else
		cout<<"Succeed ComputeSweptVolumesFromReplay"<<endl;

	//输出列表长度
	long arraySize = GetVariantArraySize(oSweptVolumeDocuments);
	cout<<"arraySize: "<<arraySize<<endl;

	//获得输出的包络列表
	CATBaseDispatch ** ioObjectArrayOut = new CATBaseDispatch *[arraySize];
	//long ret = ConvertSafeArrayVariant(pArrayVariant, ioObjectArrayOut, 3);
	long ret = ConvertSafeArrayVariant(oSweptVolumeDocuments, ioObjectArrayOut, 1);
	cout<<"ret: "<<ret<<endl;

	cout<<ioObjectArrayOut[0]<<endl;
	//cout<<ioObjectArrayOut[1]<<endl;
	//cout<<ioObjectArrayOut[2]<<endl;

	for (int i=0;i<arraySize;i++)
	{
		CATIADocument_var spADoc = NULL_var; 
		if ( ret > 0 ) 
		{ 
			spADoc = ioObjectArrayOut[i]; 
		} 
		if ( !!spADoc ) 
		{ 
			rc = spADoc->Activate();
			rc = spADoc->Save();

			//CATUnicodeString strFullPath = "E:\\项目\\上汽商用车\\滑移门\\afterdlgFailed\\Test\\Rod.1_.cgr";

			int index=CgrFilePath.SearchSubString(".cgr",0,CATUnicodeString::CATSearchModeBackward);

			//获取时间
			time_t rawtime;

			time ( &rawtime );
			//printf("%ld\n", &rawtime);
			//printf ( "The current local time is: %s", ctime (&rawtime) );

			char * time = ctime(&rawtime);
			//ctime(&rawtime) : time_t/timestampe -> "Www Mmm dd hh:mm:ss yyyy" format
			cout<< time << endl;
			//printf("%s", asctime(gmtime(&rawtime)));// asctime(gmtime(&rawtime)) = ctime(&rawtime);
			//here gmtime(&rawtime) : time_t(timpstampe) -> struct tm
			//here asctime(gmtime) : struct tm -> "Www Mmm dd hh:mm:ss yyyy" format 


			struct tm * ptm;
			ptm = gmtime(&rawtime);

			cout<<(ptm->tm_year + 1900)<<"year "<<(ptm->tm_mon + 1)<<"month "<<(ptm->tm_mday)<<"day "<<(ptm
				->tm_hour)<<":"<<(ptm->tm_min)<<":"<<(ptm->tm_sec)<<endl;
			CATUnicodeString timeyear;
			CATUnicodeString timemonth;
			CATUnicodeString timeday;
			CATUnicodeString timehour;
			CATUnicodeString timemin;
			CATUnicodeString timesec;

			timeyear.BuildFromNum(ptm->tm_year + 1900);
			timemonth.BuildFromNum(ptm->tm_mon + 1);
			timeday.BuildFromNum(ptm->tm_mday);
			timehour.BuildFromNum(ptm->tm_hour+8);
			timemin.BuildFromNum(ptm->tm_min);
			timesec.BuildFromNum(ptm->tm_sec);




			CATUnicodeString timestamp;
			//timestamp.BuildFromNum(i);
			timestamp=timeyear+timemonth+timeday+timehour+timemin+timesec;

			cout<<"timestamp="<<timestamp<<endl;
			CgrFilePath.Insert(index,timestamp);

			cout<<"1"<<endl;
			CATBSTR bstrFullPath;
			CgrFilePath.ConvertToBSTR(&bstrFullPath);//strFullPath
			cout<<"12"<<endl;

			rc = spADoc->SaveAs(bstrFullPath);
			cout<<"rc="<<rc<<endl;
			cout<<"122"<<endl;
			if (FAILED(rc))
			{
				cout<<"保存cgr失败！！！！"<<endl;
				return;
			}
			cout<<"123"<<endl;

		} 
		else
			cout<<"spADoc = NULL"<<endl;

	}

	cout<<"1234"<<endl;



}

//-------------------------------------------------------------------------
// Callback on DiaOK of _SweepPrtDlg
//-------------------------------------------------------------------------
void TestCmd::OnSweepPrtDlgDiaOKNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	if ( _HSO ) 
	{
		_HSO -> Empty();}


		_Panel->_SelectorList161->SetLine("已选择",0,CATDlgDataModify);



	if (_pSweptOKAgent!=NULL)
	{
		_pSweptOKAgent->InitializeAcquisition();
	}
	_SweepPrtPanel->SetVisibility(CATDlgHide);
}


//-------------------------------------------------------------------------
// Callback on DiaCANCEL of _SweepPrtDlg
//-------------------------------------------------------------------------
void TestCmd::OnSweepPrtDlgDiaCANCELNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	if ( _HSO ) 
	{
		_HSO -> Empty();}
	if (_pSweptCancleAgent!=NULL)
	{
		_pSweptCancleAgent->InitializeAcquisition();
	}
	_SweepPrtPanel->SetVisibility(CATDlgHide);
}
void TestCmd::OnSweepPrtDlgDiCloseNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	if ( _HSO ) 
	{
		_HSO -> Empty();}
	if (_pSweptCloseAgent!=NULL)
	{
		_pSweptCloseAgent->InitializeAcquisition();
	}
	_SweepPrtPanel->SetVisibility(CATDlgHide);
}


CATBoolean TestCmd::ChooseSwetpPart(void * date)
{
	cout<<"ChooseSwetpPart函数中"<<endl;


	CATPathElement *pSwepTPartPathSel = _pSwepTPartAgent -> GetValue ();
	_HSO -> RemoveElement(pSwepTPartPathSel);


	CATIProduct_var piInstanceProd = pSwepTPartPathSel->FindElement( CATIProduct::ClassId());

	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	spSelPrdOnSweptPrd=piInstanceProd;


	cout<<"2"<<endl;
	_pSwepTPartAgent->InitializeAcquisition();


	pSwepTPartPathSel->InitToTopElement(); 
	CATBaseUnknown* piUk= NULL;

	pSwepTPartPathSel->NextChildElement();
	piUk= pSwepTPartPathSel->NextChildElement();

	CATPathElement *pFatherSwepTPartPathSel =new CATPathElement(piUk) ;

	_HSO -> AddElement (pFatherSwepTPartPathSel);
	//delete pFatherSwepTPartPathSel;    加上这一句点击结构树会崩溃
	//pFatherSwepTPartPathSel=NULL;





	if ( NULL != piUk ) 
	{
		cout<<"NULL != piUk "<<endl;
		CATIProduct* piCurrentProd=NULL;
			HRESULT rc = piUk->QueryInterface(IID_CATIProduct, 
			(void **)&piCurrentProd);

			if (SUCCEEDED(rc))
			{
				cout<<"SUCCEEDED(rc)"<<endl;
				CATIAlias_var aliasOnCurrentProd = piCurrentProd ;
				if ( NULL_var != aliasOnCurrentProd)
				{
					cout <<"当前所选扫略product是："<<aliasOnCurrentProd->GetAlias().ConvertToChar()<<endl ;
				}


				CATUnicodeString CurrentProdname=aliasOnCurrentProd->GetAlias();
				for (int i=1;i<=ListOfMechInvoPrd.Size();i++)
				{
					int m=CurrentProdname.Compare(ListOfMechInvoPrd[i]);
					if (m==2)
					{
						//LISTProdOfSwepTPart.Append(piCurrentProd);

						//_SweepPrtPanel->_SelectorList002->SetLine ( aliasOnCurrentProd->GetAlias() ,LISTProdOfSwepTPart.Size()-1, CATDlgDataModify );//aliasOnCurrentPrd->GetAlias()


						_SweepPrtPanel->_SelectorList002->ClearLine();
						LISTProdOfSwepTPart.RemoveAll();
						LISTProdOfSwepTPart.Append(piCurrentProd);

						for (int i = 1;i<=LISTProdOfSwepTPart.Size();i++)
						{

							CATIProduct_var spSweptpart=LISTProdOfSwepTPart[i];
							CATIAlias_var aliasOnCurrentProd = spSweptpart ;
							if ( NULL_var != aliasOnCurrentProd)
							{
								cout <<"当前List中扫略product是："<<aliasOnCurrentProd->GetAlias().ConvertToChar()<<endl ;
							}



						}



						_SweepPrtPanel->_SelectorList002->SetLine ( aliasOnCurrentProd->GetAlias() ,LISTProdOfSwepTPart.Size()-1, CATDlgDataModify );//aliasOnCurrentPrd->GetAlias()





						break;
					}
				}
				piCurrentProd->Release();
				piCurrentProd = NULL;
			}
	}



	return TRUE;
}

//-------------------------------------------------------------------------
// Callback on ListSelect of _SelectorList002
//-------------------------------------------------------------------------
void TestCmd::OnSelectorList002ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here

	if ( _HSO ) 
	{
		_HSO -> Empty();
	}


	if (NULL!=_pSweptelListAgent)
	{
		_pSweptelListAgent->InitializeAcquisition();
	}
}

//-------------------------------------------------------------------------
// Callback on PushBActivate of _PushButton186
//-------------------------------------------------------------------------
void TestCmd::OnPushButton186PushBActivateNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here 选择包络零件


	//得到mechanism中的除了固定件之外所涉及机构运动的product
	CATIKinMechanism* piMechanismToGetInvoPrd = NULL;
	CATIKinMechanismFactory* piMechanismFactoryOnDocument = NULL;
	HRESULT HR = pDoc->QueryInterface(IID_CATIKinMechanismFactory,(void**)&piMechanismFactoryOnDocument);
	if (SUCCEEDED(HR))
	{
		CATLISTP(CATBaseUnknown) ListOfMechanisms;
		HR = piMechanismFactoryOnDocument->ListInstances (ListOfMechanisms);
		if (SUCCEEDED(HR))
		{
			// Read all the mechanisms of the document
			int nbMechanisms = ListOfMechanisms.Size();
			if (0==nbMechanisms)
			{
				cout<<"此文档没有可用的机构"<<endl;
				RDCDMUBFErrorMsgBox("此文档没有可用的机构");
				if (_pSweptButtonAgent!=NULL)
				{
					_pSweptButtonAgent->InitializeAcquisition();
				}
				_SweepPrtPanel->SetVisibility(CATDlgShow);

				return;
			}
			CATBaseUnknown * pMechanism_bu = NULL;

			pMechanism_bu = ListOfMechanisms[nbMechanisms];//找最后生成的机构涉及的prd
			CATUnicodeString fixedprd;

			if (pMechanism_bu &&
				SUCCEEDED(pMechanism_bu->QueryInterface(IID_CATIKinMechanism,(void**)&piMechanismToGetInvoPrd)))
			{
				// Get the fixed product of the mechanism
				CATIProduct* piProductOnFixedProduct = NULL;
				if (SUCCEEDED(piMechanismToGetInvoPrd->GetFixedProduct(&piProductOnFixedProduct)))
				{
					CATIAlias* piAliasOnFixedProduct = NULL;
					if (SUCCEEDED(piProductOnFixedProduct->QueryInterface(IID_CATIAlias,(void**)&piAliasOnFixedProduct)))
					{
						fixedprd=piAliasOnFixedProduct->GetAlias();
						cout << "   Fixed part : " << piAliasOnFixedProduct->GetAlias().ConvertToChar() << endl << flush;
						piAliasOnFixedProduct->Release();
						piAliasOnFixedProduct = NULL;
					}
					spFixedProduct=piProductOnFixedProduct;
					piProductOnFixedProduct->Release();
					piProductOnFixedProduct = NULL;
				}

				// Get the list of the products involved in the mechanism
				int nbInvolvedProducts = 0;
				CATLISTP(CATBaseUnknown)* papiProductOfMechanism = NULL;
				HR = piMechanismToGetInvoPrd->GetProductList (&papiProductOfMechanism);
				if (SUCCEEDED(HR) && papiProductOfMechanism)
				{
					nbInvolvedProducts = papiProductOfMechanism->Size();

					cout << "   Products involved : " << nbInvolvedProducts << "; " << endl << flush;

					for (int i=1;i<=nbInvolvedProducts;i++)
					{
						CATIProduct* piProductOnInvolvedProduct = NULL;//(*papiProductOfMechanism)[i];
						HR = (*papiProductOfMechanism)[i]->QueryInterface(IID_CATIProduct,(void**)&piProductOnInvolvedProduct);


						CATIAlias* piAliasOnInvolvedProduct = NULL;
						if (SUCCEEDED(piProductOnInvolvedProduct->QueryInterface(IID_CATIAlias,(void**)&piAliasOnInvolvedProduct)))
						{
							CATUnicodeString nameofprd=piAliasOnInvolvedProduct->GetAlias();
							int m=nameofprd.Compare(fixedprd);


							if (m!=2)
							{
								ListOfMechInvoPrd.Append(nameofprd);

							}

							//cout << "   involved part : " << piAliasOnInvolvedProduct->GetAlias().ConvertToChar() << endl << flush;
							piAliasOnInvolvedProduct->Release();
							piAliasOnInvolvedProduct = NULL;
						}
						piProductOnInvolvedProduct->Release();
						piProductOnInvolvedProduct = NULL;
					}
					cout<<"传入的个数为："<<ListOfMechInvoPrd.Size()<<endl;

					delete papiProductOfMechanism;
					papiProductOfMechanism = NULL;






				}


				int oDOFWithoutCmd=1;
				int oDOFWithCmd=1;
				boolean oSimulationReady=FALSE;

				piMechanismToGetInvoPrd->GetStatus(&oDOFWithoutCmd,&oDOFWithCmd,&oSimulationReady);
				cout<<"oDOFWithoutCmd="<<oDOFWithoutCmd<<endl;
				cout<<"oDOFWithCmd="<<oDOFWithCmd<<endl;

				if (oSimulationReady)
				{
					cout<<"此机构可以仿真！！！"<<endl;
				}





				CATLISTP(CATBaseUnknown)* cmdList = NULL;
				CATBaseUnknown * pCmd_bu = NULL;
				HR = piMechanismToGetInvoPrd->GetCmdList(&cmdList);
				if (SUCCEEDED(HR) && cmdList)
				{
					cout << "   Command" <<endl;

					int nbCmds = cmdList->Size();
					for (int l = 1;l<=nbCmds;l++)
					{
						cout << "      " << l << " : ";
						CATIKinCmd* piCmd = NULL;
						pCmd_bu = (*cmdList)[l];

						if (pCmd_bu)
						{
							if (SUCCEEDED(pCmd_bu->QueryInterface(IID_CATIKinCmd,(void**)&piCmd)))
							{

								// Get the command type
								const char* cmdType = NULL;
								HR =piCmd->GetType(&cmdType);
								if (SUCCEEDED(HR)) 
								{
									cout << cmdType << "; ";
								}

								// Get the joint associated to the command
								CATIKinJoint* papiAssociatedJoint = NULL; 
								HR =piCmd->GetJoint(&papiAssociatedJoint);
								if (SUCCEEDED(HR))
								{
									cout << "joint Ok;";
									papiAssociatedJoint->Release();
									papiAssociatedJoint = NULL;
								}
								cout << endl << flush;
								piCmd->Release();
								piCmd = NULL;
							}
							pCmd_bu->Release();
							pCmd_bu = NULL;
						}
					}
					cout << "   EndCommand" << endl << flush;

					//Get the value of each command of the mechanism
					int size=1;
					double* ListCommandValue;
					HR = piMechanismToGetInvoPrd->GetCmdValues(&size,&ListCommandValue);
					if (SUCCEEDED(HR))
					{
						cout << "   Command values : ";
						cout << *ListCommandValue << "; ";
						cout << endl << flush;
					}

					//double a=20;
					//double* ListCommandValueToSet=&a;

					//piMechanism->SetCmdValues(1,ListCommandValueToSet);

					//piMechanism->GetProductMotion()

					if (cmdList)
					{
						delete cmdList;
						cmdList = NULL;
					}
				}








				// Clean the environment
				piMechanismToGetInvoPrd->Release();
				piMechanismToGetInvoPrd = NULL;



				// Release the elements of the list
				for (int i = 1;i<=nbMechanisms;i++)
				{
					pMechanism_bu = ListOfMechanisms[i];
					if (pMechanism_bu)
					{
						pMechanism_bu->Release();
						pMechanism_bu = NULL;
					}
				}
				ListOfMechanisms.RemoveAll();

				piMechanismFactoryOnDocument->Release();
				piMechanismFactoryOnDocument = NULL;
			}


		}

	}

	//得到mechanism中的除了固定件之外所涉及机构运动的product



	cout<<"OnPushButton196PushBActivateNotification"<<endl;
	if (_pSweptButtonAgent!=NULL)
	{
		_pSweptButtonAgent->InitializeAcquisition();
	}
	_SweepPrtPanel->SetVisibility(CATDlgShow);
}
void TestCmd::OnSelectorList159ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	if (NULL!=_pRefListAgent)
	{
		_pRefListAgent->InitializeAcquisition();
	}

	if ( _HSO||NULL!=pRefPartPathSel ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pRefPartPathSel);
		_HSO -> EndAddElements ();

	}
}

CATBoolean TestCmd::ChooseRefPart(void * date)
{


	if (NULL==_pRefPartAgent)		
	{
		cout<<"面代理为空"<<endl;
		return TRUE;
	}


	pRefPartPathSel = _pRefPartAgent -> GetValue ();

	CATIProduct_var piInstanceProd = pRefPartPathSel->FindElement( CATIProduct::ClassId());
	CATUnicodeString oName ;
	piInstanceProd->GetPrdInstanceName(oName);
	spRefPrd=piInstanceProd;

	if ( _HSO ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pRefPartPathSel);
		_HSO -> EndAddElements ();
		//_HSO = NULL;
	}

	//CATBaseUnknown *ppSelection=NULL;
	//ppSelection= _pRefPartAgent->GetElementValue(_pRefPartAgent->GetValue());

	//CATIBRepAccess * BrepOnUpRollingFace=NULL;

	//HRESULT	rc = ppSelection -> QueryInterface(IID_CATIBRepAccess,(void**)&BrepOnUpRollingFace );
	//if ( FAILED(rc) || ( NULL == BrepOnUpRollingFace) ) 
	//{
	//	cout<<"失败IID_CATIBRepAccess！！！！！"<<endl;
	//	return FALSE;

	//}

	//spLastFeaOnRefPrd=BrepOnUpRollingFace->GetLastFeature();

	//if (NULL_var==spLastFeaOnRefPrd)
	//{
	//	cout<<"没有得到参考零件的LastFeature"<<endl;
	//}
	//BrepOnUpRollingFace->Release();
	//BrepOnUpRollingFace=NULL;



	CATIAlias_var aliasOnCurrentProd = spRefPrd ;



	_Panel->_SelectorList159->SetLine ( aliasOnCurrentProd->GetAlias() ,0, CATDlgDataModify );//aliasOnCurrentPrd->GetAlias()

	int iNumberOfSelectedLines[1];
	iNumberOfSelectedLines[0]=0;
	int iArraySize = 1;
	int iNotify = 0;
	_Panel->_SelectorList159->SetSelect(iNumberOfSelectedLines,
		iArraySize, iNotify);



	_pRefPartAgent->InitializeAcquisition();



	return TRUE;
}

//double TestCmd::GetMinDistance(CATISpecObject_var spiFirstOb,CATISpecObject_var spiSecOb)
//{
//
//	CATIMeasurableInContext_var spiMeasureCenContext=spiSecOb;
//	CATIMeasurable_var spiMeasureCen=spiSecOb;
//	CATMathAxis UpRotateAxis;
//	HRESULT rc=spiMeasureCenContext->GetAxisSystemFromMeasurable(UpRotateAxis);
//	CATMathPoint p1OnPt;
//	CATMathPoint p2OnRailFace;
//
//	double mindis=0;
//	CATIMeasurableInContext_var spiMeasureRail=spiFirstOb;
//	spiMeasureRail->MinimumDistance(spiMeasureCen,UpRotateAxis,mindis,p1OnPt,p2OnRailFace);
//	return mindis;
//
//}
double TestCmd::GetMinDistance(CATISpecObject_var spiFirstOb,CATISpecObject_var spiSecOb,CATIProduct_var ispProduct1,CATIProduct_var ispProduct2)
{

	HRESULT rc = E_FAIL;
	CATIMeasurableInContext * pMeasurableInContext = NULL;
	rc = spiSecOb->QueryInterface(IID_CATIMeasurableInContext,(void**)&pMeasurableInContext);
	if (FAILED(rc)||!pMeasurableInContext)
	{
		cout<<"无法转换到测量接口"<<endl;
		return 0;

	}

	CATIMeasurable* pMeas = NULL;
	rc = spiFirstOb->QueryInterface(IID_CATIMeasurable,(void**)&pMeas);
	if (FAILED(rc)||!pMeas)
	{
		cout<<"无法转换到测量接口"<<endl;
		return 0;

	}
	CATIMeasurable_var spMeas = pMeas;
	if (!spMeas)
	{
		cout<<"转换只能接口错误"<<endl;
		return 0;

	}
	//1
	CATIMovable_var spiMoveOnChild = ispProduct1;
	CATMathTransformation RotateTransformation;
	RotateTransformation = spiMoveOnChild->GetPosition(NULL_var);
	CATMathAxis axis;
	CATMathAxis  rotateAxis = RotateTransformation*axis;
	//2
	spiMoveOnChild = ispProduct2;
	CATMathTransformation baseTransformation;
	baseTransformation = spiMoveOnChild->GetPosition(NULL_var);
	CATMathAxis  baseAxis = baseTransformation*axis;
	CATMathTransformation trans =CATMathTransformation(baseAxis, CATMathOIJK)* CATMathTransformation(CATMathOIJK, CATMathOIJK);
	//Result
	CATMathAxis  newAxis = trans*rotateAxis;
	CATMeasModeOfCalc  ComputationMode = CATMeasExactThenApproxMode;// CATMeasExactMode
	pMeasurableInContext->SetComputationMode(ComputationMode);//
	double oMinimalDistance=0;
	CATMathPoint oPointonProduct1;
	CATMathPoint oPointonProduct2;
	pMeasurableInContext->MinimumDistance(spMeas,newAxis,oMinimalDistance,oPointonProduct1,oPointonProduct2);
	return oMinimalDistance;

}
HRESULT TestCmd::GetDistanceBetweenProductsAtPosition(CATIProduct_var ispProduct1,CATIProduct_var ispProduct2,
																		double& oMinimalDistance,CATMathPoint & oPointonProduct1,CATMathPoint & oPointonProduct2)
{
	HRESULT rc = E_FAIL;
	CATIMeasurableInContext * pMeasurableInContext = NULL;
	rc = ispProduct2->QueryInterface(IID_CATIMeasurableInContext,(void**)&pMeasurableInContext);
	if (FAILED(rc)||!pMeasurableInContext)
		return E_FAIL;

	CATIMeasurable* pMeas = NULL;
	rc = ispProduct1->QueryInterface(IID_CATIMeasurable,(void**)&pMeas);
	if (FAILED(rc)||!pMeas)
		return E_FAIL;
	CATIMeasurable_var spMeas = pMeas;
	if (!spMeas)
		return E_FAIL;
	//1
	CATIMovable_var spiMoveOnChild = ispProduct1;
	CATMathTransformation RotateTransformation;
	RotateTransformation = spiMoveOnChild->GetPosition(NULL_var);
	CATMathAxis axis;
	CATMathAxis  rotateAxis = RotateTransformation*axis;
	//2
	spiMoveOnChild = ispProduct2;
	CATMathTransformation baseTransformation;
	baseTransformation = spiMoveOnChild->GetPosition(NULL_var);
	CATMathAxis  baseAxis = baseTransformation*axis;
	CATMathTransformation trans =CATMathTransformation(baseAxis, CATMathOIJK)* CATMathTransformation(CATMathOIJK, CATMathOIJK);
	//Result
	CATMathAxis  newAxis = trans*rotateAxis;
	CATMeasModeOfCalc  ComputationMode = CATMeasExactThenApproxMode;// CATMeasExactMode
	pMeasurableInContext->SetComputationMode(ComputationMode);//
	pMeasurableInContext->MinimumDistance(spMeas,newAxis,oMinimalDistance,oPointonProduct1,oPointonProduct2);


	//得到mathpoint2

	CATMathTransformation InverseRefPrtPosition;

	trans.ComputeInverse(InverseRefPrtPosition);

	oPointonProduct2=InverseRefPrtPosition*oPointonProduct2;

	return S_OK;
}

void TestCmd::OnSelectorListMdRot2ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	cout<<"OnSelectorListMdRot2ListSelectNotification"<<endl;
	if (_pRotateFaceSelLis6Agent!=NULL)
	{
		_pRotateFaceSelLis6Agent->InitializeAcquisition();
	}
	if ( _HSO||NULL!=pMidRotateFacePathSel2 ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pMidRotateFacePathSel2);
		_HSO -> EndAddElements ();

	}


	if (_RotatePanel->_SelectorList006->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList006->ClearSelect();
	}
	if (_RotatePanel->_SelectorList007->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList007->ClearSelect();
	}
	if (_RotatePanel->_SelectorList012->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList012->ClearSelect();
	}
	if (_RotatePanel->_SelectorList014->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList014->ClearSelect();
	}
	if (_RotatePanel->_SelectorList008->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList008->ClearSelect();
	}//SelectorListDnRot2
	if (_RotatePanel->_SelectorListDnRot2->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorListDnRot2->ClearSelect();
	}

	_RotatePanel->_Label015-> SetIconName("daoxiangb");

	_RotatePanel->_Label015->Refresh();
	_RotatePanel->Refresh();


}

void TestCmd::OnSelectorListDnRot2ListSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here
	cout<<"OnSelectorListDnRot2ListSelectNotification"<<endl;
	if (_pRotateFaceSelLis7Agent!=NULL)
	{
		_pRotateFaceSelLis7Agent->InitializeAcquisition();
	}


	if ( _HSO||NULL!=pDownRotateFacePathSel2 ) 
	{
		_HSO -> Empty();
		_HSO -> AddElements (pDownRotateFacePathSel2);
		_HSO -> EndAddElements ();

	}


	if (_RotatePanel->_SelectorList006->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList006->ClearSelect();
	}
	if (_RotatePanel->_SelectorList007->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList007->ClearSelect();
	}
	if (_RotatePanel->_SelectorList012->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList012->ClearSelect();
	}
	if (_RotatePanel->_SelectorList014->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList014->ClearSelect();
	}
	if (_RotatePanel->_SelectorList008->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorList008->ClearSelect();
	}
	if (_RotatePanel->_SelectorListMdRot2->IsSelect(0)==TRUE)
	{

		_RotatePanel->_SelectorListMdRot2->ClearSelect();
	}

	_RotatePanel->_Label015-> SetIconName("daoxiangb");

	_RotatePanel->_Label015->Refresh();
	_RotatePanel->Refresh();

}

void TestCmd::OnCombo132ComboSelectNotification(CATCommand* cmd, CATNotification* evt, CATCommandClientData data)
{
	// Add your code here

cout<<"OnCombo132ComboSelectNotification"<<endl;

int lineNum=_Panel->_Combo132->GetSelect();
cout<<"选择的是："<<lineNum<<endl;
if (0==lineNum)
{
	_RotatePanel->_Frame010->SetTitle("上滚轮");
	_RotatePanel->_Frame010->Refresh();
	_RotatePanel->Refresh();

	_RotatePanel->_Frame001->SetTitle("下滚轮");
	_RotatePanel->_Frame001->Refresh();
	_RotatePanel->Refresh();

	_RailPanel->_Frame015->SetTitle("上轨道");
	_RailPanel->_Frame015->Refresh();
	_RailPanel->Refresh();

	_RailPanel->_Frame001->SetTitle("下轨道");
	_RailPanel->_Frame001->Refresh();
	_RailPanel->Refresh();




	_Panel->_PushButton166->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton186->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton196->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton133->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton135->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton136->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton139->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton140->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton144->SetSensitivity(CATDlgEnable);
	//_Panel->_PushButton187->SetSensitivity(CATDlgEnable);
	//_Panel->_PushButton192->SetSensitivity(CATDlgEnable);
	//_Panel->_PushButton195->SetSensitivity(CATDlgEnable);
} 
else if(1==lineNum)
{
	_RotatePanel->_Frame010->SetTitle("下滚轮");
	_RotatePanel->_Frame010->Refresh();
	_RotatePanel->Refresh();

	_RotatePanel->_Frame001->SetTitle("上滚轮");
	_RotatePanel->_Frame001->Refresh();
	_RotatePanel->Refresh();

	_RailPanel->_Frame015->SetTitle("下轨道");
	_RailPanel->_Frame015->Refresh();
	_RailPanel->Refresh();

	_RailPanel->_Frame001->SetTitle("上轨道");
	_RailPanel->_Frame001->Refresh();
	_RailPanel->Refresh();

	_Panel->_PushButton166->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton186->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton196->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton133->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton135->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton136->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton139->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton140->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton144->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton187->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton192->SetSensitivity(CATDlgEnable);
	_Panel->_PushButton195->SetSensitivity(CATDlgEnable);

}
else
{
	cout<<"什么都没选"<<endl;
}



}






HRESULT TestCmd::SMCCopyPasteSpecObject(CATISpecObject_var ispiSpecOnChild,CATISpecObject_var ispiSpecOnNewFather,CATISpecObject_var &ospiSpecOnNew,CATBoolean iLink)
{
	HRESULT rc=E_FAIL;

	if( !ispiSpecOnChild || !ispiSpecOnNewFather ) return rc;

	CATMmrInterPartCopy *actionCP=new CATMmrInterPartCopy(ispiSpecOnChild,ispiSpecOnNewFather);
	if( !actionCP ) return rc;

	int iMode=3; // Copy attribute and color
	rc = actionCP->SetAttributeMode(iMode);
	rc = actionCP->SetLinkMode(iLink);

	CATUnicodeString erroMessage;
	rc = actionCP->Run(&erroMessage);
	if( FAILED(rc) ) {
		cout << "==> Error in Run CopyPaste: " << erroMessage.ConvertToChar() << endl;
		return rc;
	}

	rc = actionCP->GetResult(ospiSpecOnNew);

	CATIAlias_var spiSourceAlias=ispiSpecOnChild;
	CATIAlias_var spiTargetAlias=ospiSpecOnNew;

	CATUnicodeString specAlias;
	if( !!spiSourceAlias )
		specAlias = spiSourceAlias->GetAlias();
	if( !!spiTargetAlias )
		spiTargetAlias->SetAlias(specAlias);

	//spiSpecResult->Update();

	ispiSpecOnNewFather->Update();

	delete actionCP;  actionCP = NULL;

	return rc;
}

HRESULT TestCmd::SJDCutPasteSpecObject(CATISpecObject_var ispiSpecOnChild,CATISpecObject_var ispiSpecOnNewFather)
{
	HRESULT rc=E_FAIL;

	if( !ispiSpecOnChild || !ispiSpecOnNewFather ) return rc;

	//Get current work object
	CATIMechanicalFeature_var spiMechanicalFeat=ispiSpecOnNewFather;

	CATISpecObject_var spiSpecOnOldCurrentObject=NULL_var;
	CATISpecObject_var spiSpecOnPrtPart=NULL_var;
	if( !!spiMechanicalFeat )
		spiSpecOnPrtPart = spiMechanicalFeat->GetPart();
	CATIPrtPart_var spiPrtPart=spiSpecOnPrtPart;
	if( !!spiPrtPart )
		spiSpecOnOldCurrentObject = spiPrtPart->GetCurrentFeature();

	//Get the feature container
	CATIContainer_var spiTargetContainer=ispiSpecOnNewFather->GetFeatContainer();
	CATIContainer_var spiSourceContainer=ispiSpecOnChild->GetFeatContainer();
	if( !spiTargetContainer || !spiSourceContainer )  return rc;

	//Get the CATICutAndPastable of source and target
	CATICutAndPastable *piTargetCutPastable=NULL;
	rc = spiTargetContainer->QueryInterface(IID_CATICutAndPastable,(void **)&piTargetCutPastable);
	CATICutAndPastable_var spiTargetCutPastable=piTargetCutPastable;
	if( !!piTargetCutPastable ) { piTargetCutPastable->Release();  piTargetCutPastable = NULL; }
	if( !spiTargetCutPastable )	return rc;

	CATICutAndPastable *piSourceCutPastable=NULL;
	rc = spiSourceContainer->QueryInterface(IID_CATICutAndPastable,(void **)&piSourceCutPastable);
	CATICutAndPastable_var spiSourceCutPastable=piSourceCutPastable;
	if( !!piSourceCutPastable ) { piSourceCutPastable->Release();  piSourceCutPastable = NULL; }
	if( !spiSourceCutPastable )	return rc;

	//The object to be copied and pasted
	ListOfVarBaseUnknown newListToCopy;
	ListOfVarBaseUnknown listFromCopy;
	listFromCopy.Append((CATBaseUnknown *)ispiSpecOnChild);

	//Copye the list object to the clipboard
	int RC;
	RC = spiSourceCutPastable->BoundaryExtract(newListToCopy,&listFromCopy,NULL);
	if( !RC )	return E_FAIL;

	//Get the object of clipboard
	VarBaseUnknown pExtractedList;
	pExtractedList = spiSourceCutPastable->Extract(newListToCopy,NULL);

	CATICutAndPastable_var spiExtractCutPastable=pExtractedList;
	if( !spiExtractCutPastable ) return E_FAIL;

	//Get the object in the clipboard
	ListOfVarBaseUnknown extractedListToCopy;
	RC = spiExtractCutPastable->BoundaryExtract(extractedListToCopy,NULL,NULL);
	if( !RC ) return E_FAIL;

	//We are in the CATPart document,so we should set current feature
	if( !!spiPrtPart ) {
		spiPrtPart->SetCurrentFeature(ispiSpecOnNewFather);
	}

	//Do the past operation
	ListOfVarBaseUnknown listPastedObjects;
	listPastedObjects = spiTargetCutPastable->Paste(extractedListToCopy,NULL,NULL);
	if( listPastedObjects.Size() != extractedListToCopy.Size() ) {
		cout << "==> There may be have some errors when do the paste !" << endl;
	}

	//Restore the old current feature
	if( !!spiSpecOnOldCurrentObject && !!spiPrtPart ) {
		spiPrtPart->SetCurrentFeature(spiSpecOnOldCurrentObject);
	}

	//Remove objects from source
	spiSourceCutPastable->Remove(listFromCopy,NULL);

	//Update all object
	if( !!spiSpecOnPrtPart )
		spiSpecOnPrtPart->Update();

	return rc;
}
HRESULT TestCmd::CopyAndPast(CATISpecObject_var iSourObject,CATIContainer_var ispTargetContainer)
{
	HRESULT rc=S_OK;

	if (iSourObject==NULL_var || ispTargetContainer==NULL_var)
	{
		return E_FAIL;
	}

	CATILinkableObject_var spLinkObjet= iSourObject;
	CATIPrtContainer *pTemp=NULL;
	CATIPrtContainer_var spSourceCon=NULL_var;
	if (spLinkObjet!=NULL_var)
	{
		CATDocument *pDocument=spLinkObjet->GetDocument();
		if (pDocument!=NULL)
		{	
			CATInit_var spInit=pDocument;
			if (spInit!=NULL_var)
			{
				const CATIdent idCATIPrtContainer = "CATIPrtContainer";
				pTemp = (CATIPrtContainer*) (spInit -> GetRootContainer(idCATIPrtContainer));
				if (pTemp!=NULL)
				{
					spSourceCon=pTemp;
					pTemp->Release();pTemp=NULL;
				}
			}
		}
	}

	if (spSourceCon==NULL_var)
	{
		return E_FAIL;
	}

	ListOfVarBaseUnknown newListToCopy;
	ListOfVarBaseUnknown listFromCopy;

	listFromCopy.Append(iSourObject);

	CATICutAndPastable_var piCutAndPastableOnSourceCont(spSourceCon);

	if (piCutAndPastableOnSourceCont==NULL_var)
	{
		return E_FAIL;
	}

	int result = piCutAndPastableOnSourceCont->BoundaryExtract(newListToCopy, &listFromCopy, NULL);
	if (result ==0)
	{
		return E_FAIL;
	}

	VarBaseUnknown pExtractedList;
	pExtractedList = piCutAndPastableOnSourceCont->Extract(newListToCopy, NULL);

	CATICutAndPastable *piCutAndPastableOnExtractedList = NULL;
	rc = pExtractedList -> QueryInterface(IID_CATICutAndPastable, (void**) &piCutAndPastableOnExtractedList);
	if (FAILED(rc))
	{
		return E_FAIL;
	}

	ListOfVarBaseUnknown extractedListToCopy;

	result = piCutAndPastableOnExtractedList->BoundaryExtract(extractedListToCopy, NULL, NULL);

	if (result == 0)
	{	
		piCutAndPastableOnExtractedList->Release();
		piCutAndPastableOnExtractedList = NULL;
		return E_FAIL;
	}

	piCutAndPastableOnExtractedList->Release();
	piCutAndPastableOnExtractedList = NULL;

	CATICutAndPastable_var piCutAndPastableOnTargetCont(ispTargetContainer);
	if(NULL_var == piCutAndPastableOnTargetCont)
	{
		return E_FAIL;
	}

	//CATLISTP(CATFormat) format = piCutAndPastableOnTargetCont->ListPasteFormats();
	//CATFormat *asResultWithOutLink = NULL;
	//for(int i = 1; i <= format.Size(); i++)
	//{
	//	cout << format[i]->Name() << endl;
	//	if(0 == strcmp("CATPrtResult", format[i]->Name()))
	//	{
	//		cout << "Found format: " << format[i]->Name() << endl;
	//		asResultWithOutLink = format[i];
	//		break;
	//	}
	//}

	ListOfVarBaseUnknown listPastedObjects;
	listPastedObjects = piCutAndPastableOnTargetCont->Paste(extractedListToCopy, NULL, NULL);
	if (listPastedObjects.Size() == 0)
	{
		return E_FAIL;
	}

	//if (spSourceCon!=NULL_var)
	//{
	//	CATIPrtPart_var spPart=spSourceCon->GetPart();
	//	CATISpecObject_var(spPart)->Update();
	//}

	listPastedObjects.RemoveAll();
	extractedListToCopy.RemoveAll();
	newListToCopy.RemoveAll();
	listFromCopy.RemoveAll();
	return S_OK;

}

CATISpecObject_var TestCmd::CopyWithLinkOnBRep(CATIProduct_var spPrdSrc, CATIBRepAccess_var spBrepSrc, CATIProduct_var spPrdTgt, CATISpecObject_var spSpecTgt, CATBoolean bLink)
{
	CATMmrInterPartCopy* ptCATMmrInterPartCopy = NULL;
	ptCATMmrInterPartCopy = new CATMmrInterPartCopy (spBrepSrc, spSpecTgt);
	ptCATMmrInterPartCopy->SetSourceInstance(spPrdSrc);
	ptCATMmrInterPartCopy->SetTargetInstance(spPrdTgt);
	//ptCATMmrInterPartCopy->SetImportApplicativeId(guidApplicative);
	ptCATMmrInterPartCopy->SetLinkMode(bLink);

	//int iMode=0; // Copy attribute and color
	//ptCATMmrInterPartCopy->SetAttributeMode(iMode);

	CATUnicodeString ErrorMsg;
	HRESULT rc = ptCATMmrInterPartCopy->Run(&ErrorMsg);
	if ( FAILED(rc) ){
		cout <<"  CopyWithLink: " << ErrorMsg.CastToCharPtr() << endl;
		return NULL_var;
	}

	CATISpecObject_var spCopyResult = NULL_var;
	rc = ptCATMmrInterPartCopy->GetResult(spCopyResult);
	if ( FAILED(rc) || (NULL_var == spCopyResult) )
		return NULL_var;

	delete ptCATMmrInterPartCopy;
	ptCATMmrInterPartCopy = NULL;

	return spCopyResult;
}

void TestCmd::UpdateProduct(CATIProduct * iProduct)
{
	cout<<"At PlateFrameCmd::UpdateProduct"<<endl;
	if( !iProduct )
	{
		cout<<"product为空！无法更新"<<endl;
		return;
	}

	CATIProduct_var spRootProduct=iProduct;
	CATIModelEvents_var spEvents = spRootProduct; 
	CATModify ModifyEvent(spRootProduct); 
	if( !!spEvents )
	{
		spEvents -> Dispatch (ModifyEvent); 	

	}

	CATIRedrawEvent_var spRedraw = spRootProduct; 
	if( !!spRedraw )
	{
		spRedraw -> Redraw();

	}

}

HRESULT TestCmd::GetContainerOfPartDoc(CATDocument *ipDocument,SJDContainerType iConType,CATIContainer_var &ospiContainer)
{
	HRESULT rc=E_FAIL;
	ospiContainer = NULL_var;
	if( !ipDocument || !(ipDocument->IsAKindOf("CATPart")) ) return rc;

	//The current document is a CATPart document
	CATIContainer *piContainer=NULL;
	CATIContainerOfDocument *piContainerOfDocument=NULL;
	rc = ipDocument->QueryInterface(IID_CATIContainerOfDocument,(void**)&piContainerOfDocument);
	// Get the CATIContainer
	if( SUCCEEDED(rc) && !!piContainerOfDocument ) {
		switch( iConType ) {
			case CGMContainer:
				rc=piContainerOfDocument->GetResultContainer(piContainer);
				break;
			case SpecContainer:
				rc=piContainerOfDocument->GetSpecContainer(piContainer);
				break;
			case ProductContainer:
				rc=piContainerOfDocument->GetProductContainer(piContainer);
				break;
			case BRepContainer:
				rc=piContainerOfDocument->GetBRepContainer(piContainer);
				break;
			default:
				break;
		}

		piContainerOfDocument->Release();  piContainerOfDocument = NULL;
	}

	if( SUCCEEDED(rc) && !!piContainer ) {
		ospiContainer = piContainer;
		piContainer->Release(); piContainer = NULL;
	}
	else
		rc = E_FAIL;

	return rc;
}

HRESULT TestCmd::CopyGeoObjectFromOneContainerToAnotherContainer(CATLISTP(CATCell) &ioListCell,CATGeoFactory *ipTargetGeoFactory)
{
	HRESULT rc=E_FAIL;
	if( !ipTargetGeoFactory || ioListCell.Size() < 1 ) return rc;

	CATSoftwareConfiguration *pConfig=new CATSoftwareConfiguration();
	CATCloneManager *pCloneManager=new CATCloneManager(ipTargetGeoFactory,CatCGMSingleDuplicate,pConfig);
	if( !pCloneManager ) { if( !!pConfig ) { pConfig->Release(); pConfig = NULL; } return rc;}

	CATCell *pCell=NULL;
	CATCell *pCellCloned=NULL;
	CATLISTP(CATCell) listResult;
	for(int i=1;i<=ioListCell.Size();i++) {
		pCell = ioListCell[i];
		if( !pCell ) continue;

		pCloneManager->Add(pCell);
		pCloneManager->Run();
		pCellCloned = (CATCell *)pCloneManager->ReadImage(pCell);
		if( !pCellCloned ) continue;

		listResult.Append(pCellCloned);
	}

	//Free memory
	if( !!pConfig ) { pConfig->Release(); pConfig = NULL; }
	if( !!pCloneManager ) { delete pCloneManager; pCloneManager = NULL; }

	//Reset the result
	ioListCell.RemoveAll();
	for(int i=1;i<=listResult.Size();i++) {
		pCellCloned = listResult[i];
		if( !pCellCloned ) continue;

		ioListCell.Append(pCellCloned);
	}
	listResult.RemoveAll();

	return S_OK;
}
